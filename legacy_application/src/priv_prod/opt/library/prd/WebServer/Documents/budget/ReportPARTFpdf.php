<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseextract($_REQUEST);if($rep==""){include_once("menu.php");echo "<div align='center'><form action='ReportPARTF.php'><table><tr><td>Start Date (yyyymmdd): <input type='text' name='start' size='10' value='$start'></td><td>End Date (yyyymmdd): <input type='text' name='end' size='10' value='$end'></td><td>Current Report Month: <input type='text' name='reportMonth' size='10' value='$reportMonth'><input type='submit' name='submit' value='Find'></form></td></tr></table><form></div>";}include_once("partf_fund_total.php");$where="where reportDisplay='Y' and datePost!='' and active='y'";$fldPARTF="tempPARTF";//*********** SWITCH ***************	switch ($g) {		case "county":$select="DISTINCT partf_projects.county, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY countyORDER BY county";	$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$bond_fund,$state_appro,$reserve_proj,$design,$construction,$partfid,$amt,$credit);}			break;			case "dist":$select="DISTINCT partf_projects.dist, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY distORDER BY dist";	$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$bond_fund,$state_appro,$reserve_proj,$design,$construction,$partfid,$amt,$credit);}			break;			case "park":$select="DISTINCT partf_projects.park, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY parkORDER BY park";	$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$bond_fund,$state_appro,$reserve_proj,$design,$construction,$partfid,$amt,$credit);}			break;			case "Center":$select="DISTINCT partf_projects.Center, sum(partf_payments.amount) as amt,funds.creditFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_numLEFT JOIN funds on partf_projects.projNum=funds.projNum$whereGROUP BY CenterORDER BY Center";	$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$bond_fund,$state_appro,$reserve_proj,$design,$construction,$partfid,$amt,$credit);}			break;			case "comp":// First get the allocated funds in an array$where="where reportDisplay='Y'";			$select="DISTINCT comp, sum(funds.credit) AS creditFROM partf_projects LEFT JOIN funds ON partf_projects.projNum = funds.projNum$whereGROUP  BY comp";$sql = "SELECT $select";//echo "$sql";exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$arrayCom[]=$comp;$arrayCredit[]=$credit;}// Next get the payments in an array$where="where reportDisplay='Y' and datePost!=''";			$select="DISTINCT comp, sum(partf_payments.amount) as amtFROM partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP  BY comp";$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");while($row=mysqli_fetch_array($result)){extract($row);$arrayAmt[]=$amt;}for($i=0;$i<$num;$i++){// now output values$amt=$arrayAmt[$i];$credit=$arrayCredit[$i];$comp=$arrayCom[$i];makeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$bond_fund,$state_appro,$reserve_proj,$design,$construction,$partfid,$amt,$credit);}			break;			default:// *******************************************************// Get Info for All Account and creditif($sort){$orderby="ORDER BY $sort";}else{$orderby="ORDER BY comp,budgecode DESC,partf_projects.Center";}$orderby="ORDER BY comp,YearFundC DESC,partf_projects.Center";//echo "<pre>";print_r($_REQUEST);//print_r($_SESSION);echo "</pre>";//echo "s=$s";//exit;$select="partf_projects.projNum,".$fldPARTF.".credit,YearFundC,Center,budgCode,comp,proj_man,YearFundF,fullname,dist,county,projName,startDate,endDate,design,construction,statusPer,commentsFrom partf_projects LEFT JOIN $fldPARTF on partf_projects.projNum=".$fldPARTF.".projNumwhere reportDisplay='Y' GROUP BY partf_projects.projNum$orderby";$sql = "SELECT $select";$passSQL=$sql;echo "1  $sql";//exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$arrayAllCredits[$projNum]=$credit;$arrayYearFundC[$projNum]=$YearFundC;$arrayCenter[$projNum]=$Center;$arraybudgCode[$projNum]=$budgCode;$arraycomp[$projNum]=$comp;$arrayproj_man[$projNum]=$proj_man;$arrayYearFundF[$projNum]=$YearFundF;$arraypark[$projNum]=$fullname;$arraydist[$projNum]=$dist;$arraycounty[$projNum]=$county;$arrayprojName[$projNum]=$projName;$arraystartDate[$projNum]=$startDate;$arrayendDate[$projNum]=$endDate;if($design){$arraystatusPer[$projNum]="D-".$design;}if($construction){$arraystatusPer[$projNum]="C-".$construction;}if($statusPer=="OH"){$arraystatusPer[$projNum]="On Hold";}if($statusPer=="FI"){$arraystatusPer[$projNum]="Finished";}$arraycomments[$projNum]=$comments;}// Get ALL payments (only project numbers with payments are returned)// Need to merge with All Accounts credit$select="partf_projects.projNum, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY partf_projects.projNum$orderby";$sql = "SELECT $select";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$arrayAllPayments[$projNum]=$amt;}//echo "$sql<pre>";print_r($arrayAllPayments);echo "</pre>";exit;// Get SOME payments for date range (only project numbers with payments are returned)// Need to merge with All Accounts creditif($start){$ce="Current Activity ($start - $end)";$where=$where." and datenew!='na' and datenew>='$start' ";}if($end){$where=$where." and datenew!='na' and datenew<='$end' ";}$select="partf_projects.*, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY partf_projects.projNum$orderby";$sql = "SELECT $select";//echo "$sql";exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$arraySomePayments[$projNum]=$amt;// don't send $partf_approv_num use funds.credit instead}// end while//echo "$sql<pre>";print_r($arraySomePayments);echo "</pre>";exit;	}// end Switch//include("reports/displayDDP.php");include("reports/DENR-DPR_pdf.php");?>