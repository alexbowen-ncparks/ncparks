<?phpinclude("../../include/authWIYS.inc");// $e=code for an update error,  $u=code to return values after update/*echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";EXIT;*/// ************* After Update **********if($u==1){if($statusUpdate==""){$statusUpdate="1";}$Fname=$_SESSION[wiys][first];$Lname=$_SESSION[wiys][last];include("../../include/connectWIYS.inc");$sql = "select * from status where empID='$tempID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($statusInOut=="i"){$cIN="checked";}if($statusInOut=="u"){$cINU="checked";}if($statusInOut=="o"){$cOUT="checked";}if($statusInOut=="b"){$cBACK="checked";}if($statusInOut=="n"){$cBUS="checked";}if($statusInOut=="t"){$cTRIP="checked";}if($statusInOut=="l"){$cLEAV="checked";}if($statusInOut=="c"){$cCUS="checked";}// ************* Update Problem **************if($e!=""){if($e=="0"){$message="<tr><td><font color='blue' size=+1>You failed to specify the period of unavailability. Please correct.</font></td></tr>";$cINU="checked";}if($e=="1"){$message="<tr><td><font color='blue' size=+1>You failed to indicate your return time. Please correct.</font></td></tr>";$cBACK="checked";$cOUT="";}}// end if eheaderStuff($message);echo "<table><tr><td><input type='radio' name='status[]' value='i' $cIN><font color='green'>IN</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='u' $cINU><font color='green'>IN but unavailable from:</font></td><td><input type='text' size='30' name='status1[]' value='$statusUnavail'></td><td><a href='itinerary.php?tempID=$tempID&v=1' target='mainFrame'>Submit</a> Your Weekly Itinerary</td></tr><table><table><tr><td><input type='radio' name='status[]' value='o' $cOUT><font color='red'>OUT</font>&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='b' $cBACK><font color='red'>Back at: </font><input type='text' size='20' name='status1[]' value='$statusBack'></td><td><input type='radio' name='status[]' value='n' $cBUS><font color='red'>On business at: </font><input type='text' size='20' name='status1[]' value='$statusBus'></td></tr><tr><td> </td><td><input type='radio' name='status[]' value='t' $cTRIP><font color='red'>On trip until: </font><input type='text' size='20' name='status1[]' value='$statusTrip'></td><td><input type='radio' name='status[]' value='l' $cLEAV><font color='red'>On leave from: </font><input type='text' size='20' name='status1[]' value='$statusLeave'></td><td><input type='radio' name='status[]' value='c' $cCUS><font color='red'>Custom Message: </font><input type='text' size='30' name='status1[]' value='$statusCus'></td></tr>";//echo "<a href='status.php?tempID=$tempID' name='mainFrame'>test</a>";statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate);}// ************* Before Update *************if($u==""){$Fname=$_SESSION[wiys][first];$Lname=$_SESSION[wiys][last];//print_r($_SESSION);exit;include_once("../../include/connectWIYS.inc");$sql = "select * from status where empID='$tempID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($statusInOut=="i"){$cIN="checked";}if($statusInOut=="u"){$cINU="checked";}if($statusInOut=="o"){$cOUT="checked";}if($statusInOut=="b"){$cBACK="checked";}if($statusInOut=="n"){$cBUS="checked";}if($statusInOut=="t"){$cTRIP="checked";}if($statusInOut=="l"){$cLEAV="checked";}if($statusInOut=="c"){$cCUS="checked";}if($statusInOut==""){$cOUT="checked";$query = "REPLACE status SET statusInOut='o',statusUnavail='',statusCus='',statusBack='',statusBus='' ,statusTrip='',statusLeave='',empID='$tempID'";$result = mysql_query($query) or die ("Couldn't execute query. $query");}headerStuff($message);echo "<table><tr><td><input type='radio' name='status[]' value='i' $cIN><font color='green'>IN</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='u' $cINU><font color='green'>IN but unavailable from:</font></td><td><input type='text' size='30' name='status1[]' value='$statusUnavail'></td><td><a href='itinerary.php?tempID=$tempID&v=1' target='mainFrame'>Submit</a> Your Weekly Itinerary</td></tr><table><table><tr><td><input type='radio' name='status[]' value='o' $cOUT><font color='red'>OUT</font>&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='b' $cBACK><font color='red'>Back at: </font><input type='text' size='20' name='status1[]' value='$statusBack'></td><td><input type='radio' name='status[]' value='n' $cBUS><font color='red'>On business at: </font><input type='text' size='20' name='status1[]' value='$statusBus'></td></tr><tr><td> </td><td><input type='radio' name='status[]' value='t' $cTRIP><font color='red'>On trip until: </font><input type='text' size='20' name='status1[]' value='$statusTrip'></td><td><input type='radio' name='status[]' value='l' $cLEAV><font color='red'>On leave from: </font><input type='text' size='20' name='status1[]' value='$statusLeave'></td><td><input type='radio' name='status[]' value='c' $cCUS><font color='red'>Custom Message: </font><input type='text' size='30' name='status1[]' value='$statusCus'></td></tr>";statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate);}// ************* FUNCTIONS ********function headerStuff($message) {echo "<html><head><META HTTP-EQUIV=\"CACHE-CONTROL\" CONTENT=\"NO-CACHE\"><title>Status</title><STYLE TYPE=\"text/css\"><!--body{font-family:sans-serif;background:beige}td{font-size:80%;background:beige}th{font-size:95%; vertical-align: bottom}--> </STYLE></head><body><hr><table>";if($message){echo "$message";}echo "</table><form name='statusForm' method='post' action='update.php'>";}function statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate){if($statusUpdate!=""){if($statusUpdate=="1"){$statusUpdate="0";$fs="Updated";$fb="<font color='purple'>";$fe="</font>";}else{$statusUpdate="1";$fb="<font color='green'>";$fe="</font>";$fs="Updated Again";}}else{$fs="";}$date=date("l, F d, Y");$day=substr($statusMod,6,2);$month=substr($statusMod,4,2);$year=substr($statusMod,0,4);$hour=substr($statusMod,8,2);$min=substr($statusMod,10,2);$sec=substr($statusMod,12,2);//There is a problem with browsers other than Safari not updating//status.php properly in the mainFrame. The redirect.php is a//workaround. When other browsers handle the onClick properly,//redirect.php can be replaced with status.phpecho "</table><table><tr><td>Today is: $date</td><td width='150' align='center'><input type='hidden' name='statusUpdate' value='$statusUpdate'><input type='hidden' name='tempID' value='$tempID'><input type='submit' name='Submit' value='Update'></td><td width='300'>Status for: <font color='blue' size=+1>$Fname $Lname</font> $fb &nbsp;&nbsp;$fs $fe</td><td>Last Update: ".date("l, F d, Y @ H:i:s T", mktime($hour, $min, $sec, $month, $day, $year))."</td></tr></form></table><hr></body></html>";}?>