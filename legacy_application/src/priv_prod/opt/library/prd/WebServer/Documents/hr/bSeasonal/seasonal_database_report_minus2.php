<?phpsession_start();$level=$_SESSION['hr']['level'];if($level<1){echo "You do not have access to this database. <a href='http://149.168.1.196/hr/'>login</a>";exit;}//echo "<pre>"; print_r($_SERVER); echo "</pre>"; // exit;$database="hr";include("../../../include/connectROOT.inc"); // database connection parametersextract($_REQUEST);$display=array("district","center_code","beacon_posnum","avg_rate","osbm_title","budget_hrs","ncas_account","div_app","park_approve","comments","park_comments");foreach($display as $k=>$v){	$hard_fields.="t1.".$v.",";	}	$hard_fields.="t1.budget_weeks";$sql = "SELECT sum(t1.budget_hrs*(budget_weeks-2)*avg_rate) as totalFROM seasonal_payroll as t1WHERE (park_approve='y' AND (district='east' OR  district='north' OR  district='south' OR  district='west')) OR t1.center_code='OPAD'"; //echo "$sql"; exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_assoc($result);{$operations=$row['total'];}$sql = "SELECT sum(t1.budget_hrs*(budget_weeks-2)*avg_rate) as totalFROM seasonal_payroll as t1WHERE (park_approve='y') AND (district!='east' AND  district!='north' AND  district!='south' AND  district!='west') AND t1.center_code!='OPAD'"; //echo "$sql"; exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_assoc($result);{$others=$row['total'];}$sql = "SELECT district,sum(t1.budget_hrs*(budget_weeks-2)*avg_rate) as totalFROM seasonal_payroll as t1WHERE 1 and park_approve='y'group by districtorder by district"; //echo "$sql"; //exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_assoc($result)){$district_array[$row['district']]=$row['total'];}//echo "<pre>"; print_r($district_array); echo "</pre>"; exit;$sql = "SELECT center,center_code,sum(t1.budget_hrs*(budget_weeks-2)*avg_rate) as totalFROM seasonal_payroll as t1WHERE 1 and park_approve='y'group by centerorder by center_code"; //echo "$sql"; //exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_assoc($result)){	$park_array[$row['center_code']]=$row['total'];	$center_array[$row['center_code']]=$row['center'];	}//echo "<pre>"; print_r($park_array); echo "</pre>"; //exit;$div_array=array("y","n");if($submit=="Find"){		//echo "<pre>"; print_r($_POST); echo "</pre>"; // exit;	if($_POST){	foreach($_POST AS $k=>$v){		if($v=="" OR $k=="submit"){continue;}		$passQuery.="&$k=$v";		if($k=="budget_hrs"){			$where.=" and t1.$k !='0.00'";			continue;}				if($k=="comments"){			$where.="and t1.$k like '%$v%' ";			}else{$where.=" and t1.$k='$v'";}					}		}			else	{	if($_REQUEST){		//echo "<pre>"; print_r($_REQUEST); echo "</pre>"; //exit;	foreach($_REQUEST AS $k=>$v){		if($k=="PHPSESSID" OR $k=="submit" OR $k=="rep"){continue;}		if($k=="budget_hrs"){			$where.=" and t1.$k !='0.00'";			continue;}				if($k=="comments"){			$where.="and t1.$k like '%$v%' ";			}else{$where.=" and t1.$k='$v'";}					}		}		}	}//if($level<4){$where1="and park_approve='y'";}$sql = "SELECT $hard_fieldsFROM seasonal_payroll as t1WHERE 1 $where $where1ORDER  BY t1.district,t1.center_code,t1.osbm_title"; //echo "$sql"; //exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_assoc($result)){$result_array[]=$row;}//echo "<pre>"; print_r($result_array); echo "</pre>"; exit;// ******** Menu **********if($level>3 AND $rep==""){	include("menu.php");	echo "<form method='POST'><table cellpadding='5'><tr><td>Excel <a href=\"seasonal_database_report.php?submit=Find&rep=excel$passQuery\">export</a></td>";		echo "<td>District: <select name='district'><option select=''></option>";		foreach($district_array as $k=>$v){			if($k==$district){$s="selected";}else{$s="value";}			echo "<option $s='$k'>$k</option>";			}		echo "</select></td>";				echo "<td>Center Code: <select name='center_code'><option select=''></option>";		foreach($park_array as $k=>$v){			if($k==$center_code){$s="selected";}else{$s="value";}			echo "<option $s='$k'>$k</option>";			}		echo "</select></td>";				echo "<td>Comments: <input type='text' name='comments' value='$comments'></td>";				echo "<td>Div Approve: <select name='div_app'><option select=''></option>";		foreach($div_array as $k=>$v){			if($v==$div_app){$s="selected";}else{$s="value";}			echo "<option $s='$v'>$v</option>";			}		echo "</select></td>";				echo "<td>Park Approve: <select name='park_approve'><option select=''></option>";		foreach($div_array as $k=>$v){			if($v=="n"){continue;}			if($v==$park_approve){$s="selected";}else{$s="value";}			echo "<option $s='$v'>$v</option>";			}		echo "</select></td>";				if($_POST['budget_hrs']=="0"){$ck0=" checked";}		echo "<td>Hide 0 request: <input type='checkbox' name='budget_hrs' value='0'$ck0></td>";				echo "<td><input type='submit' name='submit' value='Find'></td></tr></table>";		}if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=seasonal_database_report.xls');	if($scope=="centers"){		echo "<table>";		echo "<tr><td>center_code</td><td>amount</td><td>center</td></tr>";		foreach($park_array as $k=>$v){		$v=number_format($v,2);		$c=$center_array[$k];			echo "<tr><td>$k</td><td>$v</td><td>$c</td></tr>";			}		echo "</table>";		exit;		}}// HeaderIF($rep==""){	$gt=number_format(($operations+$others),2);	$operations=number_format($operations,2);	$others=number_format($others,2);	echo "<table border='1' cellpadding='3'><tr><td colspan='10' align='center'>$num positions</td></tr><tr><td colspan='10' align='center'>Operations: (east, north, south, west, OPAD) <b>$operations</b> + Others: (ADMI, DEDE, NARA, NRTF, PAR3, USBG) <b>$others</b> = <b>$gt</b></td></tr>";		// District		echo "<tr><td colspan='10' align='center'>";		foreach($district_array as $k=>$v){		$v=number_format($v,2);			echo "$k=$v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";			}		echo "</td></tr>";	// Parks			echo "<tr><td colspan='10' align='center'>";		foreach($park_array as $k=>$v){		$i++;		$v=number_format($v,2);			echo "$k=$v&nbsp;&nbsp;&nbsp;&nbsp;";			if(fmod($i,9)==0){echo "<br />";}			}		echo "<a href='seasonal_database_report?rep=excel&scope=centers'>export</a> Centers</td></tr></table>";	}			echo "<table border='1' cellpadding='3'><tr>";foreach($display as $fld=>$val){	$testHeader[]=$val;		if($val=="budget_hrs"){$val="hrs * weeks * rate";}		$val=str_replace("_"," ",$val);		echo "<th>$val</th>";		}		echo "</tr>";		$varHeader=0;foreach($result_array as $number=>$fields){			echo "<tr>";			foreach($fields as $fld_name=>$value){				if(in_array($fld_name,$display)){											$td="";												if($fld_name=="park_comments"){							if($value AND $rep==""){							$value="<div id=\"fieldName\"><a onclick=\"toggleDisplay('fieldDetails[$number]');\" href=\"javascript:void('')\"> details &#177</a> </div><div id=\"fieldDetails[$number]\" style=\"display: none\">$value</div>";}							}													if($fld_name=="district"){							if($track_district!=$value){							$td=" bgcolor='yellow'";							$track_district=$value;							$value.="<br />".number_format($district_array[$value],2);}							}												if($fld_name=="center_code"){							if($track_center_code!=$value){							$td=" bgcolor='yellow'";							$track_center_code=$value;							$value.="<br />".number_format($park_array[$value],2);}							}													if($fld_name=="budget_hrs"){								$td=" align='right'";							$rate=$result_array[$number]['avg_rate'];							$hours=$result_array[$number]['budget_hrs'];							$weeks=$result_array[$number]['budget_weeks'];														$Cost=$weeks*$rate*$hours;							$totalCost+=$Cost;								$tempVar=number_format($Cost,2); 								if($result_array[$number]['ncas_account']=="531311"){								$subtotalCost1311+=$Cost;								$total1311+=$Cost;}								if($result_array[$number]['ncas_account']=="531312"){								$subtotalCost1312+=$Cost;								$total1312+=$Cost;}																$value=$tempVar;								}						echo "<td$td>$value</td>";										}					else{continue;}			}			$ii++;		echo "</tr>";		}		$subtotalCost1311=number_format($subtotalCost1311,2);		echo "<tr bgcolor='aliceblue'><td colspan='5' align='right'>Subtotal 1311: $subtotalCost1311<br />";		if($subtotalCost1312>0){		$subtotalCost1312=number_format($subtotalCost1312,2);		echo "Subtotal 1312: $subtotalCost1312";}		echo "</td></tr>";		$tc=number_format($totalCost,2);		$tc1311=number_format($total1311,2);		$tc1312=number_format($total1312,2);		echo "<tr><td colspan='5' align='right'>Total 1311: $$tc1311</td></tr>";		echo "<tr><td colspan='5' align='right'>Total 1312: $$tc1312</td></tr>";				echo "<tr><td colspan='5' align='right'>Grand Total: $$tc</td></tr>";	echo "</table>";?>