<?php$query1 = "truncate table budget.project_balances_div_unposted; ";$result1 =mysqli_query($connection, $query1) or die ("Couldn't execute query 1.  $query1");if($showSQL=="1"){echo "<br><br>$query1";}$query1a = "insert into project_balances_div_unposted( center, project_number,account, vendor_name, transaction_date, transaction_number, transaction_type, transaction_amount,source_id,parkcode) select ncas_center, project_number,ncas_account, vendor_name, datesql, ncas_invoice_number,'cdcs', ncas_invoice_amount, id,'' from cid_vendor_invoice_payments where 1 and post2ncas != 'y' and ncas_credit != 'x' and project_number != '' group by id; ";$result1a =mysqli_query($connection, $query1a) or die ("Couldn't execute query 1a.  $query1a");if($showSQL=="1"){echo "<br><br>$query1a";}$query1b = "insert into project_balances_div_unposted( center, project_number,account, vendor_name, transaction_date, transaction_number, transaction_type, transaction_amount,source_id,parkcode) select ncas_center, project_number,ncas_account, vendor_name, datesql, ncas_invoice_number,'cdcs', -ncas_invoice_amount, id,'' from cid_vendor_invoice_payments where 1 and post2ncas != 'y' and ncas_credit = 'x' and project_number != '' group by id; ";$result1b =mysqli_query($connection, $query1b) or die ("Couldn't execute query 1b.  $query1b");//echo "<br><br>$query";//exit;if($showSQL=="1"){echo "<br><br>$query1b";}$query1c = "insert into project_balances_div_unposted(center, project_number,account, vendor_name, transaction_date, transaction_number, transaction_type, transaction_amount,source_id,parkcode )  select center, projnum,ncasnum, concat('pcard','-',cardholder,'-',vendor_name,'-',trans_date), transdate_new, transid_new, 'pcard',sum(amount), id,'' from pcard_unreconciled where 1  and ncas_yn != 'y' and projnum != '' group by id; ";$result1c =mysqli_query($connection, $query1c) or die ("Couldn't execute query 1c.  $query1c");if($showSQL=="1"){echo "<br><br>$query1c";}$query1d = "update partf_projectsset project_center_year_type=concat(projnum,'-',center,'-',yearfundf,'-',projcat,'-',spo_number)where 1";$result1d =mysqli_query($connection, $query1d) or die ("Couldn't execute query 1d.  $query1d");if($showSQL=="1"){echo "<br><br>$query1d";}$query2 = "truncate table project_balances_div1";$result2 =mysqli_query($connection, $query2) or die ("Couldn't execute query 2.  $query2");if($showSQL=="1"){echo "<br><br>$query2";}//if($level>4){$showSQL=1;}$query3= "insert into project_balances_div1(projnum,center,approved)select projnum,center,sum(div_app_amt)from partf_projectswhere 1 and projyn='y'group by projnum,center;";$result3 =mysqli_query($connection, $query3) or die ("Couldn't execute query 3.  $query3");//echo "<br><br>$query";//exit;if($showSQL=="1"){echo "<br><br>$query3";}$query4 = "insert into project_balances_div1(projnum,center,expenses)select proj_num,center,sum(amount)from partf_paymentswhere 1 group by proj_num,center";$result4 =mysqli_query($connection, $query4) or die ("Couldn't execute query 4.  $query4");if($showSQL=="1"){echo "<br><br>$query4";}$query4a = "insert into project_balances_div1(projnum,center,unposted)select project_number,center,sum(transaction_amount)from project_balances_div_unpostedwhere 1 group by project_number,center";$result4a =mysqli_query($connection, $query4a) or die ("Couldn't execute query 4a.  $query4a");if($showSQL=="1"){echo "<br><br>$query4a";}$query5 = "truncate table project_balances_div2";$result5 =mysqli_query($connection, $query5) or die ("Couldn't execute query 5.  $query5");if($showSQL=="1"){echo "<br><br>$query2";}//if($level>4){$showSQL=1;}$query6 = "insert into project_balances_div2(projnum,center,approved,expenses,unposted_expenses)select projnum,center,sum(approved),sum(expenses),sum(unposted)from project_balances_div1where 1 group by projnum,center";$result6 =mysqli_query($connection, $query6) or die ("Couldn't execute query 6.  $query6");if($showSQL=="1"){echo "<br><br>$query6";}$query7 = "update project_balances_div2           set balance1=approved-expenses where 1";$result7 =mysqli_query($connection, $query7) or die ("Couldn't execute query 7.  $query7");if($showSQL=="1"){echo "<br><br>$query7";}$query8="update project_balances_div2,partf_projects         set project_balances_div2.status=partf_projects.statusper		 where project_balances_div2.projnum=partf_projects.projnum";$result8 =mysqli_query($connection, $query8) or die ("Couldn't execute query 8.  $query8");if($showSQL=="1"){echo "<br><br>$query8";}$query9="update project_balances_div2,center         set project_balances_div2.budgcode=center.budcode,		     project_balances_div2.yearfundc=center.cyinitfund,			 project_balances_div2.yearfundf=center.f_year_funded,			 project_balances_div2.center_description=center.center_desc,			 project_balances_div2.section=center.section		 where project_balances_div2.center=center.center";$result9 =mysqli_query($connection, $query9) or die ("Couldn't execute query 9.  $query9");if($showSQL=="1"){echo "<br><br>$query9";}$query10="update project_balances_div2,partf_projects         set project_balances_div2.projyn=partf_projects.projyn,		     project_balances_div2.reportdisplay=partf_projects.reportdisplay,		     project_balances_div2.projcat=partf_projects.projcat,		     project_balances_div2.manager=partf_projects.manager,		     project_balances_div2.proj_man=partf_projects.proj_man,		     project_balances_div2.active=partf_projects.active,		     project_balances_div2.showpa=partf_projects.showpa,		     project_balances_div2.fullname=partf_projects.fullname,		     project_balances_div2.dist=partf_projects.dist,		     project_balances_div2.county=partf_projects.county,		     project_balances_div2.park=partf_projects.park,		     project_balances_div2.projname=partf_projects.projname,		     project_balances_div2.startdate=partf_projects.startdate,		     project_balances_div2.enddate=partf_projects.enddate,		     project_balances_div2.design=partf_projects.design,		     project_balances_div2.construction=partf_projects.construction,		     project_balances_div2.statusper=partf_projects.statusper,		     project_balances_div2.commentsi=partf_projects.commentsi	  	 where project_balances_div2.projnum=partf_projects.projnum";$result10 =mysqli_query($connection, $query10) or die ("Couldn't execute query 10.  $query10");if($showSQL=="1"){echo "<br><br>$query10";}$query11="update project_balances_div2         set balance2=balance1		 where (status='ns' or status='ip')and (balance1 > '0')";$result11 =mysqli_query($connection, $query11) or die ("Couldn't execute query 11.  $query11");if($showSQL=="1"){echo "<br><br>$query11";}$query12="update project_balances_div2         set balance3=balance1-unposted_expenses		 where 1";$result12 =mysqli_query($connection, $query12) or die ("Couldn't execute query 12.  $query12");if($showSQL=="1"){echo "<br><br>$query12";}$query13="update project_balances_div2         set balance3=balance1-unposted_expenses		 where 1";		 		 $result13 =mysqli_query($connection, $query13) or die ("Couldn't execute query 13.  $query13");if($showSQL=="1"){echo "<br><br>$query13";}$query14="select * from project_balances_div2 where 1 limit 10";			 $result14 =mysqli_query($connection, $query14) or die ("Couldn't execute query 14.  $query14");if($showSQL=="1"){echo "<br><br>$query14";}while($row=mysqli_fetch_assoc($result14)){$ARRAY[]=$row;}//echo "<pre>";print_r($ARRAY);echo "</pre>";exit;$skip=array('view');//echo "<pre>";print_r($skip);echo "</pre>";exit;echo "<table border='1'><tr>";foreach($ARRAY[0] as $field=>$value){//if the KEY($field) is in $skip ARRAY,loop stops. If $field is not in $skip ARRAY, loop continues //& passes the field name between the TD tags belowif(in_array($field,$skip)){continue;}echo "<th>$field </th>";}echo "</tr>";//exit;//$ARRAY has a KEY($index) & a VALUE($row). $row is an associative ARRAY in its own right//with its own KEY($field) & VALUE($value)if($c==''){$t=" bgcolor='$table_bg2' ";$c=1;}else{$t='';$c='';}foreach($ARRAY as $index=>$row){echo "<tr$t>";//walking thru the inner array-STARTforeach($row as $field=>$value){//if the KEY($field) is in $skip ARRAY,loop stops. If $field is not in $skip ARRAY, loop continues //& passes the field value between the TD tags belowif(in_array($field,$skip)){continue;}if($field=='approved'){$value=number_format($value,2);}if($field=='expenses'){$value=number_format($value,2);}if($field=='balance1'){$value=number_format($value,2);}if($field=='balance2'){$value=number_format($value,2);}if($field=='balance3'){$value=number_format($value,2);}echo "<td>$value</td>";}//walking thru the inner array-ENDecho "</tr>";}//walking trhu the outer array-ENDecho "</table>";?>