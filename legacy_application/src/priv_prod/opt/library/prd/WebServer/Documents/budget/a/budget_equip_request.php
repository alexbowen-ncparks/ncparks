<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("../../../include/authBUDGET.inc");//print_r($_SESSION);//EXIT;//print_r($_REQUEST);//EXIT;extract($_REQUEST);$m=1;include_once("../menu.php");if($_SESSION[budget][level]==1){$center=$_SESSION[budget][centerSess];}if($submit=="del"){$sql="DELETE from equipment_request_3 where ID='$id'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql"); $showEquipRequest="1";$id="";}if($approval=="Update Approval Status"){if($level==2){reset($distApprov);while(list($key,$val)=each($distApprov)){$sql="UPDATE equipment_request_3 SET district_approved='$val' where ID='$key'";//echo "$sql<br>";//exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}}//end level 2if($level==3){reset($sectApprov);while(list($key,$val)=each($sectApprov)){$sql="UPDATE equipment_request_3 SET section_approved='$val' where ID='$key'";//echo "$sql<br>";//exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}}//end level = 3if($level>3){reset($distApprov);while(list($key,$val)=each($distApprov)){$sql="UPDATE equipment_request_3 SET district_approved='$val',section_approved='$sectApprov[$key]',division_approved='$divApprov[$key]', ncas_acct='$acctArray[$key]'where ID='$key'";//echo "$sql<br>";//exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}}//end level >3$showEquipRequest="1";$id="";$ERcenter=$center;//echo "$ERcenter $center";//exit;}if($addRequest=="Update"){$sql="UPDATE equipment_request_3 SET equipment_description='$equipment_description',requested_amount='$requested_amount',justification='$justification',funding_source='$funding_source',ncas_account='$ncas_account'where ID='$id'";//echo "$sql";exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql"); $showEquipRequest="1";}// Show Display Formif($rep==""){include_once("../menu.php");echo "<form method='POST'>";//echo "<form>";if($_SESSION[budget][level]==2){if($ERcenter){$center=$ERcenter;}include("../getDistrict.php");}if($_SESSION[budget][level]>2){$sql1="select distinct section,parkcode,center as PCcenterfrom centerwhere 1 and fund='1280'order by section,parkcode,center";$result=mysqli_query($connection, $sql1,$connection);while($row=mysqli_fetch_array($result)){extract($row);$centerMenuArray[]=$PCcenter;$parkMenuArray[]=$parkcode;$sectionMenuArray[]=$section;}if($ERcenter){$center=$ERcenter;}}//echo "<pre>";print_r();echo "</pre>";if($level>1){echo "<td>Equipment Request for <select name=\"ERcenter\"><option selected>Select Park</option>";for ($n=0;$n<count($centerMenuArray);$n++){if($center==$centerMenuArray[$n]){$s="selected";}else{$s="value";}$show=strtoupper($sectionMenuArray[$n]."-".$parkMenuArray[$n]);$con=$centerMenuArray[$n];		echo "<option $s=\"$con\">$show</option>\n";       }   echo "</select></td>";}else{echo "<td><input type='text' name='ERcenter' value='$center' READONLY></td>";}$presentMonth=date(n);// no leading zeroif($presentMonth>6 and $presentMonth<13){$startFy=date(y);$prevYear=substr(date(Y)-1,2,2);}else{$startFy=substr(date(Y)-1,2,2);}$yr1="20".$startFy;$yr2=$yr1+1;$yr3=$yr2+1;$prev_f_year=$prevYear.substr($yr1,2,2);$fyArray[]=$prev_f_year;$endFy=substr($yr2,2,2);$fyArray[]=$startFy.$endFy;$next_f_year=$endFy.substr($yr3,2,2);$fyArray[]=$next_f_year;echo "<td> For Fiscal Year <select name=\"f_year\">";for ($n=0;$n<count($fyArray);$n++){if($f_year==$fyArray[$n]){$s="selected";}else{$s="value";}$con=$fyArray[$n];		echo "<option $s='$con'>$con</option>\n";       }   echo "</select></td>";echo "<td><input type='hidden' name='id' value=''><input type='submit' name='showEquipRequest' value='Submit'></form></td></tr></table>";}// end if rep=""if($addRequest=="Request"){if(!$equipment_description || !$request_amount || !$Justification || $funding_source=="Funding Source"){echo "Please complete all selections, including Funding Source, before submitting. Click your browser's Back button.";exit;}$sql="SELECT parkcode,dist from center where `center`='$center'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql"); $row=mysqli_fetch_array($result);extract($row);$sql="SELECT max(er_num) as er_num from equipment_request_3 where 1";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql"); $row=mysqli_fetch_array($result);extract($row);$nextER=$er_num+1;$sql="INSERT INTO equipment_request_3 set er_num='$nextER',equipment_description='$equipment_description',request_amount='$request_amount',Justification='$Justification',funding_source='$funding_source',center='$center',f_year='$f_year',park='$parkcode',district_location='$dist'";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$showEquipRequest="1";$ERcenter=$center;$id="";}// Execute Find Queryif($showEquipRequest!=""||$id!=""){echo "<table border='1' cellpadding='2' align='center'><tr><th>Equipment<br>Request<br>Number</th><th>Park</th><th>For<br>Fiscal<br>Year</th><th>Equipment<br>Description(Quantity)</th><th>Request<br>Amount</th><th>Park<br>Justification</th><th>Funding<br>Source</th><th>District<br>Approved</th><th>Section<br>Approved</th><th>Budget<br>Office<br>Approved</th><th>Budget<br>Office<br>NCAS#</th></tr><tr><td colspan='11'><font color='purple'<b>Equipment Request Form</b></font></td></tr>";$er_num="####";$park="";$submitType="Request";if($id){$sql="SELECT * FROM equipment_request_3 where id='$id'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$row=mysqli_fetch_array($result);extract($row);if($_SESSION[budget][level]==1){if($Center!=$_SESSION[budget][centerSess]){echo "$center is not your Center. Click your Browser's Back button.";exit;}}$submitType="Update";}$sql="SELECT er_num AS 'Equipment_Request_Number', location as 'Park', f_year AS 'For_Fiscal_Year', equipment_description, requested_amount as 'Request_Amount', Justification AS 'Park_Justification', Funding_Source, District_Approved, Section_Approved, Division_Approved,id,ncas_account as 'acct'FROM equipment_request_3where pay_center='$ERcenter' and f_year='$f_year'order by er_num desc";//echo "$sql $center $ERcenter";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");echo "<tr><form method='POST'><td align='center'>$er_num</td><td>$park</td><td align='center'>$f_year</td><td><input type='text' name='equipment_description' value='$equipment_description'></td><td><input type='text' name='requested_amount' value='$requested_amount' size='8'></td><td><textarea name='justification' cols='55' rows='3'>$justification</textarea></td>";$menuArray=array("","approp","opreserve","not_available");echo "<td><select name=\"funding_source\">";foreach($menuArray as $k=>$v){if($funding_source==$v){$s="selected";}else{$s="value";}		echo "<option $s=\"$v\">$v\n";		}   echo "</select></td>   <td><input type='hidden' name='acct' value='$acct'><input type='hidden' name='f_year' value='$f_year'><input type='hidden' name='center' value='$ERcenter'><input type='submit' name='addRequest' value='$submitType'></td>";if($id and $ERcenter){echo "<td align='center'><a href='budget_equip_request.php?submit=del&id=$id&f_year=$f_year&ERcenter=$ERcenter' onClick='return confirmLink()'>Delete</a></td>";}echo "</tr></form><form method='POST'><tr><td colspan='10'><b>Equipment Requested</b></td></tr>";while($row=mysqli_fetch_array($result)){extract($row);$req_amt_total+=$Request_Amount;$Request_Amount=number_format($Request_Amount,2);$erLink="$Equipment_Request_Number";//$level==1if($level>3){$erLink="<a href='budget_equip_request?id=$id&f_year=$f_year&ERcenter=$center'>$Equipment_Request_Number</a>";}if($level==2 and $Section_Approved=="" and $Division_Approved==""){$erLink="<a href='budget_equip_request?id=$id&f_year=$f_year&ERcenter=$center'>$Equipment_Request_Number</a>";}if($level==3 and $Division_Approved==""){$erLink="<a href='budget_equip_request?id=$id&f_year=$f_year&ERcenter=$center'>$Equipment_Request_Number</a>";}if(!$District_Approved){$District_Approved="-";}if(!$Section_Approved){$Section_Approved="-";}if(!$Division_Approved){$Division_Approved="-";}echo "<tr><td align='center'>$erLink</td><td align='center'>$Park</td><td align='center'>$For_Fiscal_Year</td><td align='left'>$equipment_description</td><td align='right'>$Request_Amount</td><td align='left'>$Park_Justification</td><td align='center'>$Funding_Source</td>";if($level==1){echo "<td align='center'>$District_Approved</td><td align='center'>$Section_Approved</td><td align='center'>$Division_Approved</td><td>$acct</td>";}if($level==2){if($District_Approved=='n'){$ckDN="checked";$ckDY="";}else{$ckDY="checked";$ckDN="";}if($District_Approved=='-'){$ckDN="";$ckDY="";}$approvDist="<font color='green'>Y</font><input type='radio' name='distApprov[$id]' value='y'$ckDY>N<input type='radio' name='distApprov[$id]' value='n'$ckDN>";if($Section_Approved=='-'){echo "<td align='center'>$approvDist</td>";}else{echo "<td align='center'>$District_Approved</td>";}echo "<td align='center'>$Section_Approved</td><td align='center'>$Division_Approved</td><td>$acct</td>";}if($level==3 and $_SESSION[budget][position]=="parks state supt"){if($District_Approved=='n'){$ckDN="checked";$ckDY="";}else{$ckDY="checked";$ckDN="";}if($District_Approved=='-'){$ckDN="";$ckDY="";}$approvDist="<font color='green'>Y</font><input type='radio' name='distApprov[$id]' value='y'$ckDY><font color='red'>N</font><input type='radio' name='distApprov[$id]' value='n'$ckDN>";if($Section_Approved=='n'){$ckSN="checked";$ckSY="";}else{$ckSY="checked";$ckSN="";}if($Section_Approved=='-'){$ckSN="";$ckSY="";}$approvSect="<font color='green'>Y</font><input type='radio' name='sectApprov[$id]' value='y'$ckSY><font color='red'>N</font><input type='radio' name='sectApprov[$id]' value='n'$ckSN>";echo "<td align='center'>$District_Approved</td><td align='center'>$approvSect</td><td align='center'>$Division_Approved</td><td>$acct</td>";}if($level>3){if($District_Approved=='n'){$ckDN="checked";$ckDY="";}else{$ckDY="checked";$ckDN="";}if($District_Approved=='-'){$ckDN="";$ckDY="";}$approvDist="<font color='green'>Y</font><input type='radio' name='distApprov[$id]' value='y'$ckDY><font color='red'>N</font><input type='radio' name='distApprov[$id]' value='n'$ckDN>";if($Section_Approved=='n'){$ckSN="checked";$ckSY="";}else{$ckSY="checked";$ckSN="";}if($Section_Approved=='-'){$ckSN="";$ckSY="";}$approvSect="<font color='green'>Y</font><input type='radio' name='sectApprov[$id]' value='y'$ckSY><font color='red'>N</font><input type='radio' name='sectApprov[$id]' value='n'$ckSN>";if($Division_Approved=='n'){$ckN="checked";$ckY="";}else{$ckY="checked";$ckN="";}if($Division_Approved=='-'){$ckN="";$ckY="";}$approvDiv="<font color='green'>Y</font><input type='radio' name='divApprov[$id]' value='y'$ckY><font color='red'>N</font><input type='radio' name='divApprov[$id]' value='n'$ckN>";echo "<td align='center'>$approvDist</td><td align='center'>$approvSect</td><td align='center'>$approvDiv</td>";echo "<td><input type='text' name='acctArray[$id]' value='$acct' size='9'></td>";}echo "</tr>";}// end while$req_amt_total=number_format($req_amt_total,2);echo "<tr><td align='right' colspan='5'><b>$req_amt_total</b></td></tr>";if($level>1){echo "<tr><td colspan='9' align='right'><input type='hidden' name='f_year' value='$f_year'><input type='hidden' name='center' value='$center'><input type='submit' name='approval' value='Update Approval Status'></form>";}echo "</table>";//exit;}// end submitEquipForm?>