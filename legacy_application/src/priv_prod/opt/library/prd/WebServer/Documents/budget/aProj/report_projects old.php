<?php// Create variables	if($report_period=="all"){		$start="19930701";		$yr_end=substr($f_year,2,2); 		$end="20".$yr_end."0630";					}	if($report_period=="current"){		$yr_start=substr($f_year,0,2); 		$start="20".$yr_start."0701";		$yr_end=substr($f_year,2,2); 		$end="20".$yr_end."0630";					}	if($other_period){		$rep_p="Fiscal Year $other_period";		$yr_start=substr($other_period,0,2); 		$start="20".$yr_start."0701";		$yr_end=substr($other_period,2,2); 		$end="20".$yr_end."0630";					}//echo "s=$start e=$end";exit;$query="truncate table project_cash_flow_posted;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="insert into project_cash_flow_posted (project_number,partf_payments_amount)selectcharg_proj_num,sum(amount)from partf_paymentswhere 1and partf_payments.datenew >= '$start'and partf_payments.datenew <='$end'and invoice != 'report_date'group by charg_proj_num;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="insert into project_cash_flow_posted (project_number,partf_fund_trans_in_amount)selectproj_in,sum(amount)from partf_fund_transwhere 1and proj_in != ''and datenew >= '$start'and datenew <='$end'group by proj_in;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="insert into project_cash_flow_posted (project_number,partf_fund_trans_out_amount)selectproj_out,sum(amount)from partf_fund_transwhere 1and proj_out != ''and datenew >= '$start'and datenew <='$end'group by proj_out;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="update project_cash_flow_posted,partf_projectsset project_cash_flow_posted.projcat=partf_projects.projcatwhere project_cash_flow_posted.project_number=partf_projects.projnum;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="update project_cash_flow_posted,project_categoriesset project_cash_flow_posted.project_category=project_categories.categorywhere project_cash_flow_posted.projcat=project_categories.code;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};if($projcat){$where="and partf_projects.projcat='$projcat'";}if($park){$where="and partf_projects.park='$park'";}if($dist){$where="and partf_projects.dist='$dist'";}if($statusper){$where="and partf_projects.statusper='$statusper'";}if($center){$where="and partf_projects.center='$center'";}if($yearfundf){$where="and partf_projects.yearfundf='$yearfundf'";}$query="select partf_projects.projcat as 'project_category',partf_projects.park,partf_projects.dist as 'district',partf_projects.projname,partf_projects.statusper as 'status',project_cash_flow_posted.project_number as 'project_number',partf_projects.center,partf_projects.yearfundf as 'initial_fund_year',sum(project_cash_flow_posted.partf_fund_trans_in_amount-project_cash_flow_posted.partf_fund_trans_out_amount) as 'funding',sum(project_cash_flow_posted.partf_payments_amount) as 'expenditures',sum(project_cash_flow_posted.partf_fund_trans_in_amount-project_cash_flow_posted.partf_fund_trans_out_amount)-sum(project_cash_flow_posted.partf_payments_amount) as 'net_funds'from project_cash_flow_postedleft join partf_projects on project_cash_flow_posted.project_number=partf_projects.projnumwhere 1$wheregroup by project_cash_flow_posted.project_numberorder by partf_projects.projcat,partf_projects.park;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};// ********** Summary Header$query="select max(acctdate) as acctdate from exp_rev where 1;";   $resultMax = @mysqli_query($connection, $query,$connection);   if($showSQL){echo "$query<br><br>";};$row=mysqli_fetch_array($resultMax);$report_date=$row['acctdate'];$color='blue';$f1="<font color='$color'>"; $f2="</font>";echo "<div align='center'><table border='1'><tr><td>Report Date:</td><td>$f1$report_date$f2</td></tr><tr><td>Report Name:</td><td>$f1 PARTF_Budget_History$f2</td></tr><tr><td>Report Level:</td><td>$f1$report_level$f2</td></tr><tr><td>Report Period:</td><td>$f1$rep_p$f2</td></tr></table>";echo "<table><tr>";// Menu Project Category$sql="select distinct upper(projcat) as projcatfrom partf_paymentsleft join partf_projects on partf_payments.charg_proj_num=partf_projects.projnumwhere 1and partf_payments.datenew >= '$start'and partf_payments.datenew <='$end'order by projcat asc;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['projcat'];}echo "<td align='center'>Project Category<br><select name=\"projcat\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($projcat==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."projcat=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";// Menu Parkunset($menuArray);$sql="select distinct upper(park) as parkfrom partf_paymentsleft join partf_projects on partf_payments.charg_proj_num=partf_projects.projnumwhere 1and partf_payments.datenew >= '$start'and partf_payments.datenew <='$end'order by park asc;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['park'];}echo "<td align='center'>Park<br><select name=\"park\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($park==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."park=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";// Menu Districtunset($menuArray);$sql="select distinct upper(dist) as distfrom partf_paymentsleft join partf_projects on partf_payments.charg_proj_num=partf_projects.projnumwhere 1and partf_payments.datenew >= '$start'and partf_payments.datenew <='$end'order by dist asc;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['dist'];}echo "<td align='center'>District<br><select name=\"dist\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($dist==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."dist=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";// Menu Statusunset($menuArray);$sql="select distinct upper(statusper) as statusperfrom partf_paymentsleft join partf_projects on partf_payments.charg_proj_num=partf_projects.projnumwhere 1 and statusper!=''and partf_payments.datenew >= '19930701'and partf_payments.datenew <='20090630'order by statusper asc;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['statusper'];}echo "<td align='center'>Status<br><select name=\"statusper\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($statusper==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."statusper=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";// Menu Centerunset($menuArray);$sql="select distinct centerfrom partf_paymentswhere charg_proj_num != 'na'and partf_payments.datenew >= '19930701'and partf_payments.datenew <='20090630'order by center;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['center'];}echo "<td align='center'>Center<br><select name=\"center\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($budget_group_ck==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."center=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";// Menu Initial Fund Yearunset($menuArray);$sql="select distinct yearfundffrom partf_paymentsleft join partf_projects on partf_payments.charg_proj_num=partf_projects.projnumwhere 1 and yearfundf!=''and partf_payments.datenew >= '19930701'and partf_payments.datenew <='20090630'order by yearfundc desc;";$result_1 = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result_1)){$menuArray[]=$row['yearfundf'];}echo "<td align='center'>Initial Fund Year<br><select name=\"yearfundf\" onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";for ($n=0;$n<count($menuArray);$n++){if($yearfundf==$menuArray[$n]){$s="selected";}else{$s="value";}$goto="report_level=project&report_period=$report_period&other_period=$other_period&submit=Submit&";$con="dede_reports.php?".$goto."yearfundf=".$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";                           echo "</tr></table>";// ****** Body Querywhile($row=mysqli_fetch_assoc($result)){$ARRAY[]=$row;}$num=count($ARRAY);//echo "<pre>"; print_r($ARRAY); echo "</pre>"; // exit;$fieldNames=array_values(array_keys($ARRAY[0]));$decimalFields=array("funding","expenditures","net_funds");$count=count($fieldNames);$color='red';$f1="<font color='$color'>"; $f2="</font>";echo "<table border='1' cellpadding='2'>";echo "<tr><td colspan='2' align='center'><font color='red'>$num</font> records</td></tr>";echo "<tr>";foreach($fieldNames as $k=>$v){//$v=str_replace("_"," ",$v);echo "<th>$v</th>";}echo "</tr>";foreach($ARRAY as $k=>$v){// each row// $fx = font color  and  $tr = row shading$f1="";$f2="";$j++;if(fmod($j,2)!=0){$tr=" bgcolor='aliceblue'";}else{$tr="";}echo "<tr>";	foreach($v as $k1=>$v1){// each field, e.g., $tempID=$v[tempID];			$catArray[]=$v['project_category'];		if(in_array($k1,$decimalFields)){		$total[$k1]+=$v1;		$v1=number_format($v1,2);				$td=" align='right'";			}				else				{$td=" align='left'";				$v1=strtoupper($v1);}				echo "<td$td>$v1</td>";}	echo "</tr>";}echo "<tr>";foreach($fieldNames as $k=>$v){$v2=number_format($total[$v],2);if(in_array($v,$decimalFields)){echo "<th>$v2</th>";}else{echo "<th></th>";}}echo "</tr>";$color='red';$f1="<font color='$color'>"; $f2="</font>";if(in_array("la",$catArray)){echo "<tr><td align='right'>$f1 Important Note:$f2</td><td colspan='14'>$f1 1) Data are incomplete for Project Category:   LA Land  &nbsp;&nbsp;&nbsp;2) Funding & expenditure totals for individual Fiscal Years prior to Fiscal Year 0506 are incomplete$f2</td></tr>";}echo "</table></body></html>";?>