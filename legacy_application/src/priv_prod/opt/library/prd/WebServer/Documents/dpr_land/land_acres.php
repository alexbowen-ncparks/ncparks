<?phpini_set('display_errors',1);session_start();if($_SESSION['dpr_system']['level']<1){echo "Not logged in.";}include("../../include/connectROOT.inc"); // database connection parametersinclude("menu_dpr_system.php");extract($_REQUEST);mysql_select_db('dpr_system', $connection); // databaseif($_POST)	{//	echo "<pre>"; print_r($_POST); echo "</pre>";  //exit;	if($_POST['submit']=="Add")		{		foreach($_POST as $k=>$v){			if($k!="submit"){$string.="$k='".mysql_real_escape_string($v)."', ";}			}			$string=trim($string,", ");				$query="INSERT dpr_acres SET $string"; //echo "$query";exit;			$result = mysql_query($query) or die ("Couldn't execute query. $query");			}				if($_POST['submit']=="Update")		{		$fields=array_keys($_POST); //echo "<pre>"; print_r($fields); echo "</pre>";  //exit;		$ids=array_keys($_POST['parkcode']); //echo "<pre>"; print_r($ids); echo "</pre>";  //exit;		foreach($ids as $index=>$id)			{			$string="id='$id',";			foreach($fields as $index=>$fld)				{				if($fld=="submit"){continue;}				$value=$_POST[$fld][$id];				$string.="$fld='$value',";				}			$string=trim($string,", ");			$query="REPLACE dpr_acres SET $string"; //echo "$query<br /><br />";  //exit;			$result = mysql_query($query) or die ("Couldn't execute query. $query");			}		}	//	exit;			}// ********** Get Field Types *********$sql="SHOW COLUMNS FROM  dpr_acres"; $result = @MYSQL_QUERY($sql,$connection);while($row=mysql_fetch_assoc($result)){$allFields[]=$row['Field'];}// ******** Enter your SELECT statement here **********if(@$class){$where="and class='$class'";}if(@$parkcode){$where="and parkcode='$parkcode'";}if(!empty($_POST['class']))	{	$temp=array_unique($_POST['class']); 	sort($temp);	$class=$temp[0];	$where="and class='$class'";	}if(!isset($where)){$where="";}$sql = "SELECT  * From dpr_acreswhere 1 $whereorder by `class`,parkcode";  echo "$sql<br /><br />";$result = mysql_query($sql) or die ("Couldn't execute query. $sql ".mysql_error());while($row=mysql_fetch_assoc($result)){$ARRAY[]=$row;}$fieldNames=array_values(array_keys($ARRAY[0]));$num=count($ARRAY);echo "<html><table border='1' cellpadding='2'>";$sql = "SELECT  distinct class From dpr_acreswhere 1order by class";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_assoc($result)){$classMenu[]=$row['class'];}$sql = "SELECT  distinct class_typeFrom dpr_acreswhere 1order by class";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_assoc($result)){$classTypeMenu[]=$row['class_type'];}$sql = "SELECT distinct parkcode From dpr_acreswhere 1order by parkcode";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_assoc($result)){$parkMenu[]=$row['parkcode'];}echo "<tr>";echo "<form><td align='center' colspan='3'><select name=\"class\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Select Class...</option>";foreach($classMenu as $k=>$v){	if($class==$v){$s="selected";}else{$s="value";}		echo "<option $s='land_acres.php?class=$v'>$v</option>";       }   echo "</select></td></form>";echo "<form><td align='center' colspan='2'><select name=\"class\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Select Park...</option>";foreach($parkMenu as $k=>$v){	if($class==$v){$s="selected";}else{$s="value";}		echo "<option $s='land_acres.php?parkcode=$v'>$v</option>";       }   echo "</select></td></form>";   echo "<td colspan='2' align='center'><font color='red'>$num records</font></td>";echo "<td align='center'><a href='land_acres_report.php'><font color='green'>Summary Report</font></a></td><td align='center'><a href='http://www.dpr.ncparks.gov/system_plan/'><font color='brown'>SYS_PLAN </font></a></td></tr>";echo "<tr>";foreach($fieldNames as $k=>$v){$v=str_replace("_"," ",$v);echo "<th>$v</th>";}echo "</tr>";echo "<form method='POST'><tr>";	$noAdd=array("id");foreach($fieldNames as $k=>$v)	{		if(in_array("$v",$noAdd)){$add_line="&nbsp;";}		else		{		$add_line="<input type='text' name='$v' value='' size='14'>";			if($v=="parkcode")				{				$add_line="<select name='$v'><option selected=''></option>\n";				foreach($parkMenu as $var_k=>$var_v)					{					if($v==$var_v){$s="selected";}else{$s="";}					$add_line.="<option value='$var_v' $s>$var_v</option>\n";					}				$add_line.="</select>";				}			if($v=="class")				{				$add_line="<select name='$v'><option selected=''></option>\n";				foreach($classMenu as $var_k=>$var_v)					{					if($v==$var_v){$s="selected";}else{$s="";}					$add_line.="<option value='$var_v' $s>$var_v</option>\n";					}				$add_line.="</select>";				}			if($v=="class_type")				{				$add_line="<select name='$v'><option selected=''></option>\n";				foreach($classTypeMenu as $var_k=>$var_v)					{					if($v==$var_v){$s="selected";}else{$s="";}					$add_line.="<option value='$var_v' $s>$var_v</option>\n";					}				$add_line.="</select>";				}		}	echo "<td>$add_line</td>";	}if($level>4)	{echo "<td><input type='submit' name='submit' value='Add'></td></tr></form>";}$editFlds=$fieldNames;$excludeFields=array("id","emid");$total_array=array("acres_land","acres_water","length_miles","easement");echo "<form method='POST'>";foreach($ARRAY as $k=>$v)	{// each row	// $fx = font color  and  $tr = row shading	$f1="";$f2="";	@$j++;	if(fmod($j,2)!=0){$tr=" bgcolor='aliceblue'";}else{$tr="";}	echo "<tr>";		foreach($v as $k1=>$v1)			{// field name=$k1  value=$v1				$var=$v1;			IF($k1=="acres_land"){@$total[$k1]+=$v1;}			IF($k1=="acres_water"){@$total[$k1]+=$v1;}			IF($k1=="length_miles"){@$total[$k1]+=$v1;}			IF($k1=="easement"){@$total[$k1]+=$v1;}						$id=$v['id'];				$fld=$k1."[$id]";			$var="<input type='text' name='$fld' value='$v1' size='14'>";					if($k1=="id")				{				$var=$v1;				}						if($k1=="note_1" or $k1=="note_2")				{				$var="<textarea name='$fld' cols='10' rows='1'>$v1</textarea>";				}						if($k1=="parkcode")				{				$var="<select name='$fld'><option selected=''></option>\n";				foreach($parkMenu as $var_k=>$var_v)					{					if($v1==$var_v){$s="selected";}else{$s="";}					$var.="<option value='$var_v' $s>$var_v</option>\n";					}				$var.="</select>";				}			if($k1=="class")				{				$var="<select name='$fld'><option selected=''></option>\n";				foreach($classMenu as $var_k=>$var_v)					{					if($v1==$var_v){$s="selected";}else{$s="";}					$var.="<option value='$var_v' $s>$var_v</option>\n";					}				$var.="</select>";				}			if($k1=="class_type")				{				$var="<select name='$fld'><option selected=''></option>\n";				foreach($classTypeMenu as $var_k=>$var_v)					{					if($v1==$var_v){$s="selected";}else{$s="";}					$var.="<option value='$var_v' $s>$var_v</option>\n";					}				$var.="</select>";				}							echo "<td align='right'>$var</td>";			}		echo "</tr>";	}echo "<tr><td colspan='4'>&nbsp;</td>";foreach($fieldNames as $k=>$v)	{	$f="";	if($k==2){$f=$num." units";}	if(!in_array($v, $total_array)){continue;}	 if($total[$v])	 	{	 	if($v=="acres_land" or $v=="easement" or $v=="acres_water")	 		{@$grand_total+=$total[$v];}	 		 	$f=number_format($total[$v],2);	 	}	echo "<th>$f</th>";	}@$gt=number_format($grand_total,2);echo "<th>$gt acres</th></tr>";if(empty($where))	{	echo "<tr>";	foreach($fieldNames as $k=>$v){$v=str_replace("_"," ",$v);echo "<th>$v</th>";}	echo "</tr>";	}if($level>4)	{	echo "<tr><td colspan='10' align='center'>	<input type='submit' name='submit' value='Update'>	</td></tr></table></form>";	}echo "</body></html>";?>