<?php//session_start();//include("../../../include/authBUDGET.inc");//echo "<pre>";print_r($_SESSION);echo "</pre>";//exit;//echo "<pre>";print_r($_SERVER);echo "</pre>";//exit;echo "<pre>";print_r($_REQUEST);echo "</pre>"; //exit;$file="pcard_split_update.php";$fileMenu="pcard_recon_menu.php";//$varQuery=$_SERVER[QUERY_STRING]."&m=$m";// ECHO "v=$varQuery";//exit;// ECHO "$_SERVER[QUERY_STRING]";//exit;//$reportHeader=explode("&",$_SERVER[QUERY_STRING]);//print_r($reportHeader);// **** Allow processing assistant access to all centers//if($_SESSION[budget][select]=="ADM"){$level=3;}extract($_REQUEST);$testAmt=number_format(array_sum($amount),2);echo "<br />testAmt=$testAmt<br />";echo "<br />passAmount=$passAmount<br />";//exit;if($testAmt!=$passAmount){echo "The sum of the split amounts ($testAmt) does not equal the original amount ($passAmount). Click your back button and double check your values.";exit;}echo "<br />testAmt equals passAmount<br />";//exit;$distPark=strtoupper($parkcode);$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // database// ******** Edit/Update Status ***********if($submit=="Update"){//echo "<pre>";print_r($arrayLocation);print_r($arrayTransID);//print_r($_REQUEST);echo "</pre>";exit;$today=date("Y-m-d");// Create UPDATE query ****************foreach($_REQUEST as $k=>$v){$break="";//if($k!="id"){$fldArray[]=$k;}if($k=="amount"){$fldArray[]=$k;}$val=$v[0];if($k!="amount"){continue;}/*if($k=="ncasnum"){// format a correct NCAS number$ck_ncasnum=$val;$val=str_replace("-","",$ck_ncasnum);if(strlen($val)==4 || strlen($val)==7){$val="53".$val;}}if($k=="equipnum"){$val=$v[0]; $break=1;}	*/	$updateFld.="`".$k."`='".$val."',";		if($break){break;}// break out of loop after fld equipnum}// end foreach	$updateFld=trim($updateFld,",");	$query="UPDATE `pcard_unreconciled` set $updateFld,vendor_name=replace(vendor_name,'\'','')WHERE id='$arrayID'";//echo "q=$query<br><br>";//print_r($fldArray);exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query 0. $query");// Create INSERT query(ies) ****************// First get boilerplate data from original record$sql="SELECT * from `pcard_unreconciled` where id='$arrayID'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 0. $sql");$row=mysqli_fetch_assoc($result);ksort($row);//echo "<pre>";print_r($row);echo "</pre>";//print_r($fldArray);$alpha=range(a,z);// Next create boilerplate INSERT query// Replace old values with those submittedfor($j=1;$j<count($_REQUEST[amount]);$j++){foreach($fldArray as $k=>$v){$val=$_REQUEST[$v][$j];if($v=="budget_ok"){$val=$_REQUEST[$v][$j][0];}if(in_array($v,$fldArray)){$row[$v]=$val;}}$new_trans_id=$row[trans_id].$alpha[$j-1];// Now create query string$count=count($_REQUEST[amount])-1;for($jj=1;$jj<=$count;$jj++){$insertFld="";foreach($row as $k=>$v){if($k=="trans_id"){$v=$new_trans_id;}if($k=="ncasnum"){// format a correct NCAS number$ck_ncasnum=$v;$v=str_replace("-","",$ck_ncasnum);if(strlen($v)==4 || strlen($v)==7){$v="53".$v;}}if($k!="id"){$insertFld.=$k."='".$v."',";}}}	$insertFld=trim($insertFld,",");	//$insertFld=str_replace($insertFld,"'","");$query="INSERT INTO `pcard_unreconciled` set $insertFld";//echo "$query<br><br>";$result = mysqli_query($connection, $query) or die ("Couldn't execute query 0. $query");}//echo "I'm modifing the way a Pcard split works. Please wait until after 1pm on Thursday to split any Pcard purchases. Thanks, Tom.";//exit;$query="UPDATE pcard_unreconciled,coa set pcard_unreconciled.ncas_description=coa.park_acct_desc where pcard_unreconciled.ncasnum=coa.ncasnum";//echo "$query<br>";//exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query 0. $query");$var="report_date=$report_date&admin_num=$parkcode&submit=Find";header("Location:pcard_recon.php?$var");}?>