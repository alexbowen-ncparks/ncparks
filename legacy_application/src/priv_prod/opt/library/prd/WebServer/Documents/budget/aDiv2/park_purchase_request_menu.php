<?phpif(!$report_date AND !$pa_number AND !$re_number){$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("../../../include/authBUDGET.inc");include("../menu.php");extract($_REQUEST);$level=$_SESSION['budget']['level'];$thisUser=$_SESSION['budget']['tempID'];$center=$_SESSION['budget']['centerSess'];}// $report_date can be SET in either Input1 or Input3 & Value is passed back to this file(recursive).  //echo "<pre>";print_r($_SERVER);"</pre>";//exit;echo "<pre>";print_r($_SESSION);"</pre>";//exit;echo "<pre>";print_r($_REQUEST);"</pre>";//exit;//TABLE1 Startecho "<table border='1' cellpadding='5'>";//TR1 Startecho "<tr>";//TD1 Start-Pre-approval Purchase Listecho "<td colspan='5' align='center'>      Pre-approval Purchase List by Report Date:";	  //Input1-START: Drop-down for Report Date	  	  	  $query1="select distinct report_datefrom purchase_approval_report_dateswhere 1 and f_year='1011'order by report_date desc;";$result1=mysqli_query($connection, $query1) or die ("Couldn't execute query 1. $query1");while($row=mysqli_fetch_array($result1)){	$menuArray[]=$row['report_date'];	$report_dateArray=$menuArray;}echo "<form method='post'><select name='report_date' onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";      foreach($menuArray as $k=>$v){       if($report_date==$v){$s="selected";}else{$s="value";}		echo "<option $s='park_purchase_request_menu.php?report_date=$v'>$v</option>";       }echo "</select>";echo "</form></td>";//Input1-END: Drop-down for Report Date	 //TD1-END: Pre-approval Purchase List//Input2-START: Drop-down for Purchase Typeunset($menuArray);	$query2="Select distinct purchase_type	From purchase_request_3	where purchase_type != ''	Order by purchase_type;	";		$result2=mysqli_query($connection, $query2) or die ("Couldn't execute query 2. $query2");		while($row=mysqli_fetch_array($result2)){		$menuArray[]=$row['purchase_type'];		$purchase_type_array=$menuArray;	}         //TD2-START: Purchase Type & DateRange Block				echo "<td align='right'>";				//FORM1-START: Purchase Type & DateRange Block				echo "<form>";				echo "Purchase Type: <select name='purchase_type'>";				//Creates Blank Value as First Option in Drop-down					echo "<option></option>";			   			   foreach($menuArray as $k=>$v){			    			      if($purchase_type==$v){$s="selected";}else{$s="value";}				  			echo "<option $s='$v'>$v</option>"; 		      }			echo "</select><br />";			//Input2-END: Drop-down for Purchase Type	//Input3-START: Input Box for DateRange	unset($menuArray);		$query3="select distinct report_datefrom purchase_approval_report_dateswhere 1 and f_year='1011'order by report_date desc;";$result3=mysqli_query($connection, $query3) or die ("Couldn't execute query 3. $query3");while($row=mysqli_fetch_array($result3)){	$menuArray[]=$row['report_date'];	$report_dateArray=$menuArray;}		$c=count($menuArray)-1;	$date_range=$menuArray[$c]."*".$menuArray[0];if(strpos($report_date,"*")>-1){$date_range=$report_date;}	else{}			echo "Hyphens in date are optional. <br />		<input type='text' name='report_date' value='$date_range'>		<input type='hidden' name='section' value='$section'>		<input type='hidden' name='district' value='$district'>		<input type='submit' name='submit' value='Submit'>		</form></td>";				//Input3-END: Input Box for DateRange//FORM1-END: Purchase Type & DateRange Block//TD2-END: Purchase Type & DateRange Block//Input4-START: Input Box for Section(only shows up if Report Date has been selected & level>2		if($report_date AND ($level>2)){unset($menuArray);$query4="select distinct sectionfrom centerwhere 1and center.actcenteryn='y'and center like '%1280%'order by section asc;";$result4=mysqli_query($connection, $query4) or die ("Couldn't execute query 4. $query4");while($row=mysqli_fetch_array($result4)){      $menuArray[]=$row['section'];}//TD3-START: Section Block//FORM2-START: Section Blockecho "<td><form method='post'>Section:<br /><select name='section' onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";      foreach($menuArray as $k=>$v){       if($section==$v){$s="selected";}else{$s="value";}		echo "<option $s='park_purchase_request_menu.php?report_date=$report_date&section=$v'>$v</option>";       }echo "</select>";echo "</form></td>";}//Input 4-END: Input Box for Section//TD3-END: Section Block//FORM2-END: Section Block//Input5-START: Input Box for District-only shows up if (Section=Operations & level>1) OR $level==2if(($level>1 AND $section=="operations") OR ($level==2)){unset($menuArray);$menuArray=array("east","north","south","west","STWD");//TD4-START: District Block//FORM3-START: District Blockecho "<td><form method='post'>District:<br /><select name='district' onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";      foreach($menuArray as $k=>$v){       if($district==$v){$s="selected";}else{$s="value";}		echo "<option $s='park_purchase_request_menu.php?report_date=$report_date&section=operations&district=$v'>$v</option>";       }echo "</select>";echo "</form></td>";//Input 5-END: Input Box for District//FORM3-END: District Block//TD4-END: District Block}//Input6-START: Input Box for Center Code-only shows up if (Section=Operations & level>1) OR $level==2if(($level>1 AND $section=="operations") OR ($level==2)){unset($menuArray);$query5="select distinct center_codefrom purchase_request_3where 1order by center_code;";$result5=mysqli_query($connection, $query5) or die ("Couldn't execute query 5. $query5");while($row=mysqli_fetch_array($result5)){      $parkMenuArray[]=$row['center_code'];}//TD5-START: CenterCode Block//FORM5-START: CenterCode Blockecho "<td><form method='post'>Center Code:<br /><select name='center_code' onChange=\"MM_jumpMenu('parent',this,0)\">";echo "<option></option>";      foreach($parkMenuArray as $k=>$v){       if($center_code==$v){$s="selected";}else{$s="value";}		echo "<option $s='park_purchase_request_menu.php?report_date=$report_date&section=operations&center_code=$v'>$v</option>";       }echo "</select>";echo "</form></td>";//Input6-END: Input Box for Center Code//FORM5-END: CenterCode Block//TD5-END: CenterCode Block}//TD6-START: New Request LINKecho "<td><a href='park_purchase_request.php?submit=Submit'>New Request</a></td>";//TD6-END: New Request LINK//TD7-START: PA# & RE# FIND//FORM6-START: PA# & RE# FIND//INPUT7-START: PA# & RE# FINDecho "<td align='right'><form action='park_purchase_request_view.php'>PA# <input type='text' name='pa_number' value='$pa_number' size='6'><br />RE# <input type='text' name='re_number' value='$re_number' size='6'><br /><input type='submit' name='submit' value='Find'></form></td>";//INPUT7-END: PA# & RE# FIND//FORM6-END: PA# & RE# FIND//TD7-END: PA# & RE# FIND//Input8-START: Input Box for Setting Div Approved=Section Approved  if $level>4if($level>4){//TD8-START: Setting Div Approved=Section Approved//Not sure where $message1 comes from but probably another File sends back message that Update was... //...successfulecho "<td align='center'><font color='red'>$message1<br />CAUTION!!</font>";//FORM7-START: Setting Div Approved=Section Approvedecho "<form method='post' action='park_purchase_request_update_Div_all.php'>Set Div. Approved Status<br /><font color='blue'>equal</font> Section Approved Status<br />      <select name='division_approve'>";	  echo "<option></option>";//Re-uses $report_dateArray established in TD1      foreach($report_dateArray as $k=>$v){       if($report_date==$v){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v</option>";       }	   echo "</select>";echo "<input type='submit' name='submit' value='Update'>";echo "</form></td>";//Input8-END: Input Box for Setting Div Approved=Section Approved//FORM7-END: Setting Div Approved=Section Approved//TD8-END: Setting Div Approved=Section Approved}//TD9-START: Updating RE Values by Purchase Type//FORM8-START: Updating RE Values by Purchase Type//Input9-START: Input Box for Updating RE Values by Purchase Type  if $level>4if($level>4){//Not sure where $message3 comes from but probably another File sends back message that Update was... //...successfulecho "<td align='center'><font color='red'>$message3</font>";echo "<form method='post' action='park_purchase_request_update_Div_RE.php'>Update RE Values<br />by Purchase Type<br />";echo "<select name='report_date'>";echo "<option></option>";//Re-uses $report_dateArray established in TD1      foreach($report_dateArray as $k=>$v){       if($report_date==$v){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v</option>";       }echo "</select><br />";echo "<select name='purchase_type'>";echo "<option></option>";//Re-uses $purchase_type_array established in TD2      foreach($purchase_type_array as $k=>$v){//       if($purchase_type==$v){$s="selected";}else{$s="value";}		$s="value";		echo "<option $s='$v'>$v</option>";       }echo "</select>";echo "<br />RE# <input type='text' name='re_number' value='$re_number' size='6'>";echo "<input type='submit' name='submit' value='Update'>";echo "</form></td>";//Input9-END: Input Box for Updating RE Values by Purchase Type//FORM8-END: Updating RE Values by Purchase Type//TD9-END: Updating RE Values by Purchase Type//}//TD10-START: Updating RE Values by Purchase Type if //FORM9-START: Updating RE Values by Purchase Type//Input10-START: Input Box for Updating RE Values by Purchase Type  if $level>4 (began on TD9)//Not sure where $message2 comes from but probably another File sends back message that Update was... //...successfulecho "<td align='center'><font color='red'>$message2</font><form method='post' action='park_purchase_request_update_Div_all.php'>Update Invoice & PCARD Modules<br />for PA Approvals<br /><select name='pa_approvals'>";echo "<option></option>";//Re-uses $report_dateArray established in TD1      foreach($report_dateArray as $k=>$v){       if($report_date==$v){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v</option>";       }echo "</select>";echo "<input type='submit' name='submit' value='Update'>";echo "</form></td>";}// end level>4//Input10-END: Input Box for Updating RE Values by Purchase Type//FORM9-END: Updating RE Values by Purchase Type//TD10-END: Updating RE Values by Purchase Typeecho "</tr></table>";//TR1 END//TABLE1 END//TONY start: lines206-213 only display when the user first pulls up file & Variable: report_date,pa_number,&re_number have not been setif(!$report_date AND !$pa_number AND !$re_number){echo "<table><tr><td bgcolor='white'><font color='red'>All Budget Contacts:<br><br>This NEW Weekly Pre-Approval process is for purchases $2,500 or less. The following items are excluded:</font><br><br>&nbsp;&nbsp;&nbsp;1) Travel Purchases (Approved thru other processes)<br><br>&nbsp;&nbsp;&nbsp;2)Purchases for Utilities including: a)water  b)sewer  c)electricity  d)gas  e)propane  f)oil  g)waste removal  h)other Utilities<br><br>&nbsp;&nbsp;&nbsp;3)Purchases for Approved Projects (Major Maintenance, Trail Maintenance, Capital Improvement, etc)<br><br>&nbsp;&nbsp;&nbsp;4)Equipment items $2,500 or greater</td></tr>";}//TONY end: lines206-213//TONY start: lines219-222  $district,$section,$center_code are Variables set thru Javascript... //...Drop down menus: District,Section,Center Code. Each time User Selects from 1 of these drop downs//...Values are passed back to this File. $purchase_type is a FORM Variable(not Javascript variable)...//...and is only passed back to this File when the Submit button is clicked		if($district){$passDist="&district=$district";}		if($section){$passSect="&section=$section";}		if($center_code){$passCent="&center_code=$center_code";}		if($purchase_type){$passPurc="&purchase_type=$purchase_type";}		//TONY end: lines219-222						if($level<3){	if($report_date){	echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Approved</a></td>";	//echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit'>View Approved</a></td>";	echo "	<td><a href='park_purchase_request_view.php?view=all&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View All</a></td>	<td><a href='park_purchase_request_view.php?view=pending&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Pending</a></td>	<td><a href='park_purchase_request_view.php?view=denied&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Denied</a></td>	</tr>";}}//TONY start: lines 232-243 Level 3 & level 4 users must first choose a Report Date. Once a report date has been chosen,the...//... Section Drop Down appears. Then Level 3&4 users select the Section from Drop-down. Once...//... both Variables have been selected, Level 3&4 users will see links below:if($level==3 || $level==4){	if($report_date AND $section){	echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Approved</a></td>";	//echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit'>View Approved</a></td>";	    echo "<td><a href='park_purchase_request_view.php?view=all&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View All</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=all&report_date=$report_date&submit=Submit'>View All</a></td>";	echo "<td><a href='park_purchase_request_view.php?view=pending&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Pending</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=pending&report_date=$report_date&submit=Submit'>View Pending</a></td>";	echo "<td><a href='park_purchase_request_view.php?view=denied&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Denied</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=denied&report_date=$report_date&submit=Submit'>View Denied</a></td>";	echo "</tr>";}}//TONY end: lines 232-243if($level>4){	if($report_date){echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Approved</a></td>";    //echo "<tr><td><a href='park_purchase_request_view.php?view=approved&report_date=$report_date&submit=Submit'>View Approved</a></td>";	echo "<td><a href='park_purchase_request_view.php?view=all&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View All</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=all&report_date=$report_date&submit=Submit'>View All</a></td>";	echo "<td><a href='park_purchase_request_view.php?view=pending&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Pending</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=pending&report_date=$report_date&submit=Submit'>View Pending</a></td>";	echo "<td><a href='park_purchase_request_view.php?view=denied&report_date=$report_date&submit=Submit$passDist$passSect$passCent$passPurc'>View Denied</a></td>";	//echo "<td><a href='park_purchase_request_view.php?view=denied&report_date=$report_date&submit=Submit'>View Denied</a></td>";	echo "</tr>";}}?>