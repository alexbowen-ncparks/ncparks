<?phpextract($_REQUEST);//echo "<pre>"; print_r($_REQUEST); echo "</pre>"; // exit;include("../../include/parkcodesDiv.inc");require('../../fpdf16/fpdf.php');require('../../fpdf16/extend_print_pdf.php');include("f_year.php");$database="system_plan";include("../../include/connectROOT.inc"); // database connection parameters//echo "c1=$connection";//exit;  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");// Park Name$pdf=new PDF();$pdf->SetTitle("Interpretive Themes");//First page$left_margin=20;$pdf->SetLeftMargin($left_margin);$pdf->SetRightMargin(20);foreach($_POST['parkcode'] as $k=>$v){$parkcode=$k;$pdf->AddPage();$pdf->SetFont('Arial','',18);$pdf->Cell(0,0,$parkCodeName[$k],0,0,C);$pdf->Image("pale_logo.jpeg",175,5,25);$pdf->SetFont('Arial','',5);$pdf->SetTextColor(140);$pdf->Cell(-5.2,-4,"N.C. Division of Parks & Recreation",0,0,C);$pdf->SetTextColor(0);$database="system_plan";include("../../include/connectROOT.inc"); // database connection parameters//echo "c1=$connection";//exit;  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");  unset($FAC_DISPLAY);// Get display name for facilities$sql="SELECT *from facwhere parkcode='$parkcode'order by fld_name";//echo "$sql"; //exit;$result = @MYSQL_QUERY($sql,$connection);	while($row=mysql_fetch_assoc($result)){$FAC_DISPLAY[]=$row;}//echo "<pre>"; print_r($FAC_DISPLAY); echo "</pre>";  exit;include("../../include/connectDIVPER.62.inc"); // database connection parameters  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");//echo "c2=$connection";exit;if($parkcode=="JONE"){$where="OR t1.parkcode='SALA'";} unset($PARK_INFO);$sql="SELECT county, class, class_type, sum(acres_land) as acres_land, sum(acres_water) as acres_water, sum(length_miles) as length_miles, note_1, note_2, park_purpose, inter_themes, park_summary, trail_summaryfrom dpr_acres as t1LEFT JOIN dprunit as t2 on t2.parkcode=t1.parkcodewhere t1.parkcode='$parkcode' $wheregroup by t1.parkcode,class,class_typeorder by class";//echo "$sql"; //exit;$result = @MYSQL_QUERY($sql,$connection);	while($row=mysql_fetch_assoc($result)){$PARK_INFO[]=$row;}//echo "<pre>"; print_r($PARK_INFO); echo "</pre>"; exit; unset($FACILITY);$sql="SELECT fac_name, fac_desc, sum(number) as numberfrom facility_desc as t1LEFT JOIN dprunit as t2 on t2.parkcode=t1.parkcodewhere t1.parkcode='$parkcode'group by t1.parkcode,fac_nameorder by fac_name";//echo "$sql"; //exit;$result = @MYSQL_QUERY($sql,$connection);	while($row=mysql_fetch_assoc($result)){$FACILITY[]=$row;}//echo "<pre>"; print_r($FACILITY); echo "</pre>"; // exit; unset($POSITION1);// Staff$sql="SELECT working_title as position, count(seid) as numfrom position where park='$parkcode' AND code='$parkcode'group by position order by current_salary desc";//echo "$sql"; //exit;$result = @MYSQL_QUERY($sql,$connection);	while($row=mysql_fetch_assoc($result)){$POSITION1[]=$row;}//echo "<pre>"; print_r($POSITION); echo "</pre>"; // exit;include("../../include/connect195.inc"); // database connection parameters unset($POSITION2);$sql="SELECT posTitle as position, beacon_title as position_beacon, count(id) as numfrom seasonal_payrollwhere center_code='$parkcode' and f_year='$f_year' and posTitle!=''group by posTitle order by num desc";$result = @MYSQL_QUERY($sql,$connection);//echo "$sql r=$result"; //exit;while($row=mysql_fetch_assoc($result)){$POSITION2[]=$row;}$database="photos";  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");$sql="SELECT linkfrom photos.imageswhere park='$parkcode' and sys_plan='x'";$result = @MYSQL_QUERY($sql,$connection);//echo "$sql r=$result"; //exit;$row=mysql_fetch_assoc($result);{	if($row['link']!=""){$var=explode("/",$row['link']);$var640="640.".$var[3];$link="http://149.168.1.195/photos/".$var[0]."/".$var[1]."/".$var[2]."/".$var640;}}include("../../include/connect196.inc"); // database connection parameters$database="park_use";  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");       $sql="SELECT fld_name as fac_name, category_desc as fac_descFROM `categories`left join park_category on park_category.category=categories.category_idWHERE park_id='$parkcode'";//echo "$sql"; //exit;$result = @MYSQL_QUERY($sql,$connection);	while($row=mysql_fetch_assoc($result)){$FACILITY[]=$row;}//echo "<pre>"; print_r($FACILITY); echo "</pre>"; // exit;$sql="SELECT sum(attend_tot) as visit_prevfrom statswhere park='$parkcode' and left(year_month_week,4)='$prev_yr'group by left(year_month_week,4)";$result = @MYSQL_QUERY($sql,$connection);	$row=mysql_fetch_assoc($result);if($row){extract($row);}$sql="SELECT sum(attend_tot) as visit_pentfrom statswhere park='$parkcode' and left(year_month_week,4)='$pent_yr'group by left(year_month_week,4)";$result = @MYSQL_QUERY($sql,$connection);	$row=mysql_fetch_assoc($result);if($row){extract($row);}$ps=$PARK_INFO[0]['park_summary'];$pdf->SetY(20);$pdf->SetFont('Times','',11);if($ps==""){$ps="The summary information for this park has not yet been entered.\n\n";}else{$ps.="\n\n";}$pdf_text="Summary\n".$ps;       // Interpretive themes$it=$PARK_INFO[0]['inter_themes'];$pdf_text.="Interpretive Themes\n".$it;//Acreage$land="";$water="";foreach($PARK_INFO as $k=>$v){	foreach($v as $k1=>$v1){		if($k1=="acres_land"){$land+=$v1;}		if($k1=="acres_water"){$water+=$v1;}		}	}if($land>0){$acres_land=number_format($land,0)." land acres";}if($water>0){$acres_water=number_format($water,0)." water acres";}// Miles for State Rivers and State Trailsforeach($PARK_INFO AS $k=>$v){		foreach($v as $k1=>$v1){			if($k1=="class_type" and $PARK_INFO[$k]['length_miles']>0){$type[]=$v1." - ".$PARK_INFO[$k]['length_miles'];}			}		}		if($type){$type=array_unique($type);		foreach($type as $k=>$v){			$varType.="$v miles<br />";			$pdfType.="[$v miles] ";			}$varType="<b>State River</b><br />".$varType;			}$note_1=$PARK_INFO[0]['note_1'];$note_2=$PARK_INFO[0]['note_2'];$pdf_text.="\n\nAcreage (as of $prev_yr): [$acres_land]";if($acres_water){$pdf_text.=" [$acres_water]";}if($pdfType!=""){		$pdf_text.="\nState River: $pdfType";		}//County$county=$PARK_INFO[0]['county'];//Visitation$visitation1=number_format($visit_prev,0);$pdf_text.="     Visitation ($prev_yr): $visitation1";$split=explode(",",$county);	if(count($split)>1){$varCounty="Counties:";}else{$varCounty="County:";}$pdf_text.="         $varCounty $county";		$y = $pdf->GetY();$pdf->Write(4,$pdf_text);// Facilities		$pdf->SetX(20);		$pdf_text="Visitor Facilities  (as of $prev_yr)";		$pdf->Cell(0,$y,$pdf_text);$database="system_plan";include("../../include/connectROOT.inc"); // database connection parameters  $db = mysql_select_db($database,$connection)       or die ("Couldn't select database");              unset($fac_cell);if($FAC_DISPLAY!=""){	$skip=array("id");foreach($FAC_DISPLAY as $k=>$v){				foreach($v as $fld=>$value){					if(in_array($fld,$skip)){continue;}					if($fld=="display_name"){					if($value==""){					$sql="SELECT display_name as value					FROM `fac`					WHERE fld_name='$v[fld_name]'"; //echo "$sql";exit;					$resultFac = @MYSQL_QUERY($sql,$connection);					$xx=mysql_num_rows($resultFac);					if($xx>0){					$rowFac=mysql_fetch_assoc($resultFac);					extract($rowFac);}					}			$number=$v['number'];			if($number>1){$number="=> $number";}				else{$number="";}					$fac_cell.=$value." ".$number;							}								$fac_cell.="\n";				}// end foreach		}	}		if($pdf_text!=""){		$pdf_text=$fac_cell;		$y = $pdf->GetY()+13;		$pdf->SetXY(25,$y);		$pdf->MultiCell(0,1,$pdf_text);		}if($FACILITY[1]){$pos="     Permanent Staff\n"; $num="\n";	foreach($POSITION1 as $k=>$v){				foreach($v as $fld=>$value){							if($fld=="position"){						$sl=$pdf->GetStringWidth($value);						if($sl>$sl_max){$sl_max=$sl;}						$pos.=$value."\n";}					if($fld=="num"){$num.=$value."\n";}									}		}if($rep==1){$pdf_text=$pos;	$staff_margin=55;		$y = $pdf->GetY()+5;		$pdf->SetXY($staff_margin,$y);$pdf->MultiCell(0,4.1,$pdf_text); $pdf_text=$num;$x=$staff_margin+$sl_max+3;		$pdf->SetXY($x,$y);$pdf->MultiCell(0,4.1,$pdf_text); $staff_y=$pdf->GetY();}$pos="     Seasonal Staff\n"; $num="\n";$sl_maxS="";foreach($POSITION2 as $k=>$v){						foreach($v as $fld=>$value){									if($fld=="position"){						if($value=="none"){$value=$v['position_beacon'];}						$sl=$pdf->GetStringWidth($value);						if($sl>$sl_maxS){$sl_maxS=$sl;}						$pos.=$value."\n";}					if($fld=="num"){$num.=$value."\n";}									}					}// $POSITION2[1]	}// end $FACILITY[1]	$pdf_text=$pos;		$x = $sl_max+$staff_margin+25;		$pdf->SetXY($x,$y);$pdf->MultiCell(0,4.1,$pdf_text);$pdf_text=$num;$x=$x+$sl_maxS+3;		$pdf->SetXY($x,$y);$pdf->MultiCell(0,4.1,$pdf_text); $seasonal_y=$pdf->GetY();$x=$left_margin+12;if($staff_y>$seasonal_y){$y=$staff_y;}else{$y=$seasonal_y;}if($link!="" AND $y<190){	$y+=10;	$pdf->Image($link,$x,$y,140);}	}// end each park	$pdf->Output("NC_State_Park_profiles.pdf",I);?>