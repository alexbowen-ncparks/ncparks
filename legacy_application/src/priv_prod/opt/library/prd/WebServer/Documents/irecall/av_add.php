<?php$database="irecall";include("../../include/connectROOT.inc");mysql_select_db($database,$connection);extract ($_FILES);extract ($_REQUEST);// This is very messy and should be cleaned up! Later perhaps.// modified by Tom Howard after// store.php3 - by Florian Dittmer <dittmer@gmx.net>// Example php script to demonstrate the storing of binary files into// an sql database. More information can be found at http://www.phpbuilder.com///print_r($_REQUEST);print_r($_FILES);//exit;?><HTML><HEAD><TITLE>Store photograph into iRECALL</TITLE></HEAD><body bgcolor="beige"><?php    // Show the form to submit a soundif (@$submit == "")	{	$sql = "SELECT max(soundid) FROM irecall.sound";	$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());	$row=mysql_fetch_array($result);	extract($row);	$sid=@$soundid+1;		MYSQL_CLOSE();			echo "<hr>";		if(!isset($name)){$name="";}	?>		<form method="post" action="<?php echo "av_add.php"; ?>" enctype="multipart/form-data">	Date of Recording (if known): 		<input type="text" name="dateSound" size="16"><br><br>		Park associated with recording (if known):<br><input type="text" name="park" size="50"><br><br>		Person who made recording (if known):<br><input type="text" name="source" size="50"><br><br>		Description or Comment:<br><textarea cols="40" rows="5" name="comment">	</textarea><hr>		<INPUT TYPE="hidden" name="sid" value="<?php echo $sid; ?>"		<INPUT TYPE="hidden" name="name" value="<?php echo $name; ?>"		<INPUT TYPE="hidden" name="MAX_FILE_SIZE" value="1000000">		<br>1. Click the button to select your file.		<input type="file" name="sound"  size="40">		<p>2. Then click this button. <input type="submit" name="submit" value="Add Sound or Video">		</form>  	<?php } ?><?php    // Data from Sound form is processedif (@$submit == "Add Sound or Video")	{	//print_r($_FILES);EXIT;	$type = $_FILES['sound']['type']; if($type==""){echo "Improper sound format. Type=$type";exit;}	$pos1 = strpos($type, "audio");	$pos2 = strpos($type, "video");	//echo "1=$pos1 2=$pos2";exit;	if($pos2=="0"){$reply="View the video";}else{$reply="Listen to the audio";}	if($pos1+$pos2 === ""){echo "Make sure the file is of a supported type: mp3, wav, or mov. Contact Tom Howard if you are having difficulty.";exit;}			mysql_select_db("irecall.sound");	$timestamp = strtotime($dateSound);	$newdate = date("y/m/d", $timestamp);	$name = strtoupper($name);		$file = $_FILES['sound']['name'];	$file_size = $_FILES['sound']['size'];	$file_size=round($file_size/1000);	//echo "f=$file_size";exit;	$name=$file;	//$ext = substr(strrchr($file, "."), 1);// find file extention, mp3 e.g.	$file = str_replace(" ","",strtolower($name));// remove spaces	if(!is_uploaded_file($sound['tmp_name'])){echo "not loaded"; exit;}		$uploaddir = "sounds/";	 	$result=MYSQL_QUERY("INSERT INTO irecall.sound (sid,comment,type,source,dateSound,park,file_size) "."VALUES ('$sid','$comment','$type','$source','$dateSound','$park','$file_size')");		$soundid= mysql_insert_id();			$uploadfile = $uploaddir.$soid.$file;		move_uploaded_file($sound['tmp_name'],$uploadfile);// create file on server		chmod($uploadfile,0775);			  $sql = "UPDATE sound set link='$uploadfile' where soundid='$soundid'";	$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());		MYSQL_CLOSE();	// Display		echo "<br>Success!<br><a href='#' onClick=\"window.open('$uploadfile','The Movie','height=275,width=550');\">$reply for $name in a new window</a>";	echo "<br><br><br><a href='home.php'>Return</a>";	}// **************** STORY ***************************  ?></BODY></HTML>