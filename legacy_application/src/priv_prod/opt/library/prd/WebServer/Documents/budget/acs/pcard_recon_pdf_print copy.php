<?php # create_pdf.php while($row=mysql_fetch_assoc($result)){	$array[]=$row;	$pcard_array[]=$row['pcard_num'];}	$pcard_num_array=array_count_values($pcard_array);//echo "<pre>"; print_r($pcard_num_array); echo "</pre>";  exit;define ("PAGE_WIDTH", 792); // 11 inchesdefine ("PAGE_HEIGHT",612); // 8.5 inches// Make the invoice.	$pdf = pdf_new(); include("/opt/library/prd/WebServer/include/pdf_key_23.php");pdf_open_file ($pdf, "");// Set the different PDF values.pdf_set_info ($pdf, "Author", "Tom Howard");pdf_set_info ($pdf, "Title", "Invoice for " . $vendor_name);pdf_set_info ($pdf, "Creator", "See Author");// ******************** Start Loop ***************$header_array=array("admin_num","cardholder","pcard_num","location","transid","transdate","vendor_name","amount","item_purchased","ncas_description","company","ncasnum","center","pa_number","re_number");$cut=21;// Create the page.pdf_begin_page ($pdf, PAGE_WIDTH, PAGE_HEIGHT);$new_page=1;foreach($array as $num=>$value_array){	$pcard_num=$array[$num]['pcard_num'];	$transid=$array[$num]['transid'];	$prev_transid=$array[$num-1]['transid'];		$num_pages=ceil($pcard_num_array[$pcard_num]/$cut);	if($num_pages==1){$single=1;}		if(($pcard_num!=$prev_pcard_num AND $num!=0) OR $cutRow>$cut)		{			if($pcard_num!=$prev_pcard_num){				$pageNum=0;						$x=74; $y=20;$text="Reconciler Signature";					pdf_show_xy ($pdf, $text, $x ,$y);					pdf_moveto($pdf, 140, 20);					pdf_lineto($pdf, 250, 20);					pdf_stroke($pdf);						$text="Date";					pdf_show_xy ($pdf, $text, 274 ,$y);					pdf_moveto($pdf, 290, 20);					pdf_lineto($pdf, 370, 20);					pdf_stroke($pdf);						$text="Approver Signature";					pdf_show_xy ($pdf, $text, 417 ,$y);					pdf_moveto($pdf, 479, 20);					pdf_lineto($pdf, 610, 20);					pdf_stroke($pdf);						$text="Date";					pdf_show_xy ($pdf, $text, 638 ,$y);					pdf_moveto($pdf, 655, 20);					pdf_lineto($pdf, 700, 20);					pdf_stroke($pdf);					}									else					{					$text="Continued on next page.";					pdf_show_xy ($pdf, $text, 350 ,20);										}				pdf_end_page ($pdf);					pdf_begin_page ($pdf, PAGE_WIDTH, PAGE_HEIGHT);			$new_page=1;			$cutRow=1;		}		// Set the default font from here on out.				$arial = pdf_findfont ($pdf, "Arial", "winansi");		$arialBold = pdf_findfont ($pdf, "arialnb", "winansi");		$arialItalic = pdf_findfont ($pdf, "Arial_Italic", "winansi");if($new_page==1){			$pageNum++;$fontSize=8;pdf_setfont ($pdf, $arial, $fontSize);	$date=date("Y-m-d");$text="Source: DPR Budget Database $date";$widthText = pdf_stringwidth ($pdf, $text);// Width of Title$ver=PAGE_HEIGHT-25;pdf_show_xy ($pdf, $text, 15 ,$ver+2);$fontSize=11;$lead=$fontSize+3;pdf_setfont ($pdf, $arialBold, $fontSize);$text="DIVISION OF PARKS AND RECREATION";$widthText = pdf_stringwidth ($pdf, $text);// Width of Title$hor=(PAGE_WIDTH-$widthText)/2;pdf_show_xy ($pdf, $text, $hor ,$ver);$text="Page $pageNum of ".$num_pages;pdf_show_xy ($pdf, $text, $hor+410 ,$ver-1.5);pdf_setlinewidth($pdf,0.3);pdf_moveto($pdf, 15, PAGE_HEIGHT-27);		pdf_lineto($pdf, 770, PAGE_HEIGHT-27);		pdf_stroke($pdf);pdf_moveto($pdf, 15, PAGE_HEIGHT-57);		pdf_lineto($pdf, 770, PAGE_HEIGHT-57);		pdf_stroke($pdf);		$hor=15; $ver=$ver-12;$text="admin";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=25; $text="#";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=60; $text="card";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=55; $text="holder";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=145; $text="pcard";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=140; $text="number";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=200; $text="location";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=245; $text="transid";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=285; $text="transdate";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=345; $text="vendor";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=346; $text="name";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=405; $text="amount";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=465; $text="item";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=450; $text="purchased";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=555; $text="ncas";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=540;$text="description";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=613; $text="company";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=655; $text="ncasnum";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=699; $text="center";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=737; $text="pa";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=738;$text="#";pdf_show_xy ($pdf, $text, $hor ,$ver-12);$hor=760; $text="re";pdf_show_xy ($pdf, $text, $hor ,$ver);$hor=762;$text="#";pdf_show_xy ($pdf, $text, $hor ,$ver-12);}// end header$body_array=array("admin_num"=>"9","cardholder"=>"27","pcard_num"=>"83","location"=>"84","transid"=>"26","transdate"=>"49","vendor_name"=>"51","amount"=>"89","item_purchased"=>"35","ncas_description"=>"89","company"=>"84","ncasnum"=>"23","center"=>"33","pa_number"=>"44","re_number"=>"22");$hor=1;$fontSize=9;$lead=$fontSize+3;pdf_setfont ($pdf, $arial, $fontSize);$ver=$ver-24;	foreach($value_array as $key=>$value)		{			if(!in_array($key,$header_array)){continue;}			$text=trim($value);			$width=$body_array[$key];			$hor+=$width;			if($key==pa_number OR $key==re_number){					$fontSize=7;					pdf_setfont ($pdf, $arial, $fontSize);}					else{					$fontSize=9;					$lead=$fontSize+3;					pdf_setfont ($pdf, $arial, $fontSize);}			if($key=="vendor_name" OR $key=="ncas_description" OR $key=="item_purchased")			{			//PDF_show_boxed ( $pdf , string $text , float $left , float $top , float $width , float $height , string $mode , string $feature )				pdf_show_boxed ($pdf, $text, $hor ,$ver-24,85,24,"left","");			}			else			{				if($key=="center" AND strlen($value_array['ncasnum'])>6){$hor+=15;}				pdf_show_xy ($pdf, $text, $hor ,$ver-12);								if($key=="amount")					{						$amount=$array[$num]['amount'];						$prev_amount=$array[$num-1]['amount'];					}				if($key=="amount" AND $prev_transid==$transid)					{						if($xx==""){$total=$amount+$prev_amount;}						else						{$total+=$amount;}						$xx=1;					if($transid!=$array[$num+1]['transid']){$split=1;}				}			}					}				if($split){				$text="transid $transid Total = ".$total;								pdf_show_xy ($pdf, $text,333 ,$ver-30);				$cutRow++; $total="";$xx="";				$ver=$ver-12; $split="";}			$prev_pcard_num=$pcard_num;	$new_page="";	$cutRow++;	}// end loop of thru $array		if($single==1){					$x=74; $y=20;$text="Reconciler Signature";					pdf_show_xy ($pdf, $text, $x ,$y);					pdf_moveto($pdf, 140, 20);					pdf_lineto($pdf, 250, 20);					pdf_stroke($pdf);						$text="Date";					pdf_show_xy ($pdf, $text, 274 ,$y);					pdf_moveto($pdf, 290, 20);					pdf_lineto($pdf, 370, 20);					pdf_stroke($pdf);						$text="Approver Signature";					pdf_show_xy ($pdf, $text, 417 ,$y);					pdf_moveto($pdf, 479, 20);					pdf_lineto($pdf, 610, 20);					pdf_stroke($pdf);						$text="Date";					pdf_show_xy ($pdf, $text, 638 ,$y);					pdf_moveto($pdf, 655, 20);					pdf_lineto($pdf, 700, 20);					pdf_stroke($pdf);}// Finish the pagepdf_end_page ($pdf);// Close the PDFpdf_close ($pdf);// Send the PDF to the browser.$buffer = pdf_get_buffer ($pdf);header ("Content-type: application/pdf");header ("Content-Length: " . strlen($buffer));header ("Content-Disposition: inline; filename=filename.pdf");echo $buffer;// Free the resourcespdf_delete ($pdf);  ?>