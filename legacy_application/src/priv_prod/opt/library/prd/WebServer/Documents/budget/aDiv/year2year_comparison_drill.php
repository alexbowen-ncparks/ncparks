<?php//session_start();include("../../../include/authBUDGET.inc");//echo "<pre>";print_r($_SESSION);echo "</pre>";//exit;//echo "<pre>";print_r($_SERVER);echo "</pre>";//exit;//echo "<pre>";print_r($_REQUEST);echo "</pre>";exit;//$dbTable="partf_payments";$file="year2year_comparison_drill.php";$varQuery=$_SERVER[QUERY_STRING];// ECHO "v=$varQuery";//exit;extract($_REQUEST);$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("../../../include/activity.php");// **************  Show Results ***************if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=year2year_comparison_drill.xls');echo "<html><body>";echo "<table border='1' cellpadding='3' align='center'>";}echo "<table border='1' cellpadding='3' align='center'>";// ******** Show Results ***********//exit;$query="truncate table year2year_1;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="insert into year2year_1( center, account, py1_amount,  cy_amount,lytt_amount ) select center, ncasnum, sum(amount_py1), sum(amount_cy),sum(amount_lytt) from act3 where 1 group by center,ncasnum;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$query="update year2year_1,coa set year2year_1.budget_group=coa.budget_group where year2year_1.account=coa.ncasnum;";   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};$revArray=array("operating_revenues","purchase4resale","grants","reimbursements");// ****** Body Query$whereFilter="where 1";if(in_array($budget_group,$revArray)){$query="SELECT center.parkcode, year2year_1.center, year2year_1.account, coa.park_acct_desc as 'account_description', -sum( py1_amount ) AS 'py_amount',   -sum( cy_amount ) AS 'cy_posted', -sum( lytt_amount ) AS 'lytt_posted', sum(lytt_amount-cy_amount) AS 'yearly_variance' FROM year2year_1 LEFT JOIN center ON year2year_1.center = center.center LEFT JOIN coa ON year2year_1.account = coa.ncasnum$whereFilter AND year2year_1.account='$account' AND year2year_1.budget_group='$budget_group' and year2year_1.center like '1280%' GROUP BY year2year_1.account,year2year_1.center ORDER BY center.parkcode";}else{$query="SELECT center.parkcode, year2year_1.center, year2year_1.account, coa.park_acct_desc as 'account_description', sum( py1_amount ) AS 'py_amount',  sum( cy_amount ) AS 'cy_posted', sum( lytt_amount ) AS 'lytt_posted', sum(lytt_amount-cy_amount) AS 'yearly_variance' FROM year2year_1 LEFT JOIN center ON year2year_1.center = center.center LEFT JOIN coa ON year2year_1.account = coa.ncasnum$whereFilter AND year2year_1.account='$account' AND year2year_1.budget_group='$budget_group' and year2year_1.center like '1280%' GROUP BY year2year_1.account,year2year_1.center ORDER BY center.parkcode";}   $result = @mysqli_query($connection, $query,$connection);if($showSQL){echo "$query<br><br>";};if($rep==""){echo "<table border='1' cellpadding='3' align='center'>";echo "<tr><td><a href='$file?account=$account&budget_group=$budget_group&rep=excel'>Excel Export</a></td></tr></table>";}//Explicitly populate $headerArray instead of dynamicunset($headerArray);unset($header);$headerArray=array("parkcode","center","account","account_description","py_amount","cy_posted","lytt_posted","yearly_variance");$count=count($headerArray);for($i=0;$i<$count;$i++){$h=$headerArray[$i];$header.="<th>".$h."</th>";}echo "<div align='center'><table border='1'><tr>$header</tr>";$j=1;if($rep=="excel"){$forceText="'";}while($row = mysqli_fetch_array($result)){extract($row);$py_amountTOT+=$py_amount;$lytt_postedTOT+=$lytt_posted;$cy_postedTOT+=$cy_posted;$yearly_varianceTOT+=$yearly_variance;if($rep==""){if(fmod($j,20)==0){echo "$header";}$j++;}if($yearly_variance<0){$f1="<font color='red'>";$f2="</font>";$tr=" bgcolor='AliceBlue'";}else{$f1="";$f2="";$tr="";}$py_amount=number_format($py_amount,2);$lytt_posted=number_format($lytt_posted,2);$cy_posted=number_format($cy_posted,2);$yearly_variance=number_format($yearly_variance,2);echo "<tr$tr>";echo "<td align='left'>$parkcode</td><td align='left'>$center</td><td align='left'>$account</td><td align='left'>$account_description</td><td align='right'>$py_amount</td><td align='right'>$cy_posted</td><td align='right'>$lytt_posted</td>";echo "<td align='right'>$f1$yearly_variance$f2</td></tr>";	}// end while// ****** Totals$py_amountTOT=number_format($py_amountTOT,2);$lytt_postedTOT=number_format($lytt_postedTOT,2);$cy_postedTOT=number_format($cy_postedTOT,2);$yearly_varianceTOT=number_format($yearly_varianceTOT,2);if($yearly_varianceTOT<0){$f1="<font color='red'>";$f2="</font>";}else{$f1="";$f2="";}echo "<tr><td colspan='5' align='right'>$py_amountTOT</td><td align='right'>$cy_postedTOT</td><td align='right'>$lytt_postedTOT</td><td align='right'>$f1$yearly_varianceTOT$f2</td></tr>";echo "</table></div></body></html>";?>