<?phpinclude("../../include/authBUDGET.inc"); // used to authenticate users//These are placed outside of the webserver directory for security//include("../../include/authBUDGET	.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // database//echo "<pre>";print_r($_REQUEST);echo "</pre>";exit;extract($_REQUEST);include_once("menu.php");include("../../include/activity.php");// Populate Pulldown Menusif($contract=="Transactions"){$vTable="partf_contract_trans";$v2Table="partf_contract_vitals";$fields="partf_contract_trans.dpr_contract_num as fld1,contractor as fld3,trans_type as fld4,park as fld2FROM partf_contract_transLEFT JOIN partf_contract_vitals ON partf_contract_vitals.dpr_contract_num = partf_contract_trans.dpr_contract_numLEFT JOIN partf_projects ON partf_contract_trans.dpr_proj_num = partf_projects.projNum";$sql = "SELECT $fields $where ORDER BY partf_contract_vitals.dpr_contract_num";$pick1="Contract";$pick3="Contractor";$pick4="Transaction Type";$pick2="Park";$pickField1="dpr_contract_num";$pickField2="park";$pickField3="contractor";$pickField4="trans_type";}if($contract=="Vitals"||$contract==""){$contract="Vitals";$vTable="partf_contract_vitals";$v2Table="partf_contract_trans";$fields="partf_contract_vitals.dpr_contract_num as fld1,vendor as fld3,con_type as fld4,park as fld2FROM partf_contract_vitalsLEFT JOIN partf_contract_trans ON partf_contract_vitals.dpr_contract_num = partf_contract_trans.dpr_contract_numLEFT JOIN partf_projects ON partf_contract_trans.dpr_proj_num = partf_projects.projNum";$sql = "SELECT $fields $where ORDER BY partf_contract_vitals.dpr_contract_num";$pick1="Contract";$pick3="Vendor";$pick4="Contract Type";$pick2="Park";$pickField1="dpr_contract_num";$pickField2="park";$pickField3="vendor";$pickField4="con_type";}//echo "$sql<br>"; //exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$array1[]=$fld1;//dpr_contract_numif($fld2){$array2[]=$fld2;}//park - NULL values are ignored$array3[]=strtoupper($fld3);//contractor$array4[]=$fld4;//trans_type//$array5[]=$fld5;//$array6[]=$fld6;//$array7[]=$fld7;//$array8[]=$fld8;}//$menu1=array_unique($array1);sort($menu1);$menu2=array_unique($array2);sort($menu2);$menu3=array_unique($array3);sort($menu3);$menu4=array_unique($array4);sort($menu4);//$menu5=array_unique($array5);sort($menu5);// ************** Start Display **************echo "<font color='green'>DPR Contract $contract</font><table><tr>";echo "<td><form><input type='hidden' name='contract' value='$contract'><input type='submit' name='submit' value='All'></form></td>";echo "<td><form><input type='hidden' name='contract' value='$contract'><input type='submit' name='submit' value='Add'></form></td>";function makeMenu($menuNum,$pickNum,$pickField){global $contract;echo "<td><form><select name=\"$pickField\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Pick a $pickNum</option>";$s="value";for ($n=0;$n<count($menuNum);$n++){$con=urlencode($menuNum[$n]);echo "<option $s='contract.php?contract=$contract&varEdit=conTran&$pickField=$con'>$menuNum[$n]\n";       }   echo "</select></form></td>";}//makeMenu($menu1,$pick1,$pickField1);makeMenu($menu2,$pick2,$pickField2);makeMenu($menu3,$pick3,$pickField3);makeMenu($menu4,$pick4,$pickField4);   echo "<td><form action='contract.php'>Find/Edit Contract: <input type='text' name='dpr_contract_num' size='5'><input type='hidden' name='varEdit' value='conTran'><input type='hidden' name='contract' value='$contract'><input type='hidden' name='e' value='1'><input type='Submit' name='Submit' value='Find'></form></td>";echo "</tr></table>";// ***** Pick display file and set sql statementif($submit=="Delete"){if($contract=="Vitals"){$where="cvid='$cvid'";}else{$where="ctid='$ctid'";}$query = "DELETE FROM $vTable WHERE $where";$result = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");echo "Contract $dpr_contract_num with Record ID $ctid $cvid deleted.";exit;}// Form to Add dataif($submit=="Add"){$orderby="ORDER BY dpr_contract_num DESC LIMIT 1";$sql = "SELECT dpr_contract_num From $vTable $orderby";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$row=mysqli_fetch_array($result);extract($row);if($contract=="Vitals"){include_once("contractDisplayVital.php");}else{include_once("contractDisplay.php");}permitShow0($dpr_contract_num);exit;}// Insert New Dataif($submit=="Add Data"){if($contract=="Vitals"){include_once("contractDisplayVital.php");}else{include_once("contractDisplay.php");}$query = "INSERT into $vTable set dpr_contract_num='$dpr_contract_num'";$result = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");$ctid=mysql_insert_id();$cvid=$ctid;$con_pro_num=$dpr_contract_num."-".$dpr_proj_num;if($trans_type_new){$trans_type=$trans_type_new;$con_type=$trans_type_new;}if($contract=="Vitals"){$where="cvid='$cvid'";include("updateContractVital.php");updateContract($dpr_contract_num,$con_type,$vendor,$denr_contract_num,$st_construct_con_num,$cont_admin,$comments,$taxid_num,$po_num,$cvid);}else{$where="ctid='$ctid'";include("updateContract.php");updateContract($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$po_num,$ctid);} echo "Addition successful<br>";$sql = "SELECT * From $vTable WHERE $where";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//echo "s=$sql";exit;$row=mysqli_fetch_array($result);extract($row);if($contract=="Vitals"){include_once("contractDisplayVital.php");permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$center_encum,$acct_encum,$con_type,$vendor,$denr_contract_num,$st_construct_con_num,$cont_admin,$comments,$taxid_num,$po_num,$cvid);}else{include_once("contractDisplay.php");permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$po_num,$ctid);}exit;}// Find Allif($submit=="All"){if($contract=="Vitals"){$c="contractListVital.php";//$v2Table="partf_contract_trans";$orderby="park,dpr_contract_num,dpr_proj_num";}else{$c="contractList.php";//$v2Table="partf_contract_vitals";$orderby="dpr_contract_num,dpr_proj_num,change_order_num";}$sql ="SELECT DISTINCT $vTable.dpr_contract_num,con_type,vendor,denr_contract_num,st_construct_con_num,cont_admin,$vTable.comments,taxid_num,$vTable.po_num,partf_projects.park,partf_projects.projName,amountFrom $vTableLEFT JOIN $v2Table on $vTable.dpr_contract_num=$v2Table.dpr_contract_numLEFT JOIN partf_projects on partf_contract_trans.dpr_proj_num=partf_projects.projNumORDER BY $orderby";include_once("$c");// file for display of info}//echo "$sql";exit;// Update Existing Dataif($submit=="Update"){if($trans_type_new){$trans_type=$trans_type_new;$con_type=$trans_type_new;}if($contract=="Vitals"){include("updateContractVital.php");updateContract($dpr_contract_num,$contract_name,$con_pro_num,$center_encum,$acct_encum,$con_type,$vendor,$denr_contract_num,$st_construct_con_num,$cont_admin,$comments,$taxid_num,$po_num,$cvid);echo "Update successful";}else{include("updateContract.php");updateContract($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$po_num,$ctid);echo "Update successful";}$sql = "SELECT * From $vTable WHERE dpr_contract_num='$dpr_contract_num'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//echo "s=$sql";//exit;$row=mysqli_fetch_array($result);extract($row);if($contract=="Vitals"){include("contractDisplayVital.php");permitShow0($dpr_contract_num,$contract_name,$con_pro_num,$center_encum,$acct_encum,$con_type,$vendor,$denr_contract_num,$st_construct_con_num,$cont_admin,$comments,$taxid_num,$po_num,$cvid); }else{include("contractDisplay.php");permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$po_num,$ctid);}exit;}// Select Data to Display in Table// Contract Numberif($varEdit=="conTran" AND $dpr_contract_num!=""){if($contract=="Vitals"){$vTable="partf_contract_vitals";$v2Table="partf_contract_trans";$orderby="partf_contract_vitals.dpr_contract_num";if($e==1){include_once("contractDisplayVital.php");// file for display}else{include_once("contractListVital.php");}// file for display}// end Vitalselse{$vTable="partf_contract_trans";$v2Table="partf_contract_vitals";$orderby="change_order_num DESC";if($e==1){include_once("contractDisplay.php");// file for display}else{include_once("contractList.php");}// file for display}// end Transactions$sql = "SELECT DISTINCT $vTable.dpr_contract_num,contract_name,con_type,vendor,denr_contract_num,st_construct_con_num,cont_admin,$vTable.comments,taxid_num,partf_projects.park,amount,contractor,partf_contract_vitals.po_numFrom $vTableLEFT JOIN $v2Table on $vTable.dpr_contract_num=$v2Table.dpr_contract_numLEFT JOIN partf_projects on partf_contract_trans.dpr_proj_num=partf_projects.projNum WHERE $vTable.dpr_contract_num='$dpr_contract_num' ORDER BY $orderby";}// Parkif($varEdit=="conTran" AND $park!=""){if($contract=="Vitals"){$vTable="partf_contract_vitals";$v2Table="partf_contract_trans";$orderby="partf_contract_vitals.dpr_contract_num";if($e==1){include_once("contractDisplayVital.php");// file for display}else{include_once("contractListVital.php");}// file for display}// end Vitalselse{$vTable="partf_contract_trans";$v2Table="partf_contract_vitals";$orderby="change_order_num DESC";if($e==1){include_once("contractDisplay.php");// file for display}else{include_once("contractList.php");}// file for display}// end Transactions$sql = "SELECT DISTINCT$vTable.dpr_contract_num,con_type,vendor,denr_contract_num,st_construct_con_num,cont_admin,$vTable.comments,taxid_num,$vTable.po_num,partf_projects.park,partf_projects.projName,amount From $vTableLEFT JOIN $v2Table ON $vTable.dpr_contract_num = $v2Table.dpr_contract_numLEFT JOIN partf_projects ON partf_contract_trans.dpr_proj_num = partf_projects.projNumWHERE partf_projects.park='$park' ORDER BY $orderby";}// VENDORif($varEdit=="conTran" AND ($contractor!=""||$vendor!="")){ if($contract=="Vitals"){$vTable="partf_contract_vitals";$v2Table="partf_contract_trans";$orderby="partf_contract_vitals.dpr_contract_num";$findFld="vendor='$vendor'";if($e==1){include_once("contractDisplayVital.php");// file for display}else{include_once("contractListVital.php");}// file for display}// end Vitalselse{$vTable="partf_contract_trans";$v2Table="partf_contract_vitals";$findFld="contractor='$contractor'";$orderby="change_order_num DESC";if($e==1){include_once("contractDisplay.php");// file for display}else{include_once("contractList.php");}// file for display}// end Transactions$sql = "SELECT DISTINCT$vTable.dpr_contract_num,con_type,vendor,denr_contract_num,st_construct_con_num,cont_admin,$vTable.comments,taxid_num,$vTable.po_num,partf_projects.park,partf_projects.projName,amount From $vTableLEFT JOIN $v2Table ON $vTable.dpr_contract_num = $v2Table.dpr_contract_numLEFT JOIN partf_projects ON partf_contract_trans.dpr_proj_num = partf_projects.projNumWHERE $findFld ORDER BY $orderby";}// CONTRACT TYPEif($varEdit=="conTran" AND ($trans_type!=""||$con_type!="")){ if($contract=="Vitals"){$vTable="partf_contract_vitals";$v2Table="partf_contract_trans";$orderby="partf_contract_vitals.dpr_contract_num";$findFld="con_type='$con_type'";if($e==1){include_once("contractDisplayVital.php");// file for display}else{include_once("contractListVital.php");}// file for display}// end Vitalselse{$vTable="partf_contract_trans";$v2Table="partf_contract_vitals";$findFld="trans_type='$trans_type'";$orderby="change_order_num DESC";if($e==1){include_once("contractDisplay.php");// file for display}else{include_once("contractList.php");}// file for display}// end Transactions$sql = "SELECT DISTINCT$vTable.dpr_contract_num,con_type,vendor,denr_contract_num,st_construct_con_num,cont_admin,$vTable.comments,taxid_num,$vTable.po_num,partf_projects.park,partf_projects.projName,amount From $vTableLEFT JOIN $v2Table on $vTable.dpr_contract_num=$v2Table.dpr_contract_numLEFT JOIN partf_projects on partf_contract_trans.dpr_proj_num=partf_projects.projNumWHERE $findFld ORDER BY $orderby";}// Query Databaseif($sql){echo "$sql<hr>";//exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);if($num>1){echo "<font color='green'>$num $z Records:</font><hr>";}// Finally Show Found Recordsif($contract=="Transactions"){while ($row=mysqli_fetch_array($result)){extract($row);permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$po_num,$ctid,$park,$projName);$totAmt=$totAmt+$amount;}// end whileshowTotal($totAmt);}if($contract=="Vitals"){while ($row=mysqli_fetch_array($result)){extract($row);permitShow0($dpr_contract_num,$contract_name,$con_pro_num,$center_encum,$acct_encum,$con_type,$vendor,$denr_contract_num,$st_construct_con_num,$cont_admin,$comments,$taxid_num,$po_num,$cvid,$park,$projName);$totAmt=$totAmt+$amount;}// end whileshowTotal($totAmt);}// end if Vitals}// end if $sqlecho "</table></body></html>";?>