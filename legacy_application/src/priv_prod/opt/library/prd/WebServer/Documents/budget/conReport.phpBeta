<?phpinclude("../../include/connectBUDGET.inc");// database connection parametersextract($_REQUEST);include_once("menu.php");include_once("partf_fund_total.php");echo "<div align='center'><form action='conReport.php'><table><tr><td>Start Date (yyyymmdd): <input type='text' name='start' size='10' value='$start'></td><td>End Date (yyyymmdd): <input type='text' name='end' size='10' value='$end'><input type='submit' name='submit' value='Find'></form></td></tr></table><form></div>";//$where="where reportDisplay='Y'";$where="where reportDisplay='Y' and datePost!=''";if($s==""){$s="projNum";}$fldPARTF="tempPARTF";//*********** SWITCH ***************	switch ($g) {		case "county":$select="DISTINCT partf_projects.county, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY countyORDER BY county";	$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit);}			break;			case "dist":$select="DISTINCT partf_projects.dist, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY distORDER BY dist";	$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit);}			break;			case "park":$select="DISTINCT partf_projects.park, sum(partf_payments.amount) as amtFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP BY parkORDER BY park";	$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit);}			break;			case "Center":$select="DISTINCT partf_projects.Center, sum(partf_payments.amount) as amt,funds.creditFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_numLEFT JOIN funds on partf_projects.projNum=funds.projNum$whereGROUP BY CenterORDER BY Center";	$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit);}			break;			case "comp":// First get the allocated funds in an array$where="where reportDisplay='Y'";			$select="DISTINCT comp, sum(funds.credit) AS creditFROM partf_projects LEFT JOIN funds ON partf_projects.projNum = funds.projNum$whereGROUP  BY comp";$sql = "SELECT $select";//echo "$sql";exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);$arrayCom[]=$comp;$arrayCredit[]=$credit;}// Next get the payments in an array$where="where reportDisplay='Y' and datePost!=''";			$select="DISTINCT comp, sum(partf_payments.amount) as amtFROM partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_num$whereGROUP  BY comp";$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){extract($row);$arrayAmt[]=$amt;}for($i=0;$i<$num;$i++){// now output values$amt=$arrayAmt[$i];$credit=$arrayCredit[$i];$comp=$arrayCom[$i];makeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit);}			break;			default:		// Removed DISTINCT$select="partf_projects.projNum, sum(partf_payments.amount) as amt,".$fldPARTF.".creditFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_numLEFT JOIN $fldPARTF on partf_projects.projNum=".$fldPARTF.".projNum$whereGROUP BY partf_projects.projNumORDER BY $s";$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);$arrayAllPayments[$projNum]=$amt;}//echo "$sql<pre>";print_r($arrayAllPayments);echo "</pre>";exit;if($start){$ce="Current Activity ($start - $end)";$where=$where." and datenew>='$start'";}if($end){$where=$where." and datenew<='$end' ";}$select="partf_projects.*, sum(partf_payments.amount) as amt,".$fldPARTF.".creditFrom partf_projects LEFT JOIN partf_payments on partf_projects.projNum=partf_payments.charg_proj_numLEFT JOIN $fldPARTF on partf_projects.projNum=".$fldPARTF.".projNum$whereGROUP BY partf_projects.projNumORDER BY $s";makeReportHeader($ce);//GROUP BY partf_payments.charg_proj_num$sql = "SELECT $select";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){extract($row);// don't send $partf_approv_num use funds.credit insteadmakeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit,$ce,$arrayAllPayments);}// end while	}// end Switch	echo " n = $num<br>";echo "$sql"; //exit;// ***************** FUNCTIONS **************function sortCol($fld1,$fld2){$sort=$fld1; if($fld2){$sort=$sort.",".$fld2;}echo "<a href='conReport.php?s=$sort'>Sort<br></a>";}function sumCol($fld){echo "<a href='conReport.php?g=$fld'>Group<br></a>";}function formatMoney($fm){$value=number_format($fm,2);return $value;}// Headerfunction makeReportHeader($ce){echo "<table border='1'><tr><th>"; sortCol(projNum); echo "PROJECT<BR>NUMBER</th><th>CALENDAR<BR>YEAR OF<BR>INITIAL<BR>FUNDING</th><th>"; sortCol(Center); sumCol(Center);echo "CRNT<BR>CNTR</th><th>"; sortCol(budgCode); echo "CODE</th><th>"; sortCol(comp,"partf_projects.projNum"); sumCol(comp);echo "COMP</th><th>MGR</th><th>FISCAL YR<br>OF FUNDING</th><th>"; sortCol(park,"partf_projects.projNum"); sumCol(park);echo "PARK</th><th>"; sortCol(dist,"partf_projects.park"); sumCol(dist);echo "DIST</th><th>"; sortCol(county,"partf_projects.park"); sumCol(county);echo "COUNTY</th><th>PROJECT NAME</th>";if($ce){echo "<th>$ce</th>";}echo "<th>TOTAL POSTED<BR><a href='editFunds.php'>FUNDS</a></th><th>TOTAL POSTED<BR>EXPENSES</th><th>TOTAL POSTED<BR>ENDING<BR>BALANCE</th><th>ESTIMATED<BR>CONSTRUCTION<BR>STATE DATE</th><th>ESTIMATED<BR>CONSTRUCTION<BR>END DATE</th><th>STATUS<BR>D=DESIGN<BR>C=CONST<BR>F=FINISHED</th><th>COMMENTS</th></tr>";}function makeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$park,$projName,$active,$startDate,$endDate,$status,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit,$ce,$arrayAllPayments){$cumAmount=$arrayAllPayments[$projNum];$statusPer=$status."-".$percentCom;//$dif=($credit-$amt);$dif=($credit-$cumAmount);if($dif<0){$tb="<font color='red'>";$te="</font>";}else{$tb="";$te="";}$dif=formatMoney($credit-$cumAmount);$div_app_amt=formatMoney($credit);$cumAmount=formatMoney($cumAmount);if($amt<0){$amt="(".formatMoney($amt).")";}else{$amt=formatMoney($amt);}$projNumLink="<a href='partf.php?partfid=$partfid'>$projNum</a>";$postLink="<a href='editFunds.php?proj_in=$projNum&post=1'>$div_app_amt</a>";$Center=strtoupper($Center);$park=strtoupper($park);echo "<tr><td align='center'>$projNumLink</td><td align='center'>$YearFundC</td><td>$Center</td><td>$budgCode</td><td>$comp</td><td>$proj_man</td><td align='center'>$YearFundF</td><td>$park</td><td>$dist</td><td>$county</td><td>$projName</td>";if($ce){echo "<td align='right'>$amt</td>";}echo "<td align='right'>$postLink</td><td align='right'>$cumAmount</td><td align='right'>$tb$dif$te</td><td align='center'>$startDate</td><td align='center'>$endDate</td><td>$statusPer</td><td>$comments</td></tr>";}echo "</table>";?>