<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseextract(_REQUEST);//exit;//if($s==""){exit;}//   Delete ALL records where payst is blank$sql =  "DELETE FROM  `pcard` where payst=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//   Delete ALL records where vendor is VENDOR or NAME$sql =  "DELETE FROM  `pcard` where (vendor LIKE '%VENDOR%' OR vendor LIKE '%NAME%') AND amt = '0.00'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//   Delete ALL records where postdate is blank$sql =  "DELETE FROM  `pcard` where postdate=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//   Delete ALL records where amt = 0.00$sql =  "DELETE FROM  `pcard` where amt = '0.00'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql =  "UPDATE `pcard` SET lastname=trim(lastname),vendor=trim(vendor),postdate=trim(postdate),transid=trim(transid),transdate=trim(transdate),company=trim(company),acct=trim(acct),center=trim(center),descrip=trim(descrip),payst=trim(payst) where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//   Update records by completing blank lastname and add slashes$sql =  "SELECT lastname,pcardid FROM  `pcard` where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");while($row=mysqli_fetch_array($result)){extract($row);if($lastname){$a=addslashes($lastname);}else{$sql1 =  "UPDATE  `pcard` set lastname='$a' where pcardid='$pcardid'";$result1 = mysqli_query($connection, $sql1) or die ("Couldn't execute query. $sql1");}}//   Update records by completing blank vendor and add slashes$sql =  "SELECT vendor,pcardid FROM  `pcard` where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");while($row=mysqli_fetch_array($result)){extract($row);if($vendor){$b=addslashes($vendor);}else{$sql1 =  "UPDATE  `pcard` set vendor='$b' where pcardid='$pcardid'";$result1 = mysqli_query($connection, $sql1) or die ("Couldn't execute query. $sql1");}}// Have to run this statement TWICE. Never figured out why? // My guess is that the first char is hidden perhaps// Removes the beginning quote from field$sql =  "UPDATE `pcard` SET card=trim(SUBSTRING(card FROM 2)) where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql =  "UPDATE `pcard` SET card=trim(SUBSTRING(card FROM 2)) where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");// Removes the ending quote from field$sql =  "UPDATE `pcard` SET card=SUBSTRING_INDEX(card, '\"', 1) where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");// Create db valid date$sql =  "UPDATE `pcard` SET newpostdate= CONCAT(SUBSTRING_INDEX(postdate,'/',-1),SUBSTRING_INDEX(postdate,'/',1),SUBSTRING(SUBSTRING_INDEX(postdate,'/',-2) from 1 for 2))where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql =  "UPDATE `pcard` SET mark='x' where mark=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");include("removeNonDPR_Pcards.php"); include("../menu.php"); echo "Parsing Purchase Card file completed."; ?>