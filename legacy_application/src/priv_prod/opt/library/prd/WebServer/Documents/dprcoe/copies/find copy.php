<?php extract ($_REQUEST);session_start();if(!$park){$park = $_SESSION['parkS'];}include("../../include/authCOE.inc");include("../../include/connectCOE.inc");include("../../include/parkcodes.inc");//include("../../include/dist.inc");// Process inputif($Submit =="Find"){//print_r($_REQUEST);  $monthArray = range(1,12);if (in_array($month, $monthArray)){}else{$monthArrayName = array('','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');$trans = array_flip($monthArrayName);$month = $trans[$month];}echo "<html><head><title> Calendar of Events</title></head><body><font size='4' color='004400'> Calendar of Events for $park</font>";// Create the WHERE clause$where = "WHERE park='$park'";if($enterBy){$enterBy=urldecode($enterBy);$where .=" AND enterBy='$enterBy'";}if($month){if($month<10){$month="-0".$month;}ELSE{$month="-".$month;}}ELSE {$month = "";}if($day){if($day<10){$day="-0".$day;}ELSE{$day="-".$day;}}$dateE=$year.$month.$day."%";$where .=" AND dateE LIKE '$dateE'";if($title){$title=addslashes(urldecode($title));$where .=" AND title='$title'";}$sql = "SELECT * From event $where ORDER BY dateE DESC, title";$result = @mysql_query($sql, $connection) or die("Error #". mysql_errno() . ": " . mysql_error());$numrow = mysql_num_rows($result);if($numrow < 1){echo "<br><hr>No event found using: $year$month$day&nbsp;&nbsp;&nbsp;$enterBy&nbsp;&nbsp;&nbsp;$title";exit;}//echo "<br>y $year m $month d $day $sql";echo "<hr><table width='100%'><tr><td width='7%' align='center'><u>Date of Event</u></td><td width='5%'></td><td width='20%' align='center'><u>Event Title</u></td><td width='15%' align='center'><u>Entered By</u></td></tr>";while ($row = mysql_fetch_array($result)){extract($row); $adate=strftime('%a, %b %e, %Y',strtotime($dateE));if (substr("$adate", 0, 1)=="S"){echo "<tr><td width='7%' align='center'><font color = 'red'>$adate</font></td>";} ELSE {echo "<tr><td width='10%' align='right'>$adate</td>";}echo "<td width='5%'></td><td width='20%' ><a href='edit.php?eid=$eid'>$title</a></td><td width='15%' >$enterBy</td></tr>";}echo "</table></body></html>";exit;} // end Add//  ************Start input form*************$defaultPark=$park;       if($title1==""){$keepTitle=urldecode(stripslashes($title));}else{$keepTitle=stripslashes($title1);}if($enterBy1==""){$keepName=urldecode(stripslashes($enterBy));}else{$keepName=stripslashes($enterBy1);}$keepMonth=$month; $keepDay=$day; $keepYear=$year;//echo "m $month  d $day  y $year"; exit;$sql = "SELECT DISTINCT enterBy From event WHERE park='$park' ORDER by enterBy";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$sql = "SELECT DISTINCT title, content From event WHERE park='$park' GROUP by title ORDER by title";$result1 = mysql_query($sql) or die ("Couldn't execute query. $sql");echo "<html><head><title>Search Calendar of Events</title></head><body><font size='4' color='004400'>Search the NC DPR Events Calendar</font><br><br>$success</font><hr><form name='findEvents' method='post' action='find.php'><table> <tr><td align='right'><b>Selected Park: </b></td>     <td><font size='4' color='blue'>$parkCodeName[$park]</font></td></tr></table> <table><tr><td><b>Entered By:</b></td>";echo"<td><select name='enterBy'><option value=''>";while ($row = mysql_fetch_array($result)){extract($row);$nameE=urlencode($enterBy);if($enterBy==$keepName or $enterBy==stripslashes($keepName)){echo "<option selected='$nameE'>$enterBy";}ELSE{echo "<option value='$nameE'>$enterBy";}}echo "</select></td></tr></table>";    $monthArray = range(1,12); $monthArrayName = array('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec',);echo "<table><tr><td><b>Date of Event:</b></td><td>";echo "<select name='month'>\n"; echo "<option value=''>\n";for ($i=0; $i <=11; $i++){$month = $monthArray[$i]; if($keepMonth==$month){echo "<option selected='$month'>$monthArrayName[$i]";}ELSE{echo "<option value='$month'>$monthArrayName[$i]";}}echo "</select> Month &nbsp;&nbsp;</td>";$dayArray = range(1,31); echo "<td><select name='day'>\n"; echo "<option value=''>\n";for ($i=0; $i <=30; $i++) {$day = $dayArray[$i];if($keepDay==$day){echo "<option selected='$day'>$day";}ELSE{echo "<option value='$day'>$day";}}echo "</select> Day &nbsp;</td>"; $thisYear = date('Y');  $nextYear = $thisYear + 1;$yearArray = range($thisYear, $nextYear);echo "<td><select name='year'>\n"; echo "<option value=''>\n";for ($i=0; $i <=1; $i++) {$year = $yearArray[$i];if($keepYear=="")	{if($thisYear==$yearArray[$i])	{echo "<option selected='$year'>$year";}	else{echo "<option value='$year'>$year";}	}ELSE	{if($keepYear==$yearArray[$i])	{echo "<option selected='$year'>$year";}	else{echo "<option value='$year'>$year";}	}}echo "</select> Year &nbsp;</td></tr></table>";echo "<table><tr> <td><b>Program Title:</b></td>";$titleArray = array(); $titleArray[0] = "";echo"<td><select name='title'><option value=''>";while ($row = mysql_fetch_array($result1)){extract($row);$titleE=urlencode($title);if($title==stripslashes($keepTitle)){echo "<option selected='$titleE'>$title";}ELSE{echo "<option value='$titleE'>$title";}}echo "</select></td></tr></table>";echo " <table width='500'><tr><td width='100' align='center'> <input type='hidden' name='park' value='$park'> <input type='submit' name='Submit' value='Find'></form></td></tr><tr><td width='100'><form><input type='button' value='Clear Form' onclick=\"location='find.php?park=$park'\"></form></td></tr></table><hr><form name='newPark' method='post' action='find.php'><table><tr><td align='right'><b>Select a Different Park: </b></td>     <td><select name='park'>";                            for ($n=1;$n<=$numParkCode;$n++)          {          $scode=$parkCode[$n];          if($defaultPark == $scode){         echo "<option selected='$scode'>$scode";}ELSE{echo "<option value='$scode'>$scode";}			echo "\n";          }echo "</select></td></tr><tr><td><input type='submit' name='Submit' value='Change Park'></form></tr></table></body></html>";?>