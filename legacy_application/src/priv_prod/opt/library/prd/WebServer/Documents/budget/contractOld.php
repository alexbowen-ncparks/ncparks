<?php//These are placed outside of the webserver directory for security//include("../../include/authBUDGET	.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseextract($_REQUEST);include_once("menu.php");// Base WHERE clauseif($l=="p"){$where="WHERE active='y' AND projYN='y' AND (projCat!='ci' AND projCat!='en' AND projCat!='mi') AND (park!='STWD' AND park!='YORK')";}else{$where="WHERE 1 ";}if($contract=="Transactions"){$fields="dpr_contract_num as fld1,dpr_proj_num as fld2,contractor as fld3,trans_type as fld4,change_order_num as fld5,fully_approv as fld6From partf_contract_trans";$sql = "SELECT $fields $where ORDER BY dpr_contract_num";$pick1="Contract";$pick3="Contractor";$pick4="Transaction Type";$pickField1="dpr_contract_num";$pickField3="contractor";$pickField4="trans_type";}if($contract=="Vitals"){$fields="dpr_contract_num as fld1,dpr_proj_num as fld2,vendor as fld3,con_type as fld4From partf_contract_vitals";$sql = "SELECT $fields $where ORDER BY dpr_contract_num";$pick1="Contract";$pick3="Vendor";$pick4="Contract Type";}//echo "$sql"; //exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$array1[]=$fld1;//dpr_contract_num//$array2[]=$fld2;//dpr_proj_num$array3[]=strtoupper($fld3);//contractor$array4[]=$fld4;//trans_type//$array5[]=$fld5;//$array6[]=$fld6;//$array7[]=$fld7;//$array8[]=$fld8;}$menu1=array_unique($array1);sort($menu1);//$menu2=array_unique($array2);sort($menu2);$menu3=array_unique($array3);sort($menu3);$menu4=array_unique($array4);sort($menu4);//$mneu5=array_unique($array5);sort($menu5);// ************** Start Display **************echo "<font color='green'>DPR Contract $contract</font><table><tr>";echo "<td><form><input type='submit' name='submit' value='All' ></form></td>";echo "<td><form><input type='submit' name='submit' value='Add' ></form></td>";function makeMenu($menuNum,$pickNum,$pickField){global $contract;echo "<td><form><select name=\"$pickField\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Pick a $pickNum</option>";$s="value";for ($n=0;$n<count($menuNum);$n++){$con=urlencode($menuNum[$n]);echo "<option $s='contract.php?contract=$contract&varEdit=conTran&$pickField=$con'>$menuNum[$n]\n";       }   echo "</select></form></td>";}makeMenu($menu1,$pick1,$pickField1);makeMenu($menu3,$pick3,$pickField3);makeMenu($menu4,$pick4,$pickField4);/*echo "<td><form><select name=\"contractor\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Pick a $pick2</option>";$s="value";for ($n=0;$n<count($menu3);$n++){$con=urlencode($menu3[$n]);		echo "<option $s='contract.php?varEdit=conTran&contractor=$con'>$menu3[$n]\n";       }   echo "</select></form></td>";   echo "<td><form><select name=\"trans_type\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Pick a $pick4</option>";$s="value";for ($n=0;$n<count($menu4);$n++){$con=urlencode($menu4[$n]);		echo "<option $s='contract.php?varEdit=conTran&trans_type=$con'>$menu4[$n]\n";       }   echo "</select></form></td>"; */     echo "<td><form action='contract.php'>Find/Edit Contract: <input type='text' name='dpr_contract_num' size='5'><input type='hidden' name='varEdit' value='conTran'><input type='Submit' name='Submit' value='Find'></form></td>";echo "</tr></table>";// ***** Pick display file and set sql statementif($submit=="Delete"){$query = "DELETE FROM partf_contract_trans WHERE ctid='$ctid'";$result = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");echo "Contract $dpr_contract_num with Record ID $ctid deleted.";exit;}if($submit=="Add"){include_once("contractDisplay.php");permitShow0();exit;}if($submit=="Add Data"){$query = "INSERT into partf_contract_trans set dpr_contract_num='$dpr_contract_num'";$result = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");$ctid=mysql_insert_id();$con_pro_num=$dpr_contract_num."-".$dpr_proj_num;if($trans_type_new){$trans_type=$trans_type_new;}include("updateContract.php");updateContract($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$ctid); echo "Addition successful";$sql = "SELECT * From partf_contract_trans WHERE ctid='$ctid'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//echo "s=$sql";exit;$row=mysqli_fetch_array($result);extract($row);include_once("contractDisplay.php");permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$ctid);exit;}if($submit=="All"){$sql = "SELECT * From partf_contract_trans ORDER BY dpr_contract_num,dpr_proj_num,change_order_num";include_once("contractList.php");// file for display of info}if($submit=="Update"){include("updateContract.php");//echo "<pre>";print_r($_REQUEST);echo "</pre>";EXIT;updateContract($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$ctid);echo "Update successful";$sql = "SELECT * From partf_contract_trans WHERE dpr_contract_num='$dpr_contract_num'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//echo "s=$sql";exit;$row=mysqli_fetch_array($result);extract($row);include("contract.php");permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$ctid);exit;}if($varEdit=="conTran" AND $dpr_contract_num!=""){if($e==1){include_once("contractDisplay.php");// file for display}else{include_once("contractList.php");// file for display}$sql = "SELECT * From partf_contract_trans WHERE dpr_contract_num='$dpr_contract_num' ORDER BY change_order_num DESC";}if($varEdit=="conTran" AND $contractor!=""){ include_once("contractList.php");// file for display$sql = "SELECT * From partf_contract_trans WHERE contractor='$contractor' ORDER BY dpr_contract_num,change_order_num DESC";}if($varEdit=="conTran" AND $trans_type!=""){ include_once("contractList.php");// file for display$sql = "SELECT * From partf_contract_trans WHERE trans_type='$trans_type' ORDER BY trans_type,dpr_contract_num";}if($sql){//echo "$sql";exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);if($num>1){echo "<font color='green'>$num $z Records:</font><hr>";}while ($row=mysqli_fetch_array($result)){extract($row);permitShow0($dpr_contract_num,$dpr_proj_num,$con_pro_num,$contractor,$trans_type,$change_order_num, $entry_date,$amount, $fully_approv,$comments,$ctid);$totAmt=$totAmt+$amount;}// end whileshowTotal($totAmt);}echo "</table></body></html>";?>