<?php$dbTable="partf_payments";$file="prtf_lookup_project.php";$fileMenu="prtf_lookup_project_menu.php";include("$fileMenu");extract($_REQUEST);// ******** Show Record to Edit ***********if($e==1){// FIELD NAMES are stored in $fieldArray$fieldName=array("proj_num", "center", "account", "datepost", "checknum", "invoice", "amount", "vendornum", "group_num", "vendorname", "contract_num", "contract_amt", "noncon_amt", "datenew", "pcard_name", "pcard_vendor", "pcard_descr", "purch_descr_input","xtid");echo "<table border='1' cellpadding='3' align='center'>";echo "<tr>";for($i=0;$i<count($fieldName);$i++){$fn=str_replace('_','<br>',$fieldName[$i]);echo "<th>$fn</th>";}echo "</tr>";$sql = " SELECT proj_num, partf_payments.center, account, datepost, checknum, invoice, amount, vendornum, groupnum, vendorname, contract_num, contract_amt, datenew, pcard_name, pcard_vendor, pcard_descr, purch_descr_input, projName,project_parkcode, xtid FROM `partf_payments` WHERE 1 AND `proj_num`='$proj_num' ORDER BY `datenew` DESC ";// echo "$sql";    $result = mysqli_query($connection, $sql) or die ("Couldn't execute query 3. $sql");while($row = mysqli_fetch_array($result)){extract($row);$total=$total+$amount;$noncon_amt=$amount-$contract_amt;$total_contract_amt=$total_contract_amt+$contract_amt;$total_noncon_amt=$total_noncon_amt+$noncon_amt;$amount=number_format($amount,2);$contract_amt=number_format($contract_amt,2);$noncon_amt=number_format($noncon_amt,2);echo "<tr><td>$proj_num</td><td>$center</td><td>$account</td><td>$datepost</td><td>$checknum</td><td>$invoice</td><td align='right'>$amount</td><td>$vendornum</td><td align='center'>$groupnum</td><td>$vendorname</td><td>$contract_num</td><td align='right'>$contract_amt</td><td align='right'>$noncon_amt</td><td>$datenew</td><td>$pcard_name</td><td>$pcard_vendor</td><td>$pcard_descr</td><td>$purch_descr_input</td><td>$xtid</td></tr>";}// end while$total=number_format($total,2);$total_contract_amt=number_format($total_contract_amt,2);$total_noncon_amt=number_format($total_noncon_amt,2);echo "<tr><td colspan='7' align='right'><b>$total</b></td><td colspan='5' align='right'><b>$total_contract_amt</b></td><td align='right'><b>$total_noncon_amt</b></td><td colspan='5'>&nbsp;</td></tr>";echo "<font color='purple'>$projName @ $project_parkcode</font> Total: $total</table>";exit;}// ******** Show Results ***********// FIELD NAMES are stored in $fieldArray// FIELD TYPES and SIZES are stored in $fieldType$fieldName=array("proj_num", "current_center", "projname", "project_parkcode", "district", "center_section", "spent");//print_r($fieldName);if($proj_num!=""){echo "<table border='1' cellpadding='3' align='center'><tr>";for($i=0;$i<count($fieldName);$i++){echo "<th>$fieldName[$i]</th>";}echo "</tr>";$query=" SELECT proj_num, center AS 'current_center', projname, project_parkcode, center_dist AS 'district', center_section, sum( amount ) AS 'spent', xtid as id FROM partf_payments WHERE 1 AND proj_num = '$proj_num' AND datenew <= '$datenew' GROUP BY proj_num ORDER BY project_parkcode ASC"; //echo "$query";    $result = @mysqli_query($connection, $query,$connection);//echo "<pre>";print_r($row);echo "</pre>";// extract($row); while($row = mysqli_fetch_array($result)){echo "<tr>";for($i=0;$i<count($fieldName);$i++){$t=$row[$i];$vk=$fieldName[$i];if($vk=="center"){$center=$t;}if($fieldName[$i]=="spent"){$total=$total+$t;}if($vk=="proj_num"){$pn=$t;}if($vk=="spent"){$tn=number_format($t,2);$tf="<td align='right'><a href='$file?center_section=$center_section&center_dist=$center_dist&datenew=$datenew&proj_num=$pn&e=1'>$tn</a></td>";}else{$tf="<td>$t</td>";}echo "$tf";}echo "</tr>";}// end while$total=number_format($total,2);echo "<tr><td colspan='11' align='right'><b>$total</b></td></tr></table>";}// end ifecho "</div></body></html>";?>