<?php//These are placed outside of the webserver directory for security//include("../../include/authEEID.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databasesession_start();include("../menu.php");if($_SESSION[budget][level]<4){echo "The Increase - Decrease has been locked down while the budget requests are being discussed. If you need to make a change, contact Tony at 919-841-4037.";exit;}?><script language='JavaScript'>function confirmLink(){ bConfirm=confirm('Are you sure you want to delete this record?') return (bConfirm);}</script><?php//echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//exit;//print_r($_SERVER);exit;//print_r($_SESSION);//exit;//$k=urldecode($_SERVER[QUERY_STRING]);extract($_REQUEST);if($submit=="For Review Purposes Only. Use Budget - Operating Expenses Planning to make changes."){echo "Use Budget - Operating Expenses Planning to make changes.";exit;}//extract($_SESSION);session_start();//********** SET Variables **********if(!$dbTable){$dbTable="inc_dec";}// FIELD NAMES are stored in $fieldArray// FIELD TYPES and SIZES are stored in $fieldType$sql = "SHOW COLUMNS FROM $dbTable";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$numFlds=mysqli_num_rows($result);while ($row=mysqli_fetch_assoc($result)){extract($row);$fieldArray[]=$row[Field];$fieldType[]=$row[Type];}$recordIDfld=$fieldArray[$numFlds-1];makeUpdateFields($fieldArray);// MAKE FIELD=VALUE FOR ADD/UPDATEfor($dk=0;$dk<count($fieldType);$dk++){$varD=substr($fieldType[$dk],0,7);if($varD=="decimal"){$fieldDecimal[]=$dk;}if($varD=="varchar"){$size=substr(substr($fieldType[$dk],8,7),0,-1);if($size>30){$size=30;}$fieldSize[]=$size;}else{$fieldSize[]=12;}}//print_r($fieldSize);//exit;// Find number fieldsfor($dk=0;$dk<count($fieldDecimal);$dk++){$t=$fieldDecimal[$dk];$varE[$fieldArray[$t]]=$fieldDecimal[$dk];}//print_r($varE);//exit;  //$varE = Any field(s) defined as Decimal //**** Process any Delete ******if($deleteRecord=="Delete"){//print_r($_REQUEST);exit;$query = "DELETE FROM $dbTable where $recordIDfld='$deleteRecordID'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Delete. $query");if($_SESSION[budget][level]!=2){$f="&form=1";}header("Location: /budget/portalReport.php?dbReport=Center&center=$center&acct=$acct&submit=Submit&rccYN=Y$varPX$f");exit;} //**** Process any Update or Add ******if($submit=="Update"){//echo "<pre>";print_r($_REQUEST);echo "<?pre>";exit;//session_start();$v=${$lastFld};$arr1=explode(",",$updateFields);for($j=0;$j<count($arr1);$j++){$arr2=explode("=",$arr1[$j]);$arr3[]=$arr2[0];}for($j=0;$j<count($arr1);$j++){$val1=addslashes($_REQUEST[$arr3[$j]]);if($plusMinus=="dec" and $arr3[$j]=="park_req"){$val1=-$val1;}$newQuery[$arr3[$j]]=$val1;}$arrKeys=array_keys($newQuery);$queryString=$arrKeys[0]."='".$newQuery[$arrKeys[0]]."'";if($_SESSION[budget][level]==1){$updateNum=5;}if($_SESSION[budget][level]==2){$updateNum=8;}if($_SESSION[budget][level]==3){$updateNum=11;}if($_SESSION[budget][level]==4){$updateNum=count($arrKeys);}for($j=1;$j<$updateNum;$j++){$queryString.=", ".$arrKeys[$j]."='".$newQuery[$arrKeys[$j]]."'";}//echo "u=$updateNum j=$j <pre>";print_r($arrKeys);print_r($newQuery);echo "</pre>$queryString<br>";//print_r($newQuery);exit;$query = "Update $dbTable set $queryStringwhere $lastFld='$v'";//echo "Report=Center&submit=Submit&rccYN=Y&px=$px<br> $query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Update. $query");if($_SESSION[budget][level]!=2){$f="&form=1";}$rccYN="Y"; // default for level 1if($_SESSION[budget][level]!=2){$f="&form=1";}if($scope=="division"){$centerPark=$center;$center="Select Center";$f="px=&acct=".$acct;$rccYN=$_SESSION[budget][district]."-Y";}if($scope=="dist"){$centerPark=$center;$center=$_SESSION[budget][select];$f="form=&acct=".$ncas_acct;$rccYN="Y";}if($returnDisplay==1){header("Location: /budget/portalReport.php?rccYN=$rccYN&center=$centerPark&acct=Select+NCAS+Number&varInflation=10&dbReport=Center&scope=division&lastFld=&form=&submit=Submit");}else{header("Location: /budget/portalReport.php?dbReport=Center&center=$center&submit=Submit&rccYN=$rccYN&$f");}exit;}//rccYN=Y&dbReport=CenterJORD&submit=Submit//**** Process any Add ******if($submit=="Add"){$arr1=explode(",",$updateFields);for($j=0;$j<count($arr1);$j++){$arr2=explode("=",$arr1[$j]);$arr3[]=$arr2[0];}for($j=0;$j<count($arr1);$j++){$val1=addslashes($_REQUEST[$arr3[$j]]);$newQuery[$arr3[$j]]=$val1;}$arrKeys=array_keys($newQuery);$queryString=$arrKeys[0]."='".$newQuery[$arrKeys[0]]."'";for($j=1;$j<count($arrKeys);$j++){$queryString.=", ".$arrKeys[$j]."='".$newQuery[$arrKeys[$j]]."'";}//echo "<pre>";print_r($arrKeys);print_r($newQuery);echo "</pre>$queryString<br>";//print_r($newQuery);exit;$query = "INSERT INTO $dbTable set $queryString";//echo "q=$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Update. $query");$v=mysql_insert_id();if($_SESSION[budget][level]!=2){$f="&form=1";}if($scope=="division"){//$center="Select Center";$f="px=&acct=".$acct;//$rccYN=$_SESSION[budget][district]."-Y";$rccYN="Y";}if($scope=="dist"){$center=$_SESSION[budget][select];$f="form=&acct=".$ncas_acct;$rccYN="Y";}if($returnDisplay==1){header("Location: /budget/portalReport.php?rccYN=$rccYN&center=$centerPark&acct=Select+NCAS+Number&varInflation=10&dbReport=Center&scope=division&lastFld=&form=&submit=Submit");}else{header("Location: /budget/portalReport.php?dbReport=Center&center=$center&submit=Submit&rccYN=$rccYN&$f");}exit;}//**** Prepare To Find, Update OR Delete******if($lastFld and $var){//print_r($_REQUEST);exit;$formType="Update";$passSQLedit=urlencode($passSQL);$file=$_SERVER['PHP_SELF'];//$file="inc_dec.php";if($_SESSION[budget][level]==4){$addDeleteButton="<td><form action=\"$file\" method=\"post\"><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='px' value='$px'><input type='hidden' name='$recordIDfld' value='$lastFld'><input type='hidden' name='$delTable' value='inc_dec'><input type='hidden' name='deleteRecordID' value='$var'><input type='hidden' name='center' value='$center'><input type='submit' name='deleteRecord' value='Delete' onClick='return confirmLink()'></form></td>";}$sql0 = "SELECT * from $dbTable where $lastFld='$var'";$result = mysqli_query($connection, $sql0) or die ("Couldn't execute query 0. $sql0");$row=mysqli_fetch_array($result);extract($row);}else{//**** Display record - linked from budget_summary.php ******if($center and $ncas_acct and $link_inc_dec){//print_r($_REQUEST);exit;$formType="Update";$passSQLedit=urlencode($passSQL);$file=$_SERVER['PHP_SELF'];// FIELD NAMES are stored in $fieldArray// FIELD TYPES and SIZES are stored in $fieldType$sql = "SHOW COLUMNS FROM $dbTable";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 2. $sql");while ($row=mysqli_fetch_assoc($result)){extract($row);$fieldName[]=$row[Field];$fieldType[]=$row[Type];}echo "<font color='red'>Close this window when viewing is complete.</font><table border='1' cellpadding='3' align='center'><tr>";for($i=0;$i<count($fieldName);$i++){echo "<th>$fieldName[$i]</th>";}echo "</tr>";$sql0 = "SELECT * from $dbTable where center='$center' and ncas_acct='$ncas_acct'";$result = mysqli_query($connection, $sql0) or die ("Couldn't execute query 0. $sql0");while ($row=mysqli_fetch_array($result)){//extract($row);echo "<tr>";for($i=0;$i<count($fieldName);$i++){//if($fieldName[$i]=="disu_req"){$total+=$row[$i];}echo "<td>$row[$i]</td>";}}$total=number_format($total,2);echo "</tr></table>";exit;}else{if($addRecord=="Add a Record"){$formType="Add";}if($addRecord==""){$formType="Find";$addAddButton="<td><input type='hidden' name='dbTable' value='$dbTable'><input type='hidden' name='center' value='$center'><input type='hidden' name='recordIDfld' value='$recordIDfld'><input type='submit' name='addRecord' value='Add a Record'></form></td>";}}// end else 2}// end else 1//if($cat1_4){$catCheck="checked";}$newCKBX=array_unique($ckbx);sort($newCKBX);//print_r($newCKBX);//EXIT;$caseField1=$newCKBX[0];$caseField2=$newCKBX[1];$caseField3=$newCKBX[2];function pullDown($m){}// Used \" instead of ' because of lastname or vendor name containing 'echo "<form action=\"/budget/a/inc_dec.php\" method=\"post\">";//echo "<form action=\"/budget/a/inc_dec.php\"";// Used to debug$lyFormat=number_format($ly,2);echo "<table><tr><td colspan='3'>Use this form to enter amount of any INCREASE or DECREASE<br>from last year's budget of <font color='red'>$lyFormat</font> <b>for $desc at $px.</b></td></tr>";// center, acct, fy_reqecho "<tr><td>$fieldArray[0]: <font color='blue'>${$fieldArray[0]}</font></td><td>$fieldArray[1]: <font color='blue'>${$fieldArray[1]}</font></td><td>$fieldArray[2]: <font color='blue'>${$fieldArray[2]}</font></td></tr></table>";echo "<table><tr><td colspan='3'>Enter PASU Amount: </td><td><input type=\"text\" name=\"$fieldArray[3]\" size=\"$fieldSize[3]\" value=\"${$fieldArray[3]}\"><input type='radio' name='plusMinus' value='inc'>Increase <input type='radio' name='plusMinus' value='dec'>Decrease</td><td>(Don't enter $ sign or commas, e.g., 1000 not $1,000)</td></tr></table>";echo "<table><tr><td>Enter PASU Justification:</td><td><textarea name=\"$fieldArray[4]\" cols=\"80\" rows=\"5\">${$fieldArray[4]}</textarea></td></tr>";// Get amounts based on level of Approvalif(${$fieldArray[6]}==1){$DISUamt=${$fieldArray[5]};}else{$DISUamt=${$fieldArray[3]};}if(${$fieldArray[9]}==1){$SUSPamt=${$fieldArray[8]};}else{$SUSPamt=$DISUamt;}if(${$fieldArray[12]}==1){$DIREamt=${$fieldArray[11]};}else{$DIREamt=$SUSPamt;}$totDISU=number_format($ly+$DISUamt,2);$DISUamtF=number_format($DISUamt,2); $totSUSP=number_format($ly+$SUSPamt,2);$SUSPamtF=number_format($SUSPamt,2);$totDIRE=number_format($ly+$DIREamt,2);$DIREamtF=number_format($DIREamt,2);if($_SESSION[budget][level] == 1){echo "<tr><td>DISU Amount: $lyFormat + $DISUamtF = $totDISU</td> <td> ${$fieldArray[7]}</td></tr><tr><td>SUSP Amount: $lyFormat + $SUSPamtF = $totSUSP</td> <td> ${$fieldArray[10]}</td></tr><tr><td>DIRE Amount: $lyFormat + $DIREamtF = $totDIRE</td> <td> ${$fieldArray[13]}</td></tr>";}/*fld0=centerfld1=ncas_acctfld2=fy_reqfld3=park_reqfld4=park_justfld5=disu_reqfld6=disu_appfld7=DIST justfld8=SUSP reqfld9=SUSP_appfld10=SUSP justfld11=dire_reqfld12=DIRE_appfld13=DIRE justfld14=cert_budgfld15=inc_decid*/if($_SESSION[budget][level] == 2){if ($disu_app!="1"){$disu_req=$park_req;}//else{$disu_req=$park_req;}$newDISUamt=number_format($disu_req+$ly,2);if($disu_app){$ckDISU="checked";}else{$ckDISU="";}echo "<tr><td>DISU Amount: </td><td><input type=\"text\" name=\"$fieldArray[5]\" size=\"$fieldSize[5]\" value=\"${$fieldArray[5]}\"> + $ly = $newDISUamt <input type='checkbox' name=\"$fieldArray[6]\" value='1' $ckDISU> DISU Approved</td></tr><tr><td>Enter DISU Justification: </td><td><textarea name=\"$fieldArray[7]\" cols=\"80\" rows=\"5\">${$fieldArray[7]}</textarea></td></tr>";echo "<tr><td>SUSP Amount: $lyFormat + $SUSPamtF = $totSUSP</td> <td> ${$fieldArray[10]}</td></tr><tr><td>DIRE Amount: $lyFormat + $DIREamtF = $totDIRE</td> <td> ${$fieldArray[13]}</td></tr>";}if($_SESSION[budget][level] == 3){if ($disu_app!="1"){$disu_req=$park_req;}//else{$disu_req=$park_req;}$newDISUamt=number_format($disu_req+$ly,2);if($disu_app){$ckDISU="checked";}else{$ckDISU="";}echo "<tr><td>DISU Amount: </td><td><input type=\"text\" name=\"$fieldArray[5]\" size=\"$fieldSize[5]\" value=\"${$fieldArray[5]}\"> + $ly = $newDISUamt <input type='checkbox' name=\"$fieldArray[6]\" value='1' $ckDISU> DISU Approved</td></tr><tr><td>Enter DISU Justification: </td><td><textarea name=\"$fieldArray[7]\" cols=\"80\" rows=\"5\">${$fieldArray[7]}</textarea></td></tr>";if ($susp_app!="1"){$susp_req=$disu_req;}$newSUSPamt=number_format($susp_req+$ly,2);if($susp_app){$ckSUSP="checked";}else{$ckSUSP="";}echo "<tr><td>SUSP Amount: </td><td><input type=\"text\" name=\"$fieldArray[8]\" size=\"$fieldSize[8]\" value=\"${$fieldArray[8]}\"> + $ly = $newSUSPamt <input type='checkbox' name=\"$fieldArray[9]\" value='1' $ckSUSP> SUSP Approved</td></tr><tr><td>Enter SUSP Justification: </td><td><textarea name=\"$fieldArray[10]\" cols=\"80\" rows=\"5\">${$fieldArray[10]}</textarea></td></tr>";if(${$fieldArray[12]}==1){$DIREamt=${$fieldArray[11]};}else{$DIREamt=$SUSPamt;}$DIREamt=number_format($DIREamt,2);echo "<tr><td>DIRE Amount: $DIREamt</td><td>${$fieldArray[13]}</td></tr>";}if($_SESSION[budget][level] == 4){if ($disu_app!="1"){$disu_req=$park_req;}//else{$disu_req=$park_req;}$newDISUamt=number_format($disu_req+$ly,2);if($disu_app){$ckDISU="checked";}else{$ckDISU="";}echo "<tr><td>DISU Amount: </td><td><input type=\"text\" name=\"$fieldArray[5]\" size=\"$fieldSize[5]\" value=\"${$fieldArray[5]}\"> + $ly = $newDISUamt <input type='checkbox' name=\"$fieldArray[6]\" value='1' $ckDISU> DISU Approved</td></tr><tr><td>Enter DISU Justification: </td><td><textarea name=\"$fieldArray[7]\" cols=\"80\" rows=\"5\">${$fieldArray[7]}</textarea></td></tr>";if ($susp_app!="1"){$susp_req=$disu_req;}$newSUSPamt=number_format($susp_req+$ly,2);if($susp_app){$ckSUSP="checked";}else{$ckSUSP="";}echo "<tr><td>SUSP Amount: </td><td><input type=\"text\" name=\"$fieldArray[8]\" size=\"$fieldSize[8]\" value=\"${$fieldArray[8]}\"> + $ly = $newSUSPamt <input type='checkbox' name=\"$fieldArray[9]\" value='1' $ckSUSP> SUSP Approved</td></tr><tr><td>Enter SUSP Justification: </td><td><textarea name=\"$fieldArray[10]\" cols=\"80\" rows=\"5\">${$fieldArray[10]}</textarea></td></tr>";if ($dire_app!="1"){$dire_req=$susp_req;}$newDIREamt=number_format($dire_req+$ly,2);if($dire_app){$ckDIRE="checked";}else{$ckDIRE="";}echo "<tr><td>DIRE Amount: </td><td><input type=\"text\" name=\"$fieldArray[11]\" size=\"$fieldSize[11]\" value=\"${$fieldArray[11]}\"> + $ly = $newDIREamt <input type='checkbox' name=\"$fieldArray[12]\" value='1' $ckDIRE> DIRE Approved</td></tr><tr><td>Enter DIRE Justification: </td><td><textarea name=\"$fieldArray[13]\" cols=\"80\" rows=\"5\">${$fieldArray[13]}</textarea></td></tr>";}// end if accessLevel==4if($dire_app=="1"){$budStatus="Approved";}else{$budStatus="Under Review";}$totApp=number_format($ly+$DIREamt,2);echo "<tr><td align='right' colspan='2'>INC/DEC <font color='teal'>$budStatus</font>: $totApp for $desc at $px for current FY.</td></tr>";echo "</table>";echo "<table><tr><td>Return to budget for:</td> <td><input type='radio' name='returnDisplay' value='1' checked>This Park</td><td><input type='radio' name='returnDisplay' value='2'>budget for this account at multiple parks.</td></tr></table><table><tr><td><input type='hidden' name='dbTable' value='$dbTable'><input type='hidden' name='px' value='$px'><input type='hidden' name='scope' value='$scope'><input type='hidden' name='acct' value='$ncas_acct'><input type='hidden' name='center' value='$center'><input type='hidden' name='lastFld' value='$lastFld'><input type='hidden' name='inc_decid' value='$var'><input type='hidden' name='difFile' value='portalReport.php'><input type='hidden' name='$fieldArray[0]' value='${$fieldArray[0]}'><input type='hidden' name='$fieldArray[1]' value='${$fieldArray[1]}'><input type='hidden' name='$fieldArray[2]' value='${$fieldArray[2]}'><input type='submit' name='submit' value='$formType'></form>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$addAddButton&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$addDeleteButton</tr></table>";// **************  FUNCTIONS *******************function makeGroupBy1($radio1,$caseField1,$caseField2,$caseField3,$va3,$va2,$va1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $va1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $va2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $va3>$caseField3</td>";}echo "<td><input type='checkbox' name='sumBy' value='1'>Sum By</td>";}function makeGroupBy2($radio1,$caseField1,$caseField2,$caseField3,$vb3,$vb2,$vb1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $vb1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $vb2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $vb3>$caseField3</td>";}}function makeGroupBy3($radio1,$caseField1,$caseField2,$caseField3,$vc3,$vc2,$vc1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $vc1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $vc2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $vc3>$caseField3</td>";}}function makeUpdateFields($fieldArray){global $updateFields;for($i=0;$i<count($fieldArray);$i++){if($i!=0){$updateFields.=",".$fieldArray[$i]."=$".$fieldArray[$i];}else{$updateFields.=$fieldArray[$i]."=$".$fieldArray[$i];}}// end for}// end makeUpdateFields?>