<?phpsession_start();$level=$_SESSION[budget][level];// print_r($_SESSION);extract($_REQUEST);if($Submit=="Delete"){include("../../../include/connectBUDGET.inc");// database connection parameters$sql = "DELETE from cid_vendor_invoice_payments where id='$id'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");include("../menu.php");echo "Invoice was deleted.";exit;}if($submit_acs=="Submit"||$submit_acs=="Update"){include("acsAdd.php");exit;}if($submit_acs=="Preview"){include("acs_pdf.php");exit;}$message="Pay Invoice";//$addMessage=" &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The <font color='brown'>first report</font> is now available. Select the \"Reports\" option from the \"Invoices\" menu.";$formType="Submit";if($id){ //echo "Hello";include("../../../include/connectBUDGET.inc");// database connection parameters$passID=$id;// necessary since id will being overwritten$sql = "SELECT * From cid_vendor_invoice_payments where id='$id'";	//	echo "$sql";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result);extract($row);$message="Invoice $ncas_invoice_number for $invoice_total has been entered.";$passReceived_by=$received_by;$passPrepared_by=$prepared_by;$passApproved_by=$approved_by;if($energy_group!=""){		$sql = "selectUPPER(concat(energy_group,'-',energy_subgroup,'-',unit_of_measure)) as 'passEnergy_type'from energywhere 1 and energy_group='$energy_group' and energy_subgroup='$energy_subgroup' and cdcs_uom='$cdcs_uom'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result); extract($row);		}//$passEnergy_type=$energy_group."-".$energy_subgroup."-".$cdcs_uom;if($submit_acs=="Duplicate"){//$ncas_invoice_number="";$ncas_invoice_amount="";$ncas_freight="";$invoice_total="";$po_line1="";$message="Invoice has been duplicated.";$formType="Submit";}else{$formType="Update";}// Make link(s) to ACS records$sql1 = "SELECT id as linkID,invoice_total as linkAmt From cid_vendor_invoice_paymentswhere vendor_number='$vendor_number' AND due_date='$due_date' AND prepared_by='$prepared_by'order by invoice_total";//echo "$sql";exit;$result1 = mysql_query($sql1) or die ("Couldn't execute query. $sql1");$num=mysql_num_rows($result1);if($num>1){$links="$num invoices on this ACS => ";while($row1=mysql_fetch_array($result1)){extract($row1);$linkID="[<a href='acs.php?id=$linkID'>$linkAmt</a>]";$links.=$linkID." ";}}}include("../menu.php");//echo "<pre>";print_r($_REQUEST);//print_r($_SESSION);echo "</pre>";//EXIT;$userName=$_SESSION[budget][acsName];if(!$userName){include("../../../include/connectDIVPER.62.inc");// database connection parameters$userID=$_SESSION[budget][tempID];$sql = "SELECT Nname,Fname,Lname From empinfo where tempID='$userID'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result);extract($row);if($Nname){$Fname=$Nname;}$userName=$Fname." ".$Lname;$_SESSION[budget][acsName]=$userName;}include("../../../include/connectBUDGET.inc");// database connection parametersinclude("../../../include/parkcountyRCC.inc");// used to get a park's ncas_rcc$parkcodeACS=$_SESSION[budget][select];if(!$parkcode){$parkcode=$parkcodeACS;}$prev3month=date("Y-m-d", mktime(0,0,0,(date(m)-3),date(d),date(Y)));// Get values for various pulldown menus$sql = "SELECT DISTINCT received_by From cid_vendor_invoice_payments where parkcode='$parkcode' and received_by !='' and system_entry_date>'$prev3month'order by received_by";//echo "$sql";exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){$receive[]=$row[received_by];}$sql = "SELECT DISTINCT prepared_by From cid_vendor_invoice_payments where parkcode='$parkcode' and prepared_by !=''  and system_entry_date>'$prev3month'order by prepared_by";//echo "$sql";exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){$prepare[]=$row['prepared_by'];}$sql = "SELECT DISTINCT approved_by From cid_vendor_invoice_payments where parkcode='$parkcode' and approved_by !=''  and system_entry_date>'$prev3month'order by approved_by";//echo "$sql";exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){$approve[]=$row['approved_by'];}$pcard[]="";$sql = "SELECT DISTINCT concat_ws('-',concat_ws(', ',last_name,first_name),card_number,admin) as nameCard,locationFrom budget.pcard_users where parkcode='$parkcode' and act_id='y' order by last_name";//echo "$sql";exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){extract($row);if($location=="1669"){$nameCard.="-CI";}$pcard[]=strtoupper($nameCard);}$sql = "selectconcat(energy_group,'-',energy_subgroup,'-',unit_of_measure) as 'energy_type'from energywhere 1group by concat(energy_group,energy_subgroup)order by energy_group,energy_subgroup";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){$energy_type[]=strtoupper($row['energy_type']);}//echo "<pre>"; print_r($energy_type); echo "</pre>";  exit;$testMonth=date(n);if($testMonth >0 and $testMonth<7){$year1=date(Y)-1;}if($testMonth >6){$year1=date(Y);}$currYearMonth=$year1."-07-00";$sql = "SELECT max( sheet )  AS sheetMaxFROM cid_vendor_invoice_paymentsWHERE parkcode =  '$parkcode' AND system_entry_date  >  '$currYearMonth'GROUP  BY parkcode";//echo "$sql";//exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result);extract($row);if(!$ncas_date_entered){$ncas_date_entered=date("m/d/Y");}echo "<body><table cellpadding='1'><tr><td> </td><td><font color='green'>$message</font>$addMessage<br>$links</td></tr>";if($new_vendor){$nvCK='checked';}if($ncas_credit){$crCK='checked';}if($part_pay){$ppCK='checked';}if(!$due_date){$due_date="will be calculated";}if(!$parkcode){$parkcode=$parkcodeACS;}else{$parkcode=strtoupper($parkcode);}if(!$ncas_rcc){$ncas_rcc=$parkRCC[$parkcodeACS];}if(!$ncas_county_code){$ncas_county_code=$parkCounty[$parkcodeACS];}if(!$prefix){$prefix="53";}if(!$ncas_budget_code){$ncas_budget_code="14300";}if(!$ncas_fund){$ncas_fund="1280";}if(!$ncas_company){$ncas_company="1601";}if(!$prepared_by){$prepared_by=$userName;}if(!$prepared_date){$prepared_date=$ncas_date_entered;}if(!$sheet){$sheet=$sheetMax+1;}$pay_center=$ncas_fund.$ncas_rcc;if($level>2){$sheet="";}if(!$num_invoice){$num_invoice=1;}if($level<4){$RO="READONLY";}echo "<form name='acsForm' action='acs.php' method='POST'>$sed<tr><td><font color='purple'>parkcode</font></td><td><input type='text' name='parkcode' value='$parkcode' size='5'> park ACS# <input type='text' name='sheet' value='$sheet' size='5'> check# <input type='text' name='check_num' value='$check_num' size='15'>&nbsp;&nbsp;&nbsp;&nbsp;Num. Invoices <input type='text' name='num_invoice' value='$num_invoice' size='3'$RO></td></tr>";echo "<tr><td>vendor_number</td><td><input type='button' value='Get Vendor Info' onclick=\"return popitup('vendor.php?parkcode=$parkcode')\"> <input name='vendor_number' type='text' value='$vendor_number' size='40'> New Vendor <input type='checkbox' name='new_vendor' value='x'$nvCK></td></tr>";$vendor_name=stripslashes($vendor_name);$vendor_name=stripslashes($vendor_name);echo "<tr><td>vendor_name</td><td><textarea name='vendor_name' cols='45' rows='1'>$vendor_name</textarea>";// <input type='submit' name='submit_acs' value='Get Vendor Info'>echo "</td></tr><tr><td>vendor_address</td><td><textarea name='vendor_address' cols='45' rows='3'>$vendor_address</textarea></td></tr><tr><td>group_number</td><td><input type='text' name='group_number' value='$group_number' size='5'> pay_entity <input type='text' name='pay_entity' value='$pay_entity' size='5'></td></tr>";echo "<tr><td><font color='purple'>invoice_number</font></td><td><input type='text' name='ncas_invoice_number' value='$ncas_invoice_number' size='30'></td></tr><tr><td><font color='purple'>invoice_date</font></td><td><input type='text' name='ncas_invoice_date' value='$ncas_invoice_date' size='12' maxlength='10'> (m/d/yyyy) &nbsp;&nbsp;due_date <input type='text' name='due_date' value='$due_date' size='14'> (m/d/yyyy)</td></tr><tr><td><font color='purple'>invoice_amount</font></td><td><input type='text' name='ncas_invoice_amount' value='$ncas_invoice_amount' size='15'	 onChange=\"copyData1(this,document.acsForm.invoice_total)\"    onKeyUp=\"copyData1(this,document.acsForm.invoice_total)\">&nbsp;&nbsp; freight <input type='text' name='ncas_freight' value='$ncas_freight' size='7'	 onChange=\"copyData2(this,document.acsForm.invoice_total)\"    onKeyUp=\"copyData2(this,document.acsForm.invoice_total)\"></td></tr>    <tr><td>invoice_total</td><td><input type='text' name='invoice_total' value='$invoice_total' size='15'> credit <input type='checkbox' name='ncas_credit' value='x'$crCK> refund_code <input type='text' name='refund_code' value='$refund_code' size='5'>";echo " Energy Type <select name='energy'>\n"; echo "<option value=''>\n"; for($j=0;$j<count($energy_type);$j++){if($energy_type[$j]==$passEnergy_type){$v="selected";}else{$v="value";}     echo "<option $v='$energy_type[$j]'>$energy_type[$j]\n";}echo "</select>";echo " energy_quantity <input type='text' name='energy_quantity' value='$energy_quantity' size='10'></td></tr>";/* */echo "<tr><td><font color='purple'>ncas_prefix</font></td><td><input type='text' name='prefix' value='$prefix' size='2'>&nbsp;&nbsp;&nbsp;<font color='purple'>ncas_number</font><input type='text' name='ncas_number' value='$ncas_number' size='10'>";//<img src='new.gif'>-->echo " &nbsp;&nbsp; <input type=\"button\" value=\"View Account Numbers\" onClick=\"return popitup('acctNum.php')\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type='text' name='er_num' value='$er_num' size='5' READONLY> Equip. Request Number &nbsp;&nbsp; <input type=\"button\" value=\"Approved Equipment list\" onClick=\"return popitup('equipList.php?pay_center=$pay_center')\"></td></tr>";if($ncas_number){$fullNC=$prefix.$ncas_number;$sql=" Select park_acct_desc from coa where ncasnum='$fullNC'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result);extract($row);echo "<tr><td></td><td><font color='red'>$park_acct_desc</font></td></tr>";}echo "</table><table border='1'><tr><td width='100' align='right'>for POs &nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;buy_entity <input type='text' name='ncas_buy_entity' value='$ncas_buy_entity' size='5'> FY:<input type='text' name='fy' value='$fy' size='6'> po_number<input type='text' name='ncas_po_number' value='$ncas_po_number' size='14'> part_pay <input type='checkbox' name='part_pay' value='x'$ppCK></td></tr>";echo "<tr><td> &nbsp;&nbsp; <input type=\"button\" value=\"View POs\" onClick=\"return popitup('po.php?parkcode=$parkcode&po_number=$ncas_po_number')\"></td><td> PO Line#: <input type='text' name='po_line1' value='$po_line1' size='7'> <font size='-1'>Enter amount for this PO Line# in the invoice_amount field. Create a separate record for each PO Line# paid.</font></td></tr></table><table><tr><td><input type=\"button\" value=\"PARTF Project Info\" onClick=\"return popitup('partf.php?parkcode=$parkcode')\"></td><td>project_number <input name='project_number' type='text' value='$project_number' size='8' READONLY> <font size='-2'>Project number must be entered using Project Info button.</font><br>company <input name='ncas_company' type='text' value='$ncas_company' size='8' READONLY><br>budget_code <input name='ncas_budget_code' type='text' value='$ncas_budget_code' size='8' READONLY>";if($level>2){$nfro="";}else{$nfro="READONLY";}echo "<br>ncas_fund <input name='ncas_fund' type='text' value='$ncas_fund' size='8' $nfro></td></tr>";if($project_number){$ncas_rcc="";}echo "<tr><td align='right'>rcc</td><td><input type='text' name='ncas_rcc' value='$ncas_rcc' size='4'> county_code <input type='text' name='ncas_county_code' value='$ncas_county_code' size='4'></td></tr><tr><td align='right'>remit_code</td><td><textarea name='ncas_remit_code' cols='55' rows='2'>$ncas_remit_code</textarea></td></tr><tr><td align='right'>comments</td><td><textarea name='comments' cols='55' rows='2'>$comments</textarea></td></tr>";echo "<tr><td align='right'>accrual_code</td><td><input type='text' name='ncas_accrual_code' value='$ncas_accrual_code' size='4'> fas_num<input type='text' name='fas_num' value='$fas_num' size='12'> </td></tr></table>";echo "<table>";//echo "<tr><td><font color='purple'>received_by</font></td><td><select name='received_by'>\n"; echo "<option value=''>\n"; for($j=0;$j<count($receive);$j++){if($receive[$j]==$passReceived_by){$v="selected";}else{$v="value";}     echo "<option $v='$receive[$j]'>$receive[$j]\n";}echo "</select><input type='text' name='received_byAlt' value=''></td></tr>";echo "<tr><td><font color='purple'>prepared_by</font></td><td><select name='prepared_by'>\n"; echo "<option value=''>\n";  $k=count($prepare);for($j=0;$j<$k;$j++){if($prepare[$j]==$passPrepared_by){$v="selected";}else{$v="value";}     echo "<option $v='$prepare[$j]'>$prepare[$j]\n";}if($k<1){$pbAlt=$prepared_by;}echo "</select><input type='text' name='prepared_byAlt' value='$pbAlt'>&nbsp;&nbsp;&nbsp;  prepared_date:<input type='text' name='prepared_date' value='$prepared_date'></td></tr>";echo "<tr><td><font color='purple'>approved_by</font></td><td><select name='approved_by'>\n"; echo "<option value=''>\n"; for($j=0;$j<count($approve);$j++){if($approve[$j]==$passApproved_by){$v="selected";}else{$v="value";}     echo "<option $v='$approve[$j]'>$approve[$j]\n";}echo "</select><input type='text' name='approved_byAlt' value=''>&nbsp;&nbsp;&nbsp;  approved_date:<input type='text' name='approved_date' value='$approved_date'></td></tr>";/*echo "<tr><td>entered_by</td><td> $ncas_entered_by<input type='hidden' name='ncas_entered_by' value='$ncas_entered_by'>&nbsp;&nbsp;&nbsp; date_entered:  $ncas_date_entered<input type='hidden' name='ncas_date_entered' value='$ncas_date_entered'> </td></tr>";*/if(!$system_entry_date){$system_entry_date=date("Y-m-d");}echo "</table><table><tr><td width='100'><input type='hidden' name='m' value='invoices'><input type='hidden' name='system_entry_date' value='$system_entry_date'>";echo "<input type='hidden' name='id' value='$passID'>";echo "<input type='submit' name='submit_acs' value='$formType'></form>";?><script language="JavaScript" type="text/javascript">var frmvalidator  = new Validator("acsForm");  frmvalidator.addValidation("parkcode","req","Please enter the Park Code");  frmvalidator.addValidation("ncas_invoice_number","req","Please enter an Invoice Number");  frmvalidator.addValidation("ncas_invoice_date","req","Please enter the Invoice Date");  frmvalidator.addValidation("ncas_invoice_amount","req","Please enter the Invoice Amount");  frmvalidator.addValidation("ncas_number","req","Please enter the NCAS Account Number");</script><?phpecho "</td>";if($submit_acs=="Submit"||$formType=="Update"){if($m=="invoices"){$warning="<font color='red'>Warning: NEVER</font> use this Form to lookup OLD Invoices in order to pay NEW Invoices to the same Vendor<br/><br /><font color='green'>ALWAYS</font> pay NEW Invoices using a Blank Form by accessing the Pay Invoices menu";}else{echo "<td width='100'><form action='/budget/acs/acs.php' method='POST'><input type='hidden' name='m' value='invoices'><input type='hidden' name='id' value='$passID'><input type='submit' name='submit_acs' value='Duplicate'></form></td>";}$vendor_nameURL=urlencode($vendor_name);echo "<td>";if($project_number!=""){echo "<form action='/budget/acs/acs_ci_pdf.php'>";}else{echo "<form action='/budget/acs/acs_pdf.php'>";}echo "<input type='hidden' name='m' value='invoices'><input type='hidden' name='vendor_name' value='$vendor_nameURL'><input type='hidden' name='due_date' value='$due_date'><input type='hidden' name='prepared_by' value='$passPrepared_by'><input type='submit' name='submit_acs' value='Preview'> Click browser's back button after Preview.</form></td></tr><tr><td>&nbsp;</td></tr><tr><td><form action='/budget/acs/acs.php'><input type='hidden' name='m' value='invoices'><input type='hidden' name='id' value='$passID'><input type='submit' name='Submit' value='Delete' onClick=\"return confirmLink()\"></td><td>$warning</td></tr></form>";}echo "</table></body></html>";?>