<?phpinclude("../../include/authWIYS.inc");// $e=code for an update error,  $u=code to return values after update/*echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//EXIT;*/$viewID=$tempID;// Used to pass variable when viewing someone else// ************* Update **********if($Submit=="Update"){include_once("../../include/connectWIYS.inc");$today=date("Ymd");// don't think is needed$su= strtotime("Sunday");$sun=date("Ymd",$su)."~".$sun;$mo= strtotime("Monday");$mon=date("Ymd",$mo)."~".$mon;$tu= strtotime("Tuesday");$tue=date("Ymd",$tu)."~".$tue;$we= strtotime("Wednesday");$wed=date("Ymd",$we)."~".$wed;$th= strtotime("Thursday");$thu=date("Ymd",$th)."~".$thu;$fr= strtotime("Friday");$fri=date("Ymd",$fr)."~".$fri;$sa= strtotime("Saturday");$sat=date("Ymd",$sa)."~".$sat;$ne= strtotime("+7 day");$nex=date("Ymd",$ne)."~".$nex;$mon=addslashes($mon);$tue=addslashes($tue);$wed=addslashes($wed); $thu=addslashes($thu);$fri=addslashes($fri);$sat=addslashes($sat); $sun=addslashes($sun);$nex=addslashes($nex);$query = "replace itinerary set empID='$tempID',sun='$sun',mon='$mon',tue='$tue',wed='$wed',thu='$thu',fri='$fri',sat='$sat',nex='$nex'";$result = @mysql_query($query, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());header("Location: itinerary.php?tempID=$tempID&u=1&e=0&v=1"); exit;exit;}// ************* End Update **********// ************* After Update **********include_once("../../include/connectWIYS.inc");$sql = "select * from itinerary where empID='$tempID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);// ************* Update Problem **************if($u!=""){if($e=="0"){$message="<tr><td><font color='blue' size=+1>Itinerary Updated</font></td></tr>";}if($e=="1"){$message="<tr><td><font color='blue' size=+1>You failed to indicate your return time. Please correct.</font></td></tr>";}}// end if e// ************* End Update Problem ************include("functions.php");headerStuff($message);//$Fname=$_SESSION[wiys][first];//$Lname=$_SESSION[wiys][last];$tempID=$_SESSION[wiys][tempID];$weekArray=array($sun,$mon,$tue,$wed,$thu,$fri,$sat,$nex);//print_r($weekArray);//exit;// *************** Validate **********// *********** Check for Updating$testPark=strtoupper($_SESSION[wiys][parkS]);if($testPark==$loc){$v=1;}else{$v="";}if($v==1){$today=strtotime("now");$t=date("l - F jS",strtotime("now"));// echo "$t";// concatenate values for passage through array_walk$su= strtotime("Sunday");$Su=$su."*".$sun."*sun";$mo= strtotime("Monday");$Mo=$mo."*".$mon."*mon";$tu= strtotime("Tuesday");$Tu=$tu."*".$tue."*tue";$we= strtotime("Wednesday");$We=$we."*".$wed."*wed";$th= strtotime("Thursday");$Th=$th."*".$thu."*thu";$fr= strtotime("Friday");$Fr=$fr."*".$fri."*fri";$sa= strtotime("Saturday");$Sa=$sa."*".$sat."*sat";$nx= strtotime("+7 day"); $Nx=$nx."*".$nex."*nex";$check=date("Ymd",$today);if($updateon<$check){$updateon=$check;}//$dayArray=array($Su,$Mo,$Tu,$We,$Th,$Fr,$Sa,$Nx);$dayArray=array($Su,$Mo,$Tu,$We,$Th,$Fr,$Sa);asort($dayArray);// sorts values but indexes remain the sameinclude_once("../../include/connectDIVPER.62.inc");$sql = "select Nname,Fname,Lname from empinfo where tempID='$viewID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($Nname){$Fname=$Nname;}echo "<table><tr><td></td><td>$Fname $Lname</td></tr>";// ******  Use array_walk to move $dayArray through func 'displayWeek'array_walk($dayArray,'displayWeek');echo "<tr><td>&nbsp;</td><td width='150' align='center'><input type='hidden' name='tempID' value='$viewID'><input type='submit' name='Submit' value='Update'></form></td><td><form name='return' method='post' action='status.php'><input type='hidden' name='tempID' value='$tempID'><input type='submit' name='Submit' value='Return'></form></td></tr></table>";}else{include_once("../../include/connectDIVPER.62.inc");$sql = "select Nname,Fname,Lname from empinfo where tempID='$viewID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($Nname){$Fname=$Nname;}$today=strtotime("now");$t=date("l - F jS",strtotime("now"));// echo "$today";$su= strtotime("Sunday");$Su=$su."*".$sun."*sun";//$Su=$sun."*sun"."*".$su;$mo= strtotime("Monday");$Mo=$mo."*".$mon."*mon";//$Mo=$mon."*sun"."*".$mo;$tu= strtotime("Tuesday");$Tu=$tu."*".$tue."*tue";//$Tu=$tue."*sun"."*".$tu;$we= strtotime("Wednesday");$We=$we."*".$wed."*wed";//$We=$wed."*sun"."*".$we;$th= strtotime("Thursday");$Th=$th."*".$thu."*thu";//$Th=$thu."*sun"."*".$th;$fr= strtotime("Friday");$Fr=$fr."*".$fri."*fri";//$Fr=$fri."*sun"."*".$fr;$sa= strtotime("Saturday");$Sa=$sa."*".$sat."*sat";//$Sa=$sat."*sun"."*".$sa;$nx= strtotime("+7 day"); $Nx=$nx."*".$nex."*nex";//$Nx=$nex."*sun"."*".$ne;$check=date("Ymd",$today);if($updateon<$check){$updateon=$check;}$test=strtotime("20050503");//$Nx=$test."*".$nex."*nex";//$dayArray=array($Su,$Mo,$Tu,$We,$Th,$Fr,$Sa,$Nx);$dayArray=array($Su,$Mo,$Tu,$We,$Th,$Fr,$Sa);/*echo "<pre>";print_r($dayArray);echo "<pre>";*/asort($dayArray);/*echo "<pre>";print_r($dayArray);echo "<pre>";echo "c=$check n=$test1";*/echo "<table border='1' cellpadding='15'><tr><td align='right'>Itinerary for:</td><td><b>$Fname $Lname</b></td></tr>";// ******  Use array_walk to move $dayArray through func 'displayItinerary'array_walk($dayArray,'displayItinerary');echo "<tr><td colspan='2' align='center'></form><form name='return' method='post' action='status.php'><input type='hidden' name='tempID' value='$tempID'><input type='submit' name='Submit' value='Return'></form></tr></table>";}if($v==1){include("../../include/connectWIYS.inc");include("status.php");}?>