<?php$query1 = "truncate table budget.project_balances_fund_div1; ";$result1 =mysqli_query($connection, $query1) or die ("Couldn't execute query 1.  $query1");if($showSQL=="1"){echo "<br><br>$query1";}$query2="insert into budget.project_balances_fund_div1(center,fundsin)          select fund_in,sum( amount )		 FROM partf_fund_trans 		 where fund_in != ''		 GROUP BY fund_in; ";		 $result2 =mysqli_query($connection, $query2) or die ("Couldn't execute query 2.  $query2");if($showSQL=="1"){echo "<br><br>$query2";}		 		 $query3="insert into budget.project_balances_fund_div1(center,fundsout)          select fund_out,sum( amount )		 FROM partf_fund_trans 		 where fund_out != ''		 GROUP BY fund_out; ";		 $result3 =mysqli_query($connection, $query3) or die ("Couldn't execute query 3.  $query3");if($showSQL=="1"){echo "<br><br>$query3";}		 		 $query4="insert into budget.project_balances_fund_div1(center,payments)          select center,sum(amount )		 FROM partf_payments 		 where center != ''		 GROUP BY center; ";		 $result4 =mysqli_query($connection, $query4) or die ("Couldn't execute query 4.  $query4");if($showSQL=="1"){echo "<br><br>$query4";}$query5 = "truncate table budget.project_balances_fund_div2";$result5 =mysqli_query($connection, $query5) or die ("Couldn't execute query 5.  $query5");if($showSQL=="1"){echo "<br><br>$query5";}//if($level>4){$showSQL=1;}$query6 = "insert into project_balances_fund_div2(center,fundsin,fundsout,payments)select center,sum(fundsin),sum(fundsout),sum(payments)from project_balances_fund_div1where 1 group by center";$result6 =mysqli_query($connection, $query6) or die ("Couldn't execute query 6.  $query6");if($showSQL=="1"){echo "<br><br>$query6";}$query7 = "update project_balances_fund_div2set posted_balance=fundsin-fundsout-paymentswhere 1 ";$result7 =mysqli_query($connection, $query7) or die ("Couldn't execute query 7.  $query7");if($showSQL=="1"){echo "<br><br>$query7";}$query8 = "update project_balances_fund_div2,centerset project_balances_fund_div2.center_description=center.center_desc,    project_balances_fund_div2.section=center.section,	project_balances_fund_div2.fyear=center.f_year_funded,	project_balances_fund_div2.category=center.project_type,	project_balances_fund_div2.park=center.parkcode	where project_balances_fund_div2.center=center.center";$result8 =mysqli_query($connection, $query8) or die ("Couldn't execute query 8.  $query8");if($showSQL=="1"){echo "<br><br>$query8";}$query8a = "update project_balances_fund_div2,center            set project_balances_fund_div2.project_valid='y'			where project_balances_fund_div2.center=center.center			and center.type='project' ";$result8a =mysqli_query($connection, $query8a) or die ("Couldn't execute query 8a.  $query8a");if($showSQL=="1"){echo "<br><br>$query8a";}$query9 = "truncate table project_balances_div_projcount ";$result9 =mysqli_query($connection, $query9) or die ("Couldn't execute query 9.  $query9");if($showSQL=="1"){echo "<br><br>$query9";}$query10 = "insert into project_balances_div_projcount(center,proj_count)           select center,count(center) from partf_projects where projyn='y' 		   group by center";$result10 =mysqli_query($connection, $query10) or die ("Couldn't execute query 10.  $query10");if($showSQL=="1"){echo "<br><br>$query10";}$query11 = "update project_balances_fund_div2,project_balances_div_projcount            set project_balances_fund_div2.project_count=project_balances_div_projcount.proj_count			where project_balances_fund_div2.center=project_balances_div_projcount.center";$result11 =mysqli_query($connection, $query11) or die ("Couldn't execute query 11.  $query11");if($showSQL=="1"){echo "<br><br>$query11";}/*$query7 = "update project_balances_div2           set balance1=approved-expenses where 1";$result7 =mysqli_query($connection, $query7) or die ("Couldn't execute query 7.  $query7");if($showSQL=="1"){echo "<br><br>$query7";}$query8="update project_balances_div2,partf_projects         set project_balances_div2.status=partf_projects.statusper		 where project_balances_div2.projnum=partf_projects.projnum";$result8 =mysqli_query($connection, $query8) or die ("Couldn't execute query 8.  $query8");if($showSQL=="1"){echo "<br><br>$query8";}$query9="update project_balances_div2,center         set project_balances_div2.budgcode=center.budcode,		     project_balances_div2.yearfundc=center.cyinitfund,			 project_balances_div2.yearfundf=center.f_year_funded,			 project_balances_div2.center_description=center.center_desc,			 project_balances_div2.section=center.section		 where project_balances_div2.center=center.center";$result9 =mysqli_query($connection, $query9) or die ("Couldn't execute query 9.  $query9");if($showSQL=="1"){echo "<br><br>$query9";}$query10="update project_balances_div2,partf_projects         set project_balances_div2.projyn=partf_projects.projyn,		     project_balances_div2.reportdisplay=partf_projects.reportdisplay,		     project_balances_div2.projcat=partf_projects.projcat,		     project_balances_div2.manager=partf_projects.manager,		     project_balances_div2.proj_man=partf_projects.proj_man,		     project_balances_div2.active=partf_projects.active,		     project_balances_div2.showpa=partf_projects.showpa,		     project_balances_div2.fullname=partf_projects.fullname,		     project_balances_div2.dist=partf_projects.dist,		     project_balances_div2.county=partf_projects.county,		     project_balances_div2.park=partf_projects.park,		     project_balances_div2.projname=partf_projects.projname,		     project_balances_div2.startdate=partf_projects.startdate,		     project_balances_div2.enddate=partf_projects.enddate,		     project_balances_div2.design=partf_projects.design,		     project_balances_div2.construction=partf_projects.construction,		     project_balances_div2.statusper=partf_projects.statusper,		     project_balances_div2.commentsi=partf_projects.commentsi	  	 where project_balances_div2.projnum=partf_projects.projnum";$result10 =mysqli_query($connection, $query10) or die ("Couldn't execute query 10.  $query10");if($showSQL=="1"){echo "<br><br>$query10";}$query11="update project_balances_div2         set balance2=balance1		 where (status='ns' or status='ip')and (balance1 > '0')";$result11 =mysqli_query($connection, $query11) or die ("Couldn't execute query 11.  $query11");if($showSQL=="1"){echo "<br><br>$query11";}$query12="update project_balances_div2         set balance3=balance1-unposted_expenses		 where 1";$result12 =mysqli_query($connection, $query12) or die ("Couldn't execute query 12.  $query12");if($showSQL=="1"){echo "<br><br>$query12";}$query13="update project_balances_div2         set balance3=balance1-unposted_expenses		 where 1";		 		 $result13 =mysqli_query($connection, $query13) or die ("Couldn't execute query 13.  $query13");if($showSQL=="1"){echo "<br><br>$query13";}*/$query13a="select sum(fundsin) as 'fundsin_total',sum(fundsout) as 'fundsout_total',          sum(payments) as 'payments_total',sum(posted_balance) as 'posted_balance_total'		  from project_balances_fund_div2 where 1		  ";		  $result13a =mysqli_query($connection, $query13a) or die ("Couldn't execute query 13a.  $query13a");$row13a=mysqli_fetch_array($result13a);extract($row13a);$fundsin_total=number_format($fundsin_total,2);$fundsout_total=number_format($fundsout_total,2);$payments_total=number_format($payments_total,2);$posted_balance_total=number_format($posted_balance_total,2);$query14="select * from project_balances_fund_div2 where 1 order by fyear desc";			 $result14 =mysqli_query($connection, $query14) or die ("Couldn't execute query 14.  $query14");$num14=mysqli_num_rows($result14);echo "<table><tr><td>Centers:<font color='red'> $num14 </font></td></tr></table>";if($showSQL=="1"){echo "<br><br>$query14";}while($row=mysqli_fetch_assoc($result14)){$ARRAY[]=$row;}$fieldcount=count($ARRAY[0]);echo "fieldcount=$fieldcount";//echo "<pre>";print_r($ARRAY);echo "</pre>";exit;$skip=array('view');//echo "<pre>";print_r($skip);echo "</pre>";exit;echo "<table border='1'><tr>";foreach($ARRAY[0] as $field=>$value){//if the KEY($field) is in $skip ARRAY,loop stops. If $field is not in $skip ARRAY, loop continues //& passes the field name between the TD tags belowif(in_array($field,$skip)){continue;}echo "<th>$field </th>";}echo "</tr>";//exit;//$ARRAY has a KEY($index) & a VALUE($row). $row is an associative ARRAY in its own right//with its own KEY($field) & VALUE($value)if($c==''){$t=" bgcolor='$table_bg2' ";$c=1;}else{$t='';$c='';}foreach($ARRAY as $index=>$row){echo "<tr$t>";//walking thru the inner array-STARTforeach($row as $field=>$value){//if the KEY($field) is in $skip ARRAY,loop stops. If $field is not in $skip ARRAY, loop continues //& passes the field value between the TD tags belowif(in_array($field,$skip)){continue;}if($field=='fundsin'){$value=number_format($value,2);}if($field=='fundsout'){$value=number_format($value,2);}if($field=='payments'){$value=number_format($value,2);}if($field=='posted_balance'){$value=number_format($value,2);}echo "<td>$value</td>";}//walking thru the inner array-ENDecho "</tr>";}//walking trhu the outer array-ENDecho "<tr>";foreach($ARRAY[0] as $field=>$value){if($field=='fundsin'){echo "<td>$fundsin_total</td>";}if($field=='fundsout'){echo "<td>$fundsout_total</td>";}if($field=='payments'){echo "<td>$payments_total</td>";}if($field=='posted_balance'){echo "<td>$posted_balance_total</td>";}if($field!='fundsin' and $field!='fundsout' and $field!='payments' and $field!='posted_balance'){echo "<td></td>";}}echo "</tr>";echo "</table>";?>