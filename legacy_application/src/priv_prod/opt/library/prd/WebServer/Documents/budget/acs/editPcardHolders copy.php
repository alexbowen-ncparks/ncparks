<?phpextract($_REQUEST);session_start();$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/connectROOT.inc"); // connection parametersmysql_select_db($database, $connection); // databaseif($submit_acs=="Delete"){$sql = "Delete from pcard_users where id='$id'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$m="pcard_holder";header("Location: /budget/acs/editPcardHolders.php?m=$m&parkcode=$parkcode&submit_acs=Find");exit;}//print_r($_REQUEST);//print_r($_SESSION);$parkcodeACS=$_SESSION[budget][select];$level=$_SESSION[budget][level];if($level>1){$parkcodeACS=strtoupper($parkcode);}if($level==1){$_REQUEST[parkcode]=strtoupper($parkcodeACS);}$sql = "SHOW COLUMNS from pcard_users";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");while($row=mysql_fetch_array($result)){$fields[]=$row[0];}if(!$message){$message="Find/Add Pcard Holder";}if($submit_acs=="Update"||$submit_acs=="Submit"||$submit_acs=="Add"){// ****** Any modifications to variables **********$last_name=addslashes($last_name);$first_name=addslashes($first_name);$parkcode=$parkcodeACS;for($i=0;$i<count($fields);$i++){if($fields[$i]!="id"){$val=${$fields[$i]};// force the variable$val="'".$val."'";if($i!=0) {$arraySet.=",".$fields[$i]."=".$val;}else{$arraySet.=$fields[$i]."=".$val;}}}if($submit_acs=="Add"){$query = "INSERT into pcard_users SET $arraySet";//echo $query; exit;$result = mysql_query($query) or die ("Couldn't execute query. $query");$id=mysql_insert_id();header("Location:/budget/acs/editPcardHolders.php?m=$m&parkcode=$parkcode&submit_acs=Find");exit;}if($submit_acs=="Update"){$query = "UPDATE pcard_users SET $arraySet where id='$id'";//echo "$query";exit;$result = mysql_query($query) or die ("Couldn't execute query. $query");}header("Location:/budget/acs/editPcardHolders.php?m=$m&parkcode=$parkcode&submit_acs=Find");exit;// ******************************** end Add Update}function makeQuery(&$item1,$key){global $query,$fields;if($item1 AND in_array($key,$fields)){if($key=="last_name"||$key=="first_name"){$item1=addslashes($item1);$query.=" and ".$key." like '%".$item1."%'";}else{$query.=" and ".$key."='".$item1."'";}}}include("../menu.php");if($submit_acs=="Find"||$id){$findArray=$_REQUEST;array_walk($findArray, 'makeQuery');$WHERE="Where 1 ".$query;if($level<2){$WHERE.=" and parkcode='$parkcodeACS'";}$sql = "SELECT * From pcard_users $WHERE order by last_name,first_name";if($level>1){$WHERE.=" and parkcode='$parkcodeACS'";echo "<table cellpadding='1'><form name=\"acsForm\" action='editPcardHolders.php' method='POST'><tr><td>parkcode</td><td><input type='text' name='parkcode' value='$parkcode' size='5'><input type='submit' name='submit_acs' value='Find'></tr>";}//echo "$sql";//EXIT;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);if($num<1){Header("Location: editPcardHolders.php?m=pcard_holder&message=Nothing Found.");exit;}if($num>1){echo "<tr><td colspan='4'></td></tr><tr><th>parkcode</th><th>last_name</th><th>first_name</th><th>admin</th><th>act_id</th><th>card_number</th></tr>";while($row=mysql_fetch_array($result)){extract($row);echo "<tr><td>$parkcode</td><td>$last_name</td><td>$first_name</td><td>$admin</td><td>$act_id</td><td>$card_number</td><td><a href='editPcardHolders.php?m=pcard_holder&id=$id&parkcode=$parkcode'>View</a></td></tr>";}echo "</table>";exit;}$soleRecord="y";}session_start();//echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//EXIT;$userName=$_SESSION[budget][acsName];if(!$userName){include("../../../include/connectDIVPER.62.inc");// database connection parameters$userID=$_SESSION[budget][tempID];$sql = "SELECT Nname,Fname,Lname From empinfo where tempID='$userID'";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$row=mysql_fetch_array($result);extract($row);if($Nname){$Fname=$Nname;}$userName=$Fname." ".$Lname;$_SESSION[budget][acsName]=$userName;}//These are placed outside of the webserver directory for security$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/connectROOT.inc"); // connection parametersmysql_select_db($database, $connection); // database$sql1 = "SHOW COLUMNS from pcard_users";$result1 = mysql_query($sql1) or die ("Couldn't execute query. $sql1");while($row1=mysql_fetch_array($result1)){$fields[]=$row1[0];}//print_r($fields);if($id){$formType="Update";$message="Edit Pcard Holder";}else{$formType="Find";}if($soleRecord=="y"){$formType="Update";$message="Edit Pcard Holder";}//include("/budget/parkRCC.inc");$parkcodeACS=strtoupper($_SESSION[budget][select]);$row=mysql_fetch_array($result);extract($row);if($level>1){$parkcodeACS=strtoupper($parkcode);}$passID=$id;echo "<html><header></header><body><table cellpadding='1'><tr><td> </td><td><font color='green' size='+1'>$message</font></td></tr>";echo "<form name=\"acsForm\" action='editPcardHolders.php' method='POST'><tr><td>parkcode</td><td><input type='text' name='parkcode' value='$parkcodeACS' size='5'></tr>";echo "<tr><td>last_name</td><td><input name=\"last_name\" type=\"text\" value=\"$last_name\"></td></tr>";echo "<tr><td>first_name</td><td><textarea name='first_name' cols='55' rows='1'>$first_name</textarea></td></tr><tr><td>act_id</td><td><textarea name='act_id' cols='55' rows='3'>$act_id</textarea></td></tr><tr><td>park</td><td><input type='text' name='park' value='$park' size='5'></td></tr><tr><td>location</td><td><input type='text' name='location' value='$location' size='12'></td></tr>";echo "<tr><td>admin</td><td><textarea name='admin' cols='55' rows='2'>$admin</textarea></td></tr><tr><td>card_number</td><td><textarea name='card_number' cols='55' rows='2'>$card_number</textarea></td></tr><tr><td>last_four</td><td><textarea name='last_four' cols='55' rows='2'>$last_four</textarea></td></tr><tr><td><input type='hidden' name='m' value='pcard_holder'><input type='hidden' name='message' value='$message'><input type='hidden' name='id' value='$passID'></td><td><input type='submit' name='submit_acs' value='$formType'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='hidden' name='m' value='pcard_holder'><input type='submit' name='submit_acs' value='Add'></form></td>";echo "<td><form action=''> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='hidden' name='parkcode' value='$parkcode'><input type='hidden' name='m' value='pcard_holder'><input type='hidden' name='id' value='$id'><input type='submit' name='submit_acs' value='Delete'></form></td></tr></table></body></html>";?>