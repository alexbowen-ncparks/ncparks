<?phpinclude("menu.php");//echo "<pre>";print_r($_REQUEST);echo "</pre>";//exit;$join1="LEFT JOIN coa ON coa.ncasnum = exp_rev.acct";$join2="LEFT JOIN center ON center.center = exp_rev.center";//$join3="LEFT JOIN inc_dec ON center.center = inc_dec.center AND inc_dec.ncas_acct = exp_rev.acct";$where="WHERE 1";if($_SESSION[budget][level]==1){$center=$_SESSION[budget][center];$where.=" AND exp_rev.center =  '$center'";}$where.=" AND ( acct_group =  'revenue-other' OR acct_group =  'revenue-purchase4resale' )";if($rccYN=="Y"){$where.=" AND exp_rev.fund =  '1280'";}if($rccYN=="N"){$where.=" AND exp_rev.fund =  '1280'";}$g="GROUP  BY section,center.center, acct";//echo "w=$where";if(!$submit){exit;};// ******** Get Amount revenue in Year 1$fromSQL1="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where1=$where." and f_year='$fy1'";$sql1 = "SELECT $fromSQL1 $join1 $join2 $join3 $where1 $g";$result1 = mysqli_query($connection, $sql1) or die ("Couldn't execute query 1. $sql1");$num=mysqli_num_rows($result1);while ($row1=mysqli_fetch_array($result1)){extract($row1);$conKey=$section.$acct.$center;$revenue_1_array[$conKey]=$total;}//echo "$sql1<br>";exit;//echo "$sql1<pre>";print_r($revenue_1_array);echo "</pre>";exit;// ******** Get Amount revenue in Year 2$fromSQL2="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where2=$where." and f_year='$fy2'";$sql2 = "SELECT $fromSQL2 $join1 $join2 $join3 $where2 $g";$result2 = mysqli_query($connection, $sql2) or die ("Couldn't execute query 2. $sql2");$num=mysqli_num_rows($result2);while ($row2=mysqli_fetch_array($result2)){extract($row2);$conKey=$section.$acct.$center;$revenue_2_array[$conKey]=$total;}//echo "$sq2<pre>";print_r($revenue_2_array);echo "</pre>";exit;// ******** Get Amount revenue in Year 3// For test purposes$fromSQL3="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where3=$where." and f_year='$fy3'";$sql3 = "SELECT $fromSQL3 $join1 $join2 $join3 $where3 $g";$result3 = mysqli_query($connection, $sql3) or die ("Couldn't execute query 3. $sql3");$num=mysqli_num_rows($result3);while ($row3=mysqli_fetch_array($result3)){extract($row3);$conKey=$section.$acct.$center;//array_unshift($row3, $conKey);//$revenue_3_array[]=$row3;$revenue_3_array[$conKey]=$total;}//echo "$sql3<pre>";print_r($revenue_3_array);echo "</pre>";exit;// ******** Get Amount revenue in Year 4// For test purposes$fromSQL4="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where4=$where." and f_year='$fy4'";$sql4 = "SELECT $fromSQL4 $join1 $join2 $join3 $where4 $g";$result4 = mysqli_query($connection, $sql4) or die ("Couldn't execute query 4. $sql4");$num=mysqli_num_rows($result4);while ($row4=mysqli_fetch_array($result4)){extract($row4);$conKey=$section.$acct.$center;//array_unshift($row4, $conKey);//$revenue_4_array[]=$row4;$revenue_4_array[$conKey]=$total;}//echo "$sql4<pre>";print_r($revenue_4_array);echo "</pre>";exit;// ********** This set variables AND displays the result **********$fromSQL5="CONCAT(section,exp_rev.acct,center.center) AS sacKey,section,parkcode, center.center, exp_rev.acct, coa.park_acct_desc FROM exp_rev";$where5=$where;$sql5 = "SELECT $fromSQL5 $join1 $join2 $join3 $where5 $g ORDER BY section,parkcode, acct";$result5 = mysqli_query($connection, $sql5) or die ("Couldn't execute query 5. $sql5");$num5=mysqli_num_rows($result5);while ($row5=mysqli_fetch_array($result5)){//extract($row5);$array5[]=$row5;}//echo "$sql5";//exit;$sql="SELECT max( acctdate ) as maxDate FROM  `exp_rev` WHERE 1 ";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query . $sql");$row=mysqli_fetch_array($result);extract($row);echo "<font color='green'>$num $z </font>Summaries for [Center Account] Revenues Including Items for Resale.<hr>";// Make Header	$colHeaders=array("Section","Center<br>Name","center","NCAS #","Description","revenue<br>$fy1","revenue<br>$fy2","revenue<br>$fy3","YTD<br>$maxDate");$reportFlds=array("parkcode","center","acct","park_acct_desc","revenue_1","revenue_2","revenue_3","revenue_4",);portalHeader($passSQL,$colHeaders);for($u=0;$u<count($array5);$u++){list($key,$section,$parkcode,$center,$acct, $park_acct_desc)=$array5[$u];$ck[]=$center;$now=$ck[$u];$uu=$u-1;$prev=$ck[$uu];$revenue1=$revenue_1_array[$key];$revenue2=$revenue_2_array[$key];$revenue3=$revenue_3_array[$key];$revenue4=$revenue_4_array[$key];$revenue1Form=number_format($revenue1,2);$revenue2Form=number_format($revenue2,2);$revenue3Form=number_format($revenue3,2);$revenue4Form=number_format($revenue4,2);//if($reportLevel>1 and $prev and ($now!=$prev)){if($prev and ($now!=$prev)){echo "<tr><td></td><td></td><td></td><td></td><td align='right'>SubTotal:</td><td align='right'><b>$tot1Form</b></td><td align='right'><b>$tot2Form</b></td><td align='right'><b>$tot3Form</b></td><td align='right'><b>$tot4Form</b></td></tr>";$tot1="";$tot2="";$tot3="";$tot4="";}$tot1=$revenue1+$tot1;$tot2=$revenue2+$tot2;$tot3=$revenue3+$tot3;$tot4=$revenue4+$tot4;$tot1Form=number_format($tot1,2);$tot2Form=number_format($tot2,2);$tot3Form=number_format($tot3,2);$tot4Form=number_format($tot4,2);//$req_amt=$revenue3+$park_req;$tot_revenue1=$tot_revenue1+$revenue1;$tot_revenue2=$tot_revenue2+$revenue2;$tot_revenue3=$tot_revenue3+$revenue3;$tot_revenue4=$tot_revenue4+$revenue4;//$tot_park_req=$tot_park_req+$park_req;//$tot_req_amt=$tot_req_amt+$req_amt;//$req_amt=number_format($req_amt,2);//$park_req=number_format($park_req,2);//$link1="dbTable=inc_dec&center=$center&ncas_acct=$acct&addRecord=Add+a+Record&ly=$revenue2&desc=$park_acct_desc&fy_req=$fy3&lastFld=inc_decid&var=$inc_decid";$rcc=substr($center,4,4);//$varURL1="<a href='/budget/a/inc_dec.php?$link1'>$park_req</a>";//$link2="dbTable=vendor_payments&account=$acct&rcc=$rcc&like[12]=Range&datenew=20040701*20050630&passAmt=$revenue3";//$varURL2="<a href='/budget/a/portal_ven_pay.php?$link2' target='_blank'>vp</a>";//$link3="dbTable=exp_rev&acct=$acct&center=$center&f_year=0405";//$varURL3="<a href='/budget/a/portal_ven_pay.php?$link3' target='_blank'>re</a>";echo "<tr><td>$section</td><td>$parkcode</td><td>$center</td><td>$acct</td> <td>$park_acct_desc</td> <td align='right'>$revenue1Form</td><td align='right'>$revenue2Form</td><td align='right'>$revenue3Form $varURL2 $varURL3</td><td align='right'>$revenue4Form</td></tr>";}$tot_revenue1=number_format($tot_revenue1,2);$tot_revenue2=number_format($tot_revenue2,2);$tot_revenue3=number_format($tot_revenue3,2);$tot_revenue4=number_format($tot_revenue4,2);//$tot_park_req=number_format($tot_park_req,2);//$tot_req_amt=number_format($tot_req_amt,2);echo "<tr><td></td><td></td><td></td><td></td><td align='right'>Totals:</td><td align='right'>$tot_revenue1</td><td align='right'>$tot_revenue2</td><td align='right'>$tot_revenue3</td><td align='right'>$tot_revenue4</td></tr>";echo "</table></body></html>";// *************** PMIS FUNCTIONS **************function portalHeader($passSQL,$colHeaders){global $numOfColumns;$fld=explode(",",$colHeaders);// Put Field Names in an Array$c=count($fld)-1;$lastFld=$fld[$c];$numOfColumns=count($colHeaders);echo "<table border='1' cellpadding='3'><tr>";for($x=0;$x<$numOfColumns;$x++){$var=strtoupper($colHeaders[$x]);echo "<th>$var</th>";}echo "</tr>";}function itemShow($key,$val){//echo "$key[$ff]  $val[$ff]<br>";}// end Function?>