<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/connectROOT.inc"); // connection parametersmysql_select_db($database, $connection); // databaseinclude("../../../include/authBUDGET.inc");extract($_REQUEST);//echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//exit;$level=$_SESSION['budget']['level'];if($level<4){	// Head Nat. Res. Section - Carol Tingley	if($_SESSION['budget']['beacon_num']!="60033160"){$test=1;}	// Land Resources - Sue Regier	if($_SESSION['budget']['beacon_num']!="60032790"){$test=1;}	if($test==""){exit;}	}include("../css/TDnull.inc");echo "<form action='budget_history.php'><table border='1' cellpadding='5'><tr><th>Please select a Report Type:</th></tr><tr><td align='right'>View by Year: </td><td>Budget Group <input type='radio' name='reportType' value='bg' checked></td><td>Account <input type='radio' name='reportType' value='acct'></td><td><input type='submit' name='submit' value='Submit'></td></tr></form>";if($reportType=="acct"){$ck_acct="checked";$ck_bg="";}else{$ck_bg="checked";$ck_acct="";}echo "<form action='budget_3yr_history.php'><tr bgcolor='aliceblue'><td align='right'>View 3 Year History: </td><td>Budget Group <input type='radio' name='reportType' value='bg' $ck_bg></td><td>Account <input type='radio' name='reportType' value='acct' $ck_acct></td><td><input type='submit' name='submit' value='Submit'></td></tr></form>";if(!$reportType){exit;}if($reportType=="bg"){$rt="Budget Group";$filterArray=array("f_year","budget_group","cash_type","center","parkcode","district","section");$fldArray=array("f_year","budget_group","cash_type","center","parkcode","district","section","sum(amount) as 'amount'");$headerArray=array("f_year","budget_group","cash_type","center","parkcode","district","section","amount");$groupBy="group by f_year,budget_group,parkcode,cash_type";$orderBy="order by f_year,budget_group,parkcode,cash_type";}if($reportType=="acct"){$rt="Account";$filterArray=array("f_year","budget_group","cash_type","center","parkcode","district","section","account");$fldArray=array("f_year","budget_group","cash_type","account","account_description","center","parkcode","district","section","sum(amount) as 'amount'");$headerArray=array("f_year","budget_group","cash_type","account","account_description","center","parkcode","district","section","amount");$groupBy="group by f_year,budget_group,parkcode,cash_type,account";$orderBy="order by f_year,budget_group,parkcode,cash_type,account";}//$showSQL=1;// Get f_yearinclude("../~f_year.php");$currentFY=$f_year;if($passFY){$f_year=$passFY;}echo "<table align='center'>";// Menu item 0// use $f_year from above/*$sql="SELECT DISTINCT f_yearFROM report_budget_historyWHERE 1 AND f_year != '' AND f_year != '9900'ORDER BY f_year"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray0[]=$row['f_year'];}*/// Menu item 1$sql="SELECT DISTINCT budget_groupFROM report_budget_historyWHERE 1 order by budget_group;"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray1[]=$row['budget_group'];} // Menu item 2$menuArray2[]="disburse";$menuArray2[]="receipt";// Menu item 3// manual entry for account // Menu item 4$sql="SELECT DISTINCT centerFROM report_budget_historyWHERE 1 order by center;"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray4[]=$row['center'];} // Menu item 5$sql="SELECT DISTINCT parkcodeFROM report_budget_historyWHERE 1 order by parkcode;"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray5[]=$row['parkcode'];} // Menu item 6$sql="SELECT DISTINCT districtFROM report_budget_historyWHERE 1 order by district;"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray6[]=$row['district'];}// Menu item 7$sql="SELECT DISTINCT sectionFROM report_budget_historyWHERE 1 order by section;"; $result = @MYSQL_QUERY($sql,$connection); while($row=mysql_fetch_array($result)){$menuArray7[]=$row['section'];}// ******** Display Menus **********echo "<tr><td colspan='8' align='center'><form action='/budget/menu.php?forum=blank'><input type='submit' name='submit' value='Return to Budget Menus'></td></tr></form>";echo "<tr><td colspan='8' align='center'>Report Type: <font color='blue'>$rt</font></td></tr>"; echo "<form><tr>";echo "<td align='center'>Fiscal Year<br /><b>$f_year</b>";/*echo "<td>Fiscal Year<br /><select name=\"passFY\">";foreach($menuArray0 as $k => $v){	if($v==$f_year){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>"; */ echo "<td align='center'>Budget group<br /><select name=\"budget_group\"><option selected></option>";foreach($menuArray1 as $k => $v){	if($v==$budget_group){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";   echo "<td align='center'>Cash Type<br /><select name=\"cash_type\"><option selected></option>";foreach($menuArray2 as $k => $v){	if($v==$cash_type){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";   echo "<td align='center'>Center<br /><select name=\"center\"><option selected></option>";foreach($menuArray4 as $k => $v){	if($v==$center){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";   echo "<td align='center'>Parkcode<br /><select name=\"parkcode\"><option selected></option>";foreach($menuArray5 as $k => $v){	if($v==$parkcode){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";   echo "<td align='center'>District<br /><select name=\"district\"><option selected></option>";foreach($menuArray6 as $k => $v){	if($v==$district){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";echo "<td align='center'>Section<br /><select name=\"section\"><option selected></option>";foreach($menuArray7 as $k => $v){	if($v==$section){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select></td>";if($reportType=="acct"){echo "<td align='center'>Account<br /><input type='text' name='account' value='$account' size='9'></td>";}      echo "<td><input type='hidden' name='reportType' value='$reportType'><input type='submit' name='submit' value='Filter'></td></form>";   echo "<form><td><input type='hidden' name='reportType' value='$reportType'><input type='submit' name='reset' value='Reset'></td>";echo "</form></tr>";// ******** Query ************if($submit!="Filter"){exit;}if($reportType=="bg"){$groupBy="group by budget_group,parkcode,cash_type";$orderBy="order by budget_group,parkcode,cash_type";}if($reportType=="acct"){$plus_fields=",account,account_description";$groupBy="group by budget_group,parkcode,cash_type,account";$orderBy="order by budget_group,parkcode,cash_type,account";}$WHERE="WHERE 1 ";if($budget_group){$WHERE.=" and budget_group='$budget_group'";}if($cash_type){$WHERE.=" and cash_type='$cash_type'";}if($center){$WHERE.=" and center='$center'";}if($parkcode){$WHERE.=" and parkcode='$parkcode'";}if($district){$WHERE.=" and district='$district'";}if($section){$WHERE.=" and section='$section'";}if($account){$WHERE.=" and account='$account'";}$decimalFlds=array("cy_amount","py1_amount","py2_amount","py3_amount"); $query = "SELECT  budget_group,cash_type,center,parkcode,district,section,sum(cy_amount) as 'cy_amount',sum(py1_amount) as 'py1_amount',sum(py2_amount) as 'py2_amount',sum(py3_amount) as 'py3_amount'$plus_fieldsfrom report_budget_history_multiyear$WHERE$groupBy$orderBy";//echo "$query";//exit;  $result = @MYSQL_QUERY($query,$connection);if($showSQL=="1"){echo "$query<br><br>";}$num=mysql_num_rows($result);while($row=mysql_fetch_array($result)){$b[]=$row;}// end whileif($reportType=="bg"){$headerArray=array("budget_group","cash_type","center","parkcode","district","section","cy_amount","py1_amount","py2_amount","py3_amount",);}if($reportType=="acct"){$headerArray=array("budget_group","cash_type","account","account_description","center","parkcode","district","section","cy_amount","py1_amount","py2_amount","py3_amount",);}//echo "<pre>";print_r($headerArray);echo "</pre>";exit;echo "<div><table border='1' align='center'>";echo "<tr><td colspan='8' align='center'><font color='red'>$num</font> items</td></tr>";$count=count($headerArray);for($i=0;$i<$count;$i++){$h=$headerArray[$i];if(!in_array($h,$dontShow)){	$selectFields.=$h.",";if($rep==""){if(in_array($h,$replaceArray)){$h=str_replace("_","<br>",$h);}			}	$header.="<th>".$h."</th>";					}	}$cen=$b[0][center];if($num<1){echo "<br />No records found.";}$x=2;if($passYY){$yy=$passYY;}else{$yy=15;}echo "<tr>";	for($i=0;$i<count($b);$i++){	$r=fmod($i,$x);if($r==0){$bc=" bgcolor='AliceBlue'";}else{$bc="";}	if(fmod($i,$yy)==0 and $rep==""){echo "<tr bgcolor='#698B69'>$header</tr>";}echo "<tr$bc>";	for($j=0;$j<count($headerArray);$j++){	$var=$b[$i][$headerArray[$j]];	$fieldName=$headerArray[$j];		if($fieldName=="er_num"){$er=$var;}		if(in_array($fieldName,$decimalFlds)){	$a="<td align='right'>";$totArray[$fieldName]+=$var;	$var=numFormat($var);}else{$a="<td>";}			if(in_array($fieldName,$editFlds)){			if(in_array($fieldName,$radioFlds)){	if($var=="y"){$ckY="checked";$ckN="";}else{$ckN="checked";$ckY="";}echo "<td align='right'><font color='green' size='-1'>Y</font><input type='radio' name='$headerArray[$j][$er]' value='y'$ckY><font color='red' size='-1'>N</font><input type='radio' name='$headerArray[$j][$er]' value='n'$ckN></td>";}else						{echo "<td bgcolor='beige' align='center'><input type='text' name='$headerArray[$j][$er]' value='$var' size='10'></td>";}									}else{echo "$a$var</td>";}	}	echo "</tr>";	}echo "<tr>";	for($j=0;$j<count($headerArray);$j++){	if($totArray[$headerArray[$j]]){	$var=$totArray[$headerArray[$j]];	if($var<0){$f1="<font color='red'>";$f2="</font>";}else{$f1="";$f2="";}	$v=numFormat($var);$xx=2;	echo "<td align='right'><b>$v</b></td>";}else{echo "<td></td>";}}/*$footer="<tr><td colspan='8' align='center'>Equipment Budget <a href='popupex.html' onclick=\"return popitup('explain_search.php?subject=equipment')\">Terminology</a></td></tr>";*/$footer="<tr><td colspan='12' align='center'><font color='red'>Click Button at top of screen to return to menus.</font></td></tr>";echo "$footer</table></div></body></html>";function numFormat($nf){$nf=number_format($nf,2);return $nf;}?>