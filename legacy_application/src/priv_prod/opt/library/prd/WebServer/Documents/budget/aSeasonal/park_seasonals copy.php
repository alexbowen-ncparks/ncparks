<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/connectROOT.inc"); // connection parametersmysql_select_db($database, $connection); // databasesession_start();if($_SESSION['budget']['select']==""){echo "Your session has timed out - log back in.";exit;}extract($_REQUEST);if($rep==""){include("../menu.php");}$level=$_SESSION['budget']['level'];if($level==2){include("../../../include/parkcodesDiv.inc");$distCode=$_SESSION['budget']['select'];$menuList="array".$distCode; $distList=${$menuList};//print_r($distList);//exit;}//*****************if(!$datebegin){$datebegin="2009-09-12"; }$date_end="2009-12-31";if($level==1){$center_code=$_SESSION['budget']['select'];}//********************//echo "<pre>";//print_r($_POST);//print_r($_REQUEST);//echo "<pre>";print_r($_SESSION);echo "</pre>";//echo "</pre>";  //exit;$sql = "SELECT distinct upper(center_code) as center_code FROM seasonal_payroll WHERE  1ORDER  BY center_code";// echo "$sql";$result = mysql_query($sql) or die ("Couldn't execute query. $sql c=$connection");while($row=mysql_fetch_assoc($result)){		if($level==2){		if(!in_array($row['center_code'],$distList)){continue;}		}	$center_code_array[]=$row['center_code'];	}if($level==2){$center_code_array[]="All";}if($rep==""){	echo "<form method='POST'><table cellpadding='5'><tr>";	if($level>1){echo "<td>OSMB <a href='park_seasonals_osmb.php'>Report</a></td>";}	if($level>1){		echo "<td>Center Code: <select name=\"center_code\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected></option>";$s="value";		foreach($center_code_array as $k=>$v){		if($center_code==$v){$s="selected";}else{$s="value";}		echo "<option $s='park_seasonals.php?center_code=$v'>$v</option>"; 	      }	   echo "</select></td>";	}		if($center_code=="All"){$excel="<td><a href='park_seasonals.php?center_code=All&rep=excel'>Excel</a> export</td>";}			echo "<td>OSMB Approval Period = $datebegin thru $date_end</td>$excel";	echo "</tr></table></form>";}if($center_code==""){exit;}$flds_1="t1.posTitle,t1.posNum,t1.avg_rate,t2.hours,t1.center,t1.f_year,t1.ncas_account,t1.center_code,t1.beacon_title,t1.beacon_posnum,t1.active,t1.osbm_app";$where="t1.center_code='$center_code'";if($center_code=="All"){		$where="(";	foreach($center_code_array as $k=>$v){		if($v=="All"){continue;}		$where.="t1.center_code='$v' OR ";		}		$where=rtrim($where, " OR ").")";		//echo "$where";exit;	}$orderBy="active, osbm_app, beacon_title";if($center_code=="All"){$orderBy="center_code, beacon_title";}$sql = "SELECT $flds_1,t2.park_temp,t2.district_temp,t2.section_tempFROM seasonal_payroll as t1LEFT JOIN seasonal_payroll_osmb_justify as t2 on t1.beacon_posnum=t2.beacon_posnumWHERE  $whereand t2.datebegin='$datebegin'ORDER  BY $orderBy"; //echo "$sql"; exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num0=mysql_num_rows($result);while($row=mysql_fetch_assoc($result)){$date_array[]=$row;}//echo "<pre>"; print_r($result_array); echo "</pre>"; exit;if($center_code!="All"){$sql = "SELECT * FROM seasonal_payroll WHERE  center_code='$center_code'ORDER  BY active desc, osbm_app desc, beacon_title"; //echo "$sql"; exit;$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);while($row=mysql_fetch_assoc($result)){$result_array[]=$row;}//echo "<pre>"; print_r($result_array); echo "</pre>"; exit;}$skip=array("location","employee","pmis_number","district","last_employee","weeks_spent","spent_total","last_spent","budget_weeks_left","additional_weeks_needed","projected_weeks_available","markdel","hide","division_change","payment_match","posnum_center","beacon_spent","budget_dollars","system_entry_date","comment_yn","comments","filled_0527","filled_by","osbm_lognum","osbm_logid","ep_match");if($date_array){	if($rep==""){echo "<form method='POST' name='frm_0' action='park_seasonals_delete.php'>";}echo "<table border='1' cellpadding='3'>";// Headerif($rep==""){echo "<tr><td colspan='3' align='center'><input name=\"btn\" type=\"button\" onclick=\"CheckAll_0()\" value=\"Check All\"> <input name=\"reset\" type=\"reset\" value=\"Default\"><input name=\"btn\" type=\"button\" onclick=\"UncheckAll_0()\" value=\"Uncheck All\"></td><td colspan='19' align='center'>$num0 found. Only position(s) in blue are active and OSBM approved. <font color='red'>You will need to provide a written justification for all requested positions NOT OSMB approved.</font></td></tr>";		echo "<tr><th></th>";}		if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=seasonal_positions.xls');echo "<tr><th></th>";}foreach($date_array[0] as $fld=>$val){		if(in_array($fld,$skip)){continue;}		$fld=str_replace("_"," ",$fld);		echo "<th>$fld</th>";}		echo "</tr>";foreach($date_array as $number=>$fields){	$tr="";$ckbox="";			if($date_array[$number]['park_temp']=="y")			{$tr=" bgcolor='white'"; $ckbox="checked";}						if($date_array[$number]['active']=="y" AND $date_array[$number]['osbm_app']=="y")			{$tr=" bgcolor='aliceblue'"; $ckbox="checked";}							$id=$date_array[$number]['id'];				$beacon_number=$date_array[$number]['beacon_posnum'];		echo "<tr$tr>		<td align='center'>		$id<input type='checkbox' name='position[$id]' value='$beacon_number'$ckbox>		<input type='hidden' name='delete[$id]' value='$beacon_number'>		</td>";		foreach($fields as $fld_name=>$value){			if(in_array($fld_name,$skip)){continue;}			$td="";				if($fld_name=="beacon_posnum"){							if(in_array($value,$track_posnum)){							$td=" bgcolor='red'";}							$track_posnum[]=$value;							}										if($fld_name=="hours"){				$hours=$value;				$totAmount+=$hours*$date_array[$number]['avg_rate'];				if($rep==""){			$value="<input type='text' name='hours[$beacon_number]' value='$hours' size='5'>";}else{$value=$hours;}					}				echo "<td$td>$value</td>";				}		echo "</tr>";		}		$totAmount=number_format($totAmount,2);	echo "<tr>	<td colspan='5' align='right'>$$totAmount</td>	</tr>";if($level>1){	echo "<tr>	<td colspan='5' align='right'>		<input type='hidden' name='center_code' value='$center_code'>	<input type='hidden' name='datebegin' value='$datebegin'>	<input type='submit' name='submit' value='Update'></td>	<td colspan='12'></td>	</tr></table></form>";	}}// end if date_arrayif($center_code=="All"){exit;}// ********************echo "<form method='POST' name='frm' action='park_seasonals_update.php'>";$skip=array("location","employee","pmis_number","district","last_employee","weeks_spent","spent_total","last_spent","budget_weeks_left","additional_weeks_needed","projected_weeks_available","markdel","hide","division_change","payment_match","posnum_center","beacon_spent","budget_dollars","system_entry_date","comment_yn","comments","filled_0527","filled_by","osbm_lognum","osbm_logid","ep_match","datebegin","dateend","max_hrs","max_weeks","weekly_cost","beacon_job","beacon_verified","dis_app","div_app","063009_rate");echo "<table border='1' cellpadding='3'>";// Header	echo "<tr><td colspan='5' align='center'><input name=\"btn\" type=\"button\" onclick=\"CheckAll()\" value=\"Check All\"> <input name=\"reset\" type=\"reset\" value=\"Default\"><input name=\"btn\" type=\"button\" onclick=\"UncheckAll()\" value=\"Uncheck All\"></td><td colspan='9' align='center'>$num found. <font color='red'>Only position(s) in blue are active and OSBM approved.</font></td></tr>";		echo "<tr><th></th>";foreach($result_array[0] as $fld=>$val){		if(in_array($fld,$skip)){continue;}		$fld=str_replace("_"," ",$fld);		echo "<th>$fld</th>";}		echo "</tr>";foreach($result_array as $number=>$fields){			if($result_array[$number]['active']=="y" AND $result_array[$number]['osbm_app']=="y"){$tr=" bgcolor='aliceblue'"; $ckbox="checked";}else{$tr="";$ckbox="";}				$id=$result_array[$number]['id'];				$beacon_number=$result_array[$number]['beacon_posnum'];		echo "<tr$tr>";			IF($beacon_number[0]=="6"){		echo "<td align='center'>$id<input type='checkbox' name='position[$id]' value='$beacon_number'$ckbox></td>";}			else{echo "<td>$id</td>";}						foreach($fields as $fld_name=>$value){		if(in_array($fld_name,$skip)){continue;}						echo "<td>$value</td>";				}		echo "</tr>";		}if($level>1){	echo "<tr>	<td colspan='14' align='center'>	<input type='hidden' name='center_code' value='$center_code'>	<input type='hidden' name='datebegin' value='$datebegin'>	<input type='submit' name='submit' value='Submit'></td>	</tr></table></form>";}?>