<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("../../../include/authBUDGET.inc");extract($_REQUEST);//echo "<pre>"; print_r($_SESSION); echo "</pre>"; // exit;echo "Seasonal Payroll Budgets are no longer requested thru the Budget Database. Please see Budget  <a href='http://149.168.1.195/budget/forum.php?forumID=73&submit=Go'>Forum# 73</a> for further guidance.";exit;$checkCenter=explode("-",$center);if(count($checkCenter)>1){$center=$checkCenter[2];}$level=$_SESSION['budget']['level'];if($_SESSION['budget']['beacon_num']=='60033136'){// HR Super.$level = '4';}// $edit is checkbox to allow Level > 3 users to toggel between display and edit mode//echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//exit;// Add any New Positionif($submit=="Add"){//print_r($_POST);$nc=$_POST['center_code'];$sql="SELECT center from center where parkCode='$nc'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");$row=mysqli_fetch_array($result); $centerNew=$row['center'];//echo "$sql<>br nc=$nc cn=$centerNew<br>";foreach($_POST as $k=>$v){	if($v AND $k!="passQuery" AND $k!="submit"){	if($k=="budget_rate"){$k="avg_rate";}	if($k=="center"){$token="x";} // pass $centerNew if center not passed	if($k=="center_code"){$v=strtoupper($v);}	$string.=$k."='".$v."',";}	}	$string=trim($string,",");		$system_entry_date=date("Y-m-d");		if(!$token){$string.=",center='$centerNew'";}	$sql="INSERT INTO seasonal_payroll SET $string, system_entry_date='$system_entry_date'"; //echo "$sql"; exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");}// Construct Query to be passed to Excel Exportforeach($_REQUEST as $k => $v){if($v and $k!="PHPSESSID"){$varQuery.=$k."=".$v."&";}}$passQuery=$varQuery;   $varQuery.="rep=excel";    if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=seasonal_payroll.xls');include("seasonal_payroll_header.php");}// *********** Level > 3 ************if($level>3){//print_r($_REQUEST);EXIT;if($rep==""){include_once("../menu.php");include("seasonal_payroll_header.php");// Make f_yearif($f_year==""){include("../~f_year.php");}if($showSQL==1){$p="method='POST'";}echo "<hr><table align='center'><form action='seasonal_payroll.php' $p>";// Menu 1echo "<tr><td align='center'>Request_ID<br><input type='text' name='request_id' value='$request_id' size='5'></td>";// Menu 2$sql="select distinct(f_year) as fyMenu from seasonal_payroll where 1 order by f_year";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$menuArray[]=$fyMenu;}//print_r($menuArray);echo "<td align='center'>Fiscal Year<br><select name=\"f_year\">";for ($n=0;$n<count($menuArray);$n++){if($f_year==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";   unset($menuArray);// Menu 3$sql="select distinct location from seasonal_payroll order by location";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[location];}echo "<td align='center'>Location<br><select name=\"location\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($location==$menuArray[$n] and $location!=""){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";unset($menuArray);// Menu 4$sql="select distinct center from seasonal_payroll order by center";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[center];}echo "<td align='center'>Center<br><select name=\"center\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($center==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";unset($menuArray);// Menu 5$sql="select distinct center_code from seasonal_payroll order by center_code";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[center_code];}echo "<td align='center'>Center_Code<br><select name=\"center_code\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($center_code==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>"; unset($menuArray);// Menu 5.5$sql="SELECT distinct district from seasonal_payroll order by district";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[district];}echo "<td align='center'>District<br><select name=\"district\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($district==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>"; unset($menuArray);// Menu 6$sql="select distinct posTitle from seasonal_payroll order by postitle";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[posTitle];}echo "<td align='center' colspan='2'>Pos.Title<br><select name=\"posTitle\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($posTitle==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";       // ************ New Row **************  // Menu 7echo "<td align='center'>Pos. Number<br><input type='text' name='posNum' value='$posNum' size='8'></td></tr>";      unset($menuArray);// Menu 7.5$sql="select distinct beacon_posnum from seasonal_payroll_form order by beacon_posnum";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[beacon_posnum];}echo "<tr><td align='center'>beacon_posnum<br><select name=\"beacon_posnum\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($checkAccount==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td><td align='center'>BEACON<br />Num<br><input type='text' name='beacon_posnum_box' value='$beacon_posnum' size='10'></td>";      unset($menuArray);// Menu 8$sql="select distinct ncas_account from seasonal_payroll order by ncas_account";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row[ncas_account];}// $ncas_account is passed in $_REQUEST// if $ncas_account is blank use 531311if($ncas_account){$checkAccount=$ncas_account;}else{$checkAccount="531311";}echo "<td align='center'>ncas<br />account<br><select name=\"ncas_account\"><option selected>All</option>";for ($n=0;$n<count($menuArray);$n++){if($checkAccount==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";   $menuArray=array("y","n","u");// Menu 9echo "<td align='center'>District<br />Approved<br><select name=\"dis_app\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($dis_app==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";   // Menu 10echo "<td align='center'>Division<br />Approved<br><select name=\"div_app\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($div_app==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";         unset($menuArray);$menuArray=array("y","n");// Menu 11echo "<td align='center'>Active<br><select name=\"active\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($active==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";   // Menu 11.5echo "<td align='center'>osbm<br />app<br><select name=\"osbm_app\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($osbm_app==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";   // Menu 11.7   unset($menuArray);$sql="select distinct osbm_lognumfrom seasonal_payrollwhere 1order by osbm_lognum";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){$menuArray[]=$row['osbm_lognum'];}echo "<td align='center'>osbm<br />lognum<br><select name=\"osbm_lognum\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($menuArray[$n]==""){continue;}if($osbm_lognum==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";      unset($menuArray);$menuArray=array("y","n");// Menu 12echo "<td align='center'>comment<br />yn<br><select name=\"comment_yn\"><option selected></option>";for ($n=0;$n<count($menuArray);$n++){if($comment_yn==$menuArray[$n]){$s="selected";}else{$s="value";}$con=$menuArray[$n];		echo "<option $s='$con'>$menuArray[$n]</option>\n";       }   echo "</select></td>";      echo "<td align='center'><input type='checkbox' name='showSQL' value='1'>Show SQL";      if($_SESSION['budget']['beacon_num']!='60033136'){// HR Super. echo "<br /><input type='checkbox' name='edit' value='1'>Edit Fields";}      echo "</td><td><input type='submit' name='submit' value='Submit'>";echo "</form></td>";echo "<td align='center'>";if($_SESSION['budget']['beacon_num']!='60033136'){// HR Super.echo "<a href='seasonal_payroll_mod_form.php'>Modify Form</a><br />";}echo "<a href='seasonal_payroll.php?task=hr_rates'>DPR-Approved Hourly Rates</a></td><form><td><input type='submit' name='reset' value='Reset'></td></form></tr></table>";//<td><a href='seasonal_payroll.php?$varQuery'>Excel</a></td>}}// end Level > 3// ********** DPR-Approved Hourly Ratesif($task=="hr_rates"){if($submit=="Update"){//echo "<pre>";print_r($_POST);echo "</pre>";exit;foreach($_POST as $k=>$v){	if(is_array($v)){	foreach($v as $key=>$val){	$string=$k."='".mysqli_real_escape_string($val)."'";	$sql="UPDATE seasonal_payroll_approved_rates SET $string where id=$key"; //echo "$sql<br>";	$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");				}		}	}	}$sql="select beacon_title, approved_rate, park_valid, id as hr_rate_idfrom seasonal_payroll_approved_rateswhere 1order by beacon_title";echo "<hr><form action='seasonal_payroll' method='POST'><table align='center' border='1'><td></th><th>BEACON Title</th><th>Approved Rate</th><th>Park Valid</th>";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$zz++;echo "<tr><td>$zz</td><td><input type='text' name='beacon_title[$hr_rate_id]' value=\"$beacon_title\" size='35'></td><td align='center'><input type='text' name='approved_rate[$hr_rate_id]' value='$approved_rate' size='6'></td><td align='center'><input type='text' name='park_valid[$hr_rate_id]' value='$park_valid' size='1'></td></tr>";}if($_SESSION['budget']['beacon_num']!='60033136'){// HR Super.echo "<tr><td colspan='4' align='center'><input type='hidden' name='task' value='hr_rates'><input type='submit' name='submit' value='Update'></td></tr>";}echo "</table></form>";exit;}if($level==2){//include_once("../a/park_budget_menu.php");unset($menuArray);include_once("../../../include/parkRCC.inc");//if($today>=$Lev2range[1] and $today<=$Lev2range[0]){}else{$noUpdate=1;}$distCode=$_SESSION['budget']['select'];//echo "<table align='center'><form action=\"op_exp_approval.php\">";switch($distCode){case "EADI":$distCode="east";break;case "NODI":$distCode="north";break;case "SODI":$distCode="south";break;case "WEDI":$distCode="west";break;}$D=$distCode."-NCAS";$DP=$distCode."-PARK";$array1=array($D,$DP);$where="where dist='$distCode' and section='operations' and fund='1280'";$sql="SELECT section,parkcode,center as varCenter from center $where order by section,parkcode,center";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$pc[]=$parkcode;$c[]=$varCenter;$sec[]=$section;}if($rep==""){echo "<table align='center'><form><tr>";echo "<td><select name=\"center\"><option selected>Select Center</option>";for ($n=0;$n<count($c);$n++){$con=$c[$n];if($center==$con){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$sec[$n]-$pc[$n]-$c[$n]\n";       }   echo "</select></td>";      $accountArray=array("531311","531312");   echo "<td><select name=\"ncas_account\"><option selected>All</option>";foreach($accountArray as $k=>$v){if($ncas_account==$v){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select>  FY <input type='text' name='f_year' value='$f_year' size='5' READONLY> <input type='submit' name='submit' value='Submit'></td></form></tr>";}if($center==""){exit;}}if($level==1){	$centercode=$_SESSION['budget']['select'];	$centerS=$_SESSION['budget']['centerSess'];if($rep==""){	   $accountArray=array("531311","531312");   echo "<form><tr><td><select name=\"ncas_account\"><option selected>All</option>";foreach($accountArray as $k=>$v){if($ncas_account==$v){$s="selected";}else{$s="value";}		echo "<option $s='$v'>$v\n";       }   echo "</select>  FY <input type='text' name='f_year' value='$f_year' size='5' READONLY> <input type='submit' name='submit' value='Submit'></td></form></tr>";}}if($submit!="Submit"){exit;}//$showSQL=1;// ************** make sure the latest info is returned ***********$division_approved="y";include("seasonal_payroll_query.php");//include("shown_fields.inc"); $show="request_id,f_year,center_code,posnum,postitle,beacon_title,beacon_job,beacon_posnum,ncas_account,budget_rate,budget_hrs,budget_weeks,request_amount,division_change,approved_amount,posted_payments,posted_balance,dis_app,div_app,active,osbm_app,osbm_lognum,comment_yn,comments";  $doShow=explode(",",$show); // see shown_fields.inc$dontShow=array("budget_rate","budget_hrs","budget_weeks"); $query = "SHOW COLUMNS FROM seasonal_payroll_form;"; $result = @mysqli_query($connection, $query,$connection); while($row=mysqli_fetch_array($result)){ $h=$row['Field'];  if(in_array($h,$doShow)){ 		$headerArray[]=$row['Field'];} 		 $test=substr($row['Type'],0,3); if($test=="dec"){ 		$decimalFlds[]=$row['Field']; 		if($row['Field']=="approved_amount"){			$decimalFlds[]="posted_payments";			$decimalFlds[]="posted_balance";} 		} }//print_r($decimalFlds);//print_r($headerArray); $count=count($headerArray);for($i=0;$i<$count;$i++){$h=$headerArray[$i];if(in_array($h,$doShow)){	$selectFields.=$h.",";if($rep==""){$h=str_replace("_","<br>",$h);}		if($h=="approved<br>amount"){$header.="<th>".$h."</th><th>posted<br>payments</th><th>posted<br>balance</th>";}else{$header.="<th>".$h."</th>";}						}	}		$selectFields.="sum(spent_total) as 'posted_payments',sum(approved_amount-spent_total) as 'posted_balance'";// $headerArray must match up with selectFields for this report to work		foreach($headerArray as $hk=>$hv){			$tempHeader[]=$hv;		if($hv=="approved_amount"){			 $tempHeader[]="posted_payments";			 $tempHeader[]="posted_balance";}					}	//echo "<pre>"; print_r($tempHeader); echo "</pre>"; // exit;	$headerArray=$tempHeader;		//print_r($selectFields);//exit;	if($level<4){if($level<2){$pay_center=$_SESSION['budget']['centerSess'];}else{$pay_center=$center;}$whereFilter="where 1 and seasonal_payroll_form.f_year='$f_year'and seasonal_payroll_form.center='$pay_center'";}// end Level < 4if($level>3){$whereFilter="where 1";if($request_id){$whereFilter.=" and seasonal_payroll_form.request_id='$request_id'";}if($f_year){$whereFilter.=" and seasonal_payroll_form.f_year='$f_year'";}if($location){$whereFilter.=" and seasonal_payroll_form.location='$location'";}if($center){$whereFilter.=" and seasonal_payroll_form.center='$center'";}if($center_code){$whereFilter.=" and seasonal_payroll_form.center_code='$center_code'";}if($posTitle){$whereFilter.=" and seasonal_payroll_form.posTitle='$posTitle'";}if($posNum){$whereFilter.=" and seasonal_payroll_form.posNum='$posNum'";}if($beacon_posnum){$whereFilter.=" and seasonal_payroll_form.beacon_posnum='$beacon_posnum'";}if($beacon_posnum_box){$whereFilter.=" and seasonal_payroll_form.beacon_posnum='$beacon_posnum_box'";}if($ncas_account!="All"){$whereFilter.=" and seasonal_payroll_form.ncas_account='$ncas_account'";}if($district){$whereFilter.=" and seasonal_payroll_form.district='$district'";}if($dis_app){$whereFilter.=" and seasonal_payroll_form.dis_app='$dis_app'";}if($div_app){$whereFilter.=" and seasonal_payroll_form.div_app='$div_app'";}if($active){$whereFilter.=" and seasonal_payroll_form.active='$active'";}if($osbm_app){$whereFilter.=" and seasonal_payroll_form.osbm_app='$osbm_app'";}if($osbm_lognum){$whereFilter.=" and seasonal_payroll_form.osbm_lognum='$osbm_lognum'";}if($comment_yn){$whereFilter.=" and seasonal_payroll_form.comment_yn='$comment_yn'";}}if($level<3){if($ncas_account=="All" OR !$ncas_account){$whereFilter.=" and (seasonal_payroll_form.ncas_account='531311' OR seasonal_payroll_form.ncas_account='531312')";}	else	{$whereFilter.=" and seasonal_payroll_form.ncas_account='$ncas_account'";}}/*select query for center budgets*///if($div_app=="y"){$whereFilter.=" and div_app='y'";}$sql="select $selectFieldsfrom seasonal_payroll_form$whereFiltergroup by request_idorder by center_code,posTitle,dateBegin;";//echo "<pre>"; print_r($headerArray); print_r($selectFields);echo "</pre>"; // exit;//echo "$sql<br>";//exit;if($showSQL=="1"){echo "$sql<br>";}$sql2="Select start_date,end_date from budget_request_acceptable_dates where budget_group='payroll_temporary' order by budget_group";$result2 = mysqli_query($connection, $sql2) or die ("Couldn't execute query. $sql2");$row2=mysqli_fetch_array($result2);extract($row2);$today=date("Y-m-d");if($level==1){$s=$start_date;$f=$end_date;}if($level==2){$s=$start_date;$f=$end_date;}if($level<3){$t="All requests MUST be made from <font color='red'>$s to $f</font>.";}echo "<table border='1'>";if($rep==""){echo "<tr><td colspan='24'>";echo "<a href='seasonal_payroll.php?$varQuery&rep=excel'>Excel Export</a>";echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Report Date: <font color='red'>$today</font>&nbsp;&nbsp;&nbsp; $t</td></tr>";}$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);if($rep=="excel"){echo "<tr>$header</tr>";}while($row=mysqli_fetch_array($result)){$b[]=$row;}// end while//echo "<pre>";print_r($b);echo "</pre>";exit;$x=2;$yy=10;if($level>3){$radioFlds=array("dis_app","div_app");/*$decimalFlds=array("requested_amount","approved_amount","ordered_amount", "unordered_amount","surplus_deficit");*/if($edit AND $rep==""){$editFlds=array("budget_hrs","budget_weeks","dis_app","div_app");if($level>4){$editFlds=array("beacon_title","beacon_job","beacon_posnum","ncas_account","budget_rate","budget_hrs","budget_weeks","division_change","dis_app","div_app");}}echo "<form action='seasonal_payroll_update.php' method='POST'>";if($rep==""){echo "<tr><td colspan='4' align='center'><font color='red'>$num records returned.</font></td></tr>";}echo "<tr>";	for($i=0;$i<count($b);$i++){//	$r=fmod($i,$x);if($r==0){$bc=" bgcolor='aliceblue'";}else{$bc="";}	if(fmod($i,$yy)==0 and $rep==""){echo "<tr>$header</tr><tr><td></td></tr>";}$bc=" bgcolor='white'";echo "<tr$bc>";	for($j=0;$j<count($headerArray);$j++){	$var=$b[$i][$headerArray[$j]];	$fieldName=$headerArray[$j];	//	if($b[$i][budget_weeks]!=$b[$i][max_weeks]){$bc=" bgcolor='DarkSeaGreen'";}//	if($b[$i][budget_hrs]!=$b[$i][max_hrs]){$bc=" bgcolor='Aquamarine'";}		if($b[$i][dis_app]=="y"){$bc=" bgcolor='Thistle'";}	if($b[$i][dis_app]=="n"){$bc=" bgcolor='Violet'";}		if($b[$i][div_app]=="y"){$bc=" bgcolor='PaleGreen'";}	if($b[$i][div_app]=="n"){$bc=" bgcolor='Salmon'";}			if($headerArray[$j]=="status" and $var=="inactive"){	$bc=" bgcolor='yellow'";}//else{$bc="";}	if($headerArray[$j]=="request_id"){$er=$var;}	if($var<0){$f1="<font color='red'>";$f2="</font>";}else{$f1="";$f2="";}		if(in_array($headerArray[$j],$decimalFlds)){	$a="<td align='right'$bc>";	$totArray[$headerArray[$j]]+=$var;		if($headerArray[$j]=="budget_rate"){$var=number_format($var,3);}		else{			$var=numFormat($var);			$posNum=$b[$i]['posNum'];	if($headerArray[$j]=="posted_payments"){	//	$posNum=$b[$i]['center_code'];	$beacon_posnum=$b[$i]['beacon_posnum'];	$center_code=$b[$i]['center_code'];	$var="<a href='seasonal_payroll_posted_payments.php?center_code=$center_code&f_year=$f_year&position_number=$beacon_posnum' target='_blank'>$var</a>";}	}			}else{$a="<td$bc>";}			if(in_array($headerArray[$j],$editFlds)){			$cs="7";	if($headerArray[$j]=="equipment_description" || $headerArray[$j]=="justification"){$cs="25";}else{if($headerArray[$j]=="ncas_account" || $headerArray[$j]=="pay_center"){$cs="10";}}			if(in_array($headerArray[$j],$radioFlds)){			$ckY="";$ckN="";$ckU="";	if($var=="y"){$ckY="checked";}	if($var=="n"){$ckN="checked";}	if($var=="u"){$ckU="checked";}echo "<td align='center'$bc><font color='green'>Y</font><input type='radio' name='$headerArray[$j][$er]' value='y'$ckY><font color='red'>N</font><input type='radio' name='$headerArray[$j][$er]' value='n'$ckN>&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<font color='blue'>U</font><input type='radio' name='$headerArray[$j][$er]' value='u'$ckU> 	</td>";}else						{echo "<td align='center'$bc><input type='text' name='$headerArray[$j][$er]' value='$var' size='$cs'></td>";}						}else{echo "$a$f1$var$f2</td>";}		}	echo "</tr>";	}}// end if level > 3else{$radioFlds=array("dis_app");// Level > 3 gets these from a SHOW column$decimalFlds=array("request_amount","approved_amount","division_change","posted_payments","posted_balance");$editFlds=array("dis_app");if($edit||$level<2){$editFlds=array("budget_hrs","budget_weeks");}if($rep=="excel"){unset($editFlds); $noUpdate=1;}$x=2;echo "<form action='seasonal_payroll_update.php' method='POST'>";if($rep==""){echo "<tr><td colspan='4' align='center'><font color='red'>$num records returned.</font></td></tr>";}echo "<tr>";	for($i=0;$i<count($b);$i++){//	$r=fmod($i,$x);if($r==0){$bc=" bgcolor='aliceblue'";}else{$bc="";}	if(fmod($i,$yy)==0 and $rep==""){echo "<tr>$header</tr>";}$bc=" bgcolor='white'";echo "<tr$bc>";	for($j=0;$j<count($headerArray);$j++){	$var=$b[$i][$headerArray[$j]];	$fieldName=$headerArray[$j];	//	if($b[$i][budget_weeks]!=$b[$i][max_weeks]){$bc=" bgcolor='DarkSeaGreen'";}//	if($b[$i][budget_hrs]!=$b[$i][max_hrs]){$bc=" bgcolor='Aquamarine'";}	$budgetRO="";			if($b[$i]['dis_app']=="y"){$bc=" bgcolor='PaleGreen'";}	if($b[$i]['dis_app']=="n"){$bc=" bgcolor='Thistle'";}		if($b[$i]['div_app']=="y"){$bc=" bgcolor='PaleGreen'";}	if($b[$i]['div_app']=="n"){$bc=" bgcolor='Thistle'";}		if($b[$i]['dis_app']!="u" || $b[$i]['div_app']!="u"){$budgetRO="1";}else{$budgetRO="";}			$posNum=$b[$i]['posNum'];	if($headerArray[$j]=="spent_total"){	$totArray['spent_total']+=$var;	$var="<a href='seasonal_payroll_tot_spent.php?f_year=$f_year&posNum=$posNum&amt=$var' target='_blank'>$var</a>";}		if($fieldName=="request_id"){$er=$var;}	if($fieldName=="status" and $var=="inactive"){$bc=" bgcolor='yellow'";}//else{$bc="";}	if($var<0){$f1="<font color='red'>";$f2="</font>";}else{$f1="";$f2="";}		if(in_array($headerArray[$j],$decimalFlds)){	$a="<td align='right'$bc>";	$totArray[$headerArray[$j]]+=$var;		if($headerArray[$j]=="budget_rate"){$var=number_format($var,3);}				else{			if(is_integer($var)){$varF=numFormat($var);}			$posNum=$b[$i]['posNum'];		if($headerArray[$j]=="posted_payments"){	$beacon_posnum=$b[$i]['beacon_posnum'];	$center_code=$b[$i]['center_code'];	$var="<a href='seasonal_payroll_posted_payments.php?center_code=$center_code&f_year=$f_year&position_number=$beacon_posnum' target='_blank'>$var</a>";					}	}		}else{$a="<td$bc>";}				if(in_array($headerArray[$j],$editFlds)){			if(in_array($headerArray[$j],$radioFlds)){			$ckY="";$ckN="";$ckU="";	if($var=="y"){$ckY="checked";}	if($var=="n"){$ckN="checked";}	if($var=="u"){$ckU="checked";}echo "<td width='120' align='right'$bc><font color='green'>Y</font><input type='radio' name='$headerArray[$j][$er]' value='y'$ckY> <font color='red'>N</font> <input type='radio' name='$headerArray[$j][$er]' value='n'$ckN> <font color='blue'>U</font> <input type='radio' name='$headerArray[$j][$er]' value='u'$ckU> 	</td>";}else						{			if($budgetRO){$budgetRO=" READONLY";}			echo "<td bgcolor='beige' align='center'><input type='text' name='$headerArray[$j][$er]' value='$var' size='5'$budgetRO></td>";}									}else{echo "$a$f1$var$f2</td>";}	}	echo "</tr>";	}}/// level < 4//$doShow=array("max_hrs","max_weeks","budget_rate","budget_hrs","budget_weeks");///*echo "<tr>";	for($j=0;$j<count($headerArray);$j++){	if($totArray[$headerArray[$j]]){	$var=$totArray[$headerArray[$j]];	if($var<0){$f1="<font color='red'>";$f2="</font>";}else{$f1="";$f2="";}	if($headerArray[$j]=="budget_rate"){$v=number_format($var,3);}else{$v=numFormat($var);}if(in_array($headerArray[$j],$doShow) AND !in_array($headerArray[$j],$dontShow)){if($rep==""){$h=str_replace("_","<br>",$headerArray[$j]);}else{$h=$headerArray[$j];}	echo "<td align='right'><b>$v</b></td>";}else	{echo "<td>&nbsp;</td>";}	}else{echo "<td>&nbsp;</td>";}	}echo "</tr>";//echo "<pre>"; print_r($doShow);  print_r($headerArray); echo "</pre>"; // exit;if($edit==1||$level<4){if($location){$pay_center=$center;}if($edit==1){$cs=17;}else{$cs=16;}$today=date("Y-m-d");$sql="Select start_date,end_date from budget_request_acceptable_dates where budget_group='payroll_temporary' order by budget_group";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$row=mysqli_fetch_array($result);extract($row);if($today>=$start_date and $today<=$end_date){}else{$noUpdate=1;}if(!$noUpdate || $level>3){if($level>1){$AllDistYes="<td colspan='7' align='right'>Set <font color='red'>ALL</font> District Approved to: Yes-<input type='radio' name='allDistApp' value='y'>&nbsp;&nbsp; No-<input type='radio' name='allDistApp' value='n'>&nbsp;&nbsp; U-<input type='radio' name='allDistApp' value='u'></td>";}if($level>3){$AllDivYes="<td colspan='5' align='center'>Set <font color='red'>ALL</font> Division Approved to: <br />Yes-<input type='radio' name='allDivApp' value='y'>&nbsp;&nbsp; No-<input type='radio' name='allDivApp' value='n'>&nbsp;&nbsp; U-<input type='radio' name='allDivApp' value='u'></td>";}echo "<tr>$AllDistYes$AllDivYes<td colspan='$cs' align='center'><input type='hidden' name='f_year' value='$f_year'><input type='hidden' name='passQuery' value='$passQuery'><input type='submit' name='submit' value='Update'></td></tr>";	}}echo "</table></form>";if($level>4){include("seasonal_payroll_add_emp.php");}echo "</body></html>";function numFormat($nf){$nf=number_format($nf,2);return $nf;}?>