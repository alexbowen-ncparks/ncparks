<?phpinclude("../../include/authPHOTOS.inc");include("../../include/connectPHOTOS.inc");include("../../include/connectNRID.inc");$level=$_SESSION['photos']['level'];$location=$_SESSION['parkS'];//echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";//print_r($_SERVER);if($Submit){while (list($key,$val)=each($_REQUEST)){if($key=="website"){$websiteYes=1;}if($val!=""&&$key!="Submit"&&$key!="PHPSESSID"){$val=mysql_real_escape_string($val);$querySQL.=$key."=".$val."&";}}//echo "$querySQL";//exit;if($display){$display_number = $display;}else{$display_number = "4";}//$majorGroupX = $majorGroup;$catQ=$cat;$where="mark !='x'";if($Submit=="unk"){$where .= " and images.sciName=''";}if($parkX){$_SESSION[parkS]=$parkX;$park=$parkX;$a1=$parkX;// used to pass var if orderx = Lepidoptera$where .=" and park='$park'";}else{if($park){$a1=$park;// used to pass var if orderx = Lepidoptera$where .=" and park='$park'";}}if($photoname){$photonameX=$photoname;$photoname=mysql_real_escape_string($photoname);$where .=" and photoname LIKE '%$photoname%'";}if($commentX){$comment=$commentX;$comment=mysql_real_escape_string($comment);$where .=" and comment LIKE '%$comment%'";}if($cat){$where .=" and cat LIKE '%$cat%'";}if($sciNameX){$where .=" and photos.images.sciName LIKE '%$sciNameX%'";}if($comNameX){$comNameX=mysql_real_escape_string($comNameX);$a2=$comName;$where .=" and nrid.dprspp.comName LIKE '%$comNameX%'";}if($cdX){$a3=$cdX;$where .=" and photos.images.cd = '$cdX'";}if($personIDX){$a4=$personIDX;$where .=" and photos.images.personID != ''"; $orderBy="order by personID";}if($photogX){$photog=$photogX;$photog=mysql_real_escape_string($photog);$where .=" and photog LIKE '%$photog%'";}if($website){$a5=$website;$where .=" and website = 'x'";}if($pidX){$a6=$pidX;$qPID=explode(",",$pidX); //print_r($qPID);$queryPID="(";foreach($qPID as $k=>$v){	$val=mysql_real_escape_string($v);	$queryPID.="pid='".$val."' OR ";}		$queryPID=trim($queryPID," OR ").") ";	$where .=" and ".$queryPID;//$where .=" and pid = '$pidX'";}if($majorGroup||$majorGroupX){//echo"hello";exit;if(!$majorGroupX){$majorGroupX=$majorGroup;}$pos=explode("-",$majorGroupX);if($pos[1] != "LEPIDOPTERA"){if($pos[1]){$where .=" and nrid.dprspp.orderx = '$pos[1]'";}else{$where .=" and photos.images.majorGroup = '$pos[0]'";}}else{ if($fam==1){$where .= " AND ((dprspp.family = 'PAPILIONIDAE') OR (dprspp.family = 'PIERIDAE') OR (dprspp.family = 'Riodinidae') OR (dprspp.family = 'Nymphalidae')  OR (dprspp.family = 'Lycaenidae') OR (dprspp.family = 'Hesperiidae'))";} if($fam==2){$where .= " AND (dprspp.family != 'PAPILIONIDAE') AND (dprspp.family != 'PIERIDAE') AND (dprspp.family != 'Riodinidae') AND (dprspp.family != 'Nymphalidae')  AND (dprspp.family != 'Lycaenidae') AND (dprspp.family != 'Hesperiidae')";}$where .=" and nrid.dprspp.orderx = '$pos[1]'";}}if($where=="mark !='x'"){echo "$where<br>You should pick at least one criterium, otherwise you would have been returned all photos.";}else{// If we don't know how many pages there are, make that calculation.if (!isset($num_pages)) {$sql="SELECT photos.images.*,nrid.dprspp.comName,nrid.dprspp.orderx,nrid.dprspp.family,nrid.dprspp.majorGroup as Nmg FROM photos.imagesLEFT JOIN nrid.dprspp on nrid.dprspp.sciName = photos.images.sciNameWHERE $where $orderBy";$catFind=$catQ;// echo "$sql"; //exit; //echo "$where"; //exit;$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$numrow = mysql_num_rows($result);	// Calculate the number of pages required.$t=$numrow;	if ($numrow > $display_number) {		$num_pages = ceil ($numrow/$display_number);	} elseif ($numrow > 0) {		$num_pages = 1;	} else {echo "<font color='red'>No photo found using this search:</font> $park $cat $majorGroupX $photoname $comment $cd $sciNameX $comNameX<hr>";//echo "<br>$sql";	}		$start = 0; // Currently at item 0.}// end if !isset$sql="SELECT photos.images.*,nrid.dprspp.comName,nrid.dprspp.orderx,nrid.dprspp.family,nrid.dprspp.majorGroup as Nmg FROM photos.imagesLEFT JOIN nrid.dprspp on nrid.dprspp.sciName = photos.images.sciNameWHERE $where $orderByLIMIT $start, $display_number"; $result = @mysql_query($sql, $connection) or die("$sql Error 2#". mysql_errno() . ": " . mysql_error());//echo "<br>$sql";$numrow = mysql_num_rows($result);} // end else where=="mark !='x'//*******************if($pos[1]=="LEPIDOPTERA"){$fill="<tr><td>Show <a href='search.php?Submit=1&fam=1&majorGroupX=$majorGroupX&parkX=$a1&comName=$a2&cd=$a3&display=$display&website=$a5'>Just Butterflies</a></td><td><a href='search.php?Submit=1&fam=2&majorGroupX=$majorGroupX&parkX=$a1&comName=$a2&cd=$a3&display=$display&website=$a5'>Just Moths</a></td><td><a href='search.php?Submit=1&fam=0&majorGroupX=$majorGroupX&parkX=$a1&comName=$a2&cd=$a3&display=$display&website=$a5'>Both</a></td></tr>";}if($numrow>1){$p="photos";}else{$p="photo";}echo "<htm><head><title></title></head><body bgcolor=\"#CCCCCC\"><table><tr><td colspan='5'>$numrow $p shown of $t $p found using: <font color='blue'>$park $majorGroupX $photoname $commentX $cat $sciNameX $comNameX $cd</font></td></tr>$fill</table><hr><table border='1' cellpadding='5'><tr><th>Group</th><th>Photo</th><th>Comment</th><th>Photog</th><th>Date</th><th>View</th><th>Thumbnail</th><th>CD Name</th></tr>";while ($row = mysql_fetch_array($result)){extract($row);$catFind=$catQ;if($sciName){$nridStuff = "<i>$sciName</i><br>$comName<br>$family<br>$orderx<br>$majorGroup";}else{$nridStuff="";}$link1024="";$link800="";$link640="";$link275="";$CATgroup = str_replace(",", " ", $cat);$CATgroup = explode(",", $cat);for($i=0;$i<count($CATgroup);$i++){if($CATgroup[$i]!=""){$catDisplay.="[".$CATgroup[$i]."] ";}}$linkFull="<a href='getData.php?pid=$pid&location=$link' target='_blank'>$width x $height</a>";if($width > "1024" || $height > "1024"){$link1024="<a href='getData.php?pid=$pid&location=$link&size=1024' target='_blank'>1024</a>";}if($width > "800" || $height > "800"){$link800="<a href='getData.php?pid=$pid&location=$link&size=800' target='_blank'>800</a>";}if($width > "640" || $height > "640"){$link640="<a href='getData.php?pid=$pid&location=$link&size=640' target='_blank'>640</a>";}if($width > "275" || $height > "275"){$link275="<a href='getData.php?pid=$pid&location=$link&size=275' target='_blank'>275</a>";}$catDisplay=strtoupper($catDisplay);if($website){$w="<input type='checkbox' value='x' checked>Website";}else{$w="";}echo "<tr><td>$catDisplay<br>$majorGroup<br>$w";if($location!="nondpr"){echo "<form method='post' action='store.php' enctype='multipart/form-data' align='center'>    <INPUT TYPE='hidden' name='category' value='$cat'>    <INPUT TYPE='hidden' name='photoname' value='$photoname'>    <INPUT TYPE='hidden' name='photog' value='$photog'>    <INPUT TYPE='hidden' name='comment' value='$comment'>    <INPUT TYPE='hidden' name='datePhoto' value='$datePhoto'>    <INPUT TYPE='hidden' name='majorGroup' value='$majorGroup'>    <INPUT TYPE='hidden' name='sciName' value='$sciName'>    <INPUT TYPE='hidden' name='comName' value=\"$comName\">    <INPUT TYPE='hidden' name='cd' value='$cd'>    <br><font color='purple'><input type='submit' name='submit' value='Add a Photo'><br>with same info.</font></form><form action='edit.php' method='POST' target='_blank'>";echo "<input type='hidden' name='category' value='$cat'>";echo "<input type='hidden' name='park' value='$park'>";echo "<input type='hidden' name='pid' value='$pid'>";echo "<input type='hidden' name='photog' value='$photog'>";echo "<input type='hidden' name='cd' value='$cd'>";echo "<input type='hidden' name='date' value='$date'>";echo "<input type='hidden' name='name' value='$name'>";echo "<input type='hidden' name='photoname' value='$photoname'>";echo "<input type='hidden' name='comment' value='$NScomment'>";echo "<input type='hidden' name='editSQL' value='$querySQL'>";echo "<input type='submit' name='submit' value='Edit the Photo Info'>    </form></td>";}echo "<td>$photoname<br>$nridStuff</td><td>$comment&nbsp;</td><td>$photog&nbsp;</td><td>$date&nbsp;</td><td align='center'>$linkFull<br>$link1024<br>$link800<br>$link640<br>$link275</td><td align='center'><img src='getPhoto.php?pid=$pid'></td><td align='center'>$park<br>$cd</td></tr>";$catDisplay="";}echo "<table align='center'>";if ($num_pages > 1) {	echo "<tr align='center'>		<td align='center' colspan='2'>";			// Determine what page the script is on.		if ($start == 0) {		$current_page = 1;	} else {		$current_page = ($start/$display_number) + 1;	}// Set the variables for other page Links	$baseLink="<a href=\"search.php?";	$numPageLink="&num_pages=".$num_pages;	$tLink="&t=".$t;	if($parkX){$parkLink="&parkX=".$parkX;}	if($majorGroupX){$mgLink="&majorGroupX=".$majorGroupX;}	$displayLink="&display=".$display;	if($catFind){$catLink="&cat=".$catFind;}	if($photonameX){$photoNameLink="&photonameX=".$photonameX;}	if($commentX){$commentLink="&commentX=".addslashes($commentX);}	if($sciNameX){$sciNameLink="&sciNameX=".addslashes($sciNameX);}	if($comNameX){$comNameLink="&comNameX=".addslashes($comNameX);}	if($cdX and $cdX!="none"){$cdLink="&cd=".$cdX;}	if($websiteYes==1){$websiteLink="&website=".$website;}	if($photogX){$photogLink="&photogX=".addslashes($photogX);}	if($personIDX){$personIDLink="&personIDX=on";}		// If it's not the first page, make a Previous button.	if ($start != 0) {	$startLink="start=".($start - $display_number);	$submitLink="&Submit=1\">Previous</a> ";	$previousLink=$baseLink.$startLink.$numPageLink.$tLink.$parkLink.$mgLink.$displayLink.$catLink.$photoNameLink.$sciNameLink.$comNameLink.$commentLink.$cdLink.$websiteLink.$photogLink.$personIDLink.$submitLink;echo "$previousLink";	}	// Make all the numbered pages.	for ($i = 1; $i <= $num_pages; $i++) {	//	$next_start = $start + $display_number;	$startLink="start=".($display_number * ($i - 1));	$submitLink="&Submit=1\">$i</a> ";		if($i<($current_page+10) and $i>($current_page-10)){			if ($i != $current_page) { // Don't link the current page.				$numLink=$baseLink.$startLink.$numPageLink.$tLink.$parkLink.$mgLink.$displayLink.$catLink.$photoNameLink.$sciNameLink.$comNameLink.$commentLink.$cdLink.$websiteLink.$photogLink.$personIDLink.$submitLink;//$current_page = ($start/$display_number) + 1;echo "$numLink";		} else {			echo $i . ' ';		}	}}		// If it's not the last page, make a Next button.	if ($current_page != $num_pages) {	$startLink="start=".($start + $display_number);	$submitLink="&Submit=1\">Next</a> ";			$nextLink=$baseLink.$startLink.$numPageLink.$tLink.$parkLink.$mgLink.$displayLink.$catLink.$photoNameLink.$sciNameLink.$comNameLink.$commentLink.$cdLink.$websiteLink.$photogLink.$personIDLink.$submitLink;echo "$nextLink";	}		echo '</td>	</tr>';}$showSQL="http://149.168.1.195/photos/search.php?".$querySQL."Submit=1";echo "<tr><td align='left'><font size='-2'>$showSQL</font></td></tr></table></body></html>";exit;}// end $Submit// **********************include("../../include/parkcodesDiv.inc");$sql="SELECT DISTINCT photos.images.majorGroup,nrid.dprspp.orderxFROM photos.imagesLEFT JOIN nrid.dprspp on photos.images.sciName = nrid.dprspp.sciNamewhere photos.images.sciName = nrid.dprspp.sciNameORDER BY nrid.images.majorGroup";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());//echo "$sql $where"; exit;?><html><head><title>Search Image Database</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head><body bgcolor="#CCCCCC"><form method="post" action="search.php">  <p align="center"><font size="5" color="#336633"><b><font color="#630B17">ID Search Page</font></b></font></p>  <table width="63%">    <tr>       <td width="18%" align="right">         <b>Park:</b>      </td>      <td width="20%" colspan="4"> <select name='parkX'><?php$i=1;while ($i <= $numParkCode) {if($parkCode[$i]==$parkC){$v="selected";}else{$v="value";}     echo "<option $v='$parkCode[$i]'>$parkCode[$i]\n";     $i++;}echo "</select>\n";include("cat.inc");// List of categories as array catListsort($catList); reset($catList);echo "<b>Category:</b>        <select name=\"cat\">";  echo "<option value=''>\n";//if(!$cat){$cat=0;}$i=0;while ($i <= count($catList)-1) {if($catList[$i]==$cat){$v="selected";}else{$v="value";}$catVal=$catList[$i];if($catVal=="Cultural|History"){$catVal="cultural";}     echo "<option $v='$catVal'>$catList[$i]\n";     $i++;}if($_SESSION[photos][level]>2){$employeeID="<input type='checkbox' name='personIDX'> - Employee ID";}else{$employeeID="";} echo "</select><input type='checkbox' name='website'> - Website $employeeID</td>    </tr>    <tr>       <td width='18%' align='right'>         <b>Photo Name:</b>      </td>      <td width='71%'>         <input type='text' name='photoname' size='40'>      </td>    </tr>    <tr>       <td width='18%' align='right'>         <b>Comment:</b>      </td>      <td width='71%'>         <input type='text' name='commentX' size='40'>      </td>    </tr>    <tr>       <td width='18%' align='right'><b>CD Name/Number:</b></td>      <td width='71%'> <input type='text' name='cdX' size='20'>      Photo ID<input type='text' name='pidX' size='10'></td>          </tr>    <tr><td width='18%' align='right'><b>Major Group:</b></td><td><select name='majorGroupX'>       <option> </option>";       while ($row = mysql_fetch_array($result)){extract($row);if($majorGroup!=""){if($majorGroup=="INSECT-BUTTERFLY"||$majorGroup=="INSECT-MOTH"){$majorGroup="INSECT";}include("../../include/caseOrderX.php");if (in_array($majorGroup, $check)) {}else{        echo "<option value='$majorGroup'>$majorGroupX";}        }$check[]=$majorGroup;   }   echo "</select> Used for plants/animals</td></tr>";//  echo "<pre>";print_r($track);print_r($trackX);echo "</pre>";    ?>        <tr>       <td width="18%" align="right">       <b>SciName:</b>      </td>      <td width="71%">         <input type="text" name="sciNameX" size="40"> Used for plants/animals      </td>    </tr>    <tr>       <td width="18%" align="right">       <b>ComName:</b>      </td>      <td width="71%">         <input type="text" name="comNameX" size="40"> Used for plants/animals      </td>    </tr>    <tr>       <td width="18%" align="right">       <b>Photographer:</b>      </td>      <td width="71%">         <input type="text" name="photogX" size="40">      </td>    </tr>    <tr>       <td width="18%" align="right">             </td>      <td width="71%">         <input type="text" name="display" value="4" size="5"> <b>Number of Thumbnails to Display per page</b>      </td>    </tr>  </table>  <p>     <input type="reset" name="Reset" value="Clear Form">    &nbsp; &nbsp;     <input type="submit" name="Submit" value="Submit Query">  </p>  </form><p><b>Partial search terms are acceptable.</b><br>You could enter any letter(s) of a word contained in either the Photo Name, Comment, SciName or ComName.</p></body></html>