<?php//These are placed outside of the webserver directory for security//include("../../include/authBUDGET.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // database        list($usec, $sec) = explode(' ',microtime());        $querytime_before = ((float)$usec + (float)$sec);        $sql = "delete from wholetemp where debit='0' and credit='0' and acctdate not like 'ACCT%'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql = "SELECT acctdate,whid From wholetemp";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");while($row=mysqli_fetch_array($result)){extract($row);$test=strpos($acctdate,"ACCT");if($test===false){//insert $varAcct$query="UPDATE wholetemp set acct='$varAcct' where whid='$whid'";$resultQ = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");}else{$varAcct=substr($acctdate,5,15);$query="UPDATE wholetemp set acct='$varAcct' where whid='$whid'";$resultQ = mysqli_query($connection, $query) or die ("Couldn't execute query. $query");}}$sql = "delete from wholetemp where (debit='0' and credit='0') OR invoice=''";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql = "OPTIMIZE  TABLE `wholetemp`";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql"); $sql =  "DROP  TABLE  IF  EXISTS  `whole`";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql = "CREATE  TABLE `budget` .`whole` (`center` varchar( 8  )  NOT  NULL default '' ,`fund` varchar( 4  )  NOT  NULL default '' ,`acctdate` varchar( 20  )  NOT  NULL default '' ,`invoice` varchar( 25  )  NOT  NULL default '' ,`pe` varchar( 6  )  NOT  NULL default '' ,`description` varchar( 20  )  NOT  NULL default '' ,`debit` decimal( 10, 2  )  NOT  NULL default '0.00' ,`credit` decimal( 10, 2  )  NOT  NULL default '0.00' ,`sys` varchar( 15  )  NOT  NULL default '' ,`acct` varchar( 20  )  NOT  NULL default '' ,`whid` mediumint( 8  ) unsigned NOT  NULL  AUTO_INCREMENT ,PRIMARY  KEY ( `whid`   ) ) TYPE  =  MYISAM ";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql="INSERT  INTO `budget` .`whole` SELECT  * FROM `budget` .`wholetemp`";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql="ALTER  TABLE `whole` ADD  INDEX ( `center` )";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$sql="ALTER  TABLE `whole` ADD  INDEX ( `acct` )";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");        list($usec, $sec) = explode(' ',microtime());        $querytime_after = ((float)$usec + (float)$sec);        $queryTime = $querytime_after - $querytime_before;echo "Deletion and Parsing Complete! Total time = $queryTime seconds.<BR><BR>Click <a href='transAll.php'>Link</a> to query the newly created transaction database.";?>