<?php//These are placed outside of the webserver directory for security$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // database//echo "c=$connection";exit;extract($_REQUEST);//echo "<pre>";print_r($_REQUEST);echo "</pre>";//exit;//print_r($_REQUEST);exit;if($pcard33){echo "PCARD records= $pcard33 Total Amt. = $amt33<br>";}if($whid_count){echo "PCARD records= $whid_count Total Amt. = $pcard_amt<br>";}if($pcard_extract_val){echo "pcard_extractwhere record_complete=n = $pcard_extract_val<br>";}if($step){if($step=="-1"){$step=0;}$sql = "UPDATE track_update set pc_unrecon_1='$step'";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}$sql = "SELECT max(pc_unrecon_1) as step FROM track_update";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$row=mysqli_fetch_array($result); extract($row);echo "<html><head><script language='JavaScript'>function popitup(url){   newwindow=window.open(url,'name','resizable=1,scrollbars=1,height=800,width=650,menubar=1,toolbar=1');        if (window.focus) {newwindow.focus()}        return false;}//--></script><title>NC DPR Budget Tracking System</title>";echo "The update of <b>pcard_unreconciled</b> has been completed thru step $step";echo "<table>";$today_scan=date(Ymd);$today_amer=date("m/d/y");echo "<form><tr><td>Today's Date <input type='text' name='$todays_date' value='$today_scan' size='10'></td><td>xtnd_today(mm/dd/yy) <input type='text' name='xtnd_today_amer' value='' size='10'></td><td>xtnd_today(yyyymmdd) <input type='text' name='xtnd_today_scan' value='$xtnd_today_scan' size='10'></td></tr><tr><td>reconcile week-xtnd_start(yyyymmdd) <input type='text' name='xtnd_rundate_start' value='$xtnd_rundate_start' size='10'></td><td>reconcile week-xtnd_end <input type='text' name='xtnd_rundate_end' value='$xtnd_rundate_end' size='10'></td><td>reconcile week-report_date <input type='text' name='reconcilement_date' value='$reconcilement_date' size='10'></td><td><input type='submit' name='dates' value='Submit'></td></tr></table>";if($xtnd_today_scan==""||$xtnd_rundate_start==""||$xtnd_rundate_end==""||$reconcilement_date==""){exit;}$passVars="xtnd_today_scan=$xtnd_today_scan&xtnd_rundate_start=$xtnd_rundate_start&xtnd_rundate_end=$xtnd_rundate_end&reconcilement_date=$reconcilement_date";echo "<table border='1' cellpadding='5'>";if($script==1){include("pc_unrecon_01.php");}if($step>0){$ck1="checked";$status1="Done";}else{$status1="<a href='pc_unrecon_00.php?script=1&$passVars'>Run</a>";}echo "<tr><td>1 <input type='checkbox' name='1' value='x' $ck1></td><td>$status1 Automatic</td><td>Backup TABLE=budget.pcard_unreconciled to TABLE=budget_backup1.pcard_unreconciled_$today_scan</td></tr>";if($step>1){$ck2="checked";$status2="Done";}else{$status2="<a href='exp_rev_pop_00.php?step=2&$passVars'>Run</a>";}echo "<tr><td>2 <input type='checkbox' name='1' value='x' $ck2></td><td>$status2 Automatic</td><td>Truncate table pcard_unreconciled_xtnd (TEST PHASE - not implemented)</td></tr>";if($script==3){include("pc_unrecon_03.php");}if($step>2){$ck3="checked";$status3="Done";}else{$status3="<a href='pc_unrecon_00.php?script=3&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td></td><td><input type='button' value='Get 1656 Checklist' onclick=\"return popitup('checklist.php?location=1656&report_date=$reconcilement_date')\"></td><td>CREATE TEXT FILE for XTND Report= PC Unreconciled Trans by Date (Location=1656) </td></tr>";echo "<tr><td>3 <input type='checkbox' name='1' value='x' $ck3></td><td>$status3 Manual</td><td>UPDATE pcard_unreconciledset reconciled=''where reconciled='n';</td></tr>";if($script==4){include("pc_unrecon_04.php");}if($step>3){$ck4="checked";$status4="Done";}else{$status4="<a href='pc_unrecon_00.php?script=4&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>4 <input type='checkbox' name='1' value='x' $ck4></td><td>$status4 Automatic</td><td>INSERT IGNORE INTO pcard_unreconciled(location,admin_num,post_date, ..., f_yearfrom pcard_unreconciled_xtnd</td></tr>";if($script==5){include("pc_unrecon_05.php");}if($step>4){$ck5="checked";$status5="Done";}else{$status5="<a href='pc_unrecon_00.php?script=5&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>5 <input type='checkbox' name='1' value='x' $ck5></td><td>$status5 Automatic</td><td> UPDATE pcard_unreconciled set location=trim(location), cardholder=trim(cardholder), admin_num=trim(admin_num), post_date=trim(post_date), trans_date=trim(trans_date), amount=trim(amount), vendor_name=trim(vendor_name), address=trim(address), pcard_num=trim(pcard_num), xtnd_rundate=trim(xtnd_rundate)</td></tr>";if($script==6){include("pc_unrecon_06.php");}if($step>5){$ck6="checked";$status6="Done";}else{$status6="<a href='pc_unrecon_00.php?script=6&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>6 <input type='checkbox' name='1' value='x' $ck6></td><td>$status6 Automatic</td><td> UPDATE pcard_unreconciledset transdate_new=concat(mid(trans_date,7,4),mid(trans_date,1,2),mid(trans_date,4,2))where 1;</td></tr>";if($script==7){include("pc_unrecon_07.php");}if($step>6){$ck7="checked";$status7="Done";}else{$status7="<a href='pc_unrecon_00.php?script=7&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>7 <input type='checkbox' name='1' value='x' $ck7></td><td>$status7 Automatic</td><td> UPDATE pcard_unreconciledset postdate_new=concat(mid(post_date,7,4),mid(post_date,1,2),mid(post_date,4,2))where 1;</td></tr>";if($script==8){include("pc_unrecon_08.php");}if($step>7){$ck8="checked";$status8="Done";}else{$status8="<a href='pc_unrecon_00.php?script=8&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>8 <input type='checkbox' name='1' value='x' $ck8></td><td>$status8 Automatic</td><td> UPDATE pcard_unreconciled,pcard_usersset pcard_unreconciled.parkcode=pcard_users.parkcodewhere pcard_unreconciled.pcard_num=pcard_users.card_number;</td></tr>";if($script==9){include("pc_unrecon_09.php");}if($step>8){$ck9="checked";$status9="Done";}else{$status9="<a href='pc_unrecon_00.php?script=9&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>9 <input type='checkbox' name='1' value='x' $ck9></td><td>$status9 Automatic</td><td> UPDATE pcard_unreconciled,pcard_usersset pcard_unreconciled.cardholder=pcard_users.last_namewhere pcard_unreconciled.pcard_num=pcard_users.card_number;</td></tr>";if($script==10){include("pc_unrecon_10.php");}if($step>9){$ck10="checked";$status10="Done";}else{$status10="<a href='pc_unrecon_00.php?script=10&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>10 <input type='checkbox' name='1' value='x' $ck10></td><td>$status10 Automatic</td><td> UPDATE pcard_unreconciledset transid_new=LPAD( trim(replace(trans_id,',','')),9,'0') WHERE 1;</td></tr>";if($script==11){include("pc_unrecon_11.php");}if($step>10){$ck11="checked";$status11="Done";}else{$status11="<a href='pc_unrecon_00.php?script=11&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>11 <input type='checkbox' name='1' value='x' $ck11></td><td>$status11 Automatic</td><td> UPDATE pcard_unreconciledset xtnd_rundate_new=concat('20',mid(xtnd_rundate,7,2),mid(xtnd_rundate,1,2),mid(xtnd_rundate,4,2))where 1;</td></tr>";if($script==12){include("pc_unrecon_12.php");}if($step>11){$ck12="checked";$status12="Done";}else{$status12="<a href='pc_unrecon_00.php?script=12&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>12 <input type='checkbox' name='1' value='x' $ck12></td><td>$status12 Automatic</td><td> UPDATE pcard_unreconciledset report_date='<font color='blue'>$reconcilement_date</font>'where xtnd_rundate_new >= '<font color='blue'>$xtnd_rundate_start</font>'and xtnd_rundate_new <= '<font color='blue'>$xtnd_rundate_end</font>'and report_date='';</td></tr>";if($script==13){include("pc_unrecon_13.php");}if($step>12){$ck13="checked";$status13="Done";}else{$status13="<a href='pc_unrecon_00.php?script=13&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>13 <input type='checkbox' name='1' value='x' $ck13></td><td>$status13 Automatic</td><td> UPDATE pcard_unreconciledset company='1601'where (location='1616' or location='1656')and company='';<BR>UPDATE pcard_unreconciledset company='1604'where (location='1629' or location='1669')and company='';</td></tr>";if($script==14){include("pc_unrecon_14.php");}if($step>13){$ck14="checked";$status14="Done";}else{$status14="<a href='pc_unrecon_00.php?script=14&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>14 <input type='checkbox' name='1' value='x' $ck14></td><td>$status14 Automatic</td><td> UPDATE pcard_unreconciled_xtnd set location=trim(location), cardholder=trim(cardholder), admin_num=trim(admin_num), post_date=trim(post_date), trans_date=trim(trans_date), amount=trim(amount), vendor_name=trim(vendor_name), address=trim(address), pcard_num=trim(pcard_num), xtnd_rundate=trim(xtnd_rundate)</td></tr>";if($script==15){include("pc_unrecon_15.php");}if($step>14){$ck15="checked";$status15="Done";}else{$status15="<a href='pc_unrecon_00.php?script=15&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>15 <input type='checkbox' name='1' value='x' $ck15></td><td>$status15 Automatic</td><td> UPDATE pcard_unreconciled,pcard_unreconciled_xtndset pcard_unreconciled.reconciled='n'where pcard_unreconciled.trans_id=pcard_unreconciled_xtnd.trans_id;</td></tr>";if($script==16){include("pc_unrecon_16.php");}if($step>15){$ck16="checked";$status16="Done";}else{$status16="<a href='pc_unrecon_00.php?script=16&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>16 <input type='checkbox' name='1' value='x' $ck16></td><td>$status16 Automatic</td><td> UPDATE pcard_unreconciledset reconcilement_date='<font color='blue'>$today_scan</font>'where reconciled='';<br>UPDATE pcard_unreconciledset reconciled='y'where reconciled='';</td></tr>";if($script==17){include("pc_unrecon_17.php");}if($step>16){$ck17="checked";$status17="Done";}else{$status17="<a href='pc_unrecon_00.php?script=17&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>17 <input type='checkbox' name='1' value='x' $ck17></td><td>$status17 Automatic</td><td> UPDATE pcard_unreconciled,pcard_usersset pcard_unreconciled.center=pcard_users.centerwhere pcard_unreconciled.pcard_num=pcard_users.card_numberand pcard_unreconciled.center='';</td></tr>";if($script==18){include("pc_unrecon_18.php");}if($step>17){$ck18="checked";$status18="Done";}else{$status18="<a href='pc_unrecon_00.php?script=18&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>18 <input type='checkbox' name='1' value='x' $ck18></td><td>$status18 Automatic</td><td> UPDATE pcard_unreconciled,coaset pcard_unreconciled.ncas_description=coa.park_acct_descwhere pcard_unreconciled.ncasnum=coa.ncasnum;</td></tr>";if($script==19){include("pc_unrecon_19.php");}if($step>18){$ck19="checked";$status19="Done";}else{$status19="<a href='pc_unrecon_00.php?script=19&start_date=$start_date&end_date=$end_date&fiscal_year=$fiscal_year'>Run</a>";}echo "<tr><td>19 <input type='checkbox' name='1' value='x' $ck19></td><td>$status19 Automatic</td><td> ???? SELECT reconcilement_date,reconciled,count(reconcilement_date)from pcard_unreconciledwhere 1group by reconcilement_date;</td></tr>";echo "</table>";?>