<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // database//include("../../../include/parkcodesDiv.inc");session_start();$level=$_SESSION[budget][level];extract($_REQUEST);//echo "<pre>";print_r($_REQUEST);echo "</pre>";//exit;//echo "<pre>";print_r($_SESSION);echo "</pre>"; //exit;if($id){$sql ="SELECT max(projnum) as maxProj FROM `partf_projects`";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$row=mysqli_fetch_array($result); extract($row);$max=substr($maxProj,0,2);//echo "m=$max";exit;}//print_r($_REQUEST);//print_r($_SESSION);echo "<script language=\"JavaScript\"><!--function setForm() {    opener.document.pcardForm.projnum_$pc_id.value = document.inputForm1.inputField1.value;    opener.document.pcardForm.center_$pc_id.value = document.inputForm1.inputField2.value;    self.close();    return false;}function MM_jumpMenu(targ,selObj,restore){ //v3.0  eval(targ+\".location='\"+selObj.options[selObj.selectedIndex].value+\"'\");  if (restore) selObj.selectedIndex=0;}//--></script>";echo "<table><tr><td><A HREF=\"javascript:window.print()\"><IMG SRC=\"../bar_icon_print_2.gif\" BORDER=\"0\"</A></td>";//if($level>1){echo "<td><select name='parkcode' onChange=\"MM_jumpMenu('parent',this,0)\">"; $sql = "SELECT distinct park from partf_projects ORDER BY park";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//$num=mysqli_num_rows($result);	while($row=mysqli_fetch_array($result)){	extract($row);$park=strtoupper($park);	$parkCode[]=$park;	}	        for ($n=0;$n<count($parkCode);$n++)          {$scode=$parkCode[$n];$parkArray[]=$scode;    //    if($scode=="ARCH"){$scode="ADM";}if($scode==$parkcode){$s="selected";}else{$s="value";}echo "<option $s='pcard_partf.php?parkcode=$scode&pc_id=$pc_id'>$scode\n";          }echo "</select></form></td>";//}echo "</tr></table>";if($id){$checkBalance=x;include("../b/prtf_center_budget_menu.php");//echo "Hello";exit;//$sql = "SELECT projnum,projname,new_comp as 'comp',new_center as 'center',new_budgcode as 'budgcode',new_center_year_type as 'center_year_type' FROM `partf_projects` WHERE partfid='$id'";$sql = "SELECT projnum,projname,comp,center,budgcode,center_year_type FROM `partf_projects` WHERE partfid='$id'";}else{if($_SESSION['budget']['partf']=="CONS" and $_SESSION['budget']['posNum']!="60033199" and $_SESSION['budget']['posNum']!="65027688"){  //posNum=office assistant V-Cara Hadfield, Matthew Davis$parkcode="";$menuCI=1;$where="(projcat='ci' or projcat='en' or projcat='er') and projyn='y' and center not like '4a%' order by center desc";}	else{if($_SESSION[budget][select]=="ADM"||$level==5){$where="park='$parkcode' and projyn='y' and center not like '4a%'  AND (statusper = 'ns' or statusper = 'ip') order by center desc";}else{$where="park='$parkcode' and (projcat='mm' or projcat='tm' or projcat='er' or projcat='de' or projcat='en' or projcat='nr') and projyn='y' and center not like '4a%' AND (statusper = 'ns' or statusper = 'ip') order by center desc";}}// end CONS else//$sql = "SELECT projnum,projname,new_comp as 'comp',new_center as 'center',new_center_year_type as 'center_year_type',new_budgcode as 'budgcode',partfid FROM `partf_projects` WHERE $where";$sql = "SELECT projnum,projname,comp,center,center_year_type,budgcode,partfid FROM `partf_projects` WHERE $where";//echo "$sql";}// end id elseif($parkcode){$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}//echo "$sql";exit;if($menuCI){ foreach (range('10', $max) as $numBegin) {$numArray1[]=$numBegin."00";$numArray2[]=$numBegin; }//print_r($numArray2);exit;echo "<html><table>";echo "<tr><td><form><select name=\"parkCI\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>[Park] Project Name Begins With:</option>";$s="value";for ($n=0;$n<count($parkArray);$n++){$con="pcard_partf.php?pc_id=$pc_id&parkCI=".$parkArray[$n];		echo "<option $s='$con'>$parkArray[$n]\n";       }          echo "</select></form></td>   <td><form><select name=\"vendor_number\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>[Numeric] Project Number Like:</option>";$s="value";for ($n=0;$n<count($numArray1);$n++){$con="pcard_partf.php?pc_id=$pc_id&numeric=".$numArray2[$n]."&pc=1";		echo "<option $s='$con'>$numArray1[$n]\n";       }          echo "</select></td></tr></form>";}if($parkCI and $id==""){$sql = "SELECT park as parkcode,projnum,projname,new_comp as 'comp',new_center as 'center',new_budgcode as 'budgcode',partfid,new_center_year_type as 'center_year_type' FROM `partf_projects` WHERE park ='$parkCI' and (projcat='ci' or projcat='en' or projcat='er') and (statusPer='NS' or statusPer='IP') order by projname";}if($numeric){$sql = "SELECT park as parkcode,projnum,projname,new_comp as 'comp',new_center as 'center',new_budgcode as 'budgcode',partfid,new_center_year_type as 'center_year_type' FROM `partf_projects` WHERE projnum LIKE '$numeric%' and (projcat='ci' or projcat='en') and (statusPer='NS' or statusPer='IP') order by projnum";}if($parkCI or $numeric){$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");}echo "<br>$sql";//exit;if(!$parkcode){$pc="<th>Park</th>";}else{$pc="<th></th>";}echo "<table cellpadding='2'><tr><td align='center' colspan='4'>PARTF Projects for $parkcode</td></tr><tr><td align='center' colspan='4'><font color='red'>NOTE</font>: Only Projects with Status = NS (Not Started) and Status = IP (In-Process) are available for Paying Bills. Projects with Status FI (Finished), CA (Cancelled), or TR (Transferred) are no longer Available for Paying Bill. </td></tr><tr>$pc<th>Proj. Num.</td><th>Center_Year_Type</th><th>Project Name</th></tr>";if($parkCI){$passPark="parkCI";}else{$passPark="parkcode";}$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);$p=strtoupper($projname);$parkcode=strtoupper($parkcode);$center_year_type=strtoupper($center_year_type);if($parkcode){$pc="<td>$parkcode</td>";//$parkcode=$park;}if($id!=""){$sel="";}else{$sel="Select";}echo "<tr>$pc<td><b>$projnum</b></td><td>$center_year_type</td><td>$p <a href='pcard_partf.php?id=$partfid&$passPark=$parkcode&center=$center&acs=1&pc_id=$pc_id'>$sel</a></td></tr>";}if($parkcode!="" or $parkCI!=""){if($parkcode){$thisPark=$parkcode;}else{$thisPark=$parkCI;}echo "<tr><td colspan='4' align='center'><a href='pcard_partf.php?$passPark=$thisPark&acs=1&pc_id=$pc_id'>Show List of Projects</a></td></tr>";}echo "</table>";if($id){echo "<table><form name='inputForm1' onSubmit='return setForm();'>";echo "<tr><td><input name='inputField1' type='text' value='$projnum' size='8' READONLY> Project Number</td></tr><tr><td><input name='inputField2' type='text' value='$center' size='8' READONLY> Center</td></tr>";if($stop_pay=='y'){echo "<br /><font color='red'><b>NO More payments allowed for Fund $center (Stop Pay per Budget Office)</b></font><br /><br />";{$available_funds=0;}}//echo "<br />available_funds=$available_funds<br />";//echo "<br />available_funds_noformat=$available_funds_noformat<br />";$query1="SELECT amount as 'pcard_amount_check' from pcard_unreconciled where id='$pc_id' ";        		 //echo "query1=$query1<br />";		 $result1 = mysqli_query($connection, $query1) or die ("Couldn't execute query 1.  $query1");$row1=mysqli_fetch_array($result1);extract($row1);//echo "<br />pcard_amount_check=$pcard_amount_check<br />";if($pcard_amount_check > $available_funds_noformat){$available_funds=0;}if($available_funds>0){echo "<tr><td><input type='submit' value='Update Code Sheet'></td></tr></form>";}else{$sql = "Select centerman,od_ok from center where center='$center'";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//echo "$sql";exit;$row=mysqli_fetch_array($result);extract($row);if(strtolower($od_ok)=="y"){echo "<tr><td><input type='submit' value='Update Code Sheet'></td></tr></form>";}else{$name=explode("_",$centerman);$fname=ucfirst($name[0]); $lname=ucfirst($name[1]);echo "<tr><td><font color='red'>Oops! Funds not Available. PCARD Transaction Amount exceeds available balance in Center $center</font>.<br><br><a href='mailto:$name[0].$name[1]@ncparks.gov?subject=Insufficient funds for Project $projnum in Center $center for $parkcode'>Email</a> - $fname $lname  if you need to make a payment for this project.</td></tr>";}}echo "</table>";}?>