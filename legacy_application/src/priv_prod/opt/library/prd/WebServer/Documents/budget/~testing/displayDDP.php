<?php//echo "$sql<br>test<pre>";print_r($projFundIn);print_r($projFundOut);echo "</pre>";//exit;makeReportHeader($reportMonth,$rep);while(list($key,$val)=each($arrayAllCredits)){$projNum=$key;makeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit,$ce,$arrayAllPayments,$arrayAllCredits,$arraySomePayments, $arrayYearFundC,$arrayCenter,$arraybudgCode,$arraycomp,$arrayproj_man,$arrayYearFundF,$arraypark,$arraydist,$arraycounty,$arrayprojName,$arraystartDate,$arrayendDate,$arraystatusDesign,$arraystatusConstruct,$arraystatusPer,$arraycomments,$projFundIn,$projFundOut,$passSQL,$arrayMonthCredits);}//echo "$sql<pre>";print_r($_SERVER);echo "</pre>";exit;//echo "$sql<pre>";print_r($projFundIn);print_r($projFundOut);echo "</pre>";exit;if($rep==""){$sql=$_SERVER[QUERY_STRING];echo "<br>n = $num <a href='ReportPARTF.php?$sql&rep=excel'>Excel Export</a>&nbsp;&nbsp;-->&nbsp;<a href='ReportPARTF.php?$sql&rep=pdf'>PDF File</a>";}//echo "$sql"; exit;// ***************** FUNCTIONS **************function sortCol($fld0,$fld1,$fld2){if($fld0==""){$sort=$fld1; if($fld2){$sort=$sort.",".$fld2;}if($sort=="Center"){$sort="partf_projects.".$sort;}echo "<a href='ReportPARTF.php?s=$sort'>Sort<br></a>";}}function sumCol($fld0,$fld1){if($fld0==""){echo "<a href='ReportPARTF.php?g=$fld'>Group<br></a>";}}function formatMoney($fm){$value=number_format($fm,2);return $value;}// Headerfunction makeReportHeader($reportMonth,$rep){global $month,$year;$editFunds="<a href='editFunds.php'>FUNDS</a>";if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=DDPreport.xls');$editFunds="";}echo "<table border='1'><tr><th width='10'>"; sortCol($rep,projNum); echo "PROJ.<BR>NUMBER</th><th>CALENDAR<br>YEAR OF INITIAL FUNDING</th><th>"; sortCol($rep,Center); sumCol($rep,Center);echo "CRNT<BR>CNTR</th><th>"; sortCol($rep,budgCode); echo "CODE</th><th>"; sortCol($rep,comp,"partf_projects.projNum"); sumCol($rep,comp);echo "COMP</th><th>MGR</th><th>FISCAL YR<br>OF FUNDING</th><th>"; sortCol($rep,park,"partf_projects.projNum"); sumCol($rep,park);echo "PARK</th><th>PARK DISTRICT,<BR>COUNTY</th><th>PROJECT NAME</th>";if($reportMonth){$shortMonth=date("M", mktime(0,0,0,$month,1,$year));$shortYear=date("y", mktime(0,0,0,$month,1,$year));echo "<th>Current<br>Month<br>Funds<br>$shortMonth-$shortYear</th><th>Current<br>Month<br>Expenses<br>$shortMonth-$shortYear</th>";}echo "<th>TOTAL POSTED<BR>FUNDS</th><th>TOTAL POSTED<BR>EXPENSES</th><th>TOTAL POSTED<BR>ENDING<BR>BALANCE</th><th>ESTIMATED<BR>CONSTRUCTION<BR>START DATE</th><th>ESTIMATED<BR>CONSTRUCTION<BR>END DATE</th><th>PHASE-% COMPLETE<BR>D=DESIGN<BR>C=CONST</th><th>STATUS</th></tr>";}function makeReport($projNum,$projYN,$reportDisplay,$projCat,$projSCnum,$projDENRnum,$Center,$budgCode,$comp,$projsup,$manager,$fundMan,$YearFundC,$YearFundF,$fullname,$dist,$county,$section,$fullname,$projName,$active,$startDate,$endDate,$statusProj,$percentCom,$statusPer,$comments,$commentsI,$dateadded,$brucefy,$proj_man,$secondCounty,$res_proj,$partfyn,$femayn,$fema_proj_num,$mult_proj,$partfid,$amt,$credit,$ce,$arrayAllPayments,$arrayAllCredits,$arraySomePayments, $arrayYearFundC,$arrayCenter,$arraybudgCode,$arraycomp,$arrayproj_man,$arrayYearFundF,$arraypark,$arraydist,$arraycounty,$arrayprojName,$arraystartDate,$arrayendDate,$arraystatusDesign,$arraystatusConstruct,$arraystatusPer,$arraycomments,$projFundIn,$projFundOut,$passSQL){global $reportMonth,$creditTot,$cumAmountTot,$difTot,$ceTot,$rep, $total_post_funds,$reportMonthFundsTot,$total_post_expenses;$cumAmount=$arrayAllPayments[$projNum];$credit=$arrayAllCredits[$projNum];$creditMonth=$arrayCredits[$projNum];$amt=$arraySomePayments[$projNum];//$cumAmountTot=$cumAmountTot+$cumAmount;$creditTot=$creditTot+$credit;$amtTot=$amtTot+$amt;$YearFundC=$arrayYearFundC[$projNum];$Center=strtolower($arrayCenter[$projNum]);$budgCode=$arraybudgCode[$projNum];$comp=$arraycomp[$projNum];$proj_man=$arrayproj_man[$projNum];$YearFundF=$arrayYearFundF[$projNum];$fullname=$arraypark[$projNum];$dist=$arraydist[$projNum];$county1=$arraycounty[$projNum];$projName=$arrayprojName[$projNum];$startDate=$arraystartDate[$projNum];$endDate=$arrayendDate[$projNum];$design1=$arraystatusDesign[$projNum];$construct1=$arraystatusConstruct[$projNum];if($construct1==""){$statusDC="D-".$design1;}else{$statusDC="C-".$construct1;}$statusPer=$arraystatusPer[$projNum];switch ($statusPer) {		case "NS":			$status = "NOT STARTED";			break;			case "IP":			$status = "IN PROGRESS";			break;			case "OH":			$status = "ON HOLD";			break;			case "FI":			$status = "FINISHED";			break;		}	$comments=$arraycomments[$projNum];$dif=($credit-$cumAmount);   5if($dif<0){$tb="<font color='red'>";$te="</font>";}else{$tb="";$te="";}$dif=formatMoney($dif);if($dif==0){$dif="-&nbsp;&nbsp;&nbsp;&nbsp;";}$total_post_expenses=$total_post_expenses+$cumAmount;$cumAmount=formatMoney($cumAmount);if($cumAmount==0){$cumAmount="-&nbsp;&nbsp;&nbsp;&nbsp;";}$ceTot=$ceTot+$amt;if($amt<0){$amt="(".formatMoney($amt).")";}else{$amt=formatMoney($amt);}if($amt==0){$amt="-&nbsp;&nbsp;&nbsp;&nbsp;";}if($rep==""){/*$projNumLink="<a href='partf.php?projNum=$projNum&passSQL=$passSQL'>$projNum</a>";// *********** Need to understand this better *********$div_app_amt=$credit;if($projFundIn[$projNum]){$fundIn=$projFundIn[$projNum];//$div_app_amt=$div_app_amt+$fundIn;}// *********** Need to understand this better *********if($projFundOut[$projNum]){$fundOut=$projFundOut[$projNum];//$div_app_amt=$div_app_amt-$fundOut;}if($div_app_amt!=0){$div_app_amt=formatMoney($div_app_amt,2);$postLink="<a href='editFunds.php?proj_in=$projNum&post=1'>$div_app_amt</a>";}else{$postLink="-&nbsp;&nbsp;&nbsp;&nbsp;";}*/if($projFundOut[$projNum]){$fundOut=$projFundOut[$projNum];}if($projFundIn[$projNum]){$fundIn=$projFundIn[$projNum];}$projNumLink=$projNum;$postLink=formatMoney($credit,2);$total_post_funds=$total_post_funds+$credit;}else{if($projFundOut[$projNum]){$fundOut=$projFundOut[$projNum];}if($projFundIn[$projNum]){$fundIn=$projFundIn[$projNum];}$projNumLink=$projNum;$postLink=formatMoney($credit,2);$total_post_funds=$total_post_funds-$credit;}// This kludge is necessary to get "4e72" to not display in sci. notation in Excel$Center="<font color='white'>`</font>".strtoupper($Center);// This kludge is necessary to get "04/05" to not display in sci. notation in Excel$YearFundF="<font color='white'>`</font>".$YearFundF;$fullname=strtoupper($fullname);$dist=strtoupper($dist);$county1=strtoupper($county1);if($county1=="NA"){$county1="";}else{$county1=", ".$county1;}if($dist=="STWD"){$dist="STATEWIDE";}else{$county="";}$projName=strtoupper($projName);echo "<tr><td align='center'>$projNumLink</td><td align='center'>$YearFundC</td><td align='center'>$Center</td><td align='center'>$budgCode</td><td align='center'>$comp</td><td align='center'>$proj_man</td><td align='center'>$YearFundF</td><td align='center'>$fullname</td><td align='center'>$dist$county1</td><td>$projName</td>";// 1 Monthly Funds  IN or OUTif($reportMonth){if($projFundOut[$projNum]){$fundOut=$projFundOut[$projNum];}else{$fundOut="";}if($projFundIn[$projNum]){$fundIn=$projFundIn[$projNum];}else{$fundIn="";}if($projFundOut[$projNum]||$projFundIn[$projNum]){$reportMonthFundsTot=$reportMonthFundsTot+($fundIn-$fundOut);$fundInOut=formatMoney($fundIn-$fundOut);}else{$fundInOut="-&nbsp;&nbsp;&nbsp;";}if($fundInOut<0){$f1="<font color='red'>";$f2="</font>";}echo "<td align='right'>$f1$fundInOut$f2</td>";}// 2 Monthly Expenseif($ce){echo "<td align='right'>$amt</td>";}// 3 Total Posted Fundsecho "<td align='right'>$postLink</td>";// 4 Total Posted Expensesecho "<td align='right'>$cumAmount</td>";// 5 Total Ending Balanceecho "<td align='right'>$tb$dif$te</td>";if($startDate=="na"||$startDate=="NA"||$startDate==""){}else{$startDate=substr($startDate,4,2)."/".substr($startDate,6,2)."/".substr($startDate,0,4);$endDate=substr($endDate,4,2)."/".substr($endDate,6,2)."/".substr($endDate,0,4);}echo "<td align='center'>$startDate</td>";echo "<td align='center'>$endDate</td><td align='center'>$statusDC</td><td align='center'>$status</td></tr>";}$difTot=$totalFund-$cumAmountTot;$creditTot=number_format($creditTot,2);$cumAmountTot=number_format($cumAmountTot,2);$difTot=number_format($difTot,2);$ceTot=number_format($ceTot,2);$reportMonthFundsTot=number_format($reportMonthFundsTot,2);$totalFund=number_format($totalFund,2);$total_post_end_bal=$total_post_funds-$total_post_expenses;$total_post_end_bal=number_format($total_post_end_bal,2);$total_post_funds=number_format($total_post_funds,2);$total_post_expenses=number_format($total_post_expenses,2);$start=substr($start,4,2)."/".substr($start,6,2)."/".substr($start,0,4);$end=substr($end,4,2)."/".substr($end,6,2)."/".substr($end,0,4);if($allRecords=="all"){}else{$dm="<tr><td>Posted from $start to $end </td><td align='right'>Funds: <b>$reportMonthFundsTot</b></td><td align='right'>Expenses: <b>$ceTot</b></td></tr>";}echo "</table><div align='center'><table border='1' cellpadding='5'>$dm<tr><td align='right'>(table) Posted thru $end </td><td>Total Funds <b>$totalFund</b></td>";echo "<td>Total Expenses: <b>$cumAmountTot</b></td>";echo "<td>Ending Balance: <b>$difTot</b></td></tr><tr><td align='right'>(display) Posted thru $end </td><td>Total Funds <b>$total_post_funds</b></td>";echo "<td>Total Expenses: <b>$total_post_expenses</b></td>";echo "<td>Ending Balance: <b>$total_post_end_bal</b></td></tr>";echo "</table></div></body></html>";?>