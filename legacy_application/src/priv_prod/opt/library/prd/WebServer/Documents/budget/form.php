<?php//These are placed outside of the webserver directory for security//include("../../include/authBUDGET.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseextract($_REQUEST);// remove once authBUDGET.inc is included/*echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";*///  ************UPDATE Script*************if($submit=="update"){$sql = "UPDATE paymentSET rccID='$rccID',vendorName='$vendorName',vendorID='$vendorID',invoiceDate='$invoiceDate',amount='$amount',ncasID='$ncasID',eproID='$eproID',invoiceID='$invoiceID',comments='$comments',post='$post',seriesID=RPAD(SUBSTRING( ncasid, 1, 1  ),4,'0')WHERE payID='$payID'";//echo "$sql"; exit;$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");if($message=="y"){$m="n";}else{$m="y";}header("Location: form.php?submit=Find&payID=$payID&message=$m");exit;}// end Update//  ************Start SELECT Script*************if($seriesID==""){$sql = "SELECT seriesID,count(payID) as Npayid, sum(amount) as Samount From paymentGROUP by seriesID";$show="";}else{$sql = "SELECT * From paymentWHERE seriesID='$seriesID'ORDER BY ncasid";$show="1";}// This will override previous $sql if $payID is setif($payID){$sql = "SELECT * From paymentWHERE payID='$payID'";$show="0";}//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$num=mysqli_num_rows($result);menuStuff($seriesID,$payID,$num);echo "<hr><table><tr>";if($show==""){echo "<th width='100'>Series</th><th width='100'># Invoices</th><th width='100'>Amount</th>";}if($show=="1"){echo "<th width='50'>RCC</th><th width='75'>NCAS ID</th><th width='75'>Invoice #</th><th width='100'>Invoice Date</th><th width='100'>Amount</th><th width='150'>Vendor ID</th><th width='150'>Vendor Name</th><th width='150'>E Procurement ID</th><th width='50'>Post</th>";}while ($row=mysqli_fetch_array($result)){extract($row);if($show==""){permitShow($seriesID,$Npayid,$Samount);}if($show=="0"){permitShow0($payID,$rccID,$vendorName,$vendorID,$invoiceDate,$amount,$seriesID,$ncasID,$eproID,$invoiceID,$comments,$post,$message);}if($show=="1"){permitShow1($payID,$rccID,$vendorName,$vendorID,$invoiceDate,$amount,$seriesID,$ncasID,$eproID,$invoiceID,$comments,$post);}}// end whileecho "</table></body></html>";// *************** Display Menu FUNCTION **************function menuStuff($seriesID,$payID,$num){include("../../include/parkcodesDiv.inc");$num=number_format($num);if($seriesID!=""){$var1="All Invoices for Series $seriesID";$var2 = "<br><a href='form.php'>Show Series Summary</a>";}else{$var1="Summary of Invoices Grouped by NCAS Series";}if($payID!=""){$var1="Individual Invoice Form";//$var2 = "<br><a href='form.php'>Show Series Summary</a>";}echo "<html><head><title>DPR Budget Database</title><script language='JavaScript'>function confirmLink(){bConfirm=confirm('Are you sure you want to delete this Record?') return (bConfirm);} function popup(mylink, windowname){if (! window.focus)return true;var href;if (typeof(mylink) == 'string')href=mylink;elsehref=mylink.href;window.open(href, windowname, 'width=700,height=450,scrollbars=yes');return false;}</script><STYLE TYPE=\"text/css\"><!--body{font-family:sans-serif;background:beige}td{font-size:90%;background:beige}th{font-size:95%; vertical-align: bottom}--> </STYLE></head><body><font size='4' color='004400'>NC DPR Budget Database</font><br><font size='5' color='blue'>$var1</font>$var2";}// *************** Show Permits FUNCTIONS **************// Invoicesfunction permitShow1($payID,$rccID,$vendorName,$vendorID,$invoiceDate,$amount,$seriesID,$ncasID,$eproID,$invoiceID,$comments,$post){$amount=number_format($amount,2);if($amount<0){$fb="<font color='red'>";$fe="</font>";}else {$fb="";$fe="";}echo "<tr><td align='center'>$rccID</td><td align='center'>$ncasID</td><td align='center'>$invoiceID</td><td align='center'>$invoiceDate</td><td align='right'>$fb $amount $fe</td><td align='center'>$vendorID</td><td align='right'>$vendorName</td><td align='center'>$eproID</td><td align='center'>$post</td><td><a href='form.php?submit=Find&payID=$payID' onClick='return popup(this, \"Edit\")'>View/Edit</a></td></tr>";}// Series Summaryfunction permitShow($seriesID,$Npayid,$Samount){$Samount=number_format($Samount,2);if($Samount<0){$fb="<font color='red'>";$fe="</font>";}else {$fb="";$fe="";}echo "<tr><td align='center'>$seriesID</td><td align='center'>$Npayid</td><td align='right'>$fb $Samount $fe</td><td>&nbsp;</td><td><a href='form.php?submit=Find&seriesID=$seriesID'>View/Edit</a></td></tr>";}// Individual Invoicefunction permitShow0($payID,$rccID,$vendorName,$vendorID,$invoiceDate,$amount,$seriesID,$ncasID,$eproID,$invoiceID,$comments,$post,$message){if($message=="y"){echo "<font color='red'>Update Successful</font>";}if($message=="n"){echo "<font color='green'>Update Successful</font>";}$Samount=number_format($Samount,2);if($Samount<0){$fb="<font color='red'>";$fe="</font>";}else {$fb="";$fe="";}echo "<form method='post' action='form.php'><tr><td>RCC <input type='text' name='rccID' size='6' value='$rccID'></td><td>NCAS ID <input type='text' name='ncasID' size='20' value='$ncasID'></td><td>INVOICE ID <input type='text' name='invoiceID' size='20' value='$invoiceID'></td></tr></table><table><tr><td>INVOICE DATE <input type='text' name='invoiceDate' size='16' value='$invoiceDate'></td><td>AMOUNT <input type='text' name='amount' size='16' value='$amount'></td></tr></table><table><tr><td>VENDOR ID <input type='text' name='vendorID' size='16' value='$vendorID'></td><td>VENDOR NAME <input type='text' name='vendorName' size='26' value='$vendorName'></td></tr></table><table><tr><td>E PROCUREMENT <input type='text' name='eproID' size='26' value='$eproID'></td>";if($post =="y"){$checky="checked";}else{$checkn="checked";}echo"<td>POSTED?</td><td><input type='radio' name='post' value='y' $checky>Yes</td><td><input type='radio' name='post' value='n' $checkn>No</td></tr></table><table><tr><td>COMMENTS:</td></tr><tr><td><textarea name='comments' cols='80' rows='7'>$comments</textarea></td></tr><tr><input type='hidden' name='payID' value='$payID'><input type='hidden' name='message' value='$message'><td><input type='submit' name='submit' value='update' ></td></tr></form>";}?>