<?php//These are placed outside of the webserver directory for security//include("../../include/authBUDGET.inc"); // used to authenticate usersinclude("../../include/connectBUDGET.inc");// database connection parametersinclude("menu.php");//print_r($_REQUEST);//exit;extract($_REQUEST);$formType="Add Item"; // default valueif($submit=="Find"){$from="item as val1,status as val2,comment as val3,priority as val4,ttdid FROM ttd";$where=" WHERE 1";if($item!=""){$where.=" and item LIKE '%$item%'";}if($status!=""){$where.=" and status='$status'";}if($comment!=""){$where.=" and comment LIKE '%$comment%'";}if($priority!=""){$where.=" and priority = '$priority'";}$sql1 = "SELECT $from $where";$result = mysqli_query($connection, $sql1) or die ("Couldn't execute query 1. $sql1");while ($row=mysqli_fetch_array($result)){extract($row);}}if($edit!=""){$formType="Update";$from="item as val1,status as val2,comment as val3,priority as val4,ttdid From ttd";$where=" WHERE ttdid=$edit";$sql1 = "SELECT $from $where";$result = mysqli_query($connection, $sql1) or die ("Couldn't execute query 1. $sql1");while ($row=mysqli_fetch_array($result)){extract($row);}}if($addItem=="Update"){$formType="Update";$where=" WHERE ttdid=$ttdid";//$item=addslashes($item); // don't add any since $item already has them$query="UPDATE ttd set item='$item',status='$status',comment='$comment',priority='$priority' $where";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query 3. $query");//$xtid=mysql_insert_id();header("Location: ttd.php");exit;}// *********** Display ************echo "<form action='ttd.php'><hr>DPR Accounting Program: <font color='teal'><b>Things To Do</b></font><hr><table><tr><td>Item:<br><textarea name='item' cols=80 rows=10>$val1</textarea></td>";$statusA=array("New Item","In Progress","Completed","On Hold","Modified","Other...");echo "<td>Select Status:<br><form><select name=\"status\"><option selected></option>";for ($n=0;$n<count($statusA);$n++){$con=$statusA[$n];if($val2==$con){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$statusA[$n]\n";       }   echo "</select></td>";   echo "</tr><tr><td>Comment:<br><textarea name='comment' cols=80 rows=5>$val3</textarea></td>";$priorityA=array("Low","Medium","High","Critical");echo "<td>Select Priority:<br><form><select name=\"priority\"><option selected></option>";for ($n=0;$n<count($priorityA);$n++){$con=$priorityA[$n];if($val4==$con){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$priorityA[$n]\n";       }   echo "</select></td>";   echo "</tr><tr><td align='center'><input type='hidden' name='ttdid' value='$ttdid'><input type='submit' name='addItem' value='$formType'></form</td><td><input type='submit' name='submit' value='Find'></form></td><td> <form action='ttd.php'><input type='submit' name='reset' value='Reset'></form</td>  </tr></table>";  // ***** Pick display function and set sql statement$co=count($_REQUEST); //print_r($_REQUEST);//echo "c=$co";exit;$from="ttd.* From ttd";//if($co>0){$where=" WHERE 1";//}else{exit;}if($item!=""){$item=addslashes($item);$where.=" and item LIKE '%$item%'";}if($status!=""){$where.=" and status='$status'";}//if($where==" WHERE 1"){exit;}if($submit==""){$from="item as val1,status as val2,comment as val3,priority as val4,ttdid From ttd";$sql1 = "SELECT $from $where order by dateMod DESC";}//echo "$sql1<br>";//exit;if($sql1){echo "<hr><table border='1' cellpadding='2'><tr><th>Item Number</th><th>Item Description</th><th>Comment</th><th>Status</th><th>Priority</th></tr>";$result = mysqli_query($connection, $sql1) or die ("Couldn't execute query 2. $sql1");$num=mysqli_num_rows($result);$z=$num;while ($row=mysqli_fetch_array($result)){extract($row);$link="<a href='ttd.php?edit=$ttdid'>$z</a";if($val1){$item=$val1; $val1="";}if($val2){$status=$val2; $val2="";}if($val3){$comment=$val3; $val3="";}if($val4){$priority=$val4; $val4="";}$item=substr($item, 0, 70);$comment=substr($comment, 0, 20);if($status=="Completed"){$f1="<font color='green'>";}else{$f1="<font color='black'>";}$f2="</font>";switch($priority){case "Critical":$fs1="<font color='red'>";break;case "High":$fs1="<font color='blue'>";break;case "Low":$fs1="<font color='orange'>";break;}echo "<tr><td align='center'>$link</td><td>$item</td><td>$comment</td><td align='center'>$f1$status$f2</td><td align='center'>$fs1$priority$f2</td>";$z--;$fs1="";$f1="";$f2="";}// end whileecho "</table></body></html>";// ********** Add Item ************// Add Recordif($addItem=="Add Item"){//$item=addslashes($item); // don't add any since $item already has them$query="INSERT ttd set item='$item',status='$status',comment='$comment',priority='$priority'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query 3. $query");//$xtid=mysql_insert_id();header("Location: ttd.php");exit;}}?>