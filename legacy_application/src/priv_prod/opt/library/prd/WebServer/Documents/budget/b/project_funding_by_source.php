<?php$dbTable="partf_payments";$file="project_funding_by_source.php";$fileMenu="project_funding_by_source_menu.php";include("$fileMenu");extract($_REQUEST);//print_r($_REQUEST);exit;/*// ******** Show Record to Edit ***********if($e==1){// FIELD NAMES are stored in $fieldArray$fieldName=array("trans_type","proj_out","fund_out","proj_in", "fund_in", "amount", "post_date", "comments", "partf_fund_id", "fundsin", "fundsout", "netfunds");echo "<table border='1' cellpadding='3' align='center'>";echo "<tr>";for($i=0;$i<count($fieldName);$i++){$fn=str_replace('_','<br>',$fieldName[$i]);echo "<th>$fn</th>";}echo "</tr>";$sql = " SELECT proj_num, partf_payments.center, account, datepost, checknum, invoice, amount, vendornum, groupnum, vendorname, contract_num, contract_amt, datenew, pcard_name, pcard_vendor, pcard_descr, purch_descr_input, projName,project_parkcode, xtid FROM `partf_payments` WHERE 1 AND `proj_num`='$proj_num' ORDER BY `datenew` DESC ";// echo "$sql";    $result = mysqli_query($connection, $sql) or die ("Couldn't execute query 3. $sql");while($row = mysqli_fetch_array($result)){extract($row);$total=$total+$amount;$noncon_amt=$amount-$contract_amt;$total_contract_amt=$total_contract_amt+$contract_amt;$total_noncon_amt=$total_noncon_amt+$noncon_amt;$amount=number_format($amount,2);$contract_amt=number_format($contract_amt,2);$noncon_amt=number_format($noncon_amt,2);echo "<tr><td>$proj_num</td><td>$center</td><td>$account</td><td>$datepost</td><td>$checknum</td><td>$invoice</td><td align='right'>$amount</td><td>$vendornum</td><td align='center'>$groupnum</td><td>$vendorname</td><td>$contract_num</td><td align='right'>$contract_amt</td><td align='right'>$noncon_amt</td><td>$datenew</td><td>$pcard_name</td><td>$pcard_vendor</td><td>$pcard_descr</td><td>$purch_descr_input</td><td>$xtid</td></tr>";}// end while$total=number_format($total,2);$total_contract_amt=number_format($total_contract_amt,2);$total_noncon_amt=number_format($total_noncon_amt,2);echo "<tr><td colspan='7' align='right'><b>$total</b></td><td colspan='5' align='right'><b>$total_contract_amt</b></td><td align='right'><b>$total_noncon_amt</b></td><td colspan='5'>&nbsp;</td></tr>";echo "<font color='purple'>$projName @ $project_parkcode</font> Total: $total</table>";exit;}*/// ******** Show Results ***********// FIELD NAMES are stored in $fieldArray// FIELD TYPES and SIZES are stored in $fieldType$fieldName=array("trans_type","proj_out","fund_out","proj_in", "fund_in", "amount", "post_date", "comments", "partf_fund_id", "fundsin", "fundsout", "netfunds");//print_r($fieldName);exit;if($dateStart!=""){echo "<table border='1' cellpadding='3' align='center'><tr>";for($i=0;$i<count($fieldName);$i++){echo "<th>$fieldName[$i]</th>";}echo "</tr>";$query="TRUNCATE  TABLE cid_yearly_project_funding";    $result = @mysqli_query($connection, $query,$connection);$query="INSERT  INTO cid_yearly_project_funding( trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, partf_fund_id ) SELECT trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, fidFROM partf_fund_transWHERE datenew >=  '$dateStart' AND datenew <=  '$dateEnd'GROUP  BY fidORDER  BY trans_type";    $result = @mysqli_query($connection, $query,$connection);$query="INSERT  INTO cid_yearly_project_funding( trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, partf_fund_id, fund_in_amount, fund_out_amount ) SELECT trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, fid,  '', sum( amount ) FROM partf_fund_transWHERE datenew >=  '$dateStart' AND datenew <=  '$dateEnd' AND fund_out !=  ''GROUP  BY fidORDER  BY trans_type";    $result = @mysqli_query($connection, $query,$connection);$query="INSERT  INTO cid_yearly_project_funding( trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, partf_fund_id, fund_in_amount, fund_out_amount ) SELECT trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, fid, sum( amount ) ,  ''FROM partf_fund_transWHERE datenew >=  '$dateStart' AND datenew <=  '$dateEnd' AND fund_in !=  ''GROUP  BY fidORDER  BY trans_type";    $result = @mysqli_query($connection, $query,$connection);$query="SELECT trans_type, proj_out, fund_out, proj_in, fund_in, amount, post_date, comments, partf_fund_id, sum( fund_in_amount )  AS  'fundsin', sum( fund_out_amount )  AS  'fundsout', sum( fund_in_amount - fund_out_amount )  AS  'netfunds'FROM cid_yearly_project_fundingWHERE 1 GROUP  BY partf_fund_idORDER  BY trans_type"; echo "$query";    $result = @mysqli_query($connection, $query,$connection);// ******* Numeric field array ************$numArray=array("amount","fundsin", "fundsout", "netfunds");$count=count($fieldName);$j=0;while($row = mysqli_fetch_array($result)){extract($row);$prevTT[$j]=$trans_type;// ********* Sub Totals **************if($check!=$trans_type){$k=$j-1;$TT=$prevTT[$k];$fundsinSubTot=number_format($fundsinSubTot,2);$fundsoutSubTot=number_format($fundsoutSubTot,2);$netfundsSubTot=number_format($netfundsSubTot,2);echo "<tr><td colspan='10' align='right'><b>$check Total: $fundsinSubTot</b></td><td align='right'><b>$fundsoutSubTot</b></td><td align='right'><b>$netfundsSubTot</b></td></tr>";$fundsinSubTot="";$fundsoutSubTot="";$netfundsSubTot=""; $j++;} 	for($i=0;$i<$count;$i++){$t=$row[$i];$vk=$fieldName[$i];if($vk=="trans_type"){$check=$t;}if($i==0){echo "<tr>";}if($fieldName[$i]=="fundsin"){$fundsinTotal=$fundsinTotal+$t;}if($fieldName[$i]=="fundsout"){$fundsoutTotal=$fundsoutTotal+$t;}if($fieldName[$i]=="netfunds"){$netfundsTotal=$netfundsTotal+$t;}if($fieldName[$i]=="fundsin"){$fundsinSubTot=$fundsinSubTot+$t;}if($fieldName[$i]=="fundsout"){$fundsoutSubTot=$fundsoutSubTot+$t;}if($fieldName[$i]=="netfunds"){$netfundsSubTot=$netfundsSubTot+$t;}if(in_array($vk,$numArray)){$tn=number_format($t,2);$tf="<td align='right'>$tn</td>";}else{$tf="<td>$t</td>";}echo "$tf";if($i==$count){echo "</tr>";}	}// end for}// end while// ********* Final Sub Totals **************$fundsinSubTot=number_format($fundsinSubTot,2);$fundsoutSubTot=number_format($fundsoutSubTot,2);$netfundsSubTot=number_format($netfundsSubTot,2);echo "<tr><td colspan='10' align='right'><b>$check Total: $fundsinSubTot</b></td><td align='right'><b>$fundsoutSubTot</b></td><td align='right'><b>$netfundsSubTot</b></td></tr>"; $fundsinTotal=number_format($fundsinTotal,2);$fundsoutTotal=number_format($fundsoutTotal,2);$netfundsTotal=number_format($netfundsTotal,2);echo "<tr><td colspan='10' align='right'>Grand Totals: <b>$fundsinTotal</b></td><td align='right'><b>$fundsoutTotal</b></td><td align='right'><b>$netfundsTotal</b></td></tr></table>";}// end ifecho "</div></body></html>";?>