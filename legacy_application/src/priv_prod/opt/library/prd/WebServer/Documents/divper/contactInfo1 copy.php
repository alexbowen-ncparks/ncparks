<?php//These are placed outside of the webserver directory for securityinclude("../../include/authDIVPER.inc"); // used to authenticate usersinclude("../../include/connectDIVPER.inc"); // database connection parameters//echo "<pre>";print_r($_SESSION);echo "</pre>";//print_r($_REQUEST);//exit;$logemid=$_SESSION['logemid'];$positionTitle=$_SESSION['position'];$divperLevel=$_SESSION['divper']['level'];/*$sql = "SELECT * From dpr_sections order by order_by"; $result = mysql_query($sql) or die ("Couldn't execute query2. $sql");while($row=mysql_fetch_array($result)){$full_name[$row['code']]=$row['name'];}//print_r($full_name);exit;*/$sql = "SELECT date_format(max(updateOn),'%b %D, %Y @ %r') as maxDate From empinfo";$result1 = mysql_query($sql) or die ("Couldn't execute query2. $sql");$row1=mysql_fetch_array($result1);extract($row1);echo "<html><head><STYLE TYPE=\"text/css\"><!--td{font-size:70%; vertical-align: top}th{font-size:80%; vertical-align: bottom}--> </STYLE></head><body>";IF($divperLevel>4){$addFld=", empinfo.Mphone"; $addHeader="<th>Mobile</th>";}$sql = "SELECT dpr_sections.name,position.working_title as title,empinfo.Fname, empinfo.Nname, empinfo.Lname,position.toggle,position.beacon_num,empinfo.phone $addFld , empinfo.emailFrom position LEFT JOIN emplist on position.beacon_num=emplist.beacon_numLEFT JOIN empinfo on empinfo.emid=emplist.emidLEFT JOIN dpr_sections on dpr_sections.code=position.codeWHERE position.beacon_num!=''order by position.o_chart,empinfo.Lname";$result = mysql_query($sql) or die ("Couldn't execute query. $sql");$num=mysql_num_rows($result);//echo "$sql"; exit;while ($row=mysql_fetch_assoc($result)){$a[$row['beacon_num']]=$row;}//echo "<pre>";print_r($a);echo "</pre>";exit;$header="<tr><th>&nbsp;</th><th>Section</th><th>Section Lead</th><th>First Name</th><th>Last Name</th><th>Title</th><th>BEACON</th><th>Work</th>$addHeader<th>Email</th></tr>";if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=DPR_Position_Report.xls');echo"<table>";foreach($a as $key=>$val){echo "<tr><td></td>";foreach($val as $k=>$v){$value=$v;if($k=="Fname" and $v==""){$value="VACANT";}if($k=="Fname" and $a[$key][Nname]!=""){$value=$a[$key]['Nname'];}if($k=="toggle"){if($pass!=""){$value=$a[$key]['title'];}else{$value="";}}if($k=="Nname"){continue;}if($k=="name"){$f1="<b>";$f2="</b>";$checkSub=$a[$key]['name'];}echo "<td>$value</td>";}echo "</tr>";}exit;}echo "<table width='600'><tr><td>$type listing for $num DPR employees</td><td align='center'><A HREF=\"javascript:window.print()\"><IMG SRC=\"../bar_icon_print_2.gif\" BORDER=\"0\"</A></td><td align='right'>Updated on: $maxDate</td><td><a href='contactInfo1.php?rep=excel'>Excel</a></td></tr></table><hr><table>$header";foreach($a as $key=>$val){if($bgc){$bgc="";}else{$bgc=" bgcolor=\"#f5f5f5\"";}echo "<tr$bgc><td bgcolor=\"#FFFFFF\"></td>";$pass="";foreach($val as $k=>$v){$f1="";$f2="";$value=$v;if($k=="title"){if($a[$key]['toggle']!="x"){$pass=1;echo "<td>&nbsp;</td>";continue;}}if($k=="name"){if($a[$key]['name']==$checkSub){$value="";}else {$value=$a[$key]['name'];}}if($k=="Fname" and $v==""){$value="VACANT";}if($k=="Fname" and $a[$key][Nname]!=""){$value=$a[$key]['Nname'];}if($k=="toggle"){if($pass!=""){$value=$a[$key]['title'];}else{$value="";}}if($k=="Nname"){continue;}if($k=="name"){$f1="<b>";$f2="</b>";$checkSub=$a[$key]['name'];}if(($k=="Fname" OR $k=="Lname") & $pass==""){$f1="<b>";$f2="</b>";}if($k=="phone" OR $k=="Mphone"){$cleanPhone=str_replace('(','',$value);		$cleanPhone=str_replace(') ','-',$cleanPhone);		$cleanPhone=str_replace(')','-',$cleanPhone);		$cleanPhone=str_replace('.','-',$cleanPhone);		$cleanPhone=str_replace(' ','-',$cleanPhone);		$cleanPhone=str_replace('/','-',$cleanPhone);		$value=substr($cleanPhone,0,12);		if($k=="phone"){$f1="<b>";$f2="</b>";}		}		echo "<td>$f1$value$f2</td>";}echo "</tr>";}// end foreach?>