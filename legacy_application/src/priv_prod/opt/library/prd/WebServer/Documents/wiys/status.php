<?php include("../../include/authWIYS.inc");include_once("../../include/parkcodesDiv.inc");// $e=code for an update error,  $u=code to return values after update/*echo "<pre>";print_r($_REQUEST);print_r($_SESSION);echo "</pre>";EXIT;*/if($sel){$_SESSION[wiys][select]=$sel;}// ************* After Update **********if($u==1){if($statusUpdate==""){$statusUpdate="1";}$Fname=$_SESSION[wiys][first];$Lname=$_SESSION[wiys][last];$tempID=$_SESSION[wiys][tempID];include("../../include/connectWIYS.inc");$sql = "select * from status where empID='$tempID'";//echo "$sql";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($statusInOut=="i"){$cIN="checked";}if($statusInOut=="u"){$cINU="checked";}if($statusInOut=="o"){$cOUT="checked";}if($statusInOut=="b"){$cBACK="checked";}if($statusInOut=="n"){$cBUS="checked";}if($statusInOut=="t"){$cTRIP="checked";}if($statusInOut=="l"){$cLEAV="checked";}if($statusInOut=="c"){$cCUS="checked";}// ************* Update Problem **************if($e!=""){if($e=="0"){$message="<tr><td><font color='blue' size=+1>You failed to specify the period of unavailability. Please correct.</font></td></tr>";$cINU="checked";}if($e=="1"){$message="<tr><td><font color='blue' size=+1>You failed to indicate your return time. Please correct.</font></td></tr>";$cBACK="checked";$cOUT="";}}// end if eheaderStatusStuff($message);echo "<table><tr><td><input type='radio' name='status[]' value='i' $cIN><font color='green'>IN</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='u' $cINU><font color='green'>IN but unavailable from:</font></td><td><input type='text' size='30' name='status1[]' value='$statusUnavail'></td>";/*<td><a href='itinerary.php?tempID=$tempID&v=1'>Submit</a> Your Weekly Itinerary</td>*/echo "</tr><table><table><tr><td><input type='radio' name='status[]' value='o' $cOUT><font color='red'>OUT</font>&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='b' $cBACK><font color='red'>Back at: </font><input type='text' size='20' name='status1[]' value='$statusBack'></td><td><input type='radio' name='status[]' value='n' $cBUS><font color='red'>On business at: </font><input type='text' size='20' name='status1[]' value='$statusBus'></td></tr><tr><td> </td><td><input type='radio' name='status[]' value='t' $cTRIP><font color='red'>On trip until: </font><input type='text' size='20' name='status1[]' value='$statusTrip'></td><td><input type='radio' name='status[]' value='l' $cLEAV><font color='red'>On leave from: </font><input type='text' size='20' name='status1[]' value='$statusLeave'></td><td><input type='radio' name='status[]' value='c' $cCUS><font color='red'>Custom Message: </font><input type='text' size='30' name='status1[]' value='$statusCus'></td></tr>";//echo "<a href='status.php?tempID=$tempID' name='mainFrame'>test</a>";statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate);}// ************* Before Update *************if($u==""){if($return!="x"){$Fname=$_SESSION[wiys][first];$Lname=$_SESSION[wiys][last];}//print_r($_SESSION);//print_r($_REQUEST);exit;include_once("../../include/connectWIYS.inc");$sql = "select * from status where empID='$tempID'";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);extract($row);if($statusInOut=="i"){$cIN="checked";}if($statusInOut=="u"){$cINU="checked";}if($statusInOut=="o"){$cOUT="checked";}if($statusInOut=="b"){$cBACK="checked";}if($statusInOut=="n"){$cBUS="checked";}if($statusInOut=="t"){$cTRIP="checked";}if($statusInOut=="l"){$cLEAV="checked";}if($statusInOut=="c"){$cCUS="checked";}if($statusInOut==""){$cOUT="checked";}headerStatusStuff($message);echo "<table><tr><td><input type='radio' name='status[]' value='i' $cIN><font color='green'>IN</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='u' $cINU><font color='green'>IN but unavailable from:</font></td><td><input type='text' size='30' name='status1[]' value='$statusUnavail'></td>";/*<td><a href='itinerary.php?tempID=$tempID&v=1'>Submit</a> Your Weekly Itinerary</td>*/echo "</tr><table><table><tr><td><input type='radio' name='status[]' value='o' $cOUT><font color='red'>OUT</font>&nbsp;&nbsp;</td><td><input type='radio' name='status[]' value='b' $cBACK><font color='red'>Back at: </font><input type='text' size='20' name='status1[]' value='$statusBack'></td><td><input type='radio' name='status[]' value='n' $cBUS><font color='red'>On business at: </font><input type='text' size='20' name='status1[]' value='$statusBus'></td></tr><tr><td> </td><td><input type='radio' name='status[]' value='t' $cTRIP><font color='red'>On trip until: </font><input type='text' size='20' name='status1[]' value='$statusTrip'></td><td><input type='radio' name='status[]' value='l' $cLEAV><font color='red'>On leave from: </font><input type='text' size='20' name='status1[]' value='$statusLeave'></td><td><input type='radio' name='status[]' value='c' $cCUS><font color='red'>Custom Message: </font><input type='text' size='30' name='status1[]' value='$statusCus'></td></tr>";statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate);}// **************************************************************/* echo "<pre>";print_r($_REQUEST);echo "</pre>";echo "<pre>";print_r($_SESSION);echo "</pre>";//echo "<pre>";print_r($parkCode);echo "</pre>";//EXIT;*///These are placed outside of the webserver directory for security//include("../../include/authWIYS.inc");include("../../include/connectDIVPER.62.inc");if($sel==""){$sel=$_SESSION[wiys][select];$select="where emplist.currpark = '$sel'";$order=" ORDER BY emplist.Lname";}if(in_array($sel,$parkCode)){//echo "$sel";exit;$select="where emplist.currpark = '$sel'";$order=" ORDER BY emplist.Lname";}if($sel=="pasu"){$join2="LEFT JOIN position on position.posNum=emplist.posNum";$select="where position.posTitle LIKE '%Park Superintendent%'";$order=" ORDER BY emplist.currPark";}if($sel=="disu"){$join2="LEFT JOIN position on position.posNum=emplist.posNum";$select="where position.posTitle LIKE '%District Superintendent%'";$order=" ORDER BY emplist.currPark";}if($sel=="arch"||$sel=="york"){$select="where emplist.currpark = '$sel'";$order=" ORDER BY emplist.Lname";}if($sel=="eadi"||$sel=="nodi"||$sel=="sodi"||$sel=="wedi"){$select="where emplist.currpark = '$sel'";$order=" ORDER BY emplist.Lname";}if($sel=="EADI"||$sel=="NODI"||$sel=="SODI"||$sel=="WEDI"){include_once("../../include/parkcodesDiv.inc");$distArray=${"array".$sel};// MAKE DIST variable $arrayXXXX$distArray[]=$sel;// add the DIST Office to district arraywhile (list($key,$val)=each($distArray)){$parkList=$parkList.",".$val;}$select="where FIND_IN_SET(emplist.currpark,'$parkList') AND emplist.currpark!=''";$order=" ORDER BY emplist.currpark";}if($sel || $tempID){$sql = "select emplist.currPark,empinfo.Nname,empinfo.Fname,empinfo.Lname, empinfo.tempID from empinfoLEFT JOIN emplist on emplist.tempID=empinfo.tempID$join2$select $order";//echo "$sql"; exit;$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());while($row=MYSQL_FETCH_ARRAY($result)){extract($row);$arrayTempID[]=$tempID;if($Nname){$Fname=$Nname;}$arrayPark[]=$currPark;$arrayName[]=$currPark."-".$Fname." ".$Lname;										}		}		$size="70%";$testPark=strtoupper($_SESSION[wiys][parkS]);headerStuffstatus($size);echo "<table border='1' cellpadding='5'><tr><th>Employee</th><th>Status</th><th>Last Update:</th><th>Itinerary</th></tr><tr>";if($arrayTempID){$today=date(d);include("../../include/connectWIYS.inc");for($i=0;$i<count($arrayTempID);$i++){$sql = "select * from status where empID ='$arrayTempID[$i]'";//echo "$sql";//exit;//if($i==count($arrayTempID)-1){echo "$sql";exit;}//if($arrayTempID[$i]=="Mitchell9781"){echo "$sql";exit;}$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$row=MYSQL_FETCH_ARRAY($result);$num=mysql_num_rows($result);extract($row);$day=substr($statusMod,6,2);$month=substr($statusMod,4,2);$year=substr($statusMod,0,4);$hour=substr($statusMod,8,2);$min=substr($statusMod,10,2);$sec=substr($statusMod,12,2);$v="&loc=$arrayPark[$i]&return=x";$dateMod="<td>".date("D, M j, Y @ H:i:s T", mktime($hour, $min, $sec, $month, $day, $year))."</td><td align='center'><a href='itinerary.php?tempID=$arrayTempID[$i]$v'>View</a></td>$c";if($year<date("Y")){$dateMod="";}// ******** reset status to OUT after today for any IN **********if(($statusInOut == "u" || $statusInOut=="i") AND $day!=$today){$statusInOut="o"; $query = "REPLACE status SET statusInOut='o',statusUnavail='',statusCus='',statusBack='',statusBus='' ,statusTrip='',statusLeave='',empID='$arrayTempID[$i]'";$result = mysql_query($query) or die ("Couldn't execute query. $query");}if($statusInOut=="i"||$statusInOut=="u"){$a="<font color='green'>IN</font>";}if($statusInOut=="o"){$a="<font color='red'>OUT</font>";}if($statusUnavail){$b="  [not available from: ".$statusUnavail."]";}else{$b="";}if($statusBack){$a="<font color='red'>OUT</font>";$c="  [Will return at: ".$statusBack."]";}else{$c="";}if($statusBus){$a="<font color='red'>OUT</font>";$d="  [On business at: ".$statusBus."]";}else{$d="";}if($statusTrip){$a="<font color='red'>OUT</font>";$e="  [On trip until: ".$statusTrip."]";}else{$e="";}if($statusLeave){$a="<font color='red'>OUT</font>";$f="  [On leave from: ".$statusLeave."]";}else{$f="";}if($statusCus){$a="<font color='red'>OUT</font>";$g="  [Message: ".$statusCus."]";}else{$g="";}if($num<1){$a="";$b="";$c="";$d="";$e="";$f="";$g="";$dateMod="";}echo "<tr><td>$arrayName[$i]</td><td align='center'>$a$b$c$d$e$f$g</td>$dateMod</tr>";$a="";$dateMod="";$statusCus="";$statusMod="";$statusInOut="";$statusUnavail="";$statusBack="";$statusBus="";$statusTrip="";$statusLeave="";}// end for $arrayTempID}// end if $arrayTempIDecho "</table></body></html>";// ************* FUNCTIONS ********function headerStuffstatus($size) {echo "<html><head><meta http-equiv=\"Cache-Control\" content=\"no-cache\"><meta http-equiv=\"Pragma\" content=\"no-cache\"> <TITLE> Status </TITLE><STYLE TYPE=\"text/css\"><!--body{font-family:sans-serif;background:beige}td{font-size:$size;background:beige}th{font-size:95%; vertical-align: bottom}--> </STYLE><script language=\"JavaScript\"><!--function MM_jumpMenu(targ,selObj,restore){ //v3.0  eval(targ+\".location='\"+selObj.options[selObj.selectedIndex].value+\"'\");  if (restore) selObj.selectedIndex=0;}function confirmLink(){ bConfirm=confirm('Are you sure you want to delete this record?') return (bConfirm);}//--></script></head><body><table border='1' cellpadding='5'><tr><td align='center'><a href='status.php?sel=arch'>ARCH</a>&nbsp;&nbsp;<a href='status.php?sel=york'>YORK</a></td><td align='center'><a href='status.php?sel=disu'>DISU</a>&nbsp;&nbsp;<a href='status.php?sel=pasu'>PASU</a>&nbsp;&nbsp;<td align='center' width='200'><a href='status.php?sel=eadi'>EADO</a>&nbsp;&nbsp;<a href='status.php?sel=nodi'>NODO</a>&nbsp;&nbsp;<a href='status.php?sel=sodi'>SODO</a>&nbsp;&nbsp;<a href='status.php?sel=wedi'>WEDO</a></td><td align='center' width='200'><a href='status.php?sel=EADI'>EADI</a>&nbsp;&nbsp;<a href='status.php?sel=NODI'>NODI</a>&nbsp;&nbsp;<a href='status.php?sel=SODI'>SODI</a>&nbsp;&nbsp;<a href='status.php?sel=WEDI'>WEDI</a></td><td><form>Pick a  <select name=\"park\" onChange=\"MM_jumpMenu('parent',this,0)\"><option selected>Park</option>";include("../../include/parkcodesDiv.inc");for ($n=1;$n<count($parkCode);$n++){$scode=$parkCode[$n];$s="value";if($scode==$park){$s="selected";}		echo "<option $s='status.php?sel=$scode'>$scode\n";       }   echo "</select></form></td></tr></table>";}function headerStatusStuff($message) {echo "<html><head><META HTTP-EQUIV=\"CACHE-CONTROL\" CONTENT=\"NO-CACHE\"><title>Status</title><STYLE TYPE=\"text/css\"><!--body{font-family:sans-serif;background:beige}td{font-size:80%;background:beige}th{font-size:95%; vertical-align: bottom}--> </STYLE></head><body><hr><table>";if($message){echo "$message";}echo "</table><form name='statusForm' method='post' action='update.php'>";}function statusLine($Fname,$Lname,$statusMod,$tempID,$statusUpdate){if($statusUpdate!=""){if($statusUpdate=="1"){$statusUpdate="0";$fs="Updated";$fb="<font color='purple'>";$fe="</font>";}else{$statusUpdate="1";$fb="<font color='green'>";$fe="</font>";$fs="Updated Again";}}else{$fs="";}$date=date("l, F d, Y");$day=substr($statusMod,6,2);$month=substr($statusMod,4,2);$year=substr($statusMod,0,4);$hour=substr($statusMod,8,2);$min=substr($statusMod,10,2);$sec=substr($statusMod,12,2);echo "</table><table><tr><td>Today is: $date</td><td width='150' align='center'><input type='hidden' name='statusUpdate' value='$statusUpdate'><input type='hidden' name='tempID' value='$tempID'><input type='submit' name='Submit' value='Update'></td><td width='300'>Status for: <font color='blue' size=+1>$Fname $Lname</font> $fb &nbsp;&nbsp;$fs $fe</td><td>Last Update: ".date("l, F d, Y @ H:i:s T", mktime($hour, $min, $sec, $month, $day, $year))."</td></tr></form></table><hr></body></html>";}?>