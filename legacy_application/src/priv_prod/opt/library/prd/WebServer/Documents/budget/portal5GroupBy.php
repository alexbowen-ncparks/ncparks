<?php//These are placed outside of the webserver directory for security//include("../../include/authEEID.inc"); // used to authenticate users$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("menu.php");?><script language='JavaScript'>function confirmLink(){ bConfirm=confirm('Are you sure you want to delete this record?') return (bConfirm);}</script><?php//echo "<pre>";print_r($_REQUEST);echo "</pre>";//exit;print_r($_REQUEST);//exit;extract($_REQUEST);//********** SET Variables **********$dbName="budget";// DATABASE NAME//$dbTable="table name";// TABLE NAME should be passed from URL// FIELD NAMES are stored in $fieldArray$sql = "SHOW COLUMNS FROM $dbTable";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");while ($row=mysqli_fetch_assoc($result)){extract($row);$fieldArray[]=$row[Field];}makeUpdateFields($fieldArray);// MAKE FIELD=VALUE FOR ADD/UPDATE//echo "$updateFields";exit;//print_r($_REQUEST);exit;//**** Process any Update ******if($deleteRecord=="Delete"){//print_r($_REQUEST);exit;$query = "DELETE FROM $dbTable where $idTable='$recordNum'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Delete. $query");header("Location: portal.php?passSQL=$passSQL");exit;}//**** Process any Update ******if($submit=="Update"){//print_r($_REQUEST);exit;$query = "Update $dbTable set $updateFieldswhere $idTable='$recordNum'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Update. $query");header("Location: portal.php?passSQL=$passSQL");exit;}//**** Prepare To Find, Update OR Delete******if($pcardid){//print_r($_REQUEST);exit;$formType="Update";$passSQLedit=urlencode($passSQL);$addDeleteButton="<td><form><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='recordNum' value='$eeidFld'><input type='submit' name='deleteRecord' value='Delete' onClick='return confirmLink()'></form></td>";$sql0 = "SELECT * from $dbTable where pcardid='$pcardid'";$result = mysqli_query($connection, $sql0) or die ("Couldn't execute query 0. $sql0");$row=mysqli_fetch_array($result);extract($row);}else{$formType="Find";}//if($cat1_4){$catCheck="checked";}$newCKBX=array_unique($ckbx);sort($newCKBX);print_r($newCKBX);//EXIT;$caseField1=$newCKBX[0];$caseField2=$newCKBX[1];$caseField3=$newCKBX[2];$caseField4=$newCKBX[3];$caseField5=$newCKBX[4];switch ($groupBy1) {		case "$caseField1":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va1 = "checked";			break;			case "$caseField2":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va2="checked";			break;			case "$caseField3":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va3 ="checked";			break;			case "$caseField4":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va4 ="checked";			break;			case "$caseField5":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va5 ="checked";			break;		}switch ($groupBy2) {		case "$caseField1":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb1 = "checked";			break;			case "$caseField2":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb2="checked";			break;			case "$caseField3":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb3 ="checked";			break;			case "$caseField4":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb4 ="checked";			break;			case "$caseField5":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb5 ="checked";			break;		}switch ($groupBy3) {		case "$caseField1":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc1 = "checked";			break;			case "$caseField2":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc2="checked";			break;			case "$caseField3":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc3 ="checked";			break;			case "$caseField4":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc4 ="checked";			break;			case "$caseField5":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc5 ="checked";			break;		}echo "<form action='portal.php' method='post'>";//echo "<form action='portal.php'";// Used to debugecho "<table><tr><td>$fieldArray[0]:<input type='text' name='$fieldArray[0]' size='6' value='${$fieldArray[0]}'></td></tr><tr><td>$fieldArray[1]: <input type='text' name='$fieldArray[1]' size='20' value='${$fieldArray[1]}'></td>";// lastname//$ageMenu=array("Adult","Public","Youth");/*echo "<td>Audience: <select name=\"age\"><option selected></option>";for ($n=0;$n<count($ageMenu);$n++){$con=$ageMenu[$n];if($con==$age){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$ageMenu[$n]\n";       }   echo "</select></td>";*/echo "<td>$fieldArray[2]<input type='text' name='$fieldArray[2]' size='22' value='${$fieldArray[2]}'></td>";echo "<td>$fieldArray[3]: <input type='text' name='$fieldArray[3]' size='12' value='${$fieldArray[3]}'></td>";// postdate/*<td>Cat 1-4 <input type='checkbox' name='cat1_4' value='1' $catCheck></td>*/echo "<td></tr><tr><td>$fieldArray[4]:  <input type='text' name='$fieldArray[4]' size='17' value='${$fieldArray[4]}'></td><td>$fieldArray[5]:  <input type='text' name='$fieldArray[5]' size='18' value='${$fieldArray[5]}'></td><td>$fieldArray[6]:  <input type='text' name='$fieldArray[6]' size='6' value='${$fieldArray[6]}'></td></tr>";// companyecho "<tr><td>$fieldArray[7]:  <input type='text' name='$fieldArray[7]' size='18' value='${$fieldArray[7]}'></td><td>$fieldArray[8]:  <input type='text' name='$fieldArray[8]' size='15' value='${$fieldArray[8]}'></td><td>$fieldArray[9]:  <input type='text' name='$fieldArray[9]' size='14' value='${$fieldArray[9]}'></td></tr>";// amtecho "<tr><td>$fieldArray[10]:  <input type='text' name='$fieldArray[10]' size='30' value='${$fieldArray[10]}'></td><td>$fieldArray[11]:  <input type='text' name='$fieldArray[11]' size='4' value='${$fieldArray[11]}'></td>";echo "<td>$fieldArray[12]:  <input type='text' name='$fieldArray[12]' size='1' value='${$fieldArray[12]}'></td>";echo "<td>$fieldArray[13]:  <input type='text' name='$fieldArray[13]' size='5' value='${$fieldArray[13]}'></td>";echo "</tr></table>";// Select GroupBy FieldsmakeGroupBySelect($fieldArray,$ckbx);// GroupBy radiosecho "<table><tr><td>Group by:</td>";$radio1="groupBy1";makeGroupBy1($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$va5,$va4,$va3,$va2,$va1);echo "</tr></table>";echo "<table><tr><td>Group by:</td>";$radio1="groupBy2";makeGroupBy2($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$vb5,$vb4,$vb3,$vb2,$vb1);echo "</tr></table>";echo "<table><tr><td>Group by:</td>";$radio1="groupBy3";makeGroupBy3($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$vc5,$vc4,$vc3,$vc2,$vc1);echo "</tr></table>";echo "<table><tr><td><input type='hidden' name='dbTable' value='$dbTable'><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='EEIDnum' value='$eeid'><input type='submit' name='submit' value='$formType'></form></td><td> <form action='portal.php'><input type='hidden' name='dbTable' value='$dbTable'><input type='submit' name='' value='Reset'></form</td>$addDeleteButton</tr></table>";  // ***** Pick display function and set sql statement$co=count($_REQUEST); //print_r($_REQUEST);echo "c=$co";exit;//$table="eedata0405";$from="*";// Default - gets used if not Group By// ******* Group By Variables*******// *** Make list of Fields to pass to GroupBy and Function portalHeader$passFields=$fieldArray[0];for($pf=1;$pf<count($fieldArray);$pf++){$passFields.=",".$fieldArray[$pf];}$gb1_1="card";$gb1_2="lastname";$gb1_3="vendor";$gb1_4="acct";$gb1_5="center";if($sumBy){$sumBy=",sum(attend) as attend, sum(timegiven) as timegiven";}else{$sumBy="";}// ************ GroupBy 1switch ($groupBy1) {		case "$gb1_1":$from="$passFields $sumBy";$g="Group by $gb1_1";			break;			case "$gb1_2":$from="$passFields $sumBy";$g="Group by $gb1_2";			break;			case "$gb1_3":$from="$passFields $sumBy";$g="Group by $gb1_3";			break;			case "$gb1_4":$from="$passFields $sumBy";$g="Group by $gb1_4";			break;			case "$gb1_5":$from="$passFields $sumBy";$g="Group by $gb1_5";			break;		}// ************ GroupBy 2// $from not used since all fields are referenced in groupBy1switch ($groupBy2) {		case "$gb1_1":			$g.=",$gb1_1";			break;			case "$gb1_2":			$g.=",$gb1_2";			break;			case "$gb1_3":			$g.=",$gb1_3";			break;			case "$gb1_4":			$g.=",$gb1_4";			break;			case "$gb1_5":		$g.=",$gb1_5";			break;		}// ************ GroupBy 3switch ($groupBy3) {		case "$gb1_1":			$g.=",$gb1_1";			break;			case "$gb1_2":			$g.=",$gb1_2";			break;			case "$gb1_3":			$g.=",$gb1_3";			break;			case "$gb1_4":			$g.=",$gb1_4";			break;			case "$gb1_5":		$g.=",$gb1_5";			break;		}$from.=" From $dbTable";// ********* Assign passed Values by Fieldfor($j=0;$j<count($fieldArray);$j++){$passVal[$j]=${$fieldArray[$j]};}// ********* Where **********if($co>0){$where=" WHERE 1";}else{exit;}/*if($cat1_4){$where.=" and category >= '1' and category <= '4'";}else{if($category!=""){$where.=" and category = '$category'";}}*/for($k=0;$k<count($fieldArray);$k++){if($passVal[$k]!=""){$where.=" and $fieldArray[$k] = '$passVal[$k]'";}}if($acctdate!=""){if($acctdate!=""&&$acctdateEnd==""){$where.=" and acctdate='$acctdate'";}else{$where.=" and acctdate>='$acctdate' and acctdate<='$acctdateEnd' order by acctdate";}}if($where==" WHERE 1"&&$g==''&&$passSQL==''){exit;}$sql1 = "SELECT $from $where $g";if($passSQL){$sql1=urldecode($passSQL);}echo "$sql1<br>";//echo "<pre>";print_r($fieldArray);echo "</pre>";//exit;if($sql1){// ********** This displays the result **********include_once("portalFunctions.php");$passSQL=urlencode($sql1);portalHeader($passSQL,$passFields);// Make Header$result = mysqli_query($connection, $sql1) or die ("Couldn't execute query. $sql1");$num=mysqli_num_rows($result);//echo "n=$num";if($num>1000){$sql1 = "SELECT $from $where $g limit 1000";$result = mysqli_query($connection, $sql1) or die ("Couldn't execute query. $sql1");echo "<font color='red'>$num</font> records were found. However, only the first <font color='red'>1000</font> are being displayed. Let Tom Howard know if you need to view more than 1000 at a time.<br>";}else{echo "$num <font color='green'>$z Items:$currPark</font><hr>";}// Access Levels are not used for this page/*// Park Level accessif($var==$park){$accessLevel="2";}else{$accessLevel="1";}// District wide accessif($_SESSION[itrak][level]=="2"){include_once("../../include/parkcodesDiv.inc");$a="array";$b="$var";$distArray=${$a.$b};if(in_array($park,$distArray)){$accessLevel="2";}else{$accessLevel="1";}}// System wide accessif($_SESSION[itrak][level]=="3"){$accessLevel="2";}*/// **********  using portalFunctions.php$accessLevel=1;switch($accessLevel){	case "1":while ($row=mysqli_fetch_array($result)){//extract($row);//print_r($row);exit;itemShow($row,$passSQL,$dbTable);}	break;	case "2":while ($row=mysqli_fetch_array($result)){extract($row);itemEdit($invoice,$pe,$description,$debit,$credit,$sys,$acct,$center,$fund,$acctdate,$whid);}	break;	default:	echo "Access denied";exit;	}// end Switch$total1=number_format($total1,2);//$timegivenTot=number_format($timegivenTot,0);echo "Total Amount = <font color='blue'>$total1</font> &nbsp;&nbsp;&nbsp;";if($g){echo "[$g]";}echo "</table></body></html>";}// **************  FUNCTIONS *******************function makeGroupBy1($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$va5,$va4,$va3,$va2,$va1) {echo "<td><input type='radio' name='$radio1' value='$caseField1' $va1>$caseField1</td><td><input type='radio' name='$radio1' value='$caseField2' $va2>$caseField2</td><td><input type='radio' name='$radio1' value='$caseField3' $va3>$caseField3</td><td><input type='radio' name='$radio1' value='$caseField4' $va4>$caseField4</td><td><input type='radio' name='$radio1' value='$caseField5' $va5>$caseField5 </td>";}function makeGroupBy2($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$vb5,$vb4,$vb3,$vb2,$vb1) {echo "<td><input type='radio' name='$radio1' value='$caseField1' $vb1>$caseField1</td><td><input type='radio' name='$radio1' value='$caseField2' $vb2>$caseField2</td><td><input type='radio' name='$radio1' value='$caseField3' $vb3>$caseField3</td><td><input type='radio' name='$radio1' value='$caseField4' $vb4>$caseField4</td><td><input type='radio' name='$radio1' value='$caseField5' $vb5>$caseField5 </td>";}function makeGroupBy3($radio1,$caseField1,$caseField2,$caseField3,$caseField4,$caseField5,$vc5,$vc4,$vc3,$vc2,$vc1) {echo "<td><input type='radio' name='$radio1' value='$caseField1' $vc1>$caseField1</td><td><input type='radio' name='$radio1' value='$caseField2' $vc2>$caseField2</td><td><input type='radio' name='$radio1' value='$caseField3' $vc3>$caseField3</td><td><input type='radio' name='$radio1' value='$caseField4' $vc4>$caseField4</td><td><input type='radio' name='$radio1' value='$caseField5' $vc5>$caseField5 </td>";}function makeUpdateFields($fieldArray){global $updateFields;for($i=0;$i<count($fieldArray);$i++){if($i!=0){$updateFields.=",".$fieldArray[$i]."='$".$fieldArray[$i]."'";}else{$updateFields.=$fieldArray[$i]."='$".$fieldArray[$i]."'";}}// end for}// end makeUpdateFields// Make Group By selection checkboxesfunction makeGroupBySelect($fieldArray,$ckbx){global $updateFields;echo "<table>";for($i=0;$i<count($fieldArray);$i++){$t=fmod($i,6);$name="ckbx[".$i."]";if($ckbx[$i]==$fieldArray[$i]){$c="checked";}else{$c="";}echo "<td><input type='checkbox' name='$name' value='$fieldArray[$i]' $c>$fieldArray[$i]</td>";if($i!=0 and $t==0){echo "<tr></tr>";}}// end forecho "</table>";}// end makeGroupBySelect?>