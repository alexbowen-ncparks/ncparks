<?php// called from theme.phpinclude("../../include/authSYSEXP.inc");include("../../include/connectSYSEXP.inc");//include("../../include/connectNRID.inc");session_start();// would prefer a single query, but couldn't write one// so the workaround is to use intermediate tables$sql = "TRUNCATE TABLE tempgeo";$sql = "DROP TABLE IF EXISTS tempbio,tempsce,temparc";//$sql = "DROP TABLE IF EXISTS tempbio,tempsce,tempgeo,temparc";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());// exit;$sql = "create table temparcselect name, potential, sum(priority) as arcP, sum(rarity) as arcR, sum(quality) as arcQ, sum(threat) as arcTfrom arcgroup by name";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$sql = "create table tempbioselect name, potential,sum(priority) as bioP, sum(rarity) as bioR, sum(quality) as bioQ, sum(threat) as bioTfrom biogroup by name";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());// $sql = "create table tempgeo$sql = "INSERT INTO tempgeoselect name, potential, sum(priority) as geoP, sum(rarity) as geoR, sum(quality) as geoQ, sum(threat) as geoTfrom geogroup by name";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$sql = "create table tempsceselect name, potential, sum(priority) as sceP, sum(rarity) as sceR, sum(quality) as sceQ, sum(threat) as sceTfrom scegroup by name";$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$sort = "site.name";if($s=="u"){$sort="type DESC, site.name";}$sql = "SELECT site.name,site.sid,site.threat,site.interconnect,site.demand,site.type,temparc.potential as a1,temparc.arcP,temparc.arcR,temparc.arcQ,temparc.arcT,tempbio.potential as a2,tempbio.bioP,tempbio.bioR,tempbio.bioQ,tempbio.bioT,tempgeo.potential as a3,tempgeo.geoP,tempgeo.geoR,tempgeo.geoQ,tempgeo.geoT,tempsce.potential as a4,tempsce.sceP,tempsce.sceR,tempsce.sceQ,tempsce.sceT,sum(species.score) as spscore, ((fishfresh*10)+(camptent*10)+(beach*10)+(picnick*10)+(cultural*10)+(natArea*7)+(hisArea*7)+(bike*5)+(hike*4)+(openArea*4)+(swim*4)+(fishSalt*4)+(scenic*4)+(campPrim*2.5)+(horse*1)+(boat*0.5)+(nature*0.5)+(canoe*0.5)+(ski*0.5)+(sail*0.5)) as recTotal,(tempbio.bioP+tempbio.bioR+tempbio.bioQ+tempbio.bioT+tempgeo.geoP+tempgeo.geoR+tempgeo.geoQ+tempgeo.geoT+tempsce.sceP+tempsce.sceR+tempsce.sceQ+tempsce.sceT+threat+demand+interconnect+sum(species.score)+(fishfresh*10)+(camptent*10)+(beach*10)+(picnick*10)+(cultural*10)+(natArea*7)+(hisArea*7)+(bike*5)+(hike*4)+(openArea*4)+(swim*4)+(fishSalt*4)+(scenic*4)+(campPrim*2.5)+(horse*1)+(boat*0.5)+(nature*0.5)+(canoe*0.5)+(ski*0.5)+(sail*0.5)) as completeTotalFROM siteleft join temparc on temparc.name=site.name and temparc.potential=''left join tempbio on tempbio.name=site.name and tempbio.potential=''left join tempgeo on tempgeo.name=site.name and tempgeo.potential=''left join tempsce on tempsce.name=site.name and tempsce.potential=''left join species on species.name=site.name and species.potential=''left join rec on rec.name=site.namegroup by site.nameorder by $sort"; echo "$sql"; exit;$result = @mysql_query($sql, $connection) or die("$sql Error 1#". mysql_errno() . ": " . mysql_error());$number = @mysql_num_rows($result);if($number > 0){echo "<div align='center'>NC DPR System Expansion - Unit Summary</div><table border='1'><tr><td width='270' align='center'><a href='summary.php?s=n'>Site Name:</a></td><td><a href='summary.php?s=u'>Unit:</a></td><td>arcP: </td><td>arcT:</td><td>arcR: </td><td>arcQ: </td><td>bioP: </td><td>bioT:</td><td>bioR: </td><td>bioQ: </td><td>geoP: </td><td>geoT:</td><td>geoR: </td><td>geoQ: </td><td>sceP: </td><td>sceT:</td><td>sceR: </td><td>sceQ: </td><td>Species: </td><td>Rec:</td><td>Total:</a></td></tr>";while ($row = mysql_fetch_array($result)){extract($row);switch ($type) {    case "State Park":        $type="SP";        break;    case "Natural Area":        $type="NA";        break;    case "State Rec. Area":        $type="SRA";        break;}$total=$arcP+$arcT+$arcR+$arcQ+$bioP+$bioT+$bioR+$bioQ+$geoP+$geoT+$geoR+$geoQ+$sceP+$sceT+$sceR+$sceQ+$spscore+$recTotal+$threat+$demand+$interconnect;$recTotal=round($recTotal);$total=round($total);echo "<tr><td><a href='site.php?sid=$sid' target='_blank'>$name</a></td><td align='center'>$type</td><td align='right'>$arcP</td><td align='right'>$arcT</td><td align='right'>$arcR</td><td align='right'>$arcQ</td><td align='right'>$bioP</td><td align='right'>$bioT</td><td align='right'>$bioR</td><td align='right'>$bioQ</td><td align='right'>$geoP</td><td align='right'>$geoT</td><td align='right'>$geoR</td><td align='right'>$geoQ</td><td align='right'>$sceP</td><td align='right'>$sceT</td><td align='right'>$sceR</td><td align='right'>$sceQ</td><td align='right'>$spscore</td><td align='right'>$recTotal</td><td align='right'><b>$total</b></td></tr>";$sumTotal += $total;} // end while}// end if $number?>