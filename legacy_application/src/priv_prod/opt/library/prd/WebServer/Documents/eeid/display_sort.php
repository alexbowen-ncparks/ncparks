<?php//These are placed outside of the webserver directory for security//include("../../include/authBUDGET.inc"); // used to authenticate usersinclude("../../include/connectEEID.inc");// database connection parametersinclude("menu.php");?><script language='JavaScript'>function confirmLink(){ bConfirm=confirm('Are you sure you want to delete this record?') return (bConfirm);}</script><?php//print_r($_REQUEST);exit;extract($_REQUEST);//**** Process any Update ******if($deleteRecord=="Delete"){//print_r($_REQUEST);exit;$query = "DELETE FROM eedata0405 where eeid='$EEIDnum'";//echo "$query";exit;$result = mysql_query($query) or die ("Couldn't execute query Delete. $query");header("Location: display_sort.php?passSQL=$passSQL");exit;}//**** Process any Update ******if($submit=="Update"){//print_r($_REQUEST);exit;$comments=addslashes($comments);$query = "Update eedata0405 set age='$age',category='$category',county='$county',dateprogram='$dateprogram',dist='$dist',location='$location',park='$park',presenter='$presenter',comments='$comments',resources='$resources',timegiven='$timegiven',progtitle='$progtitle',attend='$attend'where eeid='$EEIDnum'";//echo "$query";exit;$result = mysql_query($query) or die ("Couldn't execute query Update. $query");header("Location: display_sort.php?passSQL=$passSQL");exit;}//**** Prepare To Update OR Delete******if($eeidFld){//print_r($_REQUEST);exit;$formType="Update";$passSQLedit=urlencode($passSQL);$addDeleteButton="<td><form><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='EEIDnum' value='$eeidFld'><input type='submit' name='deleteRecord' value='Delete' onClick='return confirmLink()'></form></td>";$sql0 = "SELECT * from eedata0405 where eeid='$eeidFld'";$result = mysql_query($sql0) or die ("Couldn't execute query 0. $sql0");$row=mysql_fetch_array($result);extract($row);}else{$formType="Find";}if($cat1_4){$catCheck="checked";}switch ($groupBy1) {		case "dist":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va1 = "checked";			break;			case "county":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va2="checked";			break;			case "park":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va3 ="checked";			break;			case "age":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va4 ="checked";			break;			case "location":			$va5="";$va4="";$va3="";$va2="";$va1="";			$va5 ="checked";			break;		}switch ($groupBy2) {		case "dist":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb1 = "checked";			break;			case "county":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb2="checked";			break;			case "park":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb3 ="checked";			break;			case "age":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb4 ="checked";			break;			case "location":			$vb5="";$vb4="";$vb3="";$vb2="";$vb1="";			$vb5 ="checked";			break;		}switch ($groupBy3) {		case "dist":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc1 = "checked";			break;			case "county":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc2="checked";			break;			case "park":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc3 ="checked";			break;			case "age":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc4 ="checked";			break;			case "location":			$vc5="";$vc4="";$vc3="";$vc2="";$vc1="";			$vc5 ="checked";			break;		}echo "<form action='display_sort.php'><table><tr><td>Progam Date:<input type='text' name='dateprogram' size='15' value='$dateprogram'></td></tr><tr><td>Park: <input type='text' name='park' size='10' value='$park'></td>";$ageMenu=array("Adult","Public","Youth");echo "<td>Audience: <select name=\"age\"><option selected></option>";for ($n=0;$n<count($ageMenu);$n++){$con=$ageMenu[$n];if($con==$age){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$ageMenu[$n]\n";       }   echo "</select></td>";//echo "<td><input type='text' name='age' size='12' value='$age'></td>";echo "<td>Category: <input type='text' name='category' size='12' value='$category'>Cat 1-4 <input type='checkbox' name='cat1_4' value='1' $catCheck></td></td><td></tr><tr><td>Location:  <input type='text' name='location' size='17' value='$location'></td><td>County:  <input type='text' name='county' size='18' value='$county'></td><td>District:  <input type='text' name='dist' size='6' value='$dist'></td></tr><tr><td>Presenter:  <input type='text' name='presenter' size='18' value='$presenter'></td><td>Comments:  <input type='text' name='comments' size='27' value='$comments'></td><td>Resources:  <input type='text' name='resources' size='20' value='$resources'></td></tr><tr><td>Times Given:  <input type='text' name='timegiven' size='5' value='$timegiven'></td><td>Program Title:  <input type='text' name='progtitle' size='25' value='$progtitle'></td><td>Attendance:  <input type='text' name='attend' size='5' value='$attend'></td></tr></table>";echo "<table><tr><td>Group by:<input type='radio' name='groupBy1' value='dist' $va1>District </td><td><input type='radio' name='groupBy1' value='county' $va2>County </td><td><input type='radio' name='groupBy1' value='park' $va3>Park </td><td><input type='radio' name='groupBy1' value='age' $va4>Audience </td><td><input type='radio' name='groupBy1' value='location' $va5>Location </td></tr></table><table><tr><td>Group by:<input type='radio' name='groupBy2' value='dist' $vb1>District </td><td><input type='radio' name='groupBy2' value='county' $vb2>County </td><td><input type='radio' name='groupBy2' value='park' $vb3>Park </td><td><input type='radio' name='groupBy2' value='age' $vb4>Audience </td><td><input type='radio' name='groupBy2' value='location' $vb5>Location </td></tr></table><table><tr><td>Group by:<input type='radio' name='groupBy3' value='dist' $vc1>District </td><td><input type='radio' name='groupBy3' value='county' $vc2>County </td><td><input type='radio' name='groupBy3' value='park' $vc3>Park </td><td><input type='radio' name='groupBy3' value='age' $vc4>Audience </td><td><input type='radio' name='groupBy3' value='location' $vc5>Location </td></tr></table><table><tr><td><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='EEIDnum' value='$eeid'><input type='submit' name='submit' value='$formType'></form></td><td> <form action='display_sort.php'><input type='submit' name='' value='Reset'></form</td>$addDeleteButton</tr></table>";  // ***** Pick display function and set sql statement$co=count($_REQUEST); //print_r($_REQUEST);echo "c=$co";exit;$table="eedata0405";$from="*";// Default - gets used if not Group By// ******* Group By *******// ************ GroupBy 1switch ($groupBy1) {		case "dist":$from="dist,sum(attend) as attend, sum(timegiven) as timegiven";$g="Group by dist";			break;			case "county":$from="county,sum(attend) as attend, sum(timegiven) as timegiven";$g="Group by county";			break;			case "park":$from="park,sum(attend) as attend, sum(timegiven) as timegiven";$g="Group by park";			break;			case "age":$from="age,sum(attend) as attend, sum(timegiven) as timegiven";$g="Group by age";			break;			case "location":$from="location,sum(attend) as attend, sum(timegiven) as timegiven";$g="Group by Location";			break;		}// ************ GroupBy 2switch ($groupBy2) {		case "dist":			$from.=",dist";			$g.=",dist";			break;			case "county":			$from.=",county";			$g.=",county";			break;			case "park":			$from.=",park";			$g.=",park";			break;			case "age":			$from.=",age";			$g.=",age";			break;			case "location":			$from.=",location";		$g.=",Location";			break;		}// ************ GroupBy 3switch ($groupBy3) {		case "dist":			$from.=",dist";			$g.=",dist";			break;			case "county":			$from.=",county";			$g.=",county";			break;			case "park":			$from.=",park";			$g.=",park";			break;			case "age":			$from.=",age";			$g.=",age";			break;			case "location":			$from.=",location";		$g.=",Location";			break;		}$from.=" From $table";// ********* Where **********if($co>0){$where=" WHERE 1";}else{exit;}if($age!=""){$where.=" and age='$age'";}if($cat1_4){$where.=" and category >= '1' and category <= '4'";}else{if($category!=""){$where.=" and category = '$category'";}}if($dateprogram!=""){$where.=" and dateprogram = '$dateprogram'";}if($dist!=""){$where.=" and dist='$dist'";}if($location!=""){$where.=" and location='$location'";}if($park!=""){$where.=" and park='$park'";}if($presenter!=""){$where.=" and presenter LIKE '%$presenter%'";}if($comments!=""){$where.=" and comments LIKE '%$comments%'";}if($resources!=""){$where.=" and resources LIKE '%$resources%'";}if($timegiven!=""){$where.=" and timegiven='$timegiven'";}if($progtitle!=""){$where.=" and progtitle='$progtitle'";}if($attend!=""){$where.=" and attend='$attend'";}if($acctdate!=""){if($acctdate!=""&&$acctdateEnd==""){$where.=" and acctdate='$acctdate'";}else{$where.=" and acctdate>='$acctdate' and acctdate<='$acctdateEnd' order by acctdate";}}// ********* SORT BY **********//if($sort){$passSQL.=" order by $sort";}if($where==" WHERE 1"&&$g==''&&$passSQL==''){exit;}$sql1 = "SELECT $from $where $g";if($passSQL){$sql1=urldecode($passSQL);}echo "$sql1<br>";//exit;if($sql1){// ********** This displays the result **********include_once("functionEEID.php");$passSQL=urlencode($sql1);eeidHeader($passSQL);$result = mysql_query($sql1) or die ("Couldn't execute query. $sql1");$num=mysql_num_rows($result);if($num>1000){$sql1 = "SELECT $from $where $g limit 1000";$result = mysql_query($sql1) or die ("Couldn't execute query. $sql1");echo "<font color='red'>$num</font> records were found. However, only the first <font color='red'>1000</font> are being displayed. Let Tom Howard know if you need to view more than 1000 at a time.<br>";}else{echo "$num <font color='green'>$z Items:$currPark</font><hr>";}// Access Levels are not used for this page/*// Park Level accessif($var==$park){$accessLevel="2";}else{$accessLevel="1";}// District wide accessif($_SESSION[itrak][level]=="2"){include_once("../../include/parkcodesDiv.inc");$a="array";$b="$var";$distArray=${$a.$b};if(in_array($park,$distArray)){$accessLevel="2";}else{$accessLevel="1";}}// System wide accessif($_SESSION[itrak][level]=="3"){$accessLevel="2";}*/$accessLevel=1;switch($accessLevel){	case "1":while ($row=mysql_fetch_array($result)){extract($row);itemShow($age,$category,$county,$dateprogram,$dist,$location,$park,$presenter,$comments,$resources,$timegiven,$progtitle,$attend,$username,$datecreate,$datemod,$mark,$eeid,$passSQL);}	break;	case "2":while ($row=mysql_fetch_array($result)){extract($row);itemEdit($invoice,$pe,$description,$debit,$credit,$sys,$acct,$center,$fund,$acctdate,$whid);}	break;	default:	echo "Access denied";exit;	}// end Switch$attendTot=number_format($attendTot,0);$timegivenTot=number_format($timegivenTot,0);echo "Programs Given = <font color='blue'>$timegivenTot</font> Total Attendance = <font color='blue'>$attendTot</font> &nbsp;&nbsp;&nbsp;[$g]";echo "</table></body></html>";}?>