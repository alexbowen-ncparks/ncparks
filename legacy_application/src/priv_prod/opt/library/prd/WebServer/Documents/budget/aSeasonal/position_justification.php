<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databasesession_start();if($_SESSION['budget']['select']==""){echo "Your session has timed out - log back in.";exit;}extract($_REQUEST);if($del){$sql="DELETE from seasonal_payroll_justification WHERE id='$del'"; 		$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql c=$connection");}if($rep==""){include("../menu.php");}$level=$_SESSION['budget']['level'];//echo "<pre>";//print_r($_POST);//print_r($_REQUEST);//echo "<pre>";print_r($_SESSION);echo "</pre>";//echo "</pre>";  //exit;if($_POST['submit']=="Submit"){	$skip=array("submit");		foreach($_POST as $k=>$v){ // Get field names			if(in_array($k,$skip)){continue;}			$fld[]=$k;}					foreach($_POST[$fld[0]] as $k=>$v){ // Get table id value			if(in_array($k,$skip)){continue;}			$IDarray[]=$k;}				foreach($IDarray as $k=>$id){			$clause="";			foreach($fld as $k1=>$field_name){				$clause.=$field_name."='".$_POST[$field_name][$id]."',";				}				//$clause=rtrim($clause,",");		$sql="REPLACE seasonal_payroll_justification set $clause id='$id'"; 		//	$a[]=$sql;	$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql c=$connection");			}	//	echo "<pre>"; print_r($a); echo "</pre>";  exit;	}	$display_fields="t1.id,t1.beacon_title,t1.num_positions,t1.funding_source,t1.pay_rate,t1.date_vacate,t1.justification,t1.location";$sql = "SELECT $display_fields FROM seasonal_payroll_justification as t1 WHERE  1";// echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql c=$connection");while($row=mysqli_fetch_assoc($result)){		$ARRAY[]=$row;	}//echo "<pre>"; print_r($ARRAY); echo "</pre>"; // exit;if($rep==""){	echo "<form method='POST'><table cellpadding='5'><tr>";	if($level>1){echo "<td>OSMB <a href='park_seasonals_osmb.php'>Report</a></td>";}		if($center_code=="All"){$excel="<td><a href='park_seasonals.php?center_code=All&rep=excel'>Excel</a> export</td>";}			echo "<td>OSMB Approval Period = $datebegin thru $date_end</td>$excel";	echo "</tr></table></form>";}echo "<form method='POST'><table cellpadding='5' border='1'>";	echo "<tr><th></th>";	foreach($ARRAY[0] as $k=>$v){					if($k=="id"){continue;}					echo "<th>$k</th>";					}	echo "</tr>";		foreach($ARRAY as $num=>$row){ $num=$num+1;			echo " <tr valign='top'><td align='right'>$num</td>";			$test_blank_record="";				foreach($row as $fld=>$value){					$id=$row['id'];					if($fld=="id"){continue;}					$test_blank_record+=$value;										if($fld=="justification"){					$fld=$fld."[$id]";					$toggle="<div id=\"fieldName\">   ... <a onclick=\"toggleDisplay('fieldDetails[$num]');\" href=\"javascript:void('')\"> details &#177</a> <font size='-1'>$related</font></div>					<div id=\"fieldDetails[$id]\" style=\"display: none\"><br><textarea name='$fld' cols='55' rows='15'>$value</textarea></div>";					echo "<td>$toggle</td>";					}					else{						if($fld=="beacon_title"){							$img=" <a href='position_justification.php?del=$id' onClick='return confirmLink()'><img src='../../button_drop.png'></a>";						} else{$img="";}							$fld=$fld."[$id]";					echo "<td><input type='text' name='$fld' value=\"$value\" size='17'>$img</td>";}				}			echo "</tr>";			}	if($test_blank_record>0){		$id++;	foreach($ARRAY[0] as $k=>$v){					if($k=="id"){continue;}					$fld=$k."[$id]";					$new_record.="<td><input type='text' name='$fld'></td>";					}					echo "<tr><td></td>$new_record</tr>";			}	echo "</table>";if($level>1){	echo "<tr>	<td colspan='14' align='center'>	<input type='submit' name='submit' value='Submit'></td>	</tr></table></form>";}?>