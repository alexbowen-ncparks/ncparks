<?php$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databaseinclude("../../../include/authBUDGET.inc");extract($_REQUEST);// workaround to extract just the center when resubmitting form with center// pulldown already has a selected value// not sure why only the center is not returned$pos=strpos($center,"-");if($pos){$findCenter=explode("-",$center);$center=$findCenter[2];}// workaround for track_rccif($track_rcc=="Yes"){$track_rcc="y";}if($track_rcc=="No"){$track_rcc="n";}// workaround for acct_catif($acct_cat=="Expense"){$acct_cat="exp";}if($acct_cat=="Revenue"){$acct_cat="rev";}if($acct_cat=="Funding"){$acct_cat="fun";}//print_r($_SESSION);//EXIT;//print_r($_REQUEST);//EXIT;// Creates the last 4 Fiscal Years - Used in queriesif($f_year==""){$testMonth=date(n);if($testMonth >0 and $testMonth<8){$year2=date(Y)-1;}if($testMonth >7){$year2=date(Y);}$yearNext=$year2+1;$yx=substr($year2,2,2);$year3=$yearNext;$yy=substr($year3,2,2);$f_year=$yx.$yy;}else{$yx=substr($f_year,0,2);$year2="20".$yx;$year3=$year2+1;}$y0=substr($year2-3,2,4);$y1=substr($year2-2,2,4);$py3=$y0.$y1;$y2=substr($year2-1,2,4);$py2=$y1.$y2;$y3=substr($year2,2,4);$py1=$y2.$y3;$y4=substr($year3,2,4);$cy=$y3.$y4;echo "py3=$py3 py2=$py2 py1=$py1 cy=$cy <br><br>f_year=$f_year y2=$year2 y3=$year3 y4=$y4 y3=$y3 y2=$y2 y1=$y1<br><br>today=$today compare=$compare testMonth=$testMonth";//exit;// Get most recent date from Exp_Rev$sql="SELECT DATE_FORMAT(max(acctdate),'Report Date: %c/%e/%y') as maxDate FROM `exp_rev` WHERE 1";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 0. $sql");$row=mysqli_fetch_array($result);extract($row);if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=Budget_summary.xls');}// *********** Level > 2 ************if($_SESSION[budget][level]>2){//print_r($_REQUEST);EXIT;$sql="SELECT  DISTINCT section FROM  `center`";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$sectArray1[]="sect-x-".$section;$sectArray2[]=ucfirst($section)."(ALL)-NCAS#";$sectArray3[]="sect-y-".$section;$sectArray4[]=ucfirst($section)."(ALL)-ParkCode";}if($rep==""){include_once("../menu.php");echo "<table align='center'><form action=\"budget_ope_exp_detail_0607.php\">";/*$array1=array("east-x","north-x","south-x","west-x","stwd-x","east","north","south","west","stwd");$array2=array("Operations(East)-NCAS#","Operations(North)-NCAS#","Operations(South)-NCAS#","Operations(West)-NCAS#","Operations(Stwd)-NCAS#","Operations(East)-ParkCode","Operations(North)-ParkCode","Operations(South)-ParkCode","Operations(West)-ParkCode","Operations(Stwd)-ParkCode");$menuArray1=array_merge($array1,$sectArray1);$menuArray1=array_merge($menuArray1,$sectArray3);$menuArray2=array_merge($array2,$sectArray2);$menuArray2=array_merge($menuArray2,$sectArray4);$revArrayKey=array("OPERrev-east","OPERrev-north","OPERrev-south","OPERrev-west","OPERrev-stwd");$revArrayVal=array("Operations(East)-Revisions_Required","Operations(North)-Revisions_Required","Operations(South)-Revisions_Required","Operations(West)-Revisions_Required","Operations(STWD)-Revisions_Required");for($i=0;$i<count($revArrayKey);$i++){$revArray[$revArrayKey[$i]]=$revArrayVal[$i];}// Menu 1echo "<td>Scope: <select name=\"scopeMenu\"><option selected></option>";$s="value";for ($n=0;$n<count($menuArray2);$n++){$con=$menuArray1[$n];		echo "<option $s='$con'>$menuArray2[$n]\n";       }    echo "<option $s='PLAD-x'>Planning&Admin(ALL)-NCAS#\n";    echo "<option $s='PLAD'>Planning&Admin(ALL)-ParkCode\n";    echo "<option $s='OPERrev-east'>Operations(East)-Revisions_Required\n";    echo "<option $s='OPERrev-north'>Operations(North)-Revisions_Required\n";    echo "<option $s='OPERrev-south'>Operations(South)-Revisions_Required\n";    echo "<option $s='OPERrev-west'>Operations(West)-Revisions_Required\n";    echo "<option $s='OPERrev-stwd'>Operations(STWD)-Revisions_Required\n";    echo "<option $s='PLADrev-all'>Planning&Admin(ALL)-Revisions_Required\n";    echo "<option $s='CONSrev-all'>Construction(ALL)-Revisions_Required\n";   echo "</select></td>";*/// Menu 0$array1=array("y","n");$array2=array("Yes","No");echo "<td>Track RCC: <select name=\"track_rcc\"><option selected></option>"; for ($n=0;$n<count($array1);$n++){$con=$array1[$n];if($track_rcc==$con){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$array2[$n]\n";       }   echo "</select></td>";// Menu 1$array1=array("exp","rev","fun");$array2=array("Expense","Revenue","Funding");echo "<td>Account Category: <select name=\"acct_cat\"><option selected></option>"; for ($n=0;$n<count($array1);$n++){$con=$array1[$n];if($acct_cat==$con){$s="selected";}else{$s="value";}		echo "<option $s='$con'>$array2[$n]\n";       }   echo "</select></td>";// Menu 2$sql="SELECT section,parkcode,center as varCenter from center where fund='1280' order by section,parkcode,center";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$pc[]=$parkcode;$c[]=$varCenter;$sec[]=$section;}echo "<td><select name=\"center\"><option selected>Select Center</option>";for ($n=0;$n<count($c);$n++){if($center==$c[$n]){$s="selected";}else{$s="value";}$con=$c[$n];		echo "<option $s='$con'>$sec[$n]-$pc[$n]-$c[$n]</option>\n";       }   echo "</select><input type='submit' name='submit' value='Submit'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type='checkbox' name='showSQL' value='1'>Show SQL</form></td></tr></table>";}// *********** Set Scopelist($dist_sect,$orderByToggle)=explode("-",$scopeMenu);if($orderByToggle=="x" || $orderByToggle=="NCAS"){$GroupByToggle="x";$orderBy="ORDER BY oxt3_0607.ncasnum,center.dist,center.parkcode";if($dist_sect!="sect"){$limitWhere=" AND center.section='operations'";}}else{$orderBy="ORDER BY center.parkcode,oxt3_0607.ncasnum";}if($scopeMenu){list($dist_sect,$orderByToggle,$sect)=explode("-",$scopeMenu);if($dist_sect=="sect"){$whichCenter="AND center.section='$sect'";}else{$whichCenter="AND center.dist='$dist_sect'";}}else{$whichCenter="AND center.center='$center'";$orderBy="ORDER BY oxt3_0607.ncasnum";}if($dist_sect=="PLAD"){$limitWhere="AND (section != 'operations' and section != 'construction')";$whichCenter="";if($orderByToggle=="x"){$orderBy="ORDER BY oxt3_0607.ncasnum,center.section";}else{$orderBy="ORDER BY center.parkcode,oxt3_0607.ncasnum";}}if($dist_sect=="OPERrev"||$dist_sect=="PLADrev"||$dist_sect=="CONSrev"){// move to another file for ALL Revision queriesinclude("revisions.php");exit;}if($center==""){exit;}}// end Level > 2// ************* Level 2 *****************if($_SESSION[budget][level] == 2){//print_r($_REQUEST);EXIT;if($rep==""){include_once("../menu.php");include_once("../../../include/parkRCC.inc");$distCode=$_SESSION[budget][select];echo "<table align='center'><form action=\"budget_ope_exp_detail_0607.php\">";switch($distCode){case "EADI":$distCode="east";break;case "NODI":$distCode="north";break;case "SODI":$distCode="south";break;case "WEDI":$distCode="west";break;}$D=$distCode."-NCAS";$DP=$distCode."-PARK";$array1=array($D,$DP);/*// Menu 1echo "<td>Scope: <select name=\"scopeMenu\"><option selected></option>";$s="value";for ($n=0;$n<count($array1);$n++){$con=$array1[$n];		echo "<option $s='$con'>$array1[$n]\n";       }   echo "</select></td>";   $parkList=$_SESSION[budget][select];$da=${"array".$parkList}; //print_r($da);exit;while (list($key,$val)=each($da)){$parkList=$parkList.",".$val;}$where="where FIND_IN_SET(center.parkCode,'$parkList')>''";*/// Menu 2$where="where dist='$distCode' and section='operations' and fund='1280'";$sql="SELECT section,parkcode,center as varCenter from center $where order by section,parkcode,center";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query 1. $sql");while ($row=mysqli_fetch_array($result)){extract($row);$pc[]=$parkcode;$c[]=$varCenter;$sec[]=$section;}echo "<td><select name=\"center\"><option selected>Select Center</option>";$s="value";for ($n=0;$n<count($c);$n++){$con=$c[$n];		echo "<option $s='$con'>$sec[$n]-$pc[$n]-$c[$n]\n";       }   echo "</select> <input type='submit' name='submit' value='Submit'></td></form></tr></table>";}// *********** Set Scopelist($dist_sect,$orderByToggle)=explode("-",$scopeMenu);if($orderByToggle=="NCAS"){$GroupByToggle="x";$orderBy="ORDER BY oxt3_0607.ncasnum,center.dist,center.parkcode";if($dist_sect!="sect"){$limitWhere=" AND center.section='operations'";}}else{$orderBy="ORDER BY center.parkcode";}if($scopeMenu){list($dist_sect,$orderByToggle,$sect)=explode("-",$scopeMenu);if($dist_sect=="sect"){$whichCenter="AND center.section='$sect'";}else{$whichCenter="AND center.dist='$dist_sect'";}}else{$whichCenter="AND center.center='$center'";}if($center==""){exit;}}// end Level = 2// *********** Level 1 ************if($_SESSION[budget][level]==1){if($rep==""){include_once("../menu.php");}include_once("../../../include/parkcountyRCC.inc");include_once("subDist.php");}// end Level = 1// *********** Check Level **************if($_SESSION[budget][level]==2){/*list($dist_sect,$orderByToggle)=explode("-",$scopeMenu);switch($dist_sect){case "east":$distCode="EADI";break;case "north":$distCode="NODI";break;case "south":$distCode="SODI";break;case "west":$distCode="WEDI";break;}if($_SESSION[budget][select]!=$distCode){echo "$distCodeAccess denied";exit;}*/}// New Query - select query which creates 2000+ account/center totals for //"operating expenses" to be used as php variable & html reports made available //to Divisionif($track_rcc){$whereLimit=" and track_rcc='$track_rcc'";}if($acct_cat){$whereLimit.=" and acct_cat='$acct_cat'";}$sql="SELECT coa.track_rcc,coa.acct_cat,oxt3_0607.ncasnum, coa.park_acct_desc AS description, center.section, center.dist, center.parkcode, oxt3_0607.center, sum( oxt3_0607.spent0304 ) AS spent_py3, sum( oxt3_0607.spent0405 ) AS spent_py2, sum( oxt3_0607.spent0506 ) AS spent_py1, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0506 ) AS inc_cy, round( ((sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0506 ) ) / ( sum( oxt3_0607.spent0506 ) + sum( ' .01' ) )) *100) AS inc_cy_perc, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) AS request_cy, sum( oxt3_0607.spent0607 ) AS spent_cy, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0607 ) AS available, oxt3_0607.projected_excess_shortage, oxt3_0607.budget_transfer_request, oxt3_0607.JustificationFROM `oxt3_0607`LEFT JOIN center ON oxt3_0607.center = center.centerLEFT JOIN coa ON oxt3_0607.ncasnum = coa.ncasnumWHERE 1 and oxt3_0607.center='$center'$whereLimitGROUP BY oxt3_0607.ncasnum, oxt3_0607.centerORDER BY oxt3_0607.ncasnum";/* // Old Query$sql="SELECT oxt3_0607.ncasnum, coa.park_acct_desc AS description, center.section, center.dist, center.parkcode, oxt3_0607.center, sum( oxt3_0607.spent0304 ) AS spent_py3, sum( oxt3_0607.spent0405 ) AS spent_py2, sum( oxt3_0607.spent0506 ) AS spent_py1, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0506 ) AS inc_cy, round( ((sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0506 ) ) / ( sum( oxt3_0607.spent0506 ) + sum( ' .01' ) )) *100) AS inc_cy_perc, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) AS request_cy, sum( oxt3_0607.spent0607 ) AS spent_cy, sum( oxt3_0607.spent0506 ) + sum( oxt3_0607.parkinc0607 ) + sum( oxt3_0607.distinc0607 ) - sum( oxt3_0607.spent0607 ) AS available, oxt3_0607.projected_excess_shortage, oxt3_0607.budget_transfer_request, oxt3_0607.JustificationFROM `oxt3_0607`LEFT JOIN center ON oxt3_0607.center = center.centerLEFT JOIN coa ON oxt3_0607.ncasnum = coa.ncasnumWHERE 1 AND coa.track_rcc = 'y' AND oxt3_0607.ncasnum NOTLIKE  '534%' $whichCenter $limitWhereGROUP  BY oxt3_0607.ncasnum, oxt3_0607.center$orderBy";*/if($showSQL=="1"){echo "$sql<br>";//exit;}$varQuery=$_SERVER[QUERY_STRING];if($rep==""){$flip=array_flip($menuArray1);$scopeKey=$flip[$scopeMenu];echo "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href='budget_ope_exp_detail_0607.php?$varQuery&rep=excel'>Excel Export</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$menuArray2[$scopeKey]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $maxDate<br>";}echo "<table border='1'><tr>";$header="<th>Track<br>RCC</th><th>ACCT<br>CAT</th><th>NCAS#</th><th>DESCRIPTION</th><th>PARK</th><th>CENTER</th><th>Prior<br>Year 3</th><th>Prior<br>Year 2</th><th>Last<br>Year</th><th>Increase<br>Decrease</th><th>Percent<br>Inc_Dec</th><th>Current Yr.<br>Budget</th><th>Current Yr.<br>Actual</th><th>Current Yr.<br>Budget-Actual</th><th>Projected<br>Excess<br>Shortage</th><th>Budget<br>Transfer<br>Request</th><th>Justification</th>";echo "$header</tr>";if($GroupByToggle=="x"){$checkField="ncasnum";}else{$checkField="parkcode";}$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");//$num=mysqli_num_rows($result);while($row=mysqli_fetch_array($result)){extract($row);// Track Totals$spent_py3tot=$spent_py3tot+$spent_py3;// 1$spent_py2tot=$spent_py2tot+$spent_py2;//2$spent_py1tot=$spent_py1tot+$spent_py1;//3$inc_cytot=$inc_cytot+$inc_cy;//6//$inc_cy_perctot=$inc_cy_perctot+$inc_cy_perc;//6a$request_cytot=$request_cytot+$request_cy;//7$spent_cytot=$spent_cytot+$spent_cy;//8$availabletot=$availabletot+$available;//11$projected_excess_shortageTot=$projected_excess_shortageTot+$projected_excess_shortage;//12$Budget_Transfer_RequestTot=$Budget_Transfer_RequestTot+$Budget_Transfer_Request;//13// Display SubTotalsif($check!="" AND $check!=$$checkField){$subspent_py3totF=number_format($subspent_py3tot,2);$subspent_py2totF=number_format($subspent_py2tot,2);$subspent_py1totF=number_format($subspent_py1tot,2);$subware_py1totF=number_format($subware_py1tot,2);$subnonware_incdectotF=number_format($subnonware_incdectot,2);$subinc_dectotF=number_format($subinc_dectot,2);//$avePerCent=($subinc_cy_perctot/$countPerCent);//$subinc_cy_perctotF="Ave. = ".number_format($avePerCent,0)."%";$subrequest_cytotF=number_format($subrequest_cytot,2);$subspent_cytotF=number_format($subspent_cytot,2);$subware_cytotF=number_format($subware_cytot,2);$subtotal_spent_cyF=number_format($subtotal_spent_cy,2);$subRemainingtotF=number_format($subRemainingtot,2);$subProjExcessShortagetotF=number_format($subProjExcessShortagetot,2);$subBudget_Transfer_RequesttotF=number_format($subBudget_Transfer_Requesttot,2);echo "<tr><td align='right' colspan='7'><b>$subspent_py3totF</td><td align='right'><b>$subspent_py2totF</b></td><td align='right'><b>$subspent_py1totF</b></td><td align='right'><b>$subnonware_incdectotF</b></td><td align='right'><b>$subinc_dectotF</b></td><td align='right'><b>$subinc_cy_perctotF</b></td><td align='right'><b>$subrequest_cytotF</b></td><td align='right'><b>$subspent_cytotF</b></td><td align='right'><b>$subRemainingtotF</b></td><td align='right'><b>$subProjExcessShortagetotF</b></td><td align='right'><b>$subBudget_Transfer_RequesttotF</b></td></tr>";$subspent_py3grand=$subspent_py3grand+$subspent_py3tot; $subspent_py3tot="";$subspent_py2grand=$subspent_py2grand+$subspent_py2tot; $subspent_py2tot="";$subspent_py1grand=$subspent_py1grand+$subspent_py1tot; $subspent_py1tot="";$subware_py1grand=$subware_py1grand+$subware_py1tot; $subware_py1tot="";$subnonware_incdecgrand=$subnonware_incdecgrand+$subnonware_incdectot; $subnonware_incdectot="";$subinc_decgrand=$subinc_decgrand+$subinc_dectot; $subinc_dectot="";$subinc_cy_percgrand=$subinc_cy_percgrand+$subinc_cy_perctot; $subinc_cy_perctot="";$subspent_cygrand=$subspent_cygrand+$subspent_cytot; $subspent_cytot="";$subware_cygrand=$subware_cygrand+$subware_cytot; $subware_cytot="";$subtotal_spent_cygrand=$subtotal_spent_cygrand+$subtotal_spent_cy; $subtotal_spent_cy="";$subrequest_cygrand=$subrequest_cygrand+$subrequest_cytot; $subrequest_cytot="";$subRemaininggrand=$subRemaininggrand+$subRemainingtot; $subRemainingtot="";$subProjExcessShortagegrand=$subProjExcessShortagegrand+$subProjExcessShortagetot; $subProjExcessShortagetot="";$subBudget_Transfer_Requestgrand=$subBudget_Transfer_Requestgrand+$subBudget_Transfer_Requesttot; $subBudget_Transfer_Requesttot="";}// Format for displayif($acct_cat=="rev"){// reverse sign for revenues$spent_py3=-($spent_py3);$spent_py2=-($spent_py2);$spent_py1=-($spent_py1);$request_cy=-($request_cy);$spent_cy=-($spent_cy);$available=-($available);$inc_cy=-($inc_cy);$oper_rev_py3+=$spent_py3;$oper_rev_py2+=$spent_py2;$oper_rev_py1+=$spent_py1;$oper_rev_request_cy+=$request_cy;$oper_rev_spent_cy+=$spent_cy;$oper_rev_available+=$available;$oper_rev_inc_cy+=$inc_cy;}if($acct_cat=="fun"){// reverse sign for funding$spent_py3=-($spent_py3);$spent_py2=-($spent_py2);$spent_py1=-($spent_py1);$request_cy=-($request_cy);$spent_cy=-($spent_cy);$available=-($available);$inc_cy=-($inc_cy);$oper_fun_py3+=$spent_py3;$oper_fun_py2+=$spent_py2;$oper_fun_py1+=$spent_py1;$oper_fun_request_cy+=$request_cy;$oper_fun_spent_cy+=$spent_cy;$oper_fun_available+=$available;$oper_fun_inc_cy+=$inc_cy;}if($acct_cat=="exp"){$oper_exp_py3+=$spent_py3;$oper_exp_py2+=$spent_py2;$oper_exp_py1+=$spent_py1;$oper_exp_request_cy+=$request_cy;$oper_exp_spent_cy+=$spent_cy;$oper_exp_available+=$available;$oper_exp_inc_cy+=$inc_cy;}$spent_py3F=number_format($spent_py3,2);$spent_py2F=number_format($spent_py2,2);$spent_py1F=number_format($spent_py1,2);//$ware_py1F=number_format($ware_py1,2);//$total_spent_py1F=number_format($total_spent_py1,2);$inc_cyF=number_format($inc_cy,2);if($inc_cy_perc==0){$inc_cy_percF="-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";}else{$countPerCent++;$inc_cy_percF=number_format($inc_cy_perc,0)."%";}$request_cyF=number_format($request_cy,2);$spent_cyF=number_format($spent_cy,2);$ware_cyF=number_format($ware_cy,2);$total_spent_cyF=number_format($total_spent_cy,2);/*if($available<0){$availableF="<font color='red'>".number_format($available,2)."</font>";$descF="<font color='red'>".$description."</font>";}else{*/$availableF=number_format($available,2);$descF=$description;//}$projected_excess_shortageF=number_format($projected_excess_shortage,2);$Budget_Transfer_RequestF=number_format($Budget_Transfer_Request,2);if($rep==""){$linkpy1="<a href='portal_ven_pay.php?dbTable=exp_rev&acct=$ncasnum&center=$center&f_year=$py1' target='_blank'>$spent_py1F</a>";}else{$linkpy1=$spent_py1F;}if($rep==""){$linkcy="<a href='portal_ven_pay.php?dbTable=exp_rev&acct=$ncasnum&center=$center&f_year=$cy' target='_blank'>$spent_cyF</a>";}else{$linkcy=$spent_cyF;}if($rep==""){$linkIncDec="<a href='inc_dec.php?dbTable=inc_dec&center=$center&ncas_acct=$ncasnum&link_inc_dec=1&ly=$total_spent_py1&desc=$description&px=$parkcode' target='_blank'>$inc_cyF</a>";}else{$linkIncDec=$inc_cyF;}echo "<tr><td align='center'>$track_rcc</td><td align='center'>$acct_cat</td><td align='right'>$ncasnum</td><td align='right'>$descF</td>";/*<td align='right'>$section</td><td align='center'>$dist</td>*/echo "<td align='center'>$parkcode</td><td align='right'>$center</td><td align='right'>$spent_py3F</td><td align='right'>$spent_py2F</td><td align='right'>$linkpy1</td><td align='right'>$linkIncDec</td><td align='right'>$inc_cy_percF</td><td align='right'>$request_cyF</td><td align='right'>$linkcy</td><td align='right'>$availableF</td><td align='right'>$projected_excess_shortageF</td><td align='right'>$Budget_Transfer_RequestF</td><td align='right'>$justification</td></tr>";// Track SubTotals// $subx is used to hold value for last subTotal$subspent_py3tot=$subspent_py3tot+$spent_py3;$sub1=number_format($subspent_py3tot,2);$subspent_py2tot=$subspent_py2tot+$spent_py2;$sub2=number_format($subspent_py2tot,2);$subspent_py1tot=$subspent_py1tot+$spent_py1;$sub3=number_format($subspent_py1tot,2);$subware_py1tot=$subware_py1tot+$ware_py1;$sub4=number_format($subware_py1tot,2);$subinc_dectot=$subinc_dectot+$inc_cy;$sub6=number_format($subinc_dectot,2);//$subinc_cy_perctot=$subinc_cy_perctot+$inc_cy_perc;//$sub6a=number_format($subinc_cy_perctot,2);$subrequest_cytot=$subrequest_cytot+$request_cy;$sub7=number_format($subrequest_cytot,2);$subspent_cytot=$subspent_cytot+$spent_cy;$sub8=number_format($subspent_cytot,2);$subRemainingtot=$subRemainingtot+$available;$sub11=number_format($subRemainingtot,2);$subProjExcessShortagetot=$subProjExcessShortagetot+$projected_excess_shortage;$sub12=number_format($subProjExcessShortagetot,2);$subBudget_Transfer_Requesttot=$subBudget_Transfer_Requesttot+$Budget_Transfer_Request;$sub13=number_format($subBudget_Transfer_Requesttot,2);$check=$$checkField;	}// end while// Format and Display Totals$spent_py3totF=number_format($spent_py3tot,2);$spent_py2totF=number_format($spent_py2tot,2);$spent_py1totF=number_format($spent_py1tot,2);$ware_py1totF=number_format($ware_py1tot,2);$total_spent_py1totF=number_format($total_spent_py1tot,2);$inc_cytotF=number_format($inc_cytot,2);//$inc_cy_perctotF=number_format($inc_cy_perctot,2);$request_cytotF=number_format($request_cytot,2);$spent_cytotF=number_format($spent_cytot,2);$ware_cytotF=number_format($ware_cytot,2);$total_spent_cytotF=number_format($total_spent_cytot,2);$availabletotF=number_format($availabletot,2);$projected_excess_shortageTotF=number_format($projected_excess_shortageTot,2);$Budget_Transfer_RequestTotF=number_format($Budget_Transfer_RequestTot,2);/*// Print Final SubTotalsecho "<tr><td align='right' colspan='7'><b>$sub1</td><td align='right'><b>$sub2</b></td><td align='right'><b>$sub3</b></td><td align='right'><b>$sub6</b></td><td align='right'><b>$sub6a</b></td><td align='right'><b>$sub7</b></td><td align='right'><b>$sub8</b></td><td align='right'><b>$sub11</b></td><td align='right'><b>$sub12</b></td><td align='right'><b>$sub13</b></td></tr>";*/// Print Grand Totals//if($_SESSION[budget][level]>2){$addText="<br>Addition of displayed subtotals: ";$subspent_py3grandF=number_format($subspent_py3grand+$subspent_py3tot,2);$subspent_py2grandF=number_format($subspent_py2grand+$subspent_py2tot,2);$subspent_py1grandF=number_format($subspent_py1grand+$subspent_py1tot,2);$subware_py1grandF=number_format($subware_py1grand+$subware_py1tot,2);$subnonware_incdecgrandF=number_format($subnonware_incdecgrand+$subnonware_incdectot,2);$subinc_decgrandF=number_format($subinc_decgrand+$subinc_dectot,2);//$subinc_cy_percgrandF=number_format($subinc_cy_percgrand+$subinc_cy_perctot,2);$subrequest_cygrandF=number_format($subrequest_cygrand+$subrequest_cytot,2);$subspent_cygrandF=number_format($subspent_cygrand+$subspent_cytot,2);$subware_cygrandF=number_format($subware_cygrand+$subware_cytot,2);$subtotal_spent_cygrandF=number_format($subtotal_spent_cygrand+$subtotal_spent_cy,2);$subrequest_cygrandF=number_format($subrequest_cygrand+$subrequest_cytot,2);$subRemaininggrandF=number_format($subRemaininggrand+$subRemainingtot,2);$subProjExcessShortagegrandF=number_format($subProjExcessShortagegrand+$subProjExcessShortagetot,2);$subRemaininggrandF=number_format($subRemaininggrand+$subRemainingtot,2);$subBudget_Transfer_RequestgrandF=number_format($subBudget_Transfer_Requestgrand+$subBudget_Transfer_Requesttot,2);//}echo "<tr><td align='right' colspan='7'><font color='purple'><b>Selected Accounts Total</b></font>: <b>$subspent_py3grandF</b></td><td align='right'><b>$subspent_py2grandF</b></td><td align='right'><b>$subspent_py1grandF</b></td><td align='right'><b>$subinc_decgrandF</b></td><td align='right'><b>$subinc_cy_percgrandF</b></td><td align='right'><b>$subrequest_cygrandF</b></td><td align='right'><b>$subspent_cygrandF</b></td><td align='right'><b>$subRemaininggrandF</b></td><td align='right'><b>$subProjExcessShortagegrandF</b></td><td align='right'><b>$subProjExcessShortagegrandF</b></td></tr>";$net_fund_py3=($oper_rev_py3+$oper_fun_py3-$oper_exp_py3);$net_fund_py2=($oper_rev_py2+$oper_fun_py2-$oper_exp_py2);$net_fund_py1=($oper_rev_py1+$oper_fun_py1-$oper_exp_py1);$net_oper_rev=($oper_rev_request_cy+$oper_fun_request_cy-$oper_exp_request_cy);$net_oper_rev_spent=($oper_rev_spent_cy+$oper_fun_spent_cy-$oper_exp_spent_cy);$net_oper_rev_avail=($oper_rev_available+$oper_fun_available-$oper_exp_available);$net_oper_inc_cy=($oper_rev_inc_cy+$oper_fun_inc_cy-$oper_exp_inc_cy);$app_py3=number_format(-($net_fund_py3),2);$app_py2=number_format(-($net_fund_py2),2);$app_py1=number_format(-($net_fund_py1),2);$app_oper_rev=number_format(-($net_oper_rev),2);$app_oper_rev_spent=number_format(-($net_oper_rev_spent),2);$app_oper_rev_avail=number_format(-($net_oper_rev_avail),2);$app_oper_inc_cy=number_format(-($net_oper_inc_cy),2);$oper_rev_py3=number_format($oper_rev_py3,2);$oper_rev_py2=number_format($oper_rev_py2,2);$oper_rev_py1=number_format($oper_rev_py1,2);$oper_rev_request_cy=number_format($oper_rev_request_cy,2);$oper_rev_spent_cy=number_format($oper_rev_spent_cy,2);$oper_rev_available=number_format($oper_rev_available,2);$oper_fun_py3=number_format($oper_fun_py3,2);$oper_fun_py2=number_format($oper_fun_py2,2);$oper_fun_py1=number_format($oper_fun_py1,2);$oper_fun_request_cy=number_format($oper_fun_request_cy,2);$oper_fun_spent_cy=number_format($oper_fun_spent_cy,2);$oper_fun_available=number_format($oper_fun_available,2);$oper_exp_py3=number_format($oper_exp_py3,2);$oper_exp_py2=number_format($oper_exp_py2,2);$oper_exp_py1=number_format($oper_exp_py1,2);$oper_exp_request_cy=number_format($oper_exp_request_cy,2);$oper_exp_spent_cy=number_format($oper_exp_spent_cy,2);$oper_exp_available=number_format($oper_exp_available,2);$net_fund_py3=number_format($net_fund_py3,2);$net_fund_py2=number_format($net_fund_py2,2);$net_fund_py1=number_format($net_fund_py1,2);$net_oper_rev=number_format($net_oper_rev,2);$net_oper_rev_spent=number_format($net_oper_rev_spent,2);$net_oper_rev_avail=number_format($net_oper_rev_avail,2);$oper_rev_inc_cy=number_format($oper_rev_inc_cy,2);$oper_fun_inc_cy=number_format($oper_fun_inc_cy,2);$oper_exp_inc_cy=number_format($oper_exp_inc_cy,2);$net_oper_inc_cy=number_format($net_oper_inc_cy,2);// Revenuesecho "<tr><td colspan='17' align='center'>&nbsp;<br><font color='blue'><b>Center Totals - All Accounts</b></font></td></tr><tr><td colspan='6' align='right'><b>operational revenues</b></td><td align='right'>$oper_rev_py3</td><td align='right'>$oper_rev_py2</td><td align='right'>$oper_rev_py1</td><td align='right'>$oper_rev_inc_cy</td><td></td><td align='right'>$oper_rev_request_cy</td><td align='right'>$oper_rev_spent_cy</td><td align='right'>$oper_rev_available</td></tr>";// Fundingecho "<tr><td colspan='6' align='right'><b>funding revenues</b></td><td align='right'>$oper_fun_py3</td><td align='right'>$oper_fun_py2</td><td align='right'>$oper_fun_py1</td><td align='right'>$oper_fun_inc_cy</td><td></td><td align='right'>$oper_fun_request_cy</td><td align='right'>$oper_fun_spent_cy</td><td align='right'>$oper_fun_available</td></tr>";// Expensesecho "<tr><td colspan='6' align='right'><b>expenses (direct & warehouse)</b></td><td align='right'>$oper_exp_py3</td><td align='right'>$oper_exp_py2</td><td align='right'>$oper_exp_py1</td><td align='right'>$oper_exp_inc_cy</td><td></td><td align='right'>$oper_exp_request_cy</td><td align='right'>$oper_exp_spent_cy</td><td align='right'>$oper_exp_available</td></tr>";if($net_fund_py3<0){$f31="<font color='red'>";$f32="</font>";}else{$f31="";$f32="";}if($net_fund_py2<0){$f21="<font color='red'>";$f22="</font>";}else{$f21="";$f22="";}if($net_fund_py1<0){$f11="<font color='red'>";$f12="</font>";}else{$f11="";$f12="";}if($net_oper_inc_cy<0){$fi1="<font color='red'>";$fi2="</font>";}else{$fi1="";$fi2="";}if($net_oper_rev<0){$fr1="<font color='red'>";$fr2="</font>";}else{$fr1="";$fr2="";}if($net_oper_rev_spent<0){$fs1="<font color='red'>";$fs2="</font>";}else{$fs1="";$fs2="";}if($net_oper_rev_avail<0){$fa1="<font color='red'>";$fa2="</font>";}else{$fa1="";$fa2="";}// Netecho "<tr><td colspan='6' align='right'><b>Net Funds</b></td><td align='right'>$f31$net_fund_py3$f32</td><td align='right'>$f21$net_fund_py2$f22</td><td align='right'>$f11$net_fund_py1$f12</td><td align='right'>$fi1$net_oper_inc_cy$fi2</td><td></td><td align='right'>$fr1$net_oper_rev$fr2</td><td align='right'>$fs1$net_oper_rev_spent$fs2</td><td align='right'>$fa1$net_oper_rev_avail$fa2</td></tr>";// Appropriatedecho "<tr><td colspan='6' align='right'><b>Appropriated Funds</b></td><td align='right'>$app_py3</td><td align='right'>$app_py2</td><td align='right'>$app_py1</td><td align='right'>$app_oper_inc_cy</td><td></td><td align='right'>$app_oper_rev</td><td align='right'>$app_oper_rev_spent</td><td align='right'>$app_oper_rev_avail</td></tr>";echo "<tr>$header</tr>";echo "</table></body></html>";?>