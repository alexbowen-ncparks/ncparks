<?phpinclude("menu.php");//echo "<pre>";print_r($_REQUEST);echo "</pre>";//exit;$join1="LEFT JOIN coa ON coa.ncasnum = exp_rev.acct";$join2="LEFT JOIN center ON center.center = exp_rev.center";//$join3="LEFT JOIN inc_dec ON center.center = inc_dec.center AND inc_dec.ncas_acct = exp_rev.acct";$where="WHERE 1";if($_SESSION[budget][level]==1){$center=$_SESSION[budget][center];$where.=" AND exp_rev.center =  '$center'";}$where.=" AND ( acctLIKE  '531%' OR acctLIKE  '532%' OR acctLIKE  '533%' OR acctLIKE  '534%' OR acctLIKE  '535%' )";if($rccYN=="Y"){$where.=" AND exp_rev.fund =  '1280'";}if($rccYN=="N"){$where.=" AND exp_rev.fund =  '1280'";}if($groupAcct){$g="GROUP  BY section,center.center, acct";}else{$g="GROUP  BY section,center.center";}//echo "w=$where";if(!$submit){exit;};// ******** Get Amount expense in Year 1$fromSQL1="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where1=$where." and f_year='$fy1'";$sql1 = "SELECT $fromSQL1 $join1 $join2 $join3 $where1 $g";$result1 = mysqli_query($connection, $sql1) or die ("Couldn't execute query 1. $sql1");$num=mysqli_num_rows($result1);while ($row1=mysqli_fetch_array($result1)){extract($row1);$conKey=$section.$acct.$center;$expense_1_array[$conKey]=$total;}//echo "$sql1<br>";exit;//echo "$sql1<pre>";print_r($expense_1_array);echo "</pre>";exit;// ******** Get Amount expense in Year 2$fromSQL2="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where2=$where." and f_year='$fy2'";$sql2 = "SELECT $fromSQL2 $join1 $join2 $join3 $where2 $g";$result2 = mysqli_query($connection, $sql2) or die ("Couldn't execute query 2. $sql2");$num=mysqli_num_rows($result2);while ($row2=mysqli_fetch_array($result2)){extract($row2);$conKey=$section.$acct.$center;$expense_2_array[$conKey]=$total;}//echo "$sq2<pre>";print_r($expense_2_array);echo "</pre>";exit;// ******** Get Amount expense in Year 3// For test purposes$fromSQL3="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where3=$where." and f_year='$fy3'";$sql3 = "SELECT $fromSQL3 $join1 $join2 $join3 $where3 $g";$result3 = mysqli_query($connection, $sql3) or die ("Couldn't execute query 3. $sql3");$num=mysqli_num_rows($result3);while ($row3=mysqli_fetch_array($result3)){extract($row3);$conKey=$section.$acct.$center;//array_unshift($row3, $conKey);//$expense_3_array[]=$row3;$expense_3_array[$conKey]=$total;}//echo "$sql3<pre>";print_r($expense_3_array);echo "</pre>";exit;// ******** Get Amount expense in Year 4// For test purposes$fromSQL4="section,exp_rev.acct,exp_rev.center,sum( credit )  - sum( debit )  AS total FROM exp_rev";$where4=$where." and f_year='$fy4'";$sql4 = "SELECT $fromSQL4 $join1 $join2 $join3 $where4 $g";$result4 = mysqli_query($connection, $sql4) or die ("Couldn't execute query 4. $sql4");$num=mysqli_num_rows($result4);while ($row4=mysqli_fetch_array($result4)){extract($row4);$conKey=$section.$acct.$center;//array_unshift($row4, $conKey);//$expense_4_array[]=$row4;$expense_4_array[$conKey]=$total;}//echo "$sql4<pre>";print_r($expense_4_array);echo "</pre>";exit;// ********** This set variables AND displays the result **********$fromSQL5="CONCAT(section,exp_rev.acct,center.center) AS sacKey,section,parkcode, center.center, exp_rev.acct, coa.park_acct_desc FROM exp_rev";$where5=$where;$sql5 = "SELECT $fromSQL5 $join1 $join2 $join3 $where5 $g ORDER BY section,parkcode, acct";$result5 = mysqli_query($connection, $sql5) or die ("Couldn't execute query 5. $sql5");$num5=mysqli_num_rows($result5);while ($row5=mysqli_fetch_array($result5)){//extract($row5);$array5[]=$row5;}//echo "$sql5";//exit;$sql="SELECT max( acctdate ) as maxDate FROM  `exp_rev` WHERE 1 ";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query . $sql");$row=mysqli_fetch_array($result);extract($row);if($groupAcct){$a=" Account";}echo "<font color='green'>$num $z </font>Summaries for [Center$a] Expenses including Purchase For Resale and Equipment.<hr>";// Make Header	$colHeaders=array("Section","Center<br>Name","center","NCAS #","Description","expense<br>$fy1","expense<br>$fy2","expense<br>$fy3","YTD<br>$maxDate");$reportFlds=array("parkcode","center","acct","park_acct_desc","expense_1","expense_2","expense_3","expense_4",);portalHeader($passSQL,$colHeaders);for($u=0;$u<count($array5);$u++){list($key,$section,$parkcode,$center,$acct, $park_acct_desc)=$array5[$u];$ck[]=$center;$now=$ck[$u];$uu=$u-1;$prev=$ck[$uu];$expense1=$expense_1_array[$key];$expense2=$expense_2_array[$key];$expense3=$expense_3_array[$key];$expense4=$expense_4_array[$key];$expense1Form=number_format($expense1,2);$expense2Form=number_format($expense2,2);$expense3Form=number_format($expense3,2);$expense4Form=number_format($expense4,2);//if($reportLevel>1 and $prev and ($now!=$prev)){if($prev and ($now!=$prev) and $groupAcct){echo "<tr><td></td><td></td><td></td><td></td><td align='right'>SubTotal:</td><td align='right'><b>$tot1Form</b></td><td align='right'><b>$tot2Form</b></td><td align='right'><b>$tot3Form</b></td><td align='right'><b>$tot4Form</b></td></tr>";$tot1="";$tot2="";$tot3="";$tot4="";}$tot1=$expense1+$tot1;$tot2=$expense2+$tot2;$tot3=$expense3+$tot3;$tot4=$expense4+$tot4;$tot1Form=number_format($tot1,2);$tot2Form=number_format($tot2,2);$tot3Form=number_format($tot3,2);$tot4Form=number_format($tot4,2);//$req_amt=$expense3+$park_req;$tot_expense1=$tot_expense1+$expense1;$tot_expense2=$tot_expense2+$expense2;$tot_expense3=$tot_expense3+$expense3;$tot_expense4=$tot_expense4+$expense4;//$tot_park_req=$tot_park_req+$park_req;//$tot_req_amt=$tot_req_amt+$req_amt;//$req_amt=number_format($req_amt,2);//$park_req=number_format($park_req,2);//$link1="dbTable=inc_dec&center=$center&ncas_acct=$acct&addRecord=Add+a+Record&ly=$expense2&desc=$park_acct_desc&fy_req=$fy3&lastFld=inc_decid&var=$inc_decid";$rcc=substr($center,4,4);//$varURL1="<a href='/budget/a/inc_dec.php?$link1'>$park_req</a>";//$link2="dbTable=vendor_payments&account=$acct&rcc=$rcc&like[12]=Range&datenew=20040701*20050630&passAmt=$expense3";//$varURL2="<a href='/budget/a/portal_ven_pay.php?$link2' target='_blank'>vp</a>";//$link3="dbTable=exp_rev&acct=$acct&center=$center&f_year=0405";//$varURL3="<a href='/budget/a/portal_ven_pay.php?$link3' target='_blank'>re</a>";if($groupAcct){}else{$acct="";$park_acct_desc="";}echo "<tr><td>$section</td><td>$parkcode</td><td>$center</td><td>$acct</td> <td>$park_acct_desc</td> <td align='right'>$expense1Form</td><td align='right'>$expense2Form</td><td align='right'>$expense3Form $varURL2 $varURL3</td><td align='right'>$expense4Form</td></tr>";}$tot_expense1=number_format($tot_expense1,2);$tot_expense2=number_format($tot_expense2,2);$tot_expense3=number_format($tot_expense3,2);$tot_expense4=number_format($tot_expense4,2);//$tot_park_req=number_format($tot_park_req,2);//$tot_req_amt=number_format($tot_req_amt,2);echo "<tr><td></td><td></td><td></td><td></td><td align='right'>Totals:</td><td align='right'>$tot_expense1</td><td align='right'>$tot_expense2</td><td align='right'>$tot_expense3</td><td align='right'>$tot_expense4</td></tr>";echo "</table></body></html>";// *************** PMIS FUNCTIONS **************function portalHeader($passSQL,$colHeaders){global $numOfColumns;$fld=explode(",",$colHeaders);// Put Field Names in an Array$c=count($fld)-1;$lastFld=$fld[$c];$numOfColumns=count($colHeaders);echo "<table border='1' cellpadding='3'><tr>";for($x=0;$x<$numOfColumns;$x++){$var=strtoupper($colHeaders[$x]);echo "<th>$var</th>";}echo "</tr>";}function itemShow($key,$val){//echo "$key[$ff]  $val[$ff]<br>";}// end Function?>