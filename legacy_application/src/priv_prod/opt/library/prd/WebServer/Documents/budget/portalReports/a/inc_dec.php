<?php//These are placed outside of the webserver directory for security//include("../../include/authEEID.inc"); // used to authenticate usersinclude("../../../include/connectBUDGET.inc");// database connection parametersinclude("../menu.php");?><script language='JavaScript'>function confirmLink(){ bConfirm=confirm('Are you sure you want to delete this record?') return (bConfirm);}</script><?php//echo "<pre>";print_r($_REQUEST);echo "</pre>";exit;//print_r($_SERVER);exit;//$k=urldecode($_SERVER[QUERY_STRING]);extract($_REQUEST);//********** SET Variables **********if(!$dbTable){$dbTable="inc_dec";}// FIELD NAMES are stored in $fieldArray// FIELD TYPES and SIZES are stored in $fieldType$sql = "SHOW COLUMNS FROM $dbTable";//echo "$sql";$result = mysqli_query($connection, $sql) or die ("Couldn't execute query. $sql");$numFlds=mysqli_num_rows($result);while ($row=mysqli_fetch_assoc($result)){extract($row);$fieldArray[]=$row[Field];$fieldType[]=$row[Type];}$recordIDfld=$fieldArray[$numFlds-1];makeUpdateFields($fieldArray);// MAKE FIELD=VALUE FOR ADD/UPDATEfor($dk=0;$dk<count($fieldType);$dk++){$varD=substr($fieldType[$dk],0,7);if($varD=="decimal"){$fieldDecimal[]=$dk;}if($varD=="varchar"){$size=substr(substr($fieldType[$dk],8,7),0,-1);if($size>30){$size=30;}$fieldSize[]=$size;}else{$fieldSize[]=12;}}//print_r($fieldSize);//exit;// Find number fieldsfor($dk=0;$dk<count($fieldDecimal);$dk++){$t=$fieldDecimal[$dk];$varE[$fieldArray[$t]]=$fieldDecimal[$dk];}//print_r($varE);//exit;  //$varE = Any field(s) defined as Decimal //**** Process any Delete ******if($deleteRecord=="Delete"){//print_r($_REQUEST);exit;$query = "DELETE FROM $dbTable where $recordIDfld='$deleteRecordID'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Delete. $query");header("Location: /budget/portalReport.php?dbReport=Center&center=$center&submit=Submit&rccYN=Y");exit;} //**** Process any Update or Add ******if($submit=="Update"){//print_r($_REQUEST);//exit;$v=${$lastFld};$arr1=explode(",",$updateFields);for($j=0;$j<count($arr1);$j++){$arr2=explode("=",$arr1[$j]);$arr3[]=$arr2[0];}for($j=0;$j<count($arr1);$j++){$val1=$_REQUEST[$arr3[$j]];if($plusMinus=="dec" and $arr3[$j]=="park_req"){$val1=-$val1;}$newQuery[$arr3[$j]]=$val1;}$arrKeys=array_keys($newQuery);$queryString=$arrKeys[0]."='".$newQuery[$arrKeys[0]]."'";for($j=1;$j<count($arrKeys);$j++){$queryString.=", ".$arrKeys[$j]."='".$newQuery[$arrKeys[$j]]."'";}//echo "<pre>";print_r($arrKeys);print_r($newQuery);echo "</pre>$queryString<br>";//print_r($newQuery);exit;$query = "Update $dbTable set $queryStringwhere $lastFld='$v'";//echo "$query";exit;$result = mysqli_query($connection, $query) or die ("Couldn't execute query Update. $query");header("Location: /budget/portalReport.php?dbReport=Center&submit=Submit&rccYN=Y");exit;}//**** Process any Add ******if($submit=="Add"){$arr1=explode(",",$updateFields);for($j=0;$j<count($arr1);$j++){$arr2=explode("=",$arr1[$j]);$arr3[]=$arr2[0];}for($j=0;$j<count($arr1);$j++){$val1=$_REQUEST[$arr3[$j]];$newQuery[$arr3[$j]]=$val1;}$arrKeys=array_keys($newQuery);$queryString=$arrKeys[0]."='".$newQuery[$arrKeys[0]]."'";for($j=1;$j<count($arrKeys);$j++){$queryString.=", ".$arrKeys[$j]."='".$newQuery[$arrKeys[$j]]."'";}//echo "<pre>";print_r($arrKeys);print_r($newQuery);echo "</pre>$queryString<br>";//print_r($newQuery);exit;$query = "INSERT INTO $dbTable set $queryString";$result = mysqli_query($connection, $query) or die ("Couldn't execute query Update. $query");$v=mysql_insert_id();header("Location: /budget/portalReport.php?dbReport=Center&submit=Submit&rccYN=Y");exit;}//**** Prepare To Find, Update OR Delete******if($lastFld and $var){//print_r($_REQUEST);exit;$formType="Update";$passSQLedit=urlencode($passSQL);$file=$_SERVER['PHP_SELF'];//$file="inc_dec.php";$addDeleteButton="<td><form action=\"$file\" method=\"post\"><input type='hidden' name='passSQL' value='$passSQLedit'><input type='hidden' name='$recordIDfld' value='$lastFld'><input type='hidden' name='$delTable' value='inc_dec'><input type='hidden' name='deleteRecordID' value='$var'><input type='hidden' name='center' value='$center'><input type='submit' name='deleteRecord' value='Delete' onClick='return confirmLink()'></form></td>";$sql0 = "SELECT * from $dbTable where $lastFld='$var'";$result = mysqli_query($connection, $sql0) or die ("Couldn't execute query 0. $sql0");$row=mysqli_fetch_array($result);extract($row);}else{if($addRecord=="Add a Record"){$formType="Add";}if($addRecord==""){$formType="Find";$addAddButton="<td><input type='hidden' name='dbTable' value='$dbTable'><input type='hidden' name='recordIDfld' value='$recordIDfld'><input type='submit' name='addRecord' value='Add a Record'></form></td>";}}//if($cat1_4){$catCheck="checked";}$newCKBX=array_unique($ckbx);sort($newCKBX);//print_r($newCKBX);//EXIT;$caseField1=$newCKBX[0];$caseField2=$newCKBX[1];$caseField3=$newCKBX[2];function pullDown($m){}// Used \" instead of ' because of lastname or vendor name containing 'echo "<form action=\"/budget/a/inc_dec.php\" method=\"post\">";//echo "<form action=\"/budget/a/inc_dec.php\"";// Used to debugecho "<table><tr><td colspan='3'>Use this form to enter either an INCREASE or DECREASE<br>of last year's budget of <b>$ly for $desc.</b></td></tr>";// center, acct, fy_reqecho "<tr><td>$fieldArray[0]: <font color='blue'>${$fieldArray[0]}</font></td><td>$fieldArray[1]: <font color='blue'>${$fieldArray[1]}</font></td><td>$fieldArray[2]: <font color='blue'>${$fieldArray[2]}</font></td></tr>";echo "<tr><td colspan='3'>Enter Amount: <input type=\"text\" name=\"$fieldArray[3]\" size=\"$fieldSize[3]\" value=\"${$fieldArray[3]}\"><input type='radio' name='plusMinus' value='inc'>Increase <input type='radio' name='plusMinus' value='dec'>Decrease</td><td>(Don't enter $ sign or commas, e.g., 1000 not $1,000)</td></tr></table>";echo "<table><tr><td>Enter Justification: <textarea name=\"$fieldArray[4]\" cols=\"80\" rows\"5\">${$fieldArray[4]}</textarea></td></tr>";if($_SESSION[budget][level] == "4"){echo "<tr>";for($i=4;$i<7;$i++){echo "<td>$fieldArray[$i]:  "; pullDown($i); echo "<input type=\"text\" name=\"$fieldArray[$i]\" size=\"$fieldSize[$i]\" value=\"${$fieldArray[$i]}\"></td>";}echo "</tr>";// companyecho "<tr>";for($i=7;$i<10;$i++){echo "<td>$fieldArray[$i]:  "; pullDown($i); echo "<input type=\"text\" name=\"$fieldArray[$i]\" size=\"$fieldSize[$i]\" value=\"${$fieldArray[$i]}\"></td>";}echo "</tr><tr>";// amt$j=1;for($i=10;$i<23;$i++){if($fieldArray[$i]){$f=fmod($j,4);if($f==0){$tagB="<tr><td>";$tagE="</td></tr>";$j++;}else{$tagB="<td>";$tagE="</td>";$j++;}echo "$tagB $fieldArray[$i]:  "; pullDown($i); echo "<input type=\"text\" name=\"$fieldArray[$i]\" size=\"$fieldSize[$i]\" value=\"${$fieldArray[$i]}\">$tagE";}}echo "</table>";}// end if accessLevel=4echo "<table><tr><td><input type='hidden' name='dbTable' value='$dbTable'><input type='hidden' name='lastFld' value='$lastFld'><input type='hidden' name='inc_decid' value='$var'><input type='hidden' name='difFile' value='portalReport.php'><input type='hidden' name='$fieldArray[0]' value='${$fieldArray[0]}'><input type='hidden' name='$fieldArray[1]' value='${$fieldArray[1]}'><input type='hidden' name='$fieldArray[2]' value='${$fieldArray[2]}'><input type='submit' name='submit' value='$formType'></form>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$addAddButton&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$addDeleteButton</tr></table>";// **************  FUNCTIONS *******************function makeGroupBy1($radio1,$caseField1,$caseField2,$caseField3,$va3,$va2,$va1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $va1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $va2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $va3>$caseField3</td>";}echo "<td><input type='checkbox' name='sumBy' value='1'>Sum By</td>";}function makeGroupBy2($radio1,$caseField1,$caseField2,$caseField3,$vb3,$vb2,$vb1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $vb1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $vb2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $vb3>$caseField3</td>";}}function makeGroupBy3($radio1,$caseField1,$caseField2,$caseField3,$vc3,$vc2,$vc1,$ckbx) {$z=count($ckbx);if($z>0){echo "<td><input type='radio' name='$radio1' value='$caseField1' $vc1>$caseField1</td>";}if($z>1){echo "<td><input type='radio' name='$radio1' value='$caseField2' $vc2>$caseField2</td>";}if($z>2){echo "<td><input type='radio' name='$radio1' value='$caseField3' $vc3>$caseField3</td>";}}function makeUpdateFields($fieldArray){global $updateFields;for($i=0;$i<count($fieldArray);$i++){if($i!=0){$updateFields.=",".$fieldArray[$i]."=$".$fieldArray[$i];}else{$updateFields.=$fieldArray[$i]."=$".$fieldArray[$i];}}// end for}// end makeUpdateFields?>