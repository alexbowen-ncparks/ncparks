<?phpextract($_REQUEST);session_start();//print_r($_SESSION);$level=$_SESSION[budget][level];//echo "<pre>";print_r($_REQUEST);echo "</pre>";//EXIT;// Construct Query to be passed to Excel Export$fileName="projNumEdit.php";reset($_REQUEST);$varQuery="rep=excel";foreach($_REQUEST as $key => $value){if($value){$varQuery.="&$key=$value";}if($value=="Find"){break;}}if($Submit=="Update"){$database="budget";$db="budget";include("/opt/library/prd/WebServer/include/iConnect.inc"); // connection parametersmysqli_select_db($connection, $database); // databasereset($xtidArray);foreach($xtidArray as $key => $value){$vendorNameSlashed=addslashes($vendornameArray[$value]);$query = "update partf_paymentsset proj_num='$proj_numArray[$value]', purch_descr_input='$purchase_descriptionArray[$value]', contract_num='$contract_numArray[$value]',contract_amt='$contract_amtArray[$value]',charg_proj_num='$charg_proj_numArray[$value]',pcard_vendor='$pcard_vendorArray[$value]',pcard_num='$pcard_numArray[$value]',pcard_name='$pcard_nameArray[$value]',record_complete='$record_completeArray[$value]',vendorname='$vendorNameSlashed'WHERE xtid='$xtidArray[$value]'";//echo "$query";exit;    $result = @mysqli_query($connection, $query,$connection);}$loc="a=1";header("Location: projNumEdit.php?whereSQL=$whereSQL");exit;}// end Update//echo "<pre>";print_r($_REQUEST);echo "</pre>";EXIT;if($rep!="excel"){include("projNumEditMenu.php");}else{include("../../include/connectBUDGET.inc");// database connection}//echo "<pre>";print_r($_REQUEST);echo "</pre>";EXIT;if($xtid!="" || $amount!="" || $invoice!="" || $vendornum!="" || $proj_num!="" || $vendorname!="" || $center!="" || $whereSQL!="" || $park!="" || $daterange!="" || $record_complete!="") {$where="WHERE 1"; if($amount){$amount=str_replace(",","",$amount);$where.=" and amount='$amount'";$for="Amount = $amount";$q1="<input type='hidden' name='amountVar' value='$amount'>";}if($invoice){$where.=" and invoice='$invoice'";$for.=" Invoice = $invoice";$q2="<input type='hidden' name='invoiceVar' value='$invoice'>";}if($vendornum){$where.=" and vendornum='$vendornum'";$for.=" Vendor Number = $vendornum";$q3="<input type='hidden' name='vendornumVar' value='$vendornum'>";}if($proj_num){$where.=" and proj_num='$proj_num'";$for.=" Proj. Num. = $proj_num";$q4="<input type='hidden' name='proj_numVar' value='$proj_num'>";}if($vendorname){$where.=" and vendorname LIKE '%$vendorname%'";$for.=" Vendor Name like $vendorname";$q6="<input type='hidden' name='vendornameVar' value='$vendorname'>";}if($center){$where.=" and partf_payments.center = '$center'";$for.=" Center = $center";$q7="<input type='hidden' name='centerVar' value=''>";}if($xtid){$where.=" and partf_payments.xtid = '$xtid'";$for.=" Xtid = $xtid";$q8="<input type='hidden' name='xtidVar' value='$xtid'>";}if($park){$where.=" and partf_projects.park = '$park'";$for.=" Parkcode = $park";$q9="<input type='hidden' name='parkVar' value='$park'>";}if($daterange){$dr=explode("*",$daterange);$where.=" and (partf_payments.datenew >= '$dr[0]' and partf_payments.datenew <= '$dr[1]')";$for.=" Date Range = $dr[0] to $dr[1]";$q10="<input type='hidden' name='daterangeVar' value='$daterange'>";}if($record_complete){$where.=" and partf_payments.record_complete = '$record_complete'";$for.=" Record_complete = $record_complete";$q11="<input type='hidden' name='record_completeVar' value='$record_complete'>";}if($account){$where.=" and partf_payments.account like '$account%'";$for.=" account = $account";$q12="<input type='hidden' name='accountVar' value='$account'>";}if($contract_num){$where.=" and partf_payments.contract_num = '$contract_num'";$for.=" contract_num = $contract_num";$q13="<input type='hidden' name='contract_numVar' value='$contract_num'>";}if($whereSQL){$where=str_replace("*","'",$whereSQL);$a=1;}$sql="select max(datenew) as maxdate from partf_payments"; $result = mysqli_query($connection, $sql,$connection);$row = mysqli_fetch_array($result);extract($row);$sql = "SELECT SQL_CALC_FOUND_ROWS center.centerman AS Fund_Manager, partf_projects.yearfundc AS fund_year, partf_payments.center AS fund_num, center.center_desc AS fund_description, partf_payments.account, coa.park_acct_desc AS acct_description, partf_payments.datenew, partf_payments.invoice, partf_payments.amount, partf_payments.vendorname, partf_payments.pcard_vendor, partf_payments.proj_num, partf_payments.purch_descr_input AS purchase_description,partf_payments.xtid, partf_payments.contract_num, partf_payments.contract_amt, partf_payments.charg_proj_num, partf_payments.pcard_vendor, partf_payments.pcard_num, partf_payments.pcard_name, partf_payments.record_complete, partf_projects.park as parkcodeFROM  `partf_payments`LEFT  JOIN partf_projects ON partf_payments.proj_num = partf_projects.projnumLEFT  JOIN center ON partf_payments.center = center.centerLEFT  JOIN coa ON partf_payments.account = coa.ncasnum$where order by partf_payments.datenew desc"; if($level>4){echo "$sql";}//exit; $result = mysqli_query($connection, $sql,$connection) or die("Error #1 $sql". mysql_errno() . ": " . mysqli_error());// This get total records ignoring the LIMIT $sql1 = "Select FOUND_ROWS()"; $count_result = mysqli_query($connection, $sql1,$connection);$row = mysqli_fetch_array($count_result);$totNum=$row[0];//exit;$num=mysqli_num_rows($result);if($rep=="excel"){header('Content-Type: application/vnd.ms-excel');header('Content-Disposition: attachment; filename=Operating_Expense_Approval.xls');}echo "<table border='1' cellpadding='5'><tr>";if($a==1){$message="<font color='green'>The update was successful.</font>";if($rep!="excel"){echo "<td colspan='2'>Excel <a href='$fileName?$varQuery'>Export</a>";}echo "<td colspan='4'>$message</td>";}else{if($rep!="excel"){echo "<td colspan='2'>Excel <a href='$fileName?$varQuery'>Export</a>";}echo "</td><td colspan='2' align='center'>Last Update = <font color='red'>$maxdate</font></td><td colspan='10'>Displaying  <font color='purple'>$num</font> PARTF payments <font color='blue'>for $for $q1 $q2 $q3 $q4 $q5 $q6 $q7 $q8 $q9 $q10 $q11$q12 $q13</font></td></tr>";}$i=1;while ($row = mysqli_fetch_array($result))		{extract($row);$amt=number_format($amount,2);if($i==1){echo "<form action='projNumEdit.php' method='POST'><tr><th>Park</th><th>Proj<br>Num</th><th>Vendorname</th><th>Invoice</th><th>Amount</th><th>Account</th><th>Acct_description</th><th>Post<br>Date</th><th>Fund<br>Num</th><th>Fund_description</th>";if($level>4){echo "<th>Charg_Proj<br>Num</th><th>Contract<br>Number</th><th>Contract<br>Amount<br><font size=\"-2\">no comma</font></th><th>Record<br>Complete</th>";}echo "</tr>";}echo "<tr><td align='center'>$parkcode</td>";if($level>4 and $rep!=="excel"){echo "<td><input type='text' name='proj_numArray[$xtid]' value='$proj_num' size='6'></td>";}else{echo "<td>$proj_num</td>";}if($level>4 and $rep!=="excel"){echo "<td><textarea name='vendornameArray[$xtid]' cols='20' rows='2'>$vendorname</textarea></td>";}else{echo "<td>$vendorname</td>";}echo "<td>$invoice</td><td align='right'>$amt</td><td>$account</td><td>$acct_description</td>";echo "<td>$datenew</td><td>&nbsp;$fund_num</td><td>$fund_description</td>";if($level>4 and $rep!="excel"){echo "<input type='hidden' name='xtidArray[$xtid]' value='$xtid'><td><input type='text' name='charg_proj_numArray[$xtid]' value='$charg_proj_num' size='11'></td><td><input type='text' name='contract_numArray[$xtid]' value='$contract_num' size='6'></td><td><input type='text' name='contract_amtArray[$xtid]' value='$contract_amt' size='11'></td>";if($record_complete=="y"||$record_complete=="Y"){$ckY="checked";$ckN="";}else{$ckN="checked";$ckY="";}if($rep=="excel"){echo "<td>$record_complete</td>";}else{echo "<td align='right'><font color='green'>Y</font><input type='radio' name='record_completeArray[$xtid]' value='y'$ckY> <font color='red'>N</font><input type='radio' name='record_completeArray[$xtid]' value='n'$ckN></td>";	}echo "</tr>"; }if($level>4 and $rep=="excel"){echo "<td>$charg_proj_num</td><td>$contract_num</td><td>$contract_amt</td><td>$record_complete</td></tr>"; }$i++; $totAmt=$totAmt+$amount; $totcontract_amt+=$contract_amt;  		} // end while$totAmt=number_format($totAmt,2);  echo "<tr><td colspan='5' align='right'>Invoice Amount = $totAmt</td><td colspan='8' align='right'>Contract Amount = $totcontract_amt</td></tr>";	} // end if else{echo "$sql<br>You must enter something to search for.";}if($num>0){$where=str_replace("'","*",$where);echo "<tr><td colspan='20' align='right'><input type='hidden' name='whereSQL' value='$where'><input type='submit' name='Submit' value='Update'></td></tr></table></form>";}echo "</div></body></html>";?>